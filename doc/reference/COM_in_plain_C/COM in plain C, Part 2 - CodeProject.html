<!DOCTYPE html>
<html lang="en" class=" vlpumdlo idc0_348"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">

	

	
	<link rel="preconnect" href="https://apps.developermedia.com/">
	<link rel="preconnect" href="https://cdn1.developermedia.com/">
	<link rel="preconnect" href="https://cdn.ampproject.org/">
	<link rel="preconnect" href="https://fonts.googleapis.com/">
	<link rel="preconnect" href="https://ajax.googleapis.com/">
	<link rel="preconnect" href="https://adservice.google.com/">
	<link rel="preconnect" href="https://www.googletagservices.com/">
	<link rel="preconnect" href="https://www.googletagmanager.com/">
	<link rel="preconnect" href="https://www.google.com/">
	<link rel="preconnect" href="https://www.google-analytics.com/">
	<link rel="preconnect" href="https://pagead2.googlesyndication.com/">

	<link rel="preconnect" href="https://codeproject.freetls.fastly.net/">


	<link rel="preload" href="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/logo250x135.gif" as="image">


	<link rel="preload" href="https://www.codeproject.com/App_Themes/CodeProject/Img/logo135-bg.gif" as="image">
	<link rel="preload" href="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/jquery-3.4.1.min.js" as="script" type="text/javascript">


	<title>COM in plain C, Part 2 - CodeProject</title> 
    
	<!-- inlined file /App_Themes/CodeProject/Css/article.critical.min.css. Minimized in Release. -->
<style type="text/css">
.blank-background{background-color:#fff}html,div,span,applet,object,iframe,a,abbr,acronym,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,fieldset,form,label,table,tbody,tfoot,thead,tr,th,td,li,ol,ul{margin:0;padding:0;border:0}html{font-size:16px;-webkit-font-smoothing:antialiased;font-smooth:always}body,p,h1,h2,h3,h4,h5,h6,li,tr,td,th,dd,dt{font-family:"Segoe UI",Arial,Sans-Serif;font-size:16px;line-height:1.4;color:#111}body{margin:0}h1,h3,h4,h5,th{font-weight:bold}h1{color:#333;padding:0;margin:0 0 7px;text-align:left}h2{margin:20px 0 11px;padding:0;padding-bottom:10px;color:#333}h1{font-size:38px;font-weight:400}h2{font-size:29px;font-weight:400}h4{font-size:17px}table{background-color:Transparent}img{-ms-interpolation-mode:bicubic}a{text-decoration:none;color:#005782}a:visited{color:#800080}a:hover{text-decoration:underline}a:not([href]){color:inherit;text-decoration:none}input[type="text"],input[type="url"],input[type="search"],input[type="email"],input[type="number"],input[type="password"],select,textarea{border:1px solid #d7d7d7;font-size:16px;padding:5px}a.button,a.button-large,.button,.button-large{color:#fff;background-color:#e08900;border:1px solid #ccc;text-decoration:none;white-space:nowrap;font-size:100%;padding:4px;cursor:pointer;border-radius:3px;-webkit-border-radius:3px;-moz-border-radius:3px}table.small-text td,ul.small-text li,ol.small-text li,.small-text{font-size:14px}.invisible{display:none}.subdue,.subdue li,tr.subdue td{color:#808080}.align-left{text-align:left}.align-right{text-align:right}.align-center{text-align:center}.float-right{float:right}.float-left{float:left}.sticky{position:sticky;top:0}.extended{width:100%;box-sizing:border-box}.padded-top{padding-top:20px}.tight{margin:0;padding:0}.nowrap{white-space:nowrap}.fixed-layout{table-layout:fixed}.clipped{overflow:hidden}.raised{background-color:#fff8df;border:1px solid #ccc;-moz-box-shadow:4px 4px 16px 1px rgba(0,0,0,.25);-webkit-box-shadow:4px 4px 16px 1px rgba(0,0,0,.25);box-shadow:4px 4px 16px 1px rgba(0,0,0,.25)}ol,ul{padding-left:40px;margin:10px 0}ol.compact li,ul.compact li,ol li.compact,ul li.compact{font-size:14px}.callout{margin:20px 0;background-color:#ffffe1;color:#333;border:1px solid #ccc;padding:15px;border-radius:3px;-webkit-border-radius:3px;-moz-border-radius:3px}.trace{padding:20px;background-color:#eee;color:#333;border:1px solid #f00;font-size:13px}textarea,input[type="text"],input[type="button"],input[type="submit"]{-webkit-appearance:none;border-radius:0}.container-content{background-color:#fff;position:relative;zoom:1;padding:0 9px;cursor:default}.container-content-wrap{margin:auto;max-width:1270px}.flex-container{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex}.flex-extend{justify-content:space-between}.flex-wrap{flex-wrap:wrap}.flex-item{-webkit-box-flex:1;-moz-box-flex:1;-webkit-flex:1;-ms-flex:1;flex:1}.flex-item-tight{flex:0 1 auto}.hover-container{display:block;position:relative}.clearfix:after,.container:after{display:block;content:'.';visibility:hidden;height:0;clear:both}.clearfix,.container{display:inline-block;display:block}.access-link,.access-link img{position:absolute;top:0;left:0;width:1px;height:1px;z-index:101;border-style:none;margin-top:-1px;overflow:hidden}.site-top-menu{white-space:nowrap;position:absolute;z-index:101;width:100%}.site-top-menu .main-content{width:100%}.site-top-menu .main-content .memberbar{margin-left:90px;margin-right:10px}.site-top-menu.fixed .main-content{margin:auto;max-width:1270px}.site-header{background-image:url('/App_Themes/CodeProject/Img/logo135-bg.gif');white-space:nowrap;overflow:hidden}.site-header .main-content{position:relative;overflow:hidden;white-space:nowrap}.site-header .logo{display:inline-block}.site-header .promo{display:inline-block;position:absolute;top:33px;right:0}.site-header.fixed .main-content{margin:auto;max-width:1270px}.sub-headerbar{padding-right:9px;position:relative;margin:auto;max-width:1270px}.sub-headerbar-divider{margin-left:10px;height:1px;border-bottom:1px solid #ccc;position:absolute;bottom:2px;left:0;right:9px}.memberbar{height:25px;padding-top:10px;color:#999;font-size:14px}.memberbar a{color:#808080;font-size:14px}div.navbar{white-space:nowrap}.navmenu{background:#fff;color:#4d4d4d;padding:0;margin:0;list-style:none;height:25px}.navmenu ul,.navmenu li{margin:0;padding:0}.navmenu .has-submenu{position:absolute;right:5px;padding-left:10px}.navmenu>li:hover>a,.navmenu>li>a:active{border:1px solid #ccc}.navmenu ul,.navmenu>li.open:hover>a,.navmenu>li.open>a:active{border:1px solid #ccc;border-bottom-color:#fff}.navmenu>li{margin:0 11px 2px 2px}.navmenu>li:active,.navmenu>li:active>a,.navmenu>li:hover,.navmenu>li>a:active{background:#fff;color:#4d4d4d}.navmenu>li>a{padding:2px 7px 6px 7px;border:1px solid transparent;font-weight:bold}.navmenu a{display:block;float:left;color:#666;background:#fff;font-size:17px;padding:0 9px;text-decoration:none;white-space:nowrap}.navmenu a.fly{white-space:nowrap}.navmenu ul{background:#fff;position:absolute;left:-9999px;top:-9999px;list-style:none}.navmenu li{float:left;color:#4d4d4d}.navmenu li.last{height:9px}.navmenu li a:active,.navmenu li a:hover{color:#fff;background-color:#f90}.navmenu li>a:active,.navmenu li:hover,.navmenu li:hover>a,.navmenu li:hover.heading,.navmenu li a.selected{position:relative;color:#fff;background-color:#f90}.navmenu li.openable:hover ul{left:0;top:30px;z-index:500}.navmenu li.openable:hover>ul ul{position:absolute;left:-9999px;top:-9999px;width:auto}.navmenu li.open{position:relative}.navmenu li.open a{color:#fff;background-color:#f90}.navmenu li.open ul{left:0;top:30px;z-index:500}.navmenu li ul{border-bottom:5px solid #f90}.navmenu li li{float:none}.navmenu li li:active>a.fly,.navmenu li li:hover>a.fly{color:#fff;background-color:#f90}.navmenu li li a{float:none;font-size:16px;font-weight:normal}.navmenu li li a.fly{color:#4d4d4d;background-color:#fff;padding:2px 20px}.navmenu li li a.break{margin-bottom:15px}.navmenu li li a.highlight1,.navmenu li li a.highlight1:active,.navmenu li li a.highlight1:hover{background-color:#090}.navmenu li li a.highlight2,.navmenu li li a.highlight2:active,.navmenu li li a.highlight2:hover{background-color:#f90}.navmenu li li a.highlight3,.navmenu li li a.highlight3:active,.navmenu li li a.highlight3:hover{background-color:#000}.navmenu li li a.highlight1,.navmenu li li a.highlight2,.navmenu li li a.highlight3{color:#fff;font-size:16px;margin:5px 0;padding:9px 20px}.site-footer{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;padding-top:5px;width:100%;font-size:13px;color:#999}.site-footer .align-left,.site-footer .align-center,.site-footer .align-right{-webkit-box-flex:1;-moz-box-flex:1;-webkit-flex:1;-ms-flex:1;flex:1}.site-footer .align-left{flex:1 0 100px}.site-footer .align-center{flex:0 1 0%;white-space:nowrap}.site-footer .align-right{flex:1 0 100px}.site-footer .page-width .active{border-bottom:2px solid #f90}.searchbar{padding:0}.searchbar .search{margin-bottom:4px;padding:2px 5px 0;border:1px solid #ccc}.searchbar .search.subdue{color:#ccc}.searchbar input.search{width:190px;border:none;font-size:13px;padding:4px 2px}.searchbar .search-advanced{padding:8px;width:203px;z-index:1000;background-color:#fff;border:solid 1px #ccc;position:absolute;top:-4px;right:0}.searchbar .popup{display:none}.search td{background-color:#fff}.article-container-parts{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex}.article-container{-webkit-box-flex:1;-moz-box-flex:1;-webkit-flex:1;-ms-flex:1;flex:1;background-color:#fff;color:#111;zoom:1;position:relative;max-width:100%;min-height:675px}.article-container .article{margin:0 20px 0 10px;line-height:143%}.article-container span.stats{margin-left:30px}.article-left-sidebar{width:120px;min-width:120px;min-height:400px;font-size:14px;border-right:1px solid #f2f2f2;padding:0}.article-left-sidebar .article-left-sidebar-inner{width:120px;min-width:120px}.article-left-sidebar .tabs>div{padding:5px 0 5px 10px}.article-left-sidebar .selected{font-weight:bold;background:transparent url("/images/right-selected.gif") no-repeat scroll right 9px}.article-left-sidebar .original{color:#808080;margin:-10px 0 0 15px}.article-left-sidebar h4{color:#f90;font-size:14px;font-weight:bold}.article-left-sidebar .stats div div div{padding:0 0 10px 10px;color:#666}.article-right-sidebar{width:300px;margin-left:10px;font-size:14px}.article-right-sidebar .gototop{text-align:center;padding:10px 0;opacity:0;-webkit-transition:opacity .3s linear 0ms;-moz-transition:opacity .3s linear 0ms;-o-transition:opacity .3s linear 0ms;transition:opacity .3s linear 0ms}.container-content .edit-links{margin:21px 0 0 10px}.article-summary{padding:0 10px 0 10px;overflow:hidden}.article h1{margin:0 0 15px 0}.article h2{color:#f90}.article .header .title{color:#808080}.article .header .author{font-weight:bold;min-width:100px}.article .header .author a{color:#808080}.article .header .avatar{max-width:48px;max-height:48px;overflow:unset}.article .header .avatar-wrap{width:48px;height:48px;margin-right:10px;text-align:center}.article .header .date{white-space:nowrap}.article .header .license{margin-left:15px}.article .header .stats{margin-left:30px}.article .summary{color:#808080;padding:40px 0 15px 0}.article .text{padding-top:10px}.article-nav{text-align:right;margin-top:21px;vertical-align:middle;line-height:15px}span.math{display:inline-block}.msg-728x90{width:728px;height:90px;overflow:hidden}.msg-300x250{width:300px;height:250px;overflow:hidden}.tags{line-height:190%}.tags .t{background:none repeat scroll 0 0 transparent;border:1px solid #fbedbb;border-radius:12px 0 0 12px;line-height:1.4;padding:0 2px 2px 3px;position:relative;text-decoration:none;margin:2px 5px 4px 0;white-space:nowrap}.tags .t a{color:#666;display:inline-block;margin-right:3px;padding-left:5px;text-overflow:ellipsis}.container-breadcrumb{font-size:14px;margin-top:7px;color:#808080;margin:12px 0 35px}.container-breadcrumb a{color:#808080}.speech-bubble-container-down,.speech-bubble-container-up,.speech-bubble-container-up-right,.speech-bubble-container-left,.speech-bubble-container-right{position:relative}.ie .speech-bubble-container-up,.firefox .speech-bubble-container-up,.chrome .speech-bubble-container-up,.ie .speech-bubble-container-up-right,.firefox .speech-bubble-container-up-right,.chrome .speech-bubble-container-up-right{margin-top:-4px}.tooltip{position:relative;text-decoration:none}.tooltip .speech-bubble-container-up,.tooltip .speech-bubble-container-down,.tooltip .speech-bubble-container-left,.tooltip .speech-bubble-container-right,.tooltip .speech-bubble-container-up-right,.tooltip .tooltip-flyout{display:none;opacity:0;-webkit-transition:opacity .5s linear 0ms;-moz-transition:opacity .5s linear 0ms;-o-transition:opacity .5s linear 0ms;transition:opacity .5s linear 0ms}.micromodal{display:none}.bottom-promo{height:90px;margin-top:10px;overflow:hidden}.bottom-promo .msg-728x90{width:728px;margin:0 auto}.msg-728x90{overflow:hidden;position:relative;height:90px;min-width:728px}body .msg-728x90{*float:right}body .bottom-promo .msg-728x90{*float:none}table.forum{table-layout:fixed;margin:0 0 20px 0;padding:0;width:100%}.forum table{border-collapse:separate}.forum .header1,.forum .header1 TD{color:#333;font-size:14px;vertical-align:middle}.forum .header2,.forum .header2 TD{color:#fff;background-color:#f90;font-size:14px;vertical-align:middle}.forum .header2 input,.forum .header2 TD input,.forum .header2 select,.forum .header2 TD select{padding:2px}.forum .button{border:1px solid #fc6;margin:1px}.forum .searchbar{border:1px solid #ccc;padding:4px 0 0 0;margin:3px 0}.forum .searchbar .search{width:200px}.forum .searchbar input[type=image]{vertical-align:middle}.forum .dropdown{background-color:#fffdfa;font-size:95%;margin-left:5px}.forum .footer,.forum .footer td,.forum .navbar,.forum .navbar td{font-size:14px;padding:8px 0;border:0;border-top:1px solid #808080}.author-wrapper{position:relative}.author-wrapper .profile-pic{border:1px solid #333;margin:0 13px 0 0;padding:10px;-moz-box-shadow:3px 3px 5px 1px rgba(0,0,0,.2);-webkit-box-shadow:3px 3px 5px 1px rgba(0,0,0,.2);box-shadow:3px 3px 5px 1px rgba(0,0,0,.2);max-height:100px}.author-wrapper .container-member .author{font-size:29px;color:#333;font-weight:600}.rating-container .rating-prompt{padding-right:5px;white-space:nowrap;line-height:25px;margin-right:2px;font-weight:bold;color:#808080}.rating-container .rating-votes{margin-left:5px}.rating-container.large-stars,.rating-container.medium-stars,.rating-container.small-stars{margin-left:7px}.rating-container.large-stars .rating-votes,.rating-container.large-stars .rating-prompt,.rating-container.large-stars .rating-poor,.rating-container.large-stars .rating-good{line-height:25px}@media(min-width:1024px){.desktop-lg-block-only{display:none}.desktop-only{display:inherit}.desktop-block-only{display:block}.tablet-only,.tablet-block-only{display:none}.mobile-only,.mobile-block-only{display:none}.desktop-only.tablet-only{display:inherit}.desktop-block-only.tablet-block-only{display:block}}@media(min-width:821px){.desktop-lg-block-only{display:none}.tablet-only,.mobile-only{display:none}.tablet-block-only,.mobile-block-only{display:none}.tablet-only.desktop-only{display:inherit}.tablet-block-only.desktop-block-only{display:block}}.rrssb-buttons,.rrssb-buttons li,.rrssb-buttons li a{-moz-box-sizing:border-box;box-sizing:border-box}.clearfix{*zoom:1}.clearfix:after{clear:both}.clearfix:before,.clearfix:after{content:" ";display:table}.rrssb-buttons{font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;height:40px;margin:0;padding:0;width:100%}.rrssb-buttons li{float:left;height:100%;list-style:none;margin:0;padding:0 2.5px;line-height:13px}.rrssb-buttons li.email a{background-color:#0a88ff}.rrssb-buttons li.facebook a{background-color:#306199}.rrssb-buttons li.linkedin a{background-color:#007bb6}.rrssb-buttons li.twitter a{background-color:#26c4f1}.rrssb-buttons li.reddit a{background-color:#8bbbe3}.rrssb-buttons li.pinterest a{background-color:#b81621}.rrssb-buttons li.compact{padding:0 4.5px}.rrssb-buttons li.compact a{border-radius:50%;padding:0 7px 0 32px}.rrssb-buttons li.compact a .icon{left:7px;top:-3px;width:5%;transform:scale(.85)}.rrssb-buttons li.compact a .icon svg{height:auto;width:auto}.rrssb-buttons li a{background-color:#ccc;border-radius:3px;display:block;font-size:11px;font-weight:bold;height:100%;padding:11px 7px 12px 27px;position:relative;text-align:center;text-decoration:none;text-transform:uppercase;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;width:100%;-webkit-transition:background-color .2s ease-in-out;-moz-transition:background-color .2s ease-in-out;-o-transition:background-color .2s ease-in-out;transition:background-color .2s ease-in-out}.rrssb-buttons li a .icon{display:block;height:100%;left:10px;padding-top:9px;position:absolute;top:0;width:10%}.rrssb-buttons li a .icon svg{height:17px;width:17px}.rrssb-buttons li a .icon svg path,.rrssb-buttons li a .icon svg polygon{fill:#fff}
</style>
<link rel="stylesheet" type="text/css" href="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/Main.min.css" media="all" onload="if(media!='all')media='all'">
<noscript><link rel="stylesheet" type="text/css" href="https://codeproject.freetls.fastly.net/App_Themes/CodeProject/Css/Main.min.css?dt=2.8:2023-08-14:1"></noscript>


    <script type="text/javascript" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/jquery-3.4.1.min.js" defer="defer"></script>
<script type="text/javascript" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/article.min.js" defer="defer"></script>
<script type="text/javascript" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/client" defer="defer" async=""></script>
<script type="text/javascript" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/MemberProfilePopup.min.js" defer="defer"></script>
<script type="text/javascript" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/a.min.js" defer="defer"></script>

	
<meta http-equiv="content-language" content="en-US">
<meta charset="UTF-8">
<meta name="Description" content="How to write a COM component in C that can be used by script languages such as VBscript, Visual BASIC, jscript, etc.">
<meta name="Keywords" content="VC6, C++, C, Windows, Visual-Studio, Dev, COM, Beginner">
<meta name="Author" content="Jeff Glatt">
<meta name="Rating" content="General">
<meta name="Revisit-After" content="1 days">
<meta name="application-name" content="CodeProject">
<meta name="google-translate-customization" content="d908bb7ce7aff658-4c2f3a504525c916-g629383f736781a8a-13">

<link rel="dns-prefetch" href="https://ajax.googleapis.com/"> 
<link rel="canonical" href="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/COM-in-plain-C-Part-2.html">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@CodeProject">
<meta name="og:site_name" content="CodeProject">
<meta name="twitter:creator" content="@CodeProject">
<meta property="og:type" content="article">
<meta property="article:published_time" content="4/20/2006 8:38:00 PM">
<meta property="article:modified_time" content="4/20/2006 8:38:00 PM">
<meta name="twitter:label1" content="Written by">
<meta name="twitter:data1" content="Jeff Glatt">
<meta name="twitter:label2" content="Reading time">
<meta name="twitter:data2" content="39 min read">
<meta property="og:url" content="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2">
<meta property="og:title" content="COM in plain C, Part 2">
<meta property="og:description" content="How to write a COM component in C that can be used by script languages such as VBscript, Visual BASIC, jscript, etc.">

<link rel="alternate" type="application/rss+xml" title="CodeProject Latest articles - All Topics" href="https://www.codeproject.com/WebServices/ArticleRSS.aspx?cat=1">
<link rel="alternate" type="application/rss+xml" title="CodeProject Latest articles - Python" href="https://www.codeproject.com/WebServices/ArticleRSS.aspx?cat=34">
<link rel="alternate" type="application/rss+xml" title="CodeProject Lounge Postings" href="https://www.codeproject.com/webservices/LoungeRSS.aspx">
<meta name="robots" content="index, follow">

<link rel="search" type="application/opensearchdescription+xml" title="CodeProject" href="https://www.codeproject.com/info/OpenSearch.xml">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="apple-touch-icon" sizes="144x144" href="https://www.codeproject.com/favicon/apple-touch-icon.png"> 
<link rel="icon" type="image/png" sizes="32x32" href="https://www.codeproject.com/favicon/favicon-32x32.png"> 
<link rel="icon" type="image/png" sizes="16x16" href="https://www.codeproject.com/favicon/favicon-16x16.png"> 
<link rel="manifest" href="https://www.codeproject.com/favicon/manifest.json"> 
<link rel="mask-icon" href="https://www.codeproject.com/favicon/safari-pinned-tab.svg" color="#ff9900">
	<script type="application/ld+json">{
  "@context": "http://schema.org",
  "@type": "TechArticle",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2"
   },
  "name": "COM in plain C, Part 2",
  "headline": "COM in plain C, Part 2",
  "url": "https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2",
  "discussionUrl": "https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2#_comments",
  "isFamilyFriendly": "true",
  "image": "https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/Article100.png",
  "keywords": "VC6,C++,C,Windows,Visual-Studio,Dev,COM,Beginner",
  "commentCount": "67",
  "editor" : {
    "@type" : "Person",
    "name" : "Smitha Nishant",
    "url" : "https://www.codeproject.com/script/Membership/View.aspx?mid=28970"
  },
  "license": "http://www.codeproject.com/info/cpol10.aspx",
  "publisher" : {
    "@type" : "Organization",
    "name" : "CodeProject"
  },
  "description": "How to write a COM component in C that can be used by script languages such as VBscript, Visual BASIC, jscript, etc.",
  "articleSection": "C",
  "author" : [{
      "@type" : "Person",
      "name" : "Jeff Glatt",
      "url" : "https://www.codeproject.com/script/Membership/View.aspx?mid=88625"
    }],
  "datePublished": "2006-04-20",
  "dateCreated": "2006-04-20",
  "dateModified": "2006-04-20"
,
  "contentRating" : {
    "@type" : "Rating",
    "ratingValue" : 4.96,
    "bestRating" : 5,
    "worstRating" : 1
  }
}</script>

<script type="application/ld+json">{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
    "@type": "ListItem",
    "position": 1,
    "item" : {
      "@id" : "/script/Content/Tag.aspx?tags=Languages",
      "name" : "Programming Languages"
    }
  },{
    "@type": "ListItem",
    "position": 2,
    "item" : {
      "@id" : "/script/Content/Tag.aspx?tags=C",
      "name" : "C"
    }
  }]
}</script>


	<!-- base href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2" -->
	
    


<script type="text/javascript">
function defrm () { /* thanks twitter */
    document.write = '';
    window.top.location = window.self.location;
    setTimeout(function() { document.body.innerHTML = ''; }, 0);
    window.self.onload = function(evt) { document.body.innerHTML = ''; };
}

if (window.top !== window.self) {
    try {
        if (window.top.location.host) { /* will throw for all except chrome */ }
        else { defrm(); /* chrome */ }
    } catch (ex) { defrm(); /* everyone else */ }
}

// Specific case where a site is screwing with us.
if (typeof(DemoUrl) !== 'undefined') {
    document.write(unescape('%3Cme') + 'ta http' + '-equiv="re' + 'fresh con' +
                           'tent="1;url=' + DemoUrl + unescape('"%3CE'));
}
</script>
	





    <script async="" type="text/javascript" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/js"></script>
    <script type="text/javascript">
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-YZNPNQ0F2S' , {'user_id': '9bd02f62-656b-43b1-a8e3-74fba4e7f215'});
    </script>

<style id="googleidentityservice_button_styles">.qJTHM{-moz-user-select:none;color:#202124;direction:ltr;font-family:"Roboto-Regular",arial,sans-serif;font-weight:400;margin:0;overflow:hidden}.ynRLnc{left:-9999px;position:absolute;top:-9999px}.L6cTce{display:none}.bltWBb{word-break:break-all}.hSRGPd{color:#1a73e8;cursor:pointer;font-weight:500;text-decoration:none}.Bz112c-W3lGp{height:16px;width:16px}.Bz112c-E3DyYd{height:20px;width:20px}.Bz112c-r9oPif{height:24px;width:24px}.Bz112c-uaxL4e{-moz-border-radius:10px;border-radius:10px}.LgbsSe-Bz112c{display:block}.S9gUrf-YoZ4jf,.S9gUrf-YoZ4jf *{border:none;margin:0;padding:0}.fFW7wc-ibnC6b>.aZ2wEe>div{border-color:#4285f4}.P1ekSe-ZMv3u>div:nth-child(1){background-color:#1a73e8!important}.P1ekSe-ZMv3u>div:nth-child(2),.P1ekSe-ZMv3u>div:nth-child(3){background-image:linear-gradient(to right,rgba(255,255,255,.7),rgba(255,255,255,.7)),linear-gradient(to right,#1a73e8,#1a73e8)!important}.haAclf{display:inline-block}.nsm7Bb-HzV7m-LgbsSe{border-radius:4px;box-sizing:border-box;transition:background-color .218s,border-color .218s;-moz-user-select:none;background-color:#fff;background-image:none;border:1px solid #dadce0;color:#3c4043;cursor:pointer;font-family:"Google Sans",arial,sans-serif;font-size:14px;height:40px;letter-spacing:0.25px;outline:none;overflow:hidden;padding:0 12px;position:relative;text-align:center;vertical-align:middle;white-space:nowrap;width:auto}@media screen and (-ms-high-contrast:active){.nsm7Bb-HzV7m-LgbsSe{border:2px solid windowText;color:windowText}}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe{font-size:14px;height:32px;letter-spacing:0.25px;padding:0 10px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe{font-size:11px;height:20px;letter-spacing:0.3px;padding:0 8px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe{padding:0;width:40px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.pSzOP-SxQuSe{width:32px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.purZT-SxQuSe{width:20px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK{border-radius:20px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK.pSzOP-SxQuSe{border-radius:16px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK.purZT-SxQuSe{border-radius:10px}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc{border:none;color:#fff}.nsm7Bb-HzV7m-LgbsSe.MFS4be-v3pZbf-Ia7Qfc{background-color:#1a73e8}.nsm7Bb-HzV7m-LgbsSe.MFS4be-JaPV2b-Ia7Qfc{background-color:#202124;color:#e8eaed}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:18px;margin-right:8px;min-width:18px;width:18px}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:14px;min-width:14px;width:14px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:10px;min-width:10px;width:10px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin-left:8px;margin-right:-4px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin:0;padding:10px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{padding:8px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{padding:4px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-top-left-radius:3px;border-bottom-left-radius:3px;display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;justify-content:center;align-items:center;background-color:#fff;height:36px;margin-left:-10px;margin-right:12px;min-width:36px;width:36px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf .nsm7Bb-HzV7m-LgbsSe-Bz112c,.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin:0;padding:0}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{height:28px;margin-left:-8px;margin-right:10px;min-width:28px;width:28px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{height:16px;margin-left:-6px;margin-right:8px;min-width:16px;width:16px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:3px;margin-left:2px;margin-right:0;padding:0}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:18px}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:14px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:8px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-bN97Pc-sM5MNb{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;align-items:center;flex-direction:row;justify-content:space-between;flex-wrap:nowrap;height:100%;position:relative;width:100%}.nsm7Bb-HzV7m-LgbsSe .oXtfBe-l4eHX{justify-content:center}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-BPrWId{flex-grow:1;font-family:"Google Sans",arial,sans-serif;font-weight:500;overflow:hidden;text-overflow:ellipsis;vertical-align:top}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-BPrWId{font-weight:300}.nsm7Bb-HzV7m-LgbsSe .oXtfBe-l4eHX .nsm7Bb-HzV7m-LgbsSe-BPrWId{flex-grow:0}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-MJoBVe{transition:background-color .218s;bottom:0;left:0;position:absolute;right:0;top:0}.nsm7Bb-HzV7m-LgbsSe:hover,.nsm7Bb-HzV7m-LgbsSe:focus{box-shadow:none;border-color:#d2e3fc;outline:none}.nsm7Bb-HzV7m-LgbsSe:hover .nsm7Bb-HzV7m-LgbsSe-MJoBVe,.nsm7Bb-HzV7m-LgbsSe:focus .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(66,133,244,.04)}.nsm7Bb-HzV7m-LgbsSe:active .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(66,133,244,.1)}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:hover .nsm7Bb-HzV7m-LgbsSe-MJoBVe,.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:focus .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(255,255,255,.24)}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:active .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(255,255,255,.32)}.nsm7Bb-HzV7m-LgbsSe .n1UuX-DkfjY{border-radius:50%;display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;height:20px;margin-left:-4px;margin-right:8px;min-width:20px;width:20px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId{font-family:"Roboto";font-size:12px;text-align:left}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .ssJRIf,.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff .fmcmS{overflow:hidden;text-overflow:ellipsis}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;align-items:center;color:#5f6368;fill:#5f6368;font-size:11px;font-weight:400}.nsm7Bb-HzV7m-LgbsSe.jVeSEe.MFS4be-Ia7Qfc .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff{color:#e8eaed;fill:#e8eaed}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff .Bz112c{height:18px;margin:-3px -3px -3px 2px;min-width:18px;width:18px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-top-left-radius:0;border-bottom-left-radius:0;border-top-right-radius:3px;border-bottom-right-radius:3px;margin-left:12px;margin-right:-10px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:18px}.L5Fo6c-sM5MNb{border:0;display:block;left:0;position:relative;top:0}.L5Fo6c-bF1uUb{-moz-border-radius:4px;border-radius:4px;bottom:0;cursor:pointer;left:0;position:absolute;right:0;top:0}.L5Fo6c-bF1uUb:focus{border:none;outline:none}sentinel{}</style><style type="text/css"></style><link id="googleidentityservice" type="text/css" media="all" rel="stylesheet" href="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/style.css"><style></style><link href="data:text/css,%5Bid*%3D'google_ads_iframe'%5D%2C%5Bid*%3D'taboola-'%5D%2C.taboolaHeight%2C.taboola-placeholder%2C%23credential_picker_container%2C%23credentials-picker-container%2C%23credential_picker_iframe%2C%5Bid*%3D'google-one-tap-iframe'%5D%2C%23google-one-tap-popup-container%2C.google-one-tap-modal-div%2C%23amp_floatingAdDiv%2C%23ez-content-blocker-container%2C%23notify-adblock%7Bdisplay%3Anone!important%3Bmin-height%3A0!important%3Bheight%3A0!important%3B%7D" rel="stylesheet" type="text/css"></head>	

<body class="firefox firefox116"><div class="cc-revoke cc-bottom cc-animate cc-color-override--316233370" style="display: none;">Cookie Policy</div><div role="dialog" aria-live="polite" aria-label="cookieconsent" aria-describedby="cookieconsent:desc" class="cc-window cc-banner cc-type-opt-in-out cc-theme-edgeless cc-bottom cc-color-override--316233370 " style=""><!--googleoff: all--><span id="cookieconsent:desc" class="cc-message">Like every other website we use cookies. By using our site you acknowledge that you have read and understand our <a href="https://www.codeproject.com/info/cookie.aspx">Cookie Policy</a>, <a href="https://www.codeproject.com/info/privacy.aspx">Privacy Policy</a>, and our <a href="https://www.codeproject.com/info/TermsOfUse.aspx">Terms of Service</a>. <a aria-label="learn more about cookies" role="button" tabindex="0" class="cc-link" href="https://www.codeproject.com/info/privacy.aspx" rel="noopener noreferrer nofollow" target="_blank">Learn more</a></span><div class="cc-compliance cc-highlight"><a aria-label="dismiss cookie message" role="button" tabindex="0" class="cc-btn cc-dismiss">Ask me later</a><a aria-label="deny cookies" role="button" tabindex="0" class="cc-btn cc-deny">Decline</a><a aria-label="allow cookies" role="button" tabindex="0" class="cc-btn cc-allow">Allow cookies</a></div><!--googleon: all--></div>

	<div id="ctl00_OneTap_OneTap">
    <div id="g_id_onload" data-client_id="857795997829.apps.googleusercontent.com" data-login_uri="/script/Membership/OAuthLogOn.aspx?auth=Google">
    </div>
</div>



	<a class="access-link" href="#Main"><img alt="Click here to Skip to main content" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/t.gif"></a>




<div class="page-background">

	
	

	

	
    <div id="ctl00_STM" class="site-top-menu fixed">
        <div class="main-content">
            

<div class="container memberbar clearfix flex-container flex-extend">

	<div id="ctl00_MemberBar_GenInfo" class="flex-item align-left">15,723,416 members</div>

	<div class="flex-item">
		
	</div>

	<div class="flex-item align-right">

		

		

		

			<script type="text/javascript">//<!--
			function doSubmit(secure)
			{
				if (secure)
					document.signinForm.action = "https://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fArticles%2f13862%2fCOM-in-plain-C-Part-2"
				else
					document.signinForm.action = "https://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fArticles%2f13862%2fCOM-in-plain-C-Part-2"
				document.signinForm.submit();
				return true;
			}//-->
			</script>

			<a name="SignUp"></a>
			<span class="member-signin">
				<a data-micromodal-trigger="modal-1" href="javascript:;">Sign in</a>
				<!--<a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fArticles%2f13862%2fCOM-in-plain-C-Part-2">Sign in</a>-->

				<div class="micromodal" id="modal-1" aria-hidden="true">

					<div class="modal__overlay" tabindex="-1" data-micromodal-close="">
					  <div class="modal__container" role="dialog" aria-modal="true" aria-labelledby="modal-1-title">

						<header class="modal_header">
							<h4 class="modal_title" id="modal-1-title">
								Sign in
							</h4>
							<button class="modal_close" aria-label="Close modal" data-micromodal-close=""></button>
						</header>

						<form name="signinForm" id="signinForm" action="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fArticles%2f13862%2fCOM-in-plain-C-Part-2" method="post" class="tight align-left">

							
							<input id="FormName" name="FormName" value="MenuBarForm" type="hidden">

							<div>Email</div>
							<div><input type="email" name="Email" id="Email" autocomplete="email" data-ddg-inputtype="credentials.username"></div>
							<div>Password</div>
							<div><input type="password" name="Password" id="Password" autocomplete="current-password" data-ddg-inputtype="credentials.password"></div>
							<div class="action">
								<input id="joinBtn" type="button" class="create hidden" onclick="return Join();" value="Join" style="visibility: visible;">
								<input type="hidden" name="fld_quicksign" value="true">
								<input type="submit" value="Sign in" class="signin" onclick="return doSubmit(false);">
							</div>

							<div class="container">						
								<a id="ctl00_MemberBar_SendPassword" class="forgot float-right" href="https://www.codeproject.com/script/Membership/SendPassword.aspx?rp=/Articles/13862/COM-in-plain-C-Part-2">Forgot your password?</a>
							</div>
						</form>

						<hr class="divider-dark">

						Sign in with &nbsp;<a class="oauth" alt="Sign in using Github" title="Sign in using Github" href="https://www.codeproject.com/script/Membership/OAuthLogOn.aspx?auth=GitHub"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/octicons_github-lg.png" style="vertical-align:middle;padding-right:3px;border:0;"></a>
<a class="oauth" alt="Sign in using Facebook" title="Sign in using Facebook" href="https://www.codeproject.com/script/Membership/OAuthLogOn.aspx?auth=Facebook"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/facebook-lg.png" style="vertical-align:middle;padding-right:3px;border:0;"></a>
<a class="oauth" alt="Sign in using Google" title="Sign in using Google" href="https://www.codeproject.com/script/Membership/OAuthLogOn.aspx?auth=Google"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/google-plus-lg.png" style="vertical-align:middle;padding-right:3px;border:0;"></a>
<a class="oauth" alt="Sign in using Microsoft" title="Sign in using Microsoft" href="https://www.codeproject.com/script/Membership/OAuthLogOn.aspx?auth=Microsoft"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/microsoft-lg.png" style="vertical-align:middle;padding-right:3px;border:0;"></a>



					  </div>
					</div>
				  </div>

            </span>
		
	</div>
</div>
        </div>
    </div>

	
    <div id="ctl00_SH" class="site-header fixed">
        <div class="main-content">
            <div class="logo"><a href="https://www.codeproject.com/"><img id="ctl00_Logo" tabindex="1" title="CodeProject" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/logo250x135.gif" alt="Home" style="height:135px;width:250px;border-width:0px;"></a></div>
            <div class="promo"><div class="msg-728x90" data-format="728x90" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="Programming-LanguagesC" data-country="US" data-tags="VC6, C++, C, Windows, Visual-Studio, Dev, COM, Beginner,rating4.5"><noscript><a href="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Programming-LanguagesC&sz=728x90&c=371656"><img src="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Programming-LanguagesC&sz=728x90&c=371656"  width="728px" height="90px" target="_blank"/></a></noscript><iframe id="dm-gpt-iframe-1" width="728" height="90" marginwidth="0" marginheight="0" frameborder="0" scrolling="no"></iframe></div></div>
        </div>
    </div>

	
	<div id="ctl00_TPR" class="sub-headerbar flex-container flex-extend flex-wrap fixed">
		<div class="flex-item" style="min-width:20rem">
			

<div class="navbar clearfix">
<ul class="navmenu openable">

<li class="desktop-only"><a id="ctl00_TopNavBar_Home" href="https://www.codeproject.com/">home</a>


</li><li class="openable"><a id="ctl00_TopNavBar_Art" class="down selected" href="https://www.codeproject.com/script/Articles/Latest.aspx">articles</a>

	<ul>
		<li class="openable"><a id="ctl00_TopNavBar_ArtTopicList" class="fly" onmouseover="navBarMenu.ShowMap(this, 'ctl00_TopNavBar_MapFlyout');" href="https://www.codeproject.com/script/Content/SiteMap.aspx">Browse Topics<span class="has-submenu">&gt;</span></a><ul id="ctl00_TopNavBar_MapFlyout" class="taxonomy">
			<li>
				<div id="siteMap"></div>
			</li>
			</ul>
		</li>
		<li><a id="ctl00_TopNavBar_ArtLatestArts" class="fly" href="https://www.codeproject.com/script/Articles/Latest.aspx">Latest Articles</a></li>
		<li><a id="ctl00_TopNavBar_ArtTop" class="fly" href="https://www.codeproject.com/script/Articles/TopArticles.aspx?ta_so=5">Top Articles</a></li>
		<li><a id="ctl00_TopNavBar_ArtGuide" class="fly" href="https://www.codeproject.com/info/Submit.aspx">Posting/Update Guidelines</a></li>
		<li><a id="ctl00_TopNavBar_ArtHelpForum" class="fly" href="https://www.codeproject.com/Forums/1641/Article-Writing">Article Help Forum</a></li>
		<li><a id="ctl00_TopNavBar_ArtPostArticle" class="fly highlight1" href="https://www.codeproject.com/script/Articles/Submit.aspx">
			<img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/write13.png" width="13" height="13"> Submit an article or tip
			</a></li>
        
		<li><a id="ctl00_TopNavBar_ArtImportGitHub" class="fly highlight3" href="https://www.codeproject.com/script/Articles/ImportArticle.aspx">
			<img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/write13.png" width="13" height="13"> Import GitHub Project
			</a></li>
        
		<li><a id="ctl00_TopNavBar_ArtPostBlog" class="fly highlight2" href="https://www.codeproject.com/script/Articles/BlogFeed.aspx">
			<img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/write13.png" width="13" height="13"> Import your Blog
			</a></li>		
        
        <li class="last"></li>
	</ul>

</li>



<li class="openable">
<a id="ctl00_TopNavBar_Answers" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active">
    <span class="desktop-only tablet-only">quick answers</span><span class="mobile-only">Q&amp;A</span>
</a>
	<ul>
		<li id="ctl00_TopNavBar_AQL"><a id="ctl00_TopNavBar_ArticleQuestion" class="fly highlight1" href="#_comments">
			<img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/write13.png" width="13" height="13"> Ask a Question about this 
			article</a>
		</li>

		<li><a id="ctl00_TopNavBar_QAAsk" class="fly highlight2" href="https://www.codeproject.com/Questions/ask.aspx"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/write13.png" width="13" height="13"> Ask a Question</a></li>

		<li><a id="ctl00_TopNavBar_QAUnanswered" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=unanswered">View Unanswered Questions</a></li>
		<li><a id="ctl00_TopNavBar_QALatest" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active">View All Questions</a></li>
        
				<li><a id="ctl00_TopNavBar_QATR_ctl00_Tag" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;amp;alltags=true&amp;amp;tags=81" style="padding-left:30px">View C# questions</a></li>
			
				<li><a id="ctl00_TopNavBar_QATR_ctl01_Tag" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;amp;alltags=true&amp;amp;tags=87" style="padding-left:30px">View Javascript questions</a></li>
			
				<li><a id="ctl00_TopNavBar_QATR_ctl02_Tag" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;amp;alltags=true&amp;amp;tags=268" style="padding-left:30px">View Python questions</a></li>
			
				<li><a id="ctl00_TopNavBar_QATR_ctl03_Tag" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;amp;alltags=true&amp;amp;tags=78" style="padding-left:30px">View C++ questions</a></li>
			
				<li><a id="ctl00_TopNavBar_QATR_ctl04_Tag" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;amp;alltags=true&amp;amp;tags=91" style="padding-left:30px">View Java questions</a></li>
			
    
		<li class="last"></li>
	</ul>

</li>



<li class="openable"><a id="ctl00_TopNavBar_Forums" href="https://www.codeproject.com/script/Forums/List.aspx">
        <span class="desktop-only tablet-only">discussions</span><span class="mobile-only">forums</span>
</a>

	<ul>
		<li><a id="ctl00_TopNavBar_CodeProjectAI" class="fly" href="https://www.codeproject.com/Feature/CodeProjectAI-Discussions.aspx">CodeProject.AI Server</a></li>
		<li><a id="ctl00_TopNavBar_MessageBoardsAll" class="fly" href="https://www.codeproject.com/script/Forums/List.aspx">All Message Boards...</a></li>
		<li class="openable"><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1580997/Application-Lifecycle">Application Lifecycle<span class="has-submenu">&gt;</span></a>
<ul class="openable"><li><a class="fly" href="https://www.codeproject.com/Forums/1533717/Running-a-Business">Running a Business</a></li>
<li><a class="fly" href="https://www.codeproject.com/Forums/1533716/Sales-Marketing">Sales / Marketing</a></li>
<li><a class="fly" href="https://www.codeproject.com/Forums/1651/Collaboration-Beta-Testing">Collaboration / Beta Testing</a></li>
<li><a class="fly" href="https://www.codeproject.com/Forums/3304/Work-Issues">Work  Issues</a></li>
</ul></li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/369270/Design-and-Architecture">Design and Architecture</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1969389/Artificial-Intelligence">Artificial Intelligence</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/12076/ASP-NET">ASP.NET</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1580226/JavaScript">JavaScript</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1969388/Internet-of-Things">Internet of Things</a>
</li>
<li class="openable"><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1647/C-Cplusplus-MFC">C / C++ / MFC<span class="has-submenu">&gt;</span></a>
<ul class="openable"><li><a class="fly" href="https://www.codeproject.com/Forums/4486/ATL-WTL-STL">ATL /  WTL / STL</a></li>
<li><a class="fly" href="https://www.codeproject.com/Forums/3785/Managed-Cplusplus-CLI">Managed C++/CLI</a></li>
</ul></li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1649/Csharp">C#</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1627782/Free-Tools">Free Tools</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1827460/Objective-C-and-Swift">Objective-C and Swift</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1725/Database">Database</a>
</li>
<li class="openable"><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/186301/Hardware-Devices">Hardware &amp; Devices<span class="has-submenu">&gt;</span></a>
<ul class="openable"><li><a class="fly" href="https://www.codeproject.com/Forums/1644/System-Admin">System Admin</a></li>
</ul></li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1606152/Hosting-and-Servers">Hosting and Servers</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1643/Java">Java</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1942421/Linux-Programming">Linux Programming</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1988311/Python">Python</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1650/NET-Core-and-Framework">.NET (Core and Framework)</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1848626/Android">Android</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1876716/iOS">iOS</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/13695/Mobile">Mobile</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1004257/WPF">WPF</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1646/Visual-Basic">Visual Basic</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1640/Web-Development">Web Development</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/suggestions.aspx">Site Bugs / Suggestions</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1652005/Spam-and-Abuse-Watch">Spam and Abuse Watch</a>
</li>

		<li class="last"></li>
	</ul>

</li>

<li class="openable"><a id="ctl00_TopNavBar_Features" href="https://www.codeproject.com/Feature/">
      <span class="desktop-only tablet-only">features</span><span class="mobile-only">features</span>
</a>

	<ul>
		<li><a id="ctl00_TopNavBar_Comps" class="fly" href="https://www.codeproject.com/script/Contests/CurrentCompetitions.aspx?cmpTpId=3&amp;amp;awsac=true">Competitions</a></li>
        
		<li><a id="ctl00_TopNavBar_News" class="fly" href="https://www.codeproject.com/script/News/List.aspx">News</a></li>
		<li><a id="ctl00_TopNavBar_Insider" class="fly" href="https://www.codeproject.com/Feature/Insider/">The Insider Newsletter</a></li>
    	<li><a id="ctl00_TopNavBar_DailyBuild" class="fly" href="https://www.codeproject.com/Feature/DailyBuild">The Daily Build Newsletter</a></li>
		<li><a id="ctl00_TopNavBar_Newsletters" class="fly" href="https://www.codeproject.com/script/Mailouts/Archive.aspx?mtpid=1">Newsletter archive</a></li>
		<li><a id="ctl00_TopNavBar_Surveys" class="fly" href="https://www.codeproject.com/script/Surveys/List.aspx">Surveys</a></li>
		
        
		<li><a id="ctl00_TopNavBar_Stuff" class="fly" href="https://www.codeproject.com/Info/Stuff.aspx">CodeProject Stuff</a></li>
		<li class="last"></li>
	</ul>

</li>


<li class="openable"><a id="ctl00_TopNavBar_Lounge" href="https://www.codeproject.com/Lounge.aspx">
            <span class="desktop-only tablet-only">community</span><span class="mobile-only">lounge</span>
</a>

	<ul>
		<li><a id="ctl00_TopNavBar_WhosWho" class="fly" href="https://www.codeproject.com/script/Membership/Profiles.aspx">Who's Who</a></li>
		<li><a id="ctl00_TopNavBar_MVPs" class="fly break" href="https://www.codeproject.com/script/Contests/Winners.aspx?obtid=1&amp;amp;cmpTpId=2&amp;amp;cid=0">Most Valuable Professionals</a></li>

		<li><a id="ctl00_TopNavBar_LoungeLnk" class="fly highlight2" href="https://www.codeproject.com/Lounge.aspx">The Lounge &nbsp;</a></li>
		<li><a id="ctl00_TopNavBar_SiteBlog" class="fly break" href="https://www.codeproject.com/Members/CodeProject#_comments">The CodeProject Blog</a></li>

		<li><a id="ctl00_TopNavBar_WhereAmILink" class="fly" href="https://www.codeproject.com/Forums/1939564/Where-I-am-Member-Photos">Where I Am: Member Photos</a></li>
		<li><a id="ctl00_TopNavBar_InsiderLnk" class="fly" href="https://www.codeproject.com/Insider.aspx">The Insider News</a></li>
		<li><a id="ctl00_TopNavBar_WeirdWonderful" class="fly" href="https://www.codeproject.com/Feature/WeirdAndWonderful.aspx">The Weird &amp; The Wonderful</a></li>

		<li class="last"></li>
	</ul>

</li>


<li class="openable" style="margin-left:20px"><a id="ctl00_TopNavBar_Help" href="https://www.codeproject.com/KB/FAQs/">
    <span class="desktop-only tablet-only">help</span><span class="mobile-only">?</span>
</a>


	<ul>
		<li><a id="ctl00_TopNavBar_HelpWhatIs" class="fly" href="https://www.codeproject.com/info/guide.aspx">What is 'CodeProject'?</a></li>
		<li><a id="ctl00_TopNavBar_HelpGeneral" class="fly break" href="https://www.codeproject.com/KB/FAQs/">General FAQ</a></li>
		<li><a id="ctl00_TopNavBar_HelpPostQuestion" class="fly break highlight2" href="https://www.codeproject.com/Questions/ask.aspx">Ask a Question</a></li>
		<li><a id="ctl00_TopNavBar_HelpBugs" class="fly" href="https://www.codeproject.com/suggestions.aspx">Bugs and Suggestions</a></li>
		<li><a id="ctl00_TopNavBar_HelpArticles" class="fly" href="https://www.codeproject.com/Forums/1641/Article-Writing">Article Help Forum</a></li>
		
		
		
		
		<li><a id="ctl00_TopNavBar_HelpAboutUs" class="fly" href="https://www.codeproject.com/info/about.aspx">About Us</a></li>
		<li class="last"></li>
	</ul>

</li>

</ul>

</div>
		</div>
		<div class="flex-item-tight align-right">
			

<div class="searchbar">

<form method="get" action="/search.aspx?sbo=kw" name="Search" class="tight">


<table border="0" cellspacing="0" cellpadding="0" class="search"><tbody><tr><td><input tabindex="2" class="search subdue" id="sb_tb" autocomplete="off" value="Search for articles, questions, tips" name="q" data-ddg-inputtype="unknown"></td><td><input type="image" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/search.gif"></td></tr></tbody></table>

<div class="hover-container">
	<div id="SearchFilter" class="search-advanced small-text align-left" style="display: none;">
	<b>Search within:<br></b>
		
		<input type="radio" id="sb_kw" name="sbo" value="kw" checked="checked"><label for="sb_kw">Articles</label><br>
<input type="radio" id="sb_qa" name="sbo" value="qa"><label for="sb_qa">Quick Answers</label><br>
<input type="radio" id="sb_fm" name="sbo" value="fm"><label for="sb_fm">Messages</label><br>


		
		

		
		
	</div>
</div>
</form>

</div>
		</div>
		<div class="sub-headerbar-divider"></div>
	</div>		
	

	<div id="A" class="container-content-wrap fixed"> 

	<div class="container-content">

        
		<div class="clearfix">
			<div class="container-breadcrumb float-left ">
				<div><a rel="nofollow" href="https://www.codeproject.com/script/Content/SiteMap.aspx">Articles</a> / <a rel="nofollow" href="https://www.codeproject.com/script/Content/Tag.aspx?tags=Languages">Programming Languages</a> / <a rel="nofollow" href="https://www.codeproject.com/script/Content/Tag.aspx?tags=C">C</a></div>
			</div>

            <div class="float-left">
				
			</div>

			<div class="edit-links float-right">
				



 
&nbsp;










			</div>

			<div class="article-nav float-right">
				


<div style="display:inline-block;position:relative;top:-6px;margin-right:20px">
    
</div>



 

<a id="ctl00_ActionLinks_PrintMd" data-tooltip="Print" data-enabletooltip="true" data-width="auto" href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?display=Print" class="tooltip" title="">
   <img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/print48.png" width="24" height="24" style="border:0">
<div class="speech-bubble-container-up" style="width:auto">  <div class="speech-bubble-up" style="text-align:center"> Print</div>  <div class="speech-bubble-pointer-up">    <div class="speech-bubble-pointer-up-inner"></div>  </div></div></a>



<span id="ctl00_ActionLinks_R">
    
    
</span>
			</div>
		</div>

        
		<div class="extended article-container-parts">

			
		    <div id="ctl00_LeftSideBar" class="article-left-sidebar">

                <div id="ctl00_StickyBlock" class="article-left-sidebar-inner sticky">

                    
    		        

<div class="tabs">
	<div class=" selected">Article</div>
<div class="browse-code"><a href="https://www.codeproject.com/script/Articles/ViewDownloads.aspx?aid=13862">Browse Code</a></div>
<div><a href="https://www.codeproject.com/script/Articles/Statistics.aspx?aid=13862">View Stats</a></div>
<div><a href="https://www.codeproject.com/script/Articles/ListVersions.aspx?aid=13862">Revisions</a></div>
<div><a href="#_comments">Comments (67)</a></div>
<div>Posted 20 Apr 2006</div>


    
</div>



			        

			        <div>
                        <h4 id="ctl00_TaggedAsWrapper">Tagged as</h4>
			            <span id="ctl00_TagList_TagWrp" class="tags vertical">

	
	

	
	<span id="ctl00_TagList_VisibleTags"><div class="t"><a rel="tag" href="https://www.codeproject.com/Tags/VC6" data-id="4">VC6</a></div><div class="t"><a rel="tag" href="https://www.codeproject.com/Tags/Cplusplus" data-id="78">C++</a></div><div class="t"><a rel="tag" href="https://www.codeproject.com/Tags/C" data-id="80">C</a></div><div class="t"><a rel="tag" href="https://www.codeproject.com/Tags/Windows" data-id="94">Windows</a></div><div class="t"><a rel="tag" href="https://www.codeproject.com/Tags/Visual-Studio" data-id="103">Visual-Studio</a></div><div class="t"><a rel="tag" href="https://www.codeproject.com/Tags/COM" data-id="130">COM</a></div></span> 

	
	
</span>


			        </div>

                    <div id="ctl00_VerticalStatsWrapper" class="stats">
                    <h4>Stats</h4>
                    <div id="ctl00_VerticalStats"><div class="stats"><div>265K views</div><div>6.2K downloads</div><div>165 bookmarked</div></div></div>
                    </div>

                    
                </div>
		    </div>
            

			
			<div id="AT" class="article-container  fixed"> 

				<div class="article">

					<form name="aspnetForm" method="post" action="./View.aspx" id="aspnetForm" style="margin:0;padding:0">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="JVu0YtzOREewihzjazxa7MgYmsp6aMod/bXPhE4oLzy/e8rouEj+/9anqseQPdhTshNHqkPR/RLbcZ+2aIX3UKXtkLKfHhVfSLExXT9J/jgBMe4RZcQErBhir2rhx/z5wkpJTO/pyQ12U1GlD3j9OLZFYLAe+NPinmBxQq0/uQuZpY6+mFeLJCcsbSc07hdwablEU538gK+8PnXSYMOMpdw1lvhHvR5IcGiHPb//avuGZ0T4Y5ojr4o3GfaygYLMMAD7KkZT3RX7hsZpBuIu+g87TzY/K9zvxp8VsdQnsHEsCemiDf35ZpKiiYMtZ5iAztLlllIXNSERqUEpL/8zyrnQKMQBh56UvMn/defhkX5pQpmXrYvBPpPQUZjHyd/Xrl3X5ZCbWG41Lyq2Gltnc/Qs/vxZyrmZ4NThrQUxnuZsFa2sHoaXnFR5A6PBW8kMcWxEYHlD4RYaHqqoJAlwJP84fnDUaj8Bo48CxQo1ZyJVRz0PKG4syJE328vpNavTEIQMP6AD6ESNX9/U0vU1xSwVLryiexREPZAtR7luLhTk65l5T/VlApOkFEWnduoZUHw+GH+tm2pczx6W5S3EM0JES/N4ldIIcRvMIim0qkNhgKbQVzszL5UB057s+c41F564iwhpUgzFP8kNdcAzfaB6KU3waAwUfONPfSZA52TDNlbI0/zjEOflpn6RVRO/nJp+YL6IzC348wHE8Dd0Bo35nRScL7yJ8uqd9GZi03tBszBn4NoPL5yw6CK+esTpzw0+Hr1DPVk407/XkMJZkI2uUQTqYVK02+ba9GuznZv1DvknJc+IxUZkzR2x1qCFSKPRx1m6i+L3sDgR8i19FfgSMDBUoYLynNSQjk/CFWBg9sqtWQWmfxX+CQz/yRv4+hDmKW/HhlBv9qQKfc2nyVzAtY0L/JX8Zqb92LLB88JQlQSuzNzCwG7pn0Xi76xIKlemzWurkQgUlaWb1T/RlSlkwGEAQwx3oIqkTWmcs48JWsf5vzjsX/1KOnyeE+P7djQU56nvcE8nnvuWavVZnU8L/Fo2lpM7ySokjO8c1k4SPmFDoKmhXfYwJylJf0lLB8WnAB9OFvnQSoJ/sAuI8Ryyn4dQNJs803VDxg3HtXMC0rZox8ek10Gtv5F0f9Nmt81nioQtR9+msCdoYAvFyHrJTxb75/vULtvjHgYuUwGLefmqH5Vk5XadU8pfI8Athb0TMkcBZlxM/NLcbFLFAn6/vZRUArVdizkYTj4vtrvmB/9QQdWSzd5enkwRpIIzvVTFryzgyeaHdYCcAzxSpzBjA/otlBXYqKaTE4Yt6atS0cMV8qbWM/4TrFyyBlKSr5aAMbKStvg5tS437fOHy8RKeBUJfVefOyoPa3GbxGFXS/nrHNjnqMiFiJQ5uJwvLmtQjUCj7Qprmn3aSPghDPcPG3RdcmiCIruu5u89TGk+sWlft/tquNyBZsuuB/BK+qrVr3w+H/JjcEh66C/2FjIGro6rt9Z9eqsxrYpJIxLd8Kq7Ry3gzJfQLVGYY2NoaoQHX1HQdEUkY+XZOo8yF6+XHW9Ns99ArRok93O0+AFRK3iXESeT5C0vkbapoLf8q6F3FcCIiq/yOBleek7zqWDQJM+H/tiUb4I/Xc2AjJG/mJEG+8nFCd4wIrmdwbbShxla1fEUBfS7zxyiKNvODCcpT4f5vR1Okep6B9fzAxjMLcTdetdW1Pfqid81MFpmMMkOHzh3wOkHx04VNfbd+uI1em4Y4XP6HyGYtf6hT8gVN/b4lg8rqRpgOSp5wyVW1KvvWQwnmgEgL8zIzmCNnBqIOfLijTEHg7C5d97MdObEKG6SCxX8QCw3j0DxDCAnzPo6aJ7rDUzmemkJ/zF5f63RFo/+LQUvXmR8R4z8XUcGZVjm">
</div>

<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="10C1FD69">
</div>

					
					 
					<div class="header">
					    <a name="Main"></a>

					    
					    <a name="_articleTop" id="_articleTop"></a>
					    <div class="title">
					        <h1 id="ctl00_ArticleTitle">COM in plain C, Part 2</h1>
					    </div>

                        <div>
					        
					        <div class="entry flex-container">

								

                                <div class="flex-item" style="flex:1 1 auto">
                                    <div class="flex-container" style="justify-content:space-between;flex-wrap:wrap-reverse">
                                       <span id="ctl00_Authors" class="author flex-item"><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=88625" rel="author">Jeff Glatt</a></span> 

                                        <div class="flex-item" style="margin-top:-4px;">
                                            <div id="ctl00_RateArticle_RatingTable" class="small-text" data-objectref="2_13862_1">

	<meta itemprop="upvoteCount" content="95">


	<div id="ctl00_RateArticle_RatingRow" class="flex-container rating-container large-stars">

					
		<div id="ctl00_RateArticle_Prompt" class="rating-prompt nowrap">Rate me:</div>

		
		<div class="nowrap tooltip">

			
			
			

			
			<div id="ctl00_RateArticle_RatingHistWrap" class="tooltip">

				
				<div id="ctl00_RateArticle_ResultWithHist" class="rating-result"><div class="flex-container rating-stars large-stars"><div><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/star-fill-lg.png" style="width:24px;height:24px"></div><div><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/star-fill-lg.png" style="width:24px;height:24px"></div><div><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/star-fill-lg.png" style="width:24px;height:24px"></div><div><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/star-fill-lg.png" style="width:24px;height:24px"></div><div style="width:23px;" class="clipped"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/star-fill-lg.png" style="width:24px;height:24px"></div><div style="width:1px;position:relative" class="clipped"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/star-empty-lg.png" style="width:24px;height:24px;position:absolute;top:0px;right:0"></div></div></div>
				

				<div class="speech-bubble-container-up-right" style="width:170px">
					<div class="speech-bubble-up-right">
						<div class="histogram"></div>
					</div>
					<div class="speech-bubble-pointer-up-right">
						<div class="speech-bubble-pointer-up-right-inner"></div>
					</div>
				</div>
			</div>

			
            

			
            <span id="ctl00_RateArticle_RatingSignin" class="speech-bubble-container-down">
		        <div class="speech-bubble-down">
                    Please <a id="ctl00_RateArticle_SignUp" href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fArticles%2f13862%2fCOM-in-plain-C-Part-2">Sign up or sign in</a> 
                    to vote.
		        </div>
		        <div class="speech-bubble-pointer-down">
			        <div class="speech-bubble-pointer-down-inner"></div>
		        </div>
	        </span>    

		</div>
		
	
		
		<div id="ctl00_RateArticle_VoteCountNoHist" class="rating-votes nowrap">4.96/5  (98 votes)</div>	

		

		
		<div class="rating-undo" title="Undo vote" style="margin-left:5px;display:none"></div>

		
		
	</div>

	
	

</div>

                                        </div>
                                    </div>

                                    <div class="flex-container">
                                        <span id="ctl00_LastUpdated" class="date flex-item-tight" title="Date last updated">20 Apr 2006</span><a id="ctl00_LicenseLink" title="The Code Project Open License (CPOL)" class="license flex-item-tight" href="http://www.codeproject.com/info/cpol10.aspx">CPOL</a><span id="ctl00_ReadingTime" class="stats flex-item-tight">39 min read</span>
                                    </div>
                                </div>
					        </div>

                            

                        </div>

                        <div id="ctl00_DescriptionSpot" class="summary">How to write a COM component in C that can be used by script languages such as VBscript, Visual BASIC, jscript, etc.</div><span id="ctl00_ThumbnailUrl" class="date" content="https://codeproject.global.ssl.fastly.net/script/Articles/Images/article100x80.png"></span>			

                    </div>
                    
					
					

					

					
					

					
					

						
					

					

						
						<div id="contentdiv" class="text">
						



<ul class="download">
<li><a href="https://www.codeproject.com/KB/COM/com_in_c2/com_in_c2_src.zip">Download source files - 93.5 Kb</a> </li></ul>
<h2>Contents</h2>
<ul>
<li><a href="#intro">Introduction</a> 
</li><li><a href="#WHY">Why script languages can't use our DLL as is?</a> 
</li><li><a href="#TYPE">Automation data types (i.e., BSTR, VARIANT)</a> 
</li><li><a href="#DISPATCH">The IDispatch functions</a> 
</li><li><a href="#LIB">The type library</a> 
</li><li><a href="#REG">Registering the type library</a> 
</li><li><a href="#VB">A VBScript example</a> 
</li><li><a href="#PROP">A Property</a> 
</li><li><a href="#C">An updated example C application</a> 
</li><li><a href="#EXE">A COM component in an EXE</a> </li></ul>
<h2><a name="intro"></a>Introduction</h2>
<p>In the first part of this series, we created a COM component in plain
 C, packaged it into a DLL, and learned how to register it so that it 
could be used by any C/C++ application. We also created a C/C++ include 
file (<i>IExample.h</i>) that contained our GUIDs and the definition of our object's VTable (functions). By including this <i>.H</i>
 file, a C/C++ application knows what the names of our object VTable's 
members are (to call our functions), what arguments to pass, what the 
functions return, and what the GUIDs of our object and its VTable are. 
</p><p>Whereas this is all the support a C/C++ app needs, we must add further support (to our <code>IExample</code>
 DLL) to accommodate interpreted "scripting" languages such as Visual 
Basic, VBScript, Jscript, Python, etc. The focus of this article is how 
to add such support. After we add this support, we'll write a VBScript 
example to use our updated <code>IExample</code> component.</p>
<h2><a name="WHY">Why</a> script languages can't use our DLL as is?</h2>
<p>Unless a particular language can read our C/C++ include file and 
extract the information in it, a Visual Basic, Python, etc. application 
simply does not know what functions are in our object, what arguments 
those functions are passed, and what they return, and what our GUIDs 
are. Most languages do not support extracting information from a C/C++ 
include file. We need some way of specifying all the information 
contained within <i>IExample.h</i> in a language-neutral format, preferably a compact "binary" format, unlike <i>IExample.h</i>. As we'll see later, we do this by creating something called a <i>type library</i>.</p>
<p>To make it easier and more standardized for a script engine to peruse
 the contents of our "type library", we'll add some functions, called <code>IDispatch</code> functions, to our object. The script engine gets the type library information only via these <code>IDispatch</code>
 functions. Only our object directly accesses its own type library. By 
not having the script engine directly access our type library, this 
means that if Microsoft develops later versions of a type library, these
 messy version details will be hidden from the script engine.</p>
<p>There's another matter with data types. Consider a string in ANSI C. A
 C string is a series of 8-bit bytes ending with a 0 byte. But that 
isn't how strings are stored in Pascal. A Pascal string starts with a 
byte that tells how many more bytes follow. In other words, a Pascal 
string starts with a length byte, and then the rest of the bytes. There 
is no terminating 0 byte. And what about UNICODE versus ANSI? With 
UNICODE, every character in the string is actually 2 bytes (i.e., a <code>short</code>). Visual Basic strings are UNICODE, unlike ANSI C.</p>
<p>We need to deal with the problem of resolving these data type issues.
 We need to come up with a set of "generic data types" that work for any
 language that uses our object, and use only those data types for 
arguments to our object's functions (and any data our functions return).</p>
<h2><b><a name="TYPE">Automation</a> data types</b></h2>
<p>In order to support any language (as well as extensions in each 
language such as UNICODE), Microsoft has defined a generic set of data 
types that a COM object should use. Microsoft calls these "Automation 
data types". (Later, we'll look at where the word Automation comes 
from.) One such automation data type is a <code>BSTR</code>. If a COM object is passed a string, then the argument can take the form of a <code>BSTR</code>. What is a <code>BSTR</code>? It's a pointer to a specially formatted string. Every character is two bytes (i.e., a <code>short</code>),
 and it is prefaced with an unsigned long that tells how many more 
shorts follow, plus it ends with a 0 short. This accommodates the 
"string" data type of almost every language/extension. But it also means
 that, a C/C++ app, or our C object itself, will sometimes need to 
reformat a C string to a null-terminated UNICODE string prefaced with a 
length.</p>
<p>Just for the sake of illustration, let's take the following ANSI C string:</p><div class="pre-lang" id="premain31439"><div></div><div class="pre-action-link"><span id="copycode31439" class="copy-code" data-index="31439" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre31439" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-keyword">char</span> MyString[] = <span class="code-string">"</span><span class="code-string">Some text"</span>;</pre>
<p>First, let's break up the string into separate chars:</p><div class="pre-lang" id="premain207686"><div></div><div class="pre-action-link"><span id="copycode207686" class="copy-code" data-index="207686" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre207686" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-keyword">char</span> MyString[] = {<span class="code-string">'</span><span class="code-string">S'</span>,<span class="code-string">'</span><span class="code-string">o'</span>,<span class="code-string">'</span><span class="code-string">m'</span>,<span class="code-string">'</span><span class="code-string">e'</span>,<span class="code-string">'</span><span class="code-string"> '</span>,<span class="code-string">'</span><span class="code-string">t'</span>,<span class="code-string">'</span><span class="code-string">e'</span>,<span class="code-string">'</span><span class="code-string">x'</span>,<span class="code-string">'</span><span class="code-string">t'</span>, <span class="code-digit">0</span>};</pre>
<p>Since C strings are null-terminated, notice that we include that last, 0 byte in the array.</p>
<p>Now, we need to convert the string to UNICODE. This means that every char becomes a short. We'll just redefine the array as <code>short</code>:</p><div class="pre-lang" id="premain267218"><div></div><div class="pre-action-link"><span id="copycode267218" class="copy-code" data-index="267218" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre267218" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-keyword">short</span> MyString[] = {<span class="code-string">'</span><span class="code-string">S'</span>,<span class="code-string">'</span><span class="code-string">o'</span>,<span class="code-string">'</span><span class="code-string">m'</span>,<span class="code-string">'</span><span class="code-string">e'</span>,<span class="code-string">'</span><span class="code-string"> '</span>,<span class="code-string">'</span><span class="code-string">t'</span>,<span class="code-string">'</span><span class="code-string">e'</span>,<span class="code-string">'</span><span class="code-string">x'</span>,<span class="code-string">'</span><span class="code-string">t'</span>, <span class="code-digit">0</span>};</pre>
<p>Now, we need to preface the array with the number of bytes in the array. Note that we don't count the terminating zero as <code>short</code>. So, we have a length of 9 <code>short</code>s * 2 bytes per <code>short</code> (note the Intel Little Endian byte order):</p><div class="pre-lang" id="premain740794"><div></div><div class="pre-action-link"><span id="copycode740794" class="copy-code" data-index="740794" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre740794" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-keyword">short</span> MyString[] = {<span class="code-digit">18</span>, <span class="code-digit">0</span>, <span class="code-string">'</span><span class="code-string">S'</span>,<span class="code-string">'</span><span class="code-string">o'</span>,<span class="code-string">'</span><span class="code-string">m'</span>,<span class="code-string">'</span><span class="code-string">e'</span>,<span class="code-string">'</span><span class="code-string"> '</span>,<span class="code-string">'</span><span class="code-string">t'</span>,<span class="code-string">'</span><span class="code-string">e'</span>,<span class="code-string">'</span><span class="code-string">x'</span>,<span class="code-string">'</span><span class="code-string">t'</span>, <span class="code-digit">0</span>};</pre>
<p>A <code>BSTR</code> is defined as a pointer to this specially formatted UNICODE string. Actually, it is a pointer to the third <code>short</code> in the UNICODE string, because the length is supposed to <b>preface</b> the actual string. So, here we declare a variable of type <code>BSTR</code>, and set it to point to our string above:</p><div class="pre-lang" id="premain997895"><div></div><div class="pre-action-link"><span id="copycode997895" class="copy-code" data-index="997895" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre997895" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">BSTR  strptr;

strptr = &amp;MyString[2];</pre>
<p>We can now pass <code>strptr</code> to a COM object that expects a <code>BSTR</code> as an argument. And if one of our object's functions expects a <code>BSTR</code> argument, <code>strptr</code> is what is going to be passed.</p>
<p>But before you think that you have to manually reformat all of your 
strings as above, that's not necessary. Fortunately, there is an 
operating system function called <code>MultiByteToWideChar</code> to convert an ANSI C string to UNICODE, and functions like <code>SysAllocString</code> and <code>SysAllocStringLen</code>
 which will allocate a buffer to copy the UNICODE string, prefaced with 
an unsigned long holding the size of that buffer. So to take our 
original <code>char</code> string and make a <code>BSTR</code> pointer to it (error checking omitted), we can do:</p><div class="pre-lang" id="premain446529"><div></div><div class="pre-action-link"><span id="copycode446529" class="copy-code" data-index="446529" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre446529" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">DWORD len;
BSTR  strptr;
<span class="code-keyword">char</span>  MyString[] = <span class="code-string">"</span><span class="code-string">Some text"</span>;

<span class="code-comment">//</span><span class="code-comment"> Get the length (in wide chars) of the UNICODE buffer we'll need to</span>
<span class="code-comment">//</span><span class="code-comment"> convert MyString to UNICODE.</span>
len = MultiByteToWideChar(CP_ACP, <span class="code-digit">0</span>, MyString, -1, <span class="code-digit">0</span>, <span class="code-digit">0</span>);

<span class="code-comment">//</span><span class="code-comment"> Allocate a UNICODE buffer of the needed length. SysAllocStringLen will</span>
<span class="code-comment">//</span><span class="code-comment"> also allocate room for a terminating 0 short, and the unsigned long count.</span>
<span class="code-comment">//</span><span class="code-comment"> SysAllocStringLen will fill in the unsigned long with the value of</span>
<span class="code-comment">//</span><span class="code-comment"> "len * sizeof(wchar_t)" and then return a pointer to the third short in</span>
<span class="code-comment">//</span><span class="code-comment"> the buffer it allocates. All that is left for us to do is simply stuff a</span>
<span class="code-comment">//</span><span class="code-comment"> UNICODE version of our C string into this buffer.</span>
strptr = SysAllocStringLen(<span class="code-digit">0</span>, len);

<span class="code-comment">//</span><span class="code-comment"> Convert MyString to UNICODE in the buffer allocated by SysAllocStringLen.</span>
MultiByteToWideChar(CP_ACP, <span class="code-digit">0</span>, MyString, -1, strptr, len);

<span class="code-comment">//</span><span class="code-comment"> strptr is now a pointer (BSTR) to an Automation string datatype.</span></pre>
<p><b>Note:</b> Somebody must later free that buffer allocated by <code>SysAllocStringLen</code>, by passing <code>strptr</code> to <code>SysFreeString</code>. Typically, that somebody is whomever called <code>SysAllocStringLen</code> to allocate it.</p>
<p>Note that since the <code>BSTR</code> points past the unsigned long size, and the string is null-terminated anyway, you can treat a <code>BSTR</code> as if it is merely a wide char (<code>wchar_t</code>) data type. For example, you can pass it to <code>lstrlenW</code>
 to get the length in wide chars. But also note that, it's entirely 
possible that the string could have embedded 0s in it. If you write a 
function that expects to be passed a human-readable text string, then 
it's a good assumption that the <code>BSTR</code> won't be pointing to something with embedded zeroes in it. On the other hand, if the <code>BSTR</code> is pointing to binary data, then this may not be a good assumption. In this case, you can use <code>SysStringLen</code> to determine the true length in wide chars (or <code>SysStringByteLen</code> if you need the length in bytes).</p>
<p>There are other "Automation data types" too, such as a <code>long</code> (i.e., a 32-bit value). So our object's functions are not restricted to being passed only pointers to Automation strings.</p>
<p>In fact, some languages support the concept of a function being 
passed an argument which could be a choice of data types. Let's say, we 
have a <code>Print()</code> function. And, let's say, that this <code>Print</code> function takes one argument, which can be either a string pointer (<code>BSTR</code>), or a <code>long</code>,
 or maybe a variety of other Automation data types, and it will print 
whatever it is passed regardless. For example, if passed a <code>BSTR</code>, it will print the characters of that string. If passed a <code>long</code>, it will first do something akin to calling:</p><div class="pre-lang" id="premain109883"><div></div><div class="pre-action-link"><span id="copycode109883" class="copy-code" data-index="109883" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre109883" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">sprintf(myBuffer, <span class="code-string">"</span><span class="code-string">%ld"</span>, thePassedLong)</pre>
<p>...and then print out the resulting string in <code>myBuffer</code>.</p>
<p>This <code>Print</code> function needs some way to know whether it is being passed a string or a <code>long</code>. If we want to put this <code>Print</code> function into our object, we can have the application pass us another Automation data type called a <code>VARIANT</code>. A <code>VARIANT</code>
 is simply a struct that wraps another Automation data type. (This is 
the one type of "struct" that all languages supporting COM must 
internally understand and be able to create, simply for the purpose of 
passing arguments to an object's function, or receiving back data.)</p>
<p>A <code>VARIANT</code> has two members. The first member, <code>vt</code>, is set to some value that tells what other kind of data type your <code>VARIANT</code> is wrapping. The other member is a union, which is where you store the other data type.</p>
<p>So, if we wrap a <code>BSTR</code> into a <code>VARIANT</code> struct, then we set the <code>VARIANT</code>'s <code>vt</code> member to <code>VT_BSTR</code>, and store our <code>BSTR</code> (i.e., pointer to that specially formatted UNICODE string) in the <code>VARIANT</code>'s <code>bstrVal</code> member. If we wrap a <code>long</code>, then we set the <code>VARIANT</code>'s <code>vt</code> member to <code>VT_I4</code>, and store our <code>long</code> in the <code>VARIANT</code>'s <code>lVal</code> member (which, due to the union, is really the same member as <code>bstrVal</code>).</p>
<blockquote>
<p><b>In conclusion</b>, in order to support script languages, our 
object's functions must be written to be passed only a certain set of 
data types, called automation data types. Likewise, any data we return 
must be in the form of an automation data type.</p></blockquote>
<p>If you look at the definition of our <code>SetString</code> function, you'll notice one problem. We defined it to be passed a <code>char</code> pointer as so:</p><div class="pre-lang" id="premain274412"><div></div><div class="pre-action-link"><span id="copycode274412" class="copy-code" data-index="274412" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre274412" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-keyword">static</span> HRESULT STDMETHODCALLTYPE SetString(IExample *this, <span class="code-keyword">char</span> *str)</pre>
<p>This is an ANSI C string, which is not an automation data type. We need to replace this with a <code>BSTR</code> argument.</p>
<p>Our <code>GetString</code> function is even more troublesome for 
script languages. Not only is it defined to take an ANSI C string 
pointer, but the caller is expected to provide that non-UNICODE buffer, 
and our function modifies its contents. This is not automation 
compatible. When returning a <code>BSTR</code> to a script language, <b>we</b> must allocate the string and give it to the script engine. The script engine will call <code>SysFreeString</code> to free that string when done with it.</p>
<p>Given these requirements, the best thing to do is to change our <code>IExample</code> object so that its buffer member is a <code>BSTR</code>. When the script engine passes our <code>SetString</code> a <code>BSTR</code>, we'll make a copy of the string, and store this new <code>BSTR</code> in the buffer member. We'll then modify our <code>GetString</code> function to take a pointer to a <code>BSTR</code>
 (i.e., a handle) provided by the script engine. We'll create another 
copy of our string, and return it to the script engine (trusting that 
the script engine will free it).</p>
<p>So that we don't alter our original sources, I copied the contents of the <i>IExample</i> directory to a new directory named <i>IExample2</i>. I changed <i>IExample.c</i> to <i>IExample2.c</i>, and <i>IExample.h</i> to <i>IExample2.h</i>, etc.</p>
<p>In <i>IExample2.c</i>, let's rename our <code>MyRealIExample</code> struct to <code>MyRealIExample2</code>
 (to differentiate it from our original sources), and change the buffer 
member data type. (We'll also change the name of the member to 
"string"). Here is its new definition:</p><div class="pre-lang" id="premain320785"><div></div><div class="pre-action-link"><span id="copycode320785" class="copy-code" data-index="320785" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre320785" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">typedef <span class="code-keyword">struct</span> {
   IExample2Vtbl  *lpVtbl;
   DWORD          count;
   BSTR           <span class="code-keyword">string</span>;
} MyRealIExample2;</pre>
<p>And here are our updated <code>SetString</code> and <code>GetString</code> functions:</p><div class="pre-lang" id="premain378545"><div></div><div class="pre-action-link"><span class="code-collapse" data-index="378545" id="preShrink378545">Shrink ▲</span> &nbsp; <span id="copycode378545" class="copy-code" data-index="378545" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre378545" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-keyword">static</span> HRESULT STDMETHODCALLTYPE SetString(IExample2 

*this, BSTR str)
{
   <span class="code-comment">//</span><span class="code-comment"> Make sure that caller passed a string</span>
   <span class="code-keyword">if</span> (!str) <span class="code-keyword">return</span>(E_POINTER);

   <span class="code-comment">//</span><span class="code-comment"> First, free any old BSTR we allocated</span>
   <span class="code-keyword">if</span> (((MyRealIExample2 *)<span class="code-keyword">this</span>)-&gt;string)
       SysFreeString(((MyRealIExample2 *)<span class="code-keyword">this</span>)-&gt;string);

   <span class="code-comment">//</span><span class="code-comment"> Make a copy of the caller's string and save this new BSTR</span>
   <span class="code-keyword">if</span> (!(((MyRealIExample2 *)<span class="code-keyword">this</span>)-&gt;string = 
           SysAllocStringLen(str, SysStringLen(str))))
      <span class="code-keyword">return</span>(E_OUTOFMEMORY);

   <span class="code-keyword">return</span>(NOERROR);
}

<span class="code-keyword">static</span> HRESULT STDMETHODCALLTYPE GetString(IExample2 *this, BSTR *string)
{
   <span class="code-comment">//</span><span class="code-comment"> Make sure that caller passed a handle</span>
   <span class="code-keyword">if</span> (!string) <span class="code-keyword">return</span>(E_POINTER);

   <span class="code-comment">//</span><span class="code-comment"> Create a copy of our string and return the BSTR in his handle. The</span>
   <span class="code-comment">//</span><span class="code-comment"> caller is responsible for freeing it</span>
   <span class="code-keyword">if</span> (!(*string = SysAllocString(((MyRealIExample2 *)<span class="code-keyword">this</span>)-&gt;string)))
      <span class="code-keyword">return</span>(E_OUTOFMEMORY);

   <span class="code-keyword">return</span>(NOERROR);
}</pre>
<p>Also, our <code>Release</code> function must free that allocated string right before we free our <code>MyRealIExample2</code>:</p><div class="pre-lang" id="premain143610"><div></div><div class="pre-action-link"><span id="copycode143610" class="copy-code" data-index="143610" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre143610" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-keyword">if</span> (((MyRealIExample2 *)<span class="code-keyword">this</span>)-&gt;string)
        SysFreeString(((MyRealIExample2 *)<span class="code-keyword">this</span>)-&gt;string);
GlobalFree(<span class="code-keyword">this</span>);
</pre>
<p>And finally, when our <code>IClassFactory</code> creates a <code>MyRealIExample2</code>, it should clear the string member:</p><div class="pre-lang" id="premain112031"><div></div><div class="pre-action-link"><span id="copycode112031" class="copy-code" data-index="112031" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre112031" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">((MyRealIExample2 *)thisobj)-&gt;string = <span class="code-digit">0</span>;</pre>
<p>Of course, we need to update these function definitions in <i>IExample2.h</i>:</p><div class="pre-lang" id="premain225153"><div></div><div class="pre-action-link"><span id="copycode225153" class="copy-code" data-index="225153" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre225153" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-comment">//</span><span class="code-comment"> Extra functions</span>
STDMETHOD  (SetString)   (THIS_ BSTR) PURE;
STDMETHOD  (GetString)   (THIS_ BSTR *) PURE;</pre>
<p>We've now updated our object functions to use Automation data types.</p>
<h2><a name="DISPATCH">The</a> IDispatch functions</h2>
<p>Our next step is to add the <code>IDispatch</code> functions to our object. There are four <code>IDispatch</code>
 functions, already defined by Microsoft. We must write these four 
functions, and then add pointers to them in our object's VTable.</p>
<p><b>Important note:</b> In our VTable, these four pointers must be called <code>GetTypeInfoCount</code>, <code>GetTypeInfo</code>, <code>GetIDsOfNames</code>, and <code>Invoke</code>. They must appear in this order, after the three <code>IUnknown</code> functions (i.e., the first three pointers in our VTable), but before the pointers to any of our own extra functions (i.e., <code>SetString</code> and <code>GetString</code>). So, let's edit <i>IExample2.h</i>, and add the definitions for these four <code>IDispatch</code> functions. We'll change our object name from <code>IExample</code> to <code>IExample2</code>. Also, note that in the <code>DECLARE_INTERFACE_</code> line of our macro, we substitute the word <code>IDispatch</code> for <code>IUnknown</code>. This indicates that we're adding the standard <code>IDispatch</code> functions to our object.</p><div class="pre-lang" id="premain425626"><div></div><div class="pre-action-link"><span id="copycode425626" class="copy-code" data-index="425626" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre425626" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-comment">//</span><span class="code-comment"> IExample2's VTable</span>
<span class="code-preprocessor">#undef  INTERFACE
</span><span class="code-preprocessor">#define INTERFACE IExample2
</span>DECLARE_INTERFACE_ (INTERFACE, IDispatch)
{
   <span class="code-comment">//</span><span class="code-comment"> IUnknown functions</span>
   STDMETHOD  (QueryInterface)         (THIS_ REFIID, <span class="code-keyword">void</span> **) PURE;
   STDMETHOD_ (ULONG, AddRef)          (THIS) PURE;
   STDMETHOD_ (ULONG, Release)         (THIS) PURE;
   <span class="code-comment">//</span><span class="code-comment"> IDispatch functions</span>
   STDMETHOD_ (ULONG, GetTypeInfoCount)(THIS_ UINT *) PURE;
   STDMETHOD_ (ULONG, GetTypeInfo)     (THIS_ UINT, LCID, ITypeInfo **) PURE;
   STDMETHOD_ (ULONG, GetIDsOfNames)   (THIS_ REFIID, LPOLESTR *, 
                                        UINT, LCID, DISPID *) PURE;
   STDMETHOD_ (ULONG, Invoke)          (THIS_ DISPID, REFIID, 
                                        LCID, WORD, DISPPARAMS *,
                                        VARIANT *, EXCEPINFO *, UINT *) PURE;
   <span class="code-comment">//</span><span class="code-comment"> Extra functions</span>
   STDMETHOD  (SetString)              (THIS_ BSTR) PURE;
   STDMETHOD  (GetString)              (THIS_ BSTR *) PURE;
};</pre>
<p>Because I'm creating another COM component, I ran <i>GUIDGEN.EXE</i> to create new GUIDs for my <code>IExample2</code> and <code>IExample2VTbl</code>, and pasted them into <i>IExample2.h</i>.
 This allows us to test this new DLL without needing to uninstall our 
original DLL, nor have the new DLL interfere with the original. 
Otherwise, if we used the same GUIDs, we'd have two registered COM 
components (DLLs) with the same GUIDs. Not a good thing.</p>
<p>I also ran <i>GUIDGEN.EXE</i> a third time to generate a third GUID. We're going to need this for our type library. I added it to <i>IExample2.h</i>, and gave it a C variable name of <code>CLSID_TypeLib</code>.</p>
<p>Now, we need to write those four <code>IDispatch</code> functions. 
Fortunately, Microsoft's OLE32 DLL has some generic functions we can 
call that do most of the work for these four functions. The only real 
work we need to do is to load our type library (which we'll be creating 
later in this article), and create a COM object called an <code>ITypeInfo</code> to give to a script engine. But even there, Microsoft provides some functions to do a lot of that work, namely <code>LoadRegTypeLib</code> to load the type library, and <code>GetTypeInfoOfGuid</code> to create an <code>ITypeInfo</code>.</p>
<p>Our <code>GetTypeInfoCount</code> function is easy. The caller passes us a handle to a <code>UINT</code>. We fill this in with a 1 if we have a type library, or 0 if we don't. We do:</p><div class="pre-lang" id="premain125441"><div></div><div class="pre-action-link"><span id="copycode125441" class="copy-code" data-index="125441" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre125441" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">ULONG STDMETHODCALLTYPE GetTypeInfoCount(IExample2 *this, UINT *pCount)
{
   *pCount = <span class="code-digit">1</span>;
   <span class="code-keyword">return</span>(S_OK);
}</pre>
<p>Our <code>GetTypeInfo</code> function must return (to the script engine) a pointer to an <code>ITypeInfo</code> object that we create from our type library. What does an <code>ITypeInfo</code>
 object do? It manages the script engine's access to all of the 
information loaded from our type library. Remember, we said that we're 
not going to let anyone directly load and access our type library. 
Instead, we give the script engine an <code>ITypeInfo</code> object, whose functions parse our type library information and return specific information about a function in our <code>IExample2</code> object. For example, once we give our <code>ITypeInfo</code> to the script engine, that engine can call our <code>ITypeInfo</code>'s <code>GetFuncDesc</code> function to determine how many arguments are passed to our <code>GetString</code> function, what each type of argument is, and what <code>GetString</code> returns if anything.</p>
<p><i>"Oh great. More functions to write"</i>, you must be thinking. Yes, we could write all of the necessary functions for an <code>ITypeInfo</code> object, and put them in <i>IExample2.c</i>. We could then have <code>IExample2</code>'s <code>GetTypeInfo</code> function allocate one of our <code>ITypeInfo</code> objects, initialize it (i.e., store its VTable in it), and return it to the script engine.</p>
<p>But, we're not going to do this. We're going to save ourselves a bit of work. Microsoft has already written some generic <code>ITypeInfo</code> functions (contained in the OLE DLLs), and gives us a function we can call that will allocate an <code>ITypeInfo</code> for us, and fill in its VTable to these generic functions. We can then give this "generic" <code>ITypeInfo</code> to the script engine. All we need to do is load our type library into memory and "give" it to this generic <code>ITypeInfo</code>,
 and from then on, Microsoft's functions will handle doling out the 
information to the script engine. In order to take advantage of 
Microsoft's generic <code>ITypeInfo</code> functions, we must adhere to certain rules. We must make sure our <code>IExample2</code> object is defined as something called a <i>dual interface</i>. Let's not worry right now what that is. But we're going to adhere to this requirement.</p>
<p>Before we dive into our <code>GetTypeInfo</code> function, let me say
 one thing about a type library. It can contain strings that are meant 
to be displayed to humans. For example, if we want, we could tag our <code>GetString</code> function with a "text description" that reads: <i>This function returns an IExample2 object's string</i>. Then, for example, the Visual BASIC IDE could get our <code>ITypeInfo</code> object, call its <code>GetDocumentation</code> function to retrieve this description for <code>GetString</code>, and display it to a VB programmer who wants to call our <code>IExample</code>'s <code>GetString</code>.
 There are many human languages, so just like the resources for your 
EXE/DLL can be in different languages, so too does a type library have a
 "Language ID" (LCID). For this article, we're going to create only an 
English type library, and ignore any issues concerning loading a 
particular language type library. Just be aware that a script engine may
 pass our <code>GetTypeInfo</code> function a LCID other than English, if it desires another language.</p>
<p><code>GetTypeInfo</code> is defined as so:</p><div class="pre-lang" id="premain775727"><div></div><div class="pre-action-link"><span id="copycode775727" class="copy-code" data-index="775727" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre775727" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">ULONG STDMETHODCALLTYPE GetTypeInfo(IExample2 *this, 
      UINT itinfo, LCID lcid, ITypeInfo **pTypeInfo)</pre>
<p>The <code>itinfo</code> argument is not used, and should be 0. The 
LCID specifies what language type library to use. Again, we ignore this 
since we're going to deal only with English. The final argument is where
 the script engine expects us to return a pointer to our <code>ITypeInfo</code> object.</p>
<p>We only ever need one <code>ITypeInfo</code> object because its contents do not change. So our <code>GetTypeInfo</code> function will simply make sure that our type library is loaded, and that we have gotten a pointer to Microsoft's generic <code>ITypeInfo</code>. We'll store this pointer in a global variable. We do need to increment the <code>ITypeInfo</code>'s reference count (i.e., call its <code>AddRef</code> function) every time the script engine calls our <code>GetTypeInfo</code>. (And of course, we expect the script engine to call <code>ITypeInfo</code>'s <code>Release</code> when done with the <code>ITypeInfo</code>). So, here is our <code>GetTypeInfo</code> function, and a helper function (<code>loadMyTypeInfo</code>) we write that does the real work of loading our type library and getting Microsoft's generic <code>ITypeInfo</code>. Note how our helper function calls the OLE API <code>LoadRegTypeLib</code>
 to do all the work of loading our type library. All we need to do is 
pass the GUID that I created for our type library (and put in <i>IExample2.h</i>, giving it the variable name <code>CLSID_TypeLib</code>).</p><div class="pre-lang" id="premain741715"><div></div><div class="pre-action-link"><span class="code-collapse" data-index="741715" id="preShrink741715">Shrink ▲</span> &nbsp; <span id="copycode741715" class="copy-code" data-index="741715" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre741715" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">ULONG STDMETHODCALLTYPE GetTypeInfo(IExample2 *this, 
      UINT itinfo, LCID lcid, ITypeInfo **pTypeInfo)
{
   HRESULT  hr;

   <span class="code-comment">//</span><span class="code-comment"> Assume an error.</span>
   *pTypeInfo = <span class="code-digit">0</span>;

   <span class="code-keyword">if</span> (itinfo) hr = ResultFromScode(DISP_E_BADINDEX);

   <span class="code-comment">//</span><span class="code-comment"> If our ITypeInfo is already created,</span>
   <span class="code-comment">//</span><span class="code-comment"> just increment its ref count.</span>
   <span class="code-keyword">else</span> <span class="code-keyword">if</span> (MyTypeInfo)
   {
      MyTypeInfo-&gt;lpVtbl-&gt;AddRef(MyTypeInfo);
      hr = <span class="code-digit">0</span>;
   }
   <span class="code-keyword">else</span>
   {
      <span class="code-comment">//</span><span class="code-comment"> Load our type library and</span>
      <span class="code-comment">//</span><span class="code-comment"> get Microsoft's generic ITypeInfo object.</span>
      hr = loadMyTypeInfo(<span class="code-keyword">this</span>);
   }

   <span class="code-keyword">if</span> (!hr) *pTypeInfo = MyTypeInfo;

   <span class="code-keyword">return</span>(hr);
}

<span class="code-keyword">static</span> HRESULT loadMyTypeInfo(<span class="code-keyword">void</span>)
{
   HRESULT   hr;
   LPTYPELIB pTypeLib;

   <span class="code-comment">//</span><span class="code-comment"> Load our type library and get a ptr to its TYPELIB. Note: This does an</span>
   <span class="code-comment">//</span><span class="code-comment"> implicit pTypeLib-&gt;lpVtbl-&gt;AddRef(pTypeLib).</span>
   <span class="code-keyword">if</span> (!(hr = LoadRegTypeLib(&amp;CLSID_TypeLib, <span class="code-digit">1</span>, <span class="code-digit">0</span>, <span class="code-digit">0</span>, &amp;pTypeLib)))
   {
      <span class="code-comment">//</span><span class="code-comment"> Get Microsoft's generic ITypeInfo,</span>
      <span class="code-comment">//</span><span class="code-comment"> giving it our loaded type library. We only</span>
      <span class="code-comment">//</span><span class="code-comment"> need one of these, and we'll store</span>
      <span class="code-comment">//</span><span class="code-comment"> it in a global. Tell Microsoft this is for</span>
      <span class="code-comment">//</span><span class="code-comment"> our IExample2's VTable, by passing that VTable's GUID.</span>
      <span class="code-keyword">if</span> (!(hr = pTypeLib-&gt;lpVtbl-&gt;GetTypeInfoOfGuid(
            pTypeLib, &amp;IID_IExample2, &amp;MyTypeInfo)))
      {
         <span class="code-comment">//</span><span class="code-comment"> We no longer need the ptr</span>
         <span class="code-comment">//</span><span class="code-comment"> to the TYPELIB now that we've given it</span>
         <span class="code-comment">//</span><span class="code-comment"> to Microsoft's generic ITypeInfo.</span>
         <span class="code-comment">//</span><span class="code-comment"> Note: The generic ITypeInfo has done</span>
         <span class="code-comment">//</span><span class="code-comment"> a pTypeLib-&gt;lpVtbl-&gt;AddRef(pTypeLib),</span>
         <span class="code-comment">//</span><span class="code-comment"> so this TYPELIB ain't going away</span>
         <span class="code-comment">//</span><span class="code-comment"> until the generic ITypeInfo does</span>
         <span class="code-comment">//</span><span class="code-comment"> a pTypeLib-&gt;lpVtbl-&gt;Release too.</span>
         pTypeLib-&gt;lpVtbl-&gt;Release(pTypeLib);

         <span class="code-comment">//</span><span class="code-comment"> Since caller wants us to return our ITypeInfo pointer,</span>
         <span class="code-comment">//</span><span class="code-comment"> we need to increment its reference count. Caller is</span>
         <span class="code-comment">//</span><span class="code-comment"> expected to Release() it when done.</span>
         MyTypeInfo-&gt;lpVtbl-&gt;AddRef(MyTypeInfo);
      }
   }

   <span class="code-keyword">return</span>(hr);
}</pre>
<p>When we later create our type library, we'll need to assign each one of our own functions we add to <code>IExample2</code> (i.e., <code>GetString</code> and <code>SetString</code>)
 a numeric value, which Microsoft refers to as a DISPID (Dispatch ID). 
This can be any value of our choosing, but each function must have a 
unique DISPID. (Note: Do not use the value 0, or negative values). We'll
 arbitrarily assign a DISPID of 1 to <code>GetString</code>, and 2 to <code>SetString</code>.
 Script engines internally use this DISPID for faster calls to our 
functions, since it's quicker to lookup a function in some table via 
matching a numeric value versus comparison of a function name string.</p>
<p>Next, we write our <code>GetIDsOfNames</code> function. The purpose 
of this function is to allow the script engine to pass us the name of 
one of our own functions we added to <code>IExample2</code> (i.e., <code>GetString</code> or <code>SetString</code>), and we'll return the DISPID we assigned to that function. For example, if the engine passes us "<code>GetString</code>", then we'll return the DISPID 1.</p>
<p>Because we're going to define our <code>IExample2</code> as a "dual interface" when we create our type library, we can then call the OLE function <code>DispGetIDsOfNames</code>, which will do all the work that our <code>GetIDsOfNames</code>
 needs to do (i.e., parsing the info in our type library to look up the 
DISPID we assigned to a particular function). The only thing we need to 
do is make sure that we got a <code>ITypeInfo</code>, because that needs to be passed to <code>DispGetIDsOfNames</code>. So, here is our <code>GetIDsOfNames</code>:</p><div class="pre-lang" id="premain628158"><div></div><div class="pre-action-link"><span id="copycode628158" class="copy-code" data-index="628158" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre628158" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">ULONG STDMETHODCALLTYPE GetIDsOfNames(IExample2 *this, 
      REFIID riid, LPOLESTR *rgszNames, UINT cNames, 
      LCID lcid, DISPID *rgdispid)
{
   <span class="code-keyword">if</span> (!MyTypeInfo)
   {
      HRESULT hr;

      <span class="code-keyword">if</span> ((hr = loadMyTypeInfo())) <span class="code-keyword">return</span>(hr);
   }

   <span class="code-comment">//</span><span class="code-comment"> Let OLE32.DLL's DispGetIDsOfNames()</span>
   <span class="code-comment">//</span><span class="code-comment"> do all the real work of using our type</span>
   <span class="code-comment">//</span><span class="code-comment"> library to look up the DISPID</span>
   <span class="code-comment">//</span><span class="code-comment"> of the requested function in our object</span>
   <span class="code-keyword">return</span>(DispGetIDsOfNames(MyTypeInfo, rgszNames, 
                            cNames, rgdispid));
}</pre>
<p>We have one last <code>IDispatch</code> function to write - <code>Invoke</code>. This is what the script engine calls to (indirectly) call another one of the functions we added to <code>IExample2</code> (i.e., <code>GetString</code> or <code>SetString</code>). The script engine passes the DISPID for the function it wants to call (i.e., 1 for <code>GetString</code>, or 2 for <code>SetString</code>). The engine also passes an array of <code>VARIANT</code> structs, filled in with the arguments to be passed to <code>GetString</code> or <code>SetString</code>. It also passes a <code>VARIANT</code> we need to fill in with any return value from the function (not the <code>HRESULT</code> return from <code>Invoke</code>, but rather, whatever our type library indicates is the return value from <code>GetString</code> or <code>SetString</code>).</p>
<p>So, what our <code>Invoke</code> function does is first look at the DISPID. If it's 1, we know that we have to call <code>GetString</code>. If it's 2, we know we have to call <code>SetString</code>. So immediately, you should be thinking <i>case statement</i>. And it could be a big <code>case</code> statement if you've added lots of functions to <code>IExample2</code>.</p>
<p>Next, we need to pull those arguments out of the <code>VARIANT</code>s and call the correct function, passing it the arguments. For example, if the script is calling <code>SetString</code>, we need to pull the <code>BSTR</code> out of the first <code>VARIANT</code> and pass it to <code>SetString</code>.</p>
<p>Here's a problem. A script engine is allowed to pass a <code>VARIANT</code> that wraps what may not be the exact data type we expect, but one that can be coerced into the correct type. Our <code>SetString</code> expects a <code>BSTR</code>
 (pointer to a string). But, let's assume the script engine wants to set
 our string member to the string "10". Now, this is how the engine could
 setup the <code>VARIANT</code> passed to us:</p><div class="pre-lang" id="premain648723"><div></div><div class="pre-action-link"><span id="copycode648723" class="copy-code" data-index="648723" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre648723" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">VARIANT myArg;

myArg.vt = VT_BSTR;
myArg.bstrVal = SysAllocString(L<span class="code-string">"</span><span class="code-string">10"</span>);</pre>
<p>OK, we're good to go. It's passing us a <code>BSTR</code> wrapped in that <code>VARIANT</code>.</p>
<p>But the engine could instead pass us a <code>long</code>, as so:</p><div class="pre-lang" id="premain438888"><div></div><div class="pre-action-link"><span id="copycode438888" class="copy-code" data-index="438888" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre438888" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">VARIANT myArg;

myArg.vt = VT_I4;
myArg.lVal = <span class="code-digit">10</span>;</pre>
<p>Now, our <code>Invoke</code> function has to see that this is not <code>VT_BSTR</code>, and do the conversion ourselves before we call <code>SetString</code> (error checking omitted):</p><div class="pre-lang" id="premain722842"><div></div><div class="pre-action-link"><span class="code-collapse" data-index="722842" id="preShrink722842">Shrink ▲</span> &nbsp; <span id="copycode722842" class="copy-code" data-index="722842" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre722842" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-comment">//</span><span class="code-comment"> Determine which function to call based upon the DISPID</span>
<span class="code-comment">//</span><span class="code-comment"> the caller passed us.</span>
<span class="code-keyword">switch</span> (dispid)
{
   <span class="code-comment">//</span><span class="code-comment"> GetString()</span>
   <span class="code-keyword">case</span> <span class="code-digit">1</span>:
      <span class="code-comment">//</span><span class="code-comment"> Here we'd call GetString with the appropriate args.</span>
      <span class="code-keyword">break</span>;

   <span class="code-comment">//</span><span class="code-comment"> SetString()</span>
   <span class="code-keyword">case</span> <span class="code-digit">2</span>:
      <span class="code-comment">//</span><span class="code-comment"> Did he pass the BSTR that SetString expects?</span>
      <span class="code-keyword">if</span> (params-&gt;rgdispidNamedArgs[0]-&gt;vt != VT_BSTR)
      {
         <span class="code-comment">//</span><span class="code-comment"> Nope. We've got to try to convert whatever he passed</span>
         <span class="code-comment">//</span><span class="code-comment"> into a BSTR.</span>

         <span class="code-comment">//</span><span class="code-comment"> Did he pass a long?</span>
         <span class="code-keyword">if</span> (params-&gt;rgdispidNamedArgs[0]-&gt;vt == VT_I4)
         {
             <span class="code-comment">//</span><span class="code-comment"> Create a BSTR out of that long.</span>
             wchar_t temp[33];

             wsprintW(temp, L<span class="code-string">"</span><span class="code-string">%d"</span>, params-&gt;rgdispidNamedArgs[0]-&gt;lVal);
             params-&gt;rgdispidNamedArgs[0]-&gt;bstrVal = SysAllocString(temp);

             <span class="code-comment">//</span><span class="code-comment"> NOTE: The engine will free this BSTR when it calls</span>
             <span class="code-comment">//</span><span class="code-comment"> VariantClear() on params-&gt;rgdispidNamedArgs[0].</span>
         }
         <span class="code-keyword">else</span>
         {
            <span class="code-comment">//</span><span class="code-comment"> Here we need to check/convert even more possible datatypes!</span>
            <span class="code-comment">//</span><span class="code-comment"> If we exhaust the logical possibilites, return DISP_E_TYPEMISMATCH.</span>
         }
     }

     <span class="code-comment">//</span><span class="code-comment"> Call SetString with the BSTR arg.</span>
     <span class="code-keyword">return</span>(this-&gt;lpVtbl-&gt;SetString(<span class="code-keyword">this</span>, params-&gt;rgdispidNamedArgs[0]-&gt;bStrVal));
}</pre>
<p><i>"Oh great! This could turn into major work for me, given there are lots of functions!"</i>, you're thinking. Yes, it could. But at least, Microsoft does provide a bunch of OLE APIs to convert a <code>VARIANT</code> from one type to another. So, we can simply do:</p><div class="pre-lang" id="premain953332"><div></div><div class="pre-action-link"><span id="copycode953332" class="copy-code" data-index="953332" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre953332" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-comment">//</span><span class="code-comment"> SetString()</span>
<span class="code-keyword">case</span> <span class="code-digit">2</span>:
   <span class="code-keyword">if</span> ((hr = VariantChangeType(¶ms-&gt;rgdispidNamedArgs[0],
       ¶ms-&gt;rgdispidNamedArgs[0], <span class="code-digit">0</span>, VT_BSTR))) <span class="code-keyword">return</span>(hr);
   <span class="code-keyword">return</span>(this-&gt;lpVtbl-&gt;SetString(<span class="code-keyword">this</span>, 
          params-&gt;rgdispidNamedArgs[0]-&gt;bStrVal));</pre>
<p>But, here's something even better. Because we're going to define <code>IExample2</code> as a dual interface, we can call the Microsoft function <code>DispInvoke</code> to do <b>all</b>
 of the work for us. It uses our type library to match that DISPID with 
the correct function to call, checks/converts the arguments, calls the 
correct function, and even messages the return value into the <code>VARIANT</code> the engine passed for that purpose. The only thing we need to do, like in our <code>GetIDsOfNames</code> function, is make sure that we have got a <code>ITypeInfo</code> because that needs to be passed to the <code>DispInvoke</code>. So, here's our <code>Invoke</code>:</p><div class="pre-lang" id="premain685225"><div></div><div class="pre-action-link"><span class="code-collapse" data-index="685225" id="preShrink685225">Shrink ▲</span> &nbsp; <span id="copycode685225" class="copy-code" data-index="685225" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre685225" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">ULONG STDMETHODCALLTYPE Invoke(IExample2 *this, 
      DISPID dispid, REFIID riid, LCID lcid,
      WORD wFlags, DISPPARAMS *params, VARIANT *result, 
      EXCEPINFO *pexcepinfo, UINT *puArgErr)
{
   <span class="code-comment">//</span><span class="code-comment"> We implement only a "default" interface</span>
   <span class="code-keyword">if</span> (!IsEqualIID(riid, &amp;IID_NULL))
      <span class="code-keyword">return</span>(DISP_E_UNKNOWNINTERFACE);

   <span class="code-comment">//</span><span class="code-comment"> We need our ITypeInfo (to pass to DispInvoke)</span>
   <span class="code-keyword">if</span> (!MyTypeInfo)
   {
      HRESULT hr;

      <span class="code-keyword">if</span> ((hr = loadMyTypeInfo())) <span class="code-keyword">return</span>(hr);
   }

   <span class="code-comment">//</span><span class="code-comment"> Let OLE32.DLL's DispInvoke() do all</span>
   <span class="code-comment">//</span><span class="code-comment"> the real work of calling the appropriate</span>
   <span class="code-comment">//</span><span class="code-comment"> function in our object, and massaging</span>
   <span class="code-comment">//</span><span class="code-comment"> the passed args into the correct format</span>
   <span class="code-keyword">return</span>(DispInvoke(<span class="code-keyword">this</span>, MyTypeInfo, dispid, wFlags, 
          <span class="code-keyword">params</span>, result, pexcepinfo, puArgErr));
}</pre>
<p>And, that takes care of all the <code>IDispatch</code> functions.</p>
<blockquote>
<p><b>In conclusion</b>, in order to support script languages, our object's VTable must include the four standard <code>IDispatch</code> functions. They must appear immediately after the first three, <code>IUnknown</code> functions (<code>QueryInterface</code>, <code>AddRef</code>, and <code>Release</code>).
 To make it easier to implement them, we can define our VTable as "dual 
interface" (in our type library) and then call some Microsoft OLE 
functions to do most of the real work.</p></blockquote>
<h2><a name="LIB">The</a> type library</h2>
<p>Our next step is to create our type library. First, we need to create
 the "source" file that contains the definitions of our object and its 
VTable, and their GUIDs, much like we created <i>IExample.h</i> for the benefit of our C compiler. But, the format of this source file will be different than <i>IExample.h</i>, and we will compile it with a special utility called <i>MIDL.EXE</i> (which ships with your compiler, or can be found in Microsoft's Windows Platform SDK).</p>
<p>Typically, this source file's name ends with the extension <i>.IDL</i>. If so, when we add it to our Visual C++ project, Visual C++'s IDE will automatically invoke <i>MIDL.EXE</i> on it to turn it into a binary file whose name ends with the extension <i>.TLB</i>. That TLB file is our type library.</p>
<p>In the <i>IExample2</i> directory, you will find the file <i>IExample2_extra.idl</i> which is the source for our type library. The syntax has some similarities with C++. A line preceded with <code>//</code> is a comment. And, C style opening and closing braces <code>{</code> and <code>}</code> are used to contain a particular "structure" or entity.</p>
<p>The IDL begins with the following lines:</p><div class="pre-lang" id="premain556440"><div></div><div class="pre-action-link"><span id="copycode556440" class="copy-code" data-index="556440" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre556440" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-bracket">[</span><span class="code-sdkkeyword">uuid</span>(E1124082-5FCD-4a66-82A6-755E4D45A9FC), version(<span class="code-digit">1</span>.<span class="code-digit">0</span>), 

helpstring(<span class="code-string">"</span><span class="code-string">IExample2 COM server"</span>)]
library IExample2
{</pre>
<p>The first line is enclosed in brackets. It contains three particular 
bits of info, each separated by a comma. The first bit of info is the 
GUID for our type library. Note that it is the same GUID as specified in
 <i>IExample2.h</i> for <code>CLSID_TypeLib</code> (i.e., it's that extra GUID I generated to use for our type library).</p>
<p>Next, is the version number for our type library (which I've chosen as 1.0).</p>
<p>Last, is any help description (for our type library) that we'd like 
some object browser to display to a programmer (such as Visual BASIC's 
object browser may do). Here, I identity what my COM component is/does. 
For example, if you were creating a COM component that reads UPC bar 
codes, perhaps your help string would be "Acme Brand UPC bar code 
reader".</p>
<p>The next line must start with a <code>library</code> keyword. After this, you can give some name to the type library. I just chose <code>IExample2</code>, but it could be anything of your choice. Note that this is not related to the actual filename of the TLB file.</p>
<p>Finally, we have an opening brace. Everything between this and the 
final closing brace in our IDL source will be part of our type library. 
This is where we put the definitions of our <code>IExample2</code> object and its VTable.</p>
<p>The next line:</p><div class="pre-lang" id="premain190348"><div></div><div class="pre-action-link"><span id="copycode190348" class="copy-code" data-index="190348" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre190348" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">importlib(<span class="code-string">"</span><span class="code-string">STDOLE2.TLB"</span>);</pre>
<p>is like a <code>#include</code> statement in a <i>.H</i> file. It includes the contents of Microsoft's <i>STDOLE2.TLB</i> file (shipped with your compiler, or in the SDK) which defines basic COM objects such as <code>IUnknown</code> and <code>IDispatch</code>. We need to reference this since our <code>IExample2</code> VTable has the <code>IDispatch</code> functions (and therefore the <code>IUnknown</code> functions too) appearing at the start of it.</p>
<p>What follows is the start of our <code>IExample2</code>'s VTable definition. It looks like so:</p><div class="pre-lang" id="premain272323"><div></div><div class="pre-action-link"><span id="copycode272323" class="copy-code" data-index="272323" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre272323" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-bracket">[</span><span class="code-sdkkeyword">uuid</span>(B6127C55-AC5F-4ba0-AFF6-7220C95EEF4D), dual, 
      oleautomation, hidden, nonextensible]
<span class="code-keyword">interface</span> IExample2Vtbl : IDispatch
{</pre>
<p>The first line is between brackets, and it contains the GUID for our <code>IExample2</code>'s VTable (which you'll note is the same GUID identified as <code>IID_IExample2</code> in <i>IExample2.h</i>; it must be so).</p>
<p>This line also contains several keywords that describe our VTable. The most important keyword is "<code>dual</code>". This is how we indicate that <code>IExample2</code> is a "dual interface". What this means is that, in addition to allowing some C/C++ application to directly call our <code>SetString</code> and <code>GetString</code> functions via <code>IExample2</code>'s VTable (like you saw in the demo C application with the first article), that same VTable also has the four <code>IDispatch</code> functions in it which a script engine such as VBScript can use to (indirectly) call <code>SetString</code> and <code>GetString</code> via <code>Invoke</code>. That's why it is called "<code>dual</code>". This same VTable works for both C/C++ apps that want to call our <code>SetString</code> and <code>GetString</code> functions directly, as well as a script engine that needs to call them via our <code>Invoke</code> function.</p>
<p>The <code>oleautomation</code> keyword means that we are using only Automation data types for arguments passed to the <code>SetString</code> and <code>GetString</code> functions, and also for any returned values.</p>
<p><b>Note:</b> The <code>dual</code> keyword automatically implies <code>oleautomation</code>. So, we technically don't need to specify <code>oleautomation</code>. But, I do anyway. If you identify a VTable with the <code>oleautomation</code>
 keyword, and then you try to use some non-Automation data type as an 
argument (or a return value) in one of your functions, the <i>MIDL.EXE</i> will give an error. Note that older versions of <i>MIDL.EXE</i> may flag newer Automation data types as an error, so make sure you use the <i>MIDL.EXE</i> in the latest Platform SDK.</p>
<p>The <code>hidden</code> keyword simply means that we don't want our VTable itself to be listed in some object browser. We want to show only our <code>IExample2</code> object, which we'll define presently.</p>
<p>The <code>nonextensible</code> keyword means that we won't be doing 
something unexpected like adding extra functions (which aren't defined 
in our type library) to <code>IExample2</code>'s VTable when we actually allocate and give an <code>IExample2</code> object to someone.</p>
<p>The next line must start with <code>interface</code> to indicate that
 we're defining a VTable. This is followed by whatever name we decide to
 give to this VTable in our IDL source. We could call it <code>IExample2Vtbl</code>, or whatever. I went with "<code>IExample2Vtbl</code>". We also specify the <code>IDispatch</code> type since our <code>IExample2</code> VTable does, in fact, start with an <code>IDispatch</code> (and of course, an <code>IUnknown</code> before that, since <code>IDispatch</code> implies <code>IUnknown</code> too).</p>
<p><b>Note:</b> If our VTable did not have the four <code>IDispatch</code> functions, then we would define it as the <code>IUnknown</code> type instead. 
</p><p>Finally, we have an opening C brace. After this is where we list all of the functions in our VTable. It looks like this:</p><div class="pre-lang" id="premain728460"><div></div><div class="pre-action-link"><span id="copycode728460" class="copy-code" data-index="728460" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre728460" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-bracket">[</span><span class="code-sdkkeyword">helpstring</span>(<span class="code-string">"</span><span class="code-string">Sets the test string."</span>)]
[id(<span class="code-digit">1</span>)] HRESULT SetString([in] BSTR str);
[helpstring(<span class="code-string">"</span><span class="code-string">Gets the test string."</span>)]
[id(<span class="code-digit">2</span>)] HRESULT GetString([out, retval] BSTR *strptr);</pre>
<p>First of all, you'll note that we don't define the <code>IUnknown</code> (<code>QueryInterface</code>, <code>AddRef</code>, and <code>Release</code>) nor the <code>IDispatch</code> (<code>GetTypeInfoCount</code>, <code>GetTypeInfo</code>, <code>GetIDsOfNames</code>, and <code>Invoke</code>) functions. We don't have to, because we specified <code>IDispatch</code> as our VTable type, so these automatically get added by the <i>MIDL.EXE</i> (which knows about those functions because we imported <i>STDOLE.TLB</i>).</p>
<p>So, we list only those functions we added to the end of <code>IExample2</code>'s VTable (i.e., <code>SetString</code> and <code>GetString</code>). These <b>must</b> be listed in the same order as they appear in <i>IExample2.h</i>'s definition of our VTable.</p>
<p>We've specified a help string before each function. Again, this is 
just text that an object browser would display to a programmer.</p>
<p>For each function, we first specify the DISPID that we choose to give it. Remember that we arbitrarily decided to choose 1 for <code>SetString</code> and 2 for <code>GetString</code>.</p>
<p>The rest of the definition for each function looks the same as in <i>IExample2.h</i>,
 except for one thing. Before each argument, we have to specify whether 
the argument is something that is initialized to a particular value by 
the script engine before it is passed to us (i.e., an <code>[in]</code> argument), or is an un-initialized argument that the engine expects us to fill in with some value (i.e., an <code>[out]</code>
 argument). Or maybe, it's even supposed to be an argument that the 
script engine initializes to some value, and then also expects us to 
modify it with a new value (i.e., an <code>[in, out]</code> argument). Or, maybe it can be an argument that is passed to us, which the engine expects our <code>Invoke</code> function to store in that special <code>VARIANT</code> the engine passes for the purpose of returning the value (i.e., an <code>[out, retval]</code> argument).</p>
<p><code>SetString</code> expects to be passed a <code>BSTR</code> that the engine has set to a particular value. So, we identify that as <code>[in]</code>.</p>
<p>Since <code>GetString</code> expects to be passed a <code>BSTR</code> pointer that we will fill in with a copy of a string we allocated, we should specify this as an <code>[out]</code> argument. Unfortunately, for reasons I won't get into here, Microsoft doesn't allow simply <code>[out]</code>. We must either use <code>[in, out]</code> or <code>[out, retval]</code>. The difference between the two is whether we want our allocated <code>BSTR</code> to be returned to the script as the return value of its call to <code>GetString</code> (i.e., <code>[out, retval]</code>), or whether the script will pass the name of some variable to <code>GetString</code> to be filled in (i.e., <code>[in, out]</code>). In other words, it depends upon how we want the script to call our <code>GetString</code> function. We have two choices, and here are the choices illustrated using VBScript:</p><div class="pre-lang" id="premain972790"><div>VBScript</div><div class="pre-action-link"><span id="copycode972790" class="copy-code" data-index="972790" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre972790" style="margin-top:0;" class="lang-vbscript notranslate" data-language="vbscript" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true">newString = GetString()  <span class="code-comment">'</span><span class="code-comment"> [out, retval]</span>
GetString(newString)     <span class="code-comment">'</span><span class="code-comment"> [in, out]</span></pre>
<p>The former looks more natural to me, so we'll go ahead and define the argument passed to <code>GetString</code> as <code>[out, retval]</code>.</p>
<p><b>Note:</b> Only one argument passed to your function can be marked as <code>[out, retval]</code>. The remaining arguments must be either <code>[in]</code> or <code>[in, out]</code>.</p>
<p>We end the definition of our VTable with a closing brace. 
</p><p>Now, we get to the definition of our <code>IExample2</code> object. It looks like so:</p><div class="pre-lang" id="premain914640"><div></div><div class="pre-action-link"><span id="copycode914640" class="copy-code" data-index="914640" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre914640" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-bracket">[</span><span class="code-sdkkeyword">uuid</span>(520F4CFD-61C6-4eed-<span class="code-digit">8004</span>-C26D514D3D19), 
      helpstring(<span class="code-string">"</span><span class="code-string">IExample2 object."</span>), appobject]
coclass IExample2
{
   [default] <span class="code-keyword">interface</span> IExample2Vtbl;
}</pre>
<p>The first line specifies the GUID for our <code>IExample2</code> object. Again, note that it is the same GUID defined in <i>IExample2.h</i> as <code>CLSID_IExample2</code>, and it must be so.</p>
<p>We specify a help string that lets an object browser know what this particular object is/does.</p>
<p>The <code>appobject</code> keyword indicates that our <code>IExample2</code> object can be gotten via <code>CoGetClassObject</code>.</p>
<p>The next line must start with <code>coclass</code>, followed by what we decide to call our object in this IDL source.</p>
<p>Within the braces, we put a line that indicates that our object begins with the VTable that we identified as "<code>IExample2Vtbl</code>" in our IDL file. This line contains the <code>interface</code> keyword, followed by the name of our VTable. We preface it with the <code>default</code>
 keyword (enclosed in brackets) to indicate that this is the VTable a 
script engine should assume is the one that it will get in its <code>IExample2</code>
 object. (We haven't talked about this yet, but it's possible for an 
object to have pointers to more than one VTable inside it. This is known
 as "multiple interfaces". But trying to get such an object to work with
 script engines is a major hassle, so we'll avoid it altogether. Even 
though we have only one VTable in <code>IExample2</code>, we still need to mark it as the default one.)</p>
<p>We finish up with a couple closing braces, and our IDL file is done. You can compile it with <i>MIDL.EXE</i> (or add the <i>IExample2_extra.idl</i> to your Visual C++ project and let the IDE run <i>MIDL.EXE</i> on it). If there are no problems, you should end up with a binary file named <i>IExample2.tlb</i>. That's our type library.</p>
<p>It's possible to embed that <i>.TLB</i> file in the resources of our DLL, and have it loaded from there. But I like to keep the <i>.TLB</i> separate from the DLL. Why? Because C/C++ applications don't need the <i>.TLB</i>, nor do compiled Visual BASIC apps. The <i>.TLB</i>
 is needed only for interpreted Visual BASIC, VBScript, and other such 
interpreted languages. (And you do need to distribute the type library 
for those programmers.)</p>
<blockquote>
<p><b>In conclusion</b>, an IDL file contains the "source code" for our 
type library. We put the definitions of our objects and their VTables in
 this file, much like we do in a C include file, but in a slightly 
different format. It is compiled with <i>MIDL.EXE</i> to create a <i>.TLB</i> file which is our actual, binary type library. This <i>.TLB</i>
 file can either be embedded in our DLL's resources, or shipped along 
with our DLL, to allow script engines to use our component.</p></blockquote>
<h2><b><a name="REG">Registering</a> the type library</b></h2>
<p>We're done with our updated component. Of course, before anyone can 
use it, we need to install/register it. In the first article, you'll 
recall, we wrote a utility to register our component. We need to make a 
very simple addition to that code, because our type library (<i>.TLB</i>
 file) needs to be registered too. So, we'll do that in the same 
installation utility. Microsoft provides an API to do all of the work of
 registering a type library: <code>RegisterTypeLib</code>.</p>
<p>But before we look at that, there's another matter to discuss. Visual
 BASIC programmers don't like to deal with complicated things like "big 
numbers". A GUID looks too scary to them. So, Microsoft decided that COM
 developers could associate a "Product ID" (ProdID) with their 
component. And instead of using our <code>IExample2</code> GUID to 
create our object, a Visual BASIC programmer will use our ProdID 
instead. So what's a ProdID? It's just some unique string you choose to 
identify your component. Typically, you'll take your main object name 
(here, we have <code>IExample2</code>), and append some interface name 
to it, and maybe even a version number, each separated by a dot. I'm 
just going to arbitrarily choose <b>IExample2.object</b> as my ProdID. In order to associate this ProdID with our <code>IExample2</code>,
 we need to set a couple extra registry keys. We'll do that in our 
installation utility as well. All we do is create a registry key named 
"IExample2.object" (i.e., our chosen ProdID). Then, we create a subkey 
named "CLSID" under that, and set its default value to our <code>IExample2</code> GUID. The only tricky part is that the GUID has to be formatted into a human-readable string.</p>
<p>In the directory <i>RegIExample2</i>, there is an updated 
installation utility which creates the extra ProdID registry keys, and 
calls RegisterTypeLib to register our type library. The additions are 
trivial, so you can peruse the commented code to study the details.</p>
<p>After running this installation utility, a script engine can now use our component.</p>
<p>Of course, our uninstall utility needs to be updated to delete the extra registry keys. And, Microsoft provides <b>UnRegisterTypeLib</b> to undo what RegisterTypeLib does. Peruse the updated code in the directory <i>UnregIExample2</i>.</p>
<blockquote>
<p><b>In conclusion</b>, the type library (i.e., the TLB file) must be registered, just like our <code>IExample</code>
 object itself. This is easily done with RegisterTypeLib. Furthermore, 
we should choose a ProdID, which is just a non-scary string that a VB 
programmer can use in lieu of our object's GUID, and set up some 
registry keys to associate this ProdID with our GUID.</p></blockquote>
<h2><a name="VB">A</a> VBScript example</h2>
<p>Let's take a trivial VBScript example of using <code>IExample2</code>. We'll simply call <code>SetString</code> to set <code>IExample2</code>'s string member to "Hello World". Then, we'll call <code>GetString</code> to retrieve that string (into another VBScript variable) and display it (so we can be sure it was set/retrieved properly).</p><div class="pre-lang" id="premain412084"><div>VBScript</div><div class="pre-action-link"><span id="copycode412084" class="copy-code" data-index="412084" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre412084" style="margin-top:0;" class="lang-vbscript notranslate" data-language="vbscript" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true"><span class="code-keyword">set</span> myObj = <span class="code-keyword">CreateObject</span>(<span class="code-string">"</span><span class="code-string">IExample2.object"</span>)
myObj.SetString(<span class="code-string">"</span><span class="code-string">Hello world"</span>)
copy = myObj.GetString()
MsgBox copy, <span class="code-digit">0</span>, <span class="code-string">"</span><span class="code-string">GetString return"</span></pre>
<p>First, the VBScript gets one of our <code>IExample2</code> objects. The script calls the VB engine's <code>CreateObject</code>. Note that our <code>IExample2</code> ProdID has been passed. <code>CreateObject</code> first calls <code>CLSIDFromProgID</code> to look up <code>IExample2</code>'s GUID from that ProdID. Then, <code>CreateObject</code> calls <code>CoCreateInstance</code> to get a pointer to an <code>IExample2</code> that our DLL allocates. The script stores this in the variable <code>myObj</code>.</p>
<p>Next, the script calls our <code>IExample2</code>'s <code>SetString</code>, passing the string "Hello World". The script engine does this by calling <code>IExample2</code>'s <code>GetIDsOfNames</code> to get the DISPID for <code>SetString</code>, then calls <code>IExample2</code>'s <code>Invoke</code>, passing a <code>VARIANT</code> wrapping a <code>BSTR</code> of "Hello World".</p>
<p>Next, the script calls our <code>IExample2</code>'s <code>GetString</code>. Again, the script engine calls <code>GetIDsOfNames</code> and <code>Invoke</code>. The script stores the string we (i.e., <code>Invoke</code>) return in the variable <code>copy</code>.</p>
<p>Finally, the script displays what <code>GetString</code> returned.</p>
<p>But don't run this script yet. We're going to change something about our component first.</p>
<h2><b><a name="PROP">A</a> Property</b></h2>
<p>Consider the following C code:</p><div class="pre-lang" id="premain780384"><div></div><div class="pre-action-link"><span id="copycode780384" class="copy-code" data-index="780384" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre780384" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">typedef <span class="code-keyword">struct</span> {
   <span class="code-keyword">char</span> *  <span class="code-keyword">string</span>;
} IExample;

IExample example;

example.<span class="code-keyword">string</span> = <span class="code-string">"</span><span class="code-string">Hello World"</span>;</pre>
<p>Wouldn't it be nice if VBScript could do a similar thing to set our <code>IExample2</code>'s string member? For example, instead of calling <code>SetString</code>, the VBScript could do this:</p><div class="pre-lang" id="premain618259"><div>VBScript</div><div class="pre-action-link"><span id="copycode618259" class="copy-code" data-index="618259" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre618259" style="margin-top:0;" class="lang-vbscript notranslate" data-language="vbscript" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true">myObj.<span class="code-keyword">string</span> = <span class="code-string">"</span><span class="code-string">Hello World"</span></pre>
<p>But although it looks like the script is directly accessing our <code>IExample2</code>'s string member, this would internally translate into a call to our <code>SetString</code>, passing "Hello World".</p>
<p>And so too, the script could do this to retrieve the value of <code>IExample2</code>'s string member (and assign it to the <code>copy</code> variable):</p><div class="pre-lang" id="premain175237"><div>VBScript</div><div class="pre-action-link"><span id="copycode175237" class="copy-code" data-index="175237" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre175237" style="margin-top:0;" class="lang-vbscript notranslate" data-language="vbscript" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true">copy = myObj.<span class="code-keyword">string</span></pre>
<p>And again, this would internally translate to a call to our <code>GetString</code>, and the return value is assigned to <code>copy</code>.</p>
<p>Can we do that? Yes, we can. But we need to change the definitions of <code>SetString</code> and <code>GetString</code>, not in our C code, nor in our <i>.H</i> file, but rather, in our <i>.IDL</i> file. Since <code>SetString</code> sets the value of a member, we need to mark it as a "property set" function. And since <code>GetString</code> retrieves the value of a member, we need to mark it as a "property get" function. In the IDL file, we also rename <code>GetString</code> and <code>SetString</code>
 to both be what member name we want the VBScript to use. Here, we'll 
choose "string". So, here is how we change the definitions in our IDL 
file:</p><div class="pre-lang" id="premain922440"><div></div><div class="pre-action-link"><span id="copycode922440" class="copy-code" data-index="922440" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre922440" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-bracket">[</span><span class="code-sdkkeyword">id</span>(<span class="code-digit">1</span>), propput] HRESULT <span class="code-keyword">string</span>([in] BSTR);
[id(<span class="code-digit">1</span>), propget] HRESULT <span class="code-keyword">string</span>([out, retval] BSTR *);</pre>
<p>All we've done is add "<code>propput</code>" to <code>SetString</code> (and change the function name to "string"). We also added "<code>propget</code>" to <code>GetString</code>, and changed its function name to "string" as well.</p>
<p><i>"Wait a minute. How can you have two functions with the same name?"</i>, you may ask. We don't. The real function names are still <code>SetString</code> and <code>GetString</code>. After all, these appear in <i>IExample2.h</i>'s
 VTable definition in the same place that they appear in our IDL VTable 
definition. It's only that our type library considers the names to both 
be "string", and it knows that they are two different functions because 
one sets the value (<code>propput</code>) and the other retrieves the value (<code>propget</code>).</p>
<p>But in order to declare a function as <code>propget</code>, it must take exactly two arguments. First, of course, is a pointer to our object. The second argument must be declared as <code>[in]</code>, and it should be the value to set the member. For example, since <code>IExample2</code>'s string member needs to be set to a <code>BSTR</code> (pointer), we define the argument as a <code>BSTR</code>. If the string member had been defined as a <code>long</code>, we would have defined the argument as "<code>long</code>". As long as we stick to automation data types, we're OK.</p>
<p>And in order to declare a function as <code>propput</code>, it must take exactly two arguments. First, of course, is a pointer to our object. The second argument must be declared as <code>[out, retval]</code>, and it should be a pointer to where we return the member's value. For example, since <code>IExample2</code>'s string member is a <code>BSTR</code> (pointer), we define the argument as a <code>BSTR *</code> (which is actually a handle since <code>BSTR</code> itself is a pointer). If the string member had been defined as a <code>long</code>, we would have defined the argument as "<code>long *</code>".</p>
<p>I've changed the above two lines in <i>IExample2_extra.idl</i>, and renamed it to <i>IExample2.idl</i>. Run <i>MIDL.EXE</i> on it to produce a new <i>.TLB</i> file.</p>
<p>Now, we can rewrite our VBScript example as so:</p><div class="pre-lang" id="premain793905"><div>VBScript</div><div class="pre-action-link"><span id="copycode793905" class="copy-code" data-index="793905" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre793905" style="margin-top:0;" class="lang-vbscript notranslate" data-language="vbscript" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true"><span class="code-keyword">set</span> myObj = <span class="code-keyword">CreateObject</span>(<span class="code-string">"</span><span class="code-string">IExample2.object"</span>)
myObj.<span class="code-keyword">string</span> = <span class="code-string">"</span><span class="code-string">Hello World"</span>
MsgBox myObj.<span class="code-keyword">string</span>, <span class="code-digit">0</span>, <span class="code-string">"</span><span class="code-string">GetString return"</span></pre>
<blockquote>
<p><b>In conclusion</b>, if you wish to allow a script to set the value 
of some data member of your object, add a function to set the value, and
 mark it as <code>propput</code> in the IDL file. In the IDL file, the 
function name will simply be the member name. The second argument passed
 to the function should be marked <code>[in]</code> and be the desired 
value. If you wish to allow a script to retrieve the value of some data 
member of your object, add a function to retrieve the value, and mark it
 as <code>propget</code> in the IDL file. In the IDL file, the function 
name will simply be the member name. The second argument passed to the 
function should be marked <code>[out, retval]</code> and be a pointer to where you return the value.</p></blockquote>
<p><b>Note:</b> You do not need to supply both a <code>propget</code> and a <code>propset</code>
 for a given member. You can supply one or the other. For example, if we
 wanted to make the string member a read-only value, then we would 
eliminate our <code>SetString</code> function, and remove that <code>propput</code> line from our IDL file (as well as remove <code>SetString</code> from <i>IExample2.h</i>'s VTable definition).</p>
<h2><a name="C">An</a> updated example C application</h2>
<p>Because we changed the data types passed to <code>SetString</code> and <code>GetString</code>, we must update our C/C++ clients to pass the correct data types. This is fairly trivial, and simply involves using <code>SysAllocString</code> where we need to get a <code>BSTR</code>, or <code>SysFreeString</code> where we need to free one. The updated C example is in the directory <i>IExampleApp2</i>.</p>
<h2><a name="EXE">A</a> COM component in an EXE</h2>
<p>Instead of packaging our COM component into a DLL, we could instead 
package it into its own EXE. The advantage of this is that the EXE runs 
in its own process space, and therefore, any crash of the application 
doesn't crash the COM component (or vice versa, necessarily). The 
disadvantage is that the OS must do "data marshalling" to allow data to 
be passed between process boundaries, so things can run more slowly.</p>
<p>The great news is that very little in our DLL needs to be changed. In the directory <i>IExampleExe</i>, you'll find a project to build an EXE out of the code we used to build <code>IExample2</code>. I've changed the name of the files <i>IExample2.c</i> to <i>IExampleExe.c</i>, <i>IExample2.h</i> to <i>IExampleExe.h</i>, and <i>IExample2.idl</i> to <i>IExampleExe.idl</i>. I've also searched and replaced all instances of <code>IExample2</code> with <code>IExampleExe</code>. So now, our object is referred to as <code>IExampleExe</code>. And of course, I replaced the GUIDs in <i>IExampleExe.h</i> and <i>IExampleExe.idl</i>
 with newly generated ones so that this EXE component won't conflict 
with our DLL components. Since we're creating an EXE, we no longer need a
 DEF file, so that has been removed from the project.</p>
<p>In <i>IExampleExe.c</i>, we have to replace the <code>DllMain</code> function with a <code>WinMain</code> function. Our <code>WinMain</code> must do the initialization of our <code>IClassFactory</code> and global variables, just like <code>DllMain</code> did. But our <code>WinMain</code> must also call the OLE APIs <code>CoInitialize</code> to initialize COM, and then call <code>CoRegisterClassObject</code>
 to add our EXE to COM's running task list. What's that? It's simply an 
internal list COM maintains of all the currently running EXEs which are 
COM components. If our EXE is not in this list, then no application can 
use our COM component. And, our EXE is not in that list until it calls <code>CoRegisterClassObject</code>. Since it is our <code>WinMain</code> that calls <code>CoRegisterClassObject</code>, it stands to reason that no app can use our COM component until our EXE is started.</p>
<p>After our EXE is added to the running task list, it simply does a message loop until it receives a <code>WM_QUIT</code> message.</p>
<p>While our EXE is in memory, spinning around that message loop, an application can call <code>CoCreateInstance</code> (or <code>CoGetClassObject</code>/<code>CreateInstance</code>) to get one of our <code>IExampleExe</code>
 objects and call its functions. To call those functions, the 
application need do nothing more than the IExample2App demo did. The OS 
handles all of the needed details to make it happen.</p>
<p>When our EXE is ready to terminate, it calls <code>CoRevokeClassObject</code> to remove itself from COM's running task list, and then calls <code>CoUninitialize</code> to free up the COM resources.</p>
<p>That's the extent of the differences (although I did add a little code in the <code>Release</code> functions of our <code>IExampleExe</code> object and <code>IClassFactory</code> object to check if we want to unload the DLL when all apps have <code>Release</code>d our objects).</p>
<p>When registering a COM component in an EXE, versus a DLL, instead of creating a key named "<code>InprocServer32</code>", we create a key named "<code>LocalServer32</code>". In the directory <i>RegIExampleExe</i>, is an example of registering <code>IExampleExe</code>. (No uninstall utility has been provided. It is a trivial exercise left up to you to accomplish).</p>
<p>To test out this new EXE component, you can simply modify <i>IExample2App.c</i> to reference the GUIDs for <code>IExampleExe</code>, by changing it to <code>#include IExampleExe.h</code>:</p><div class="pre-lang" id="premain700498"><div></div><div class="pre-action-link"><span id="copycode700498" class="copy-code" data-index="700498" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre700498" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">#include <span class="code-string">"</span><span class="code-string">../IExampleExe/IExampleExe.h"</span></pre>
<p>Remember that you must install/register our COM component once, and then run our component (<i>IExample.exe</i>) to get it into COM's task list <b>before</b> you run the modified <i>IExample2App.exe</i> test program.</p>
<h2>What's next?</h2>
<p>In the next chapter, we'll look at the <code>IDispatch</code> 
functions from the point of view of a script engine. How does a script 
engine translate some code in its own language to a call to our object's
 <code>IDispatch</code> functions?</p>


						</div>
						

						
						<h2>License</h2>
						<div id="LicenseTerms"><p>This article, along with any associated source code and files, is licensed under <a href="http://www.codeproject.com/info/cpol10.aspx" rel="license">The Code Project Open License (CPOL)</a></p></div>
						

						
						<br>
						
						    

<div class="author-wrapper">

    <div class="desktop-only tablet-only" style="position:absolute; top:-30px;right:20px">
        <img id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberPhoto" class="profile-pic" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/member_unknown.gif" style="border-width:0px;transform:rotate(1deg);">
    </div>

    <div style="padding-right:100px">
        <div class="subdue" style="margin-bottom:7px">Written By</div>

        <div class="container-member">
             <b><a id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberProfileLink" class="author" href="https://www.codeproject.com/Members/Jeff-Glatt">Jeff Glatt</a></b>
        </div>

        <div class="company text-nowrap">
            <span id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberJobTitle"></span>
	        <span id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberCompany"></span>
        </div>

        <div class="text-nowrap">
            <span id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberLocation"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/US.gif" alt="United States" width="16" height="11">&nbsp;United States</span>
        </div>
    </div>

</div>

<div class="description" style="padding-top:1rem">
    This member has not yet provided a Biography. Assume it's 
interesting and varied, and probably something to do with programming.
</div>

<div id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_SocialRow" class="follow flex-container flex-extend" style="margin-top:20px">
    <div class="flex-item">
        
    </div>
    <div class="flex-item-tight" style="margin-right:25px">
        
    </div>
</div>

<br>
						
						

						<div class="clearfix"></div>

						<div style="padding-top:8px">
							
						</div>

					

				    
					</form>

				</div>

				
				<div class="bottom-promo"> 
				    <div class="msg-728x90" data-format="728x90" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="Programming-LanguagesC" data-country="US" data-loadonview="true" data-tags="VC6, C++, C, Windows, Visual-Studio, Dev, COM, Beginner,rating4.5,pos_bottom"><noscript><a href="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Programming-LanguagesC&sz=728x90&c=371656"><img src="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Programming-LanguagesC&sz=728x90&c=371656"  width="728px" height="90px" target="_blank"/></a></noscript></div>
				</div>
				
                
                

				
				

					<h2 class="padded-top">Comments and Discussions</h2>

                    
			        <div id="ctl00_SharePH" class="share-list float-right desktop-only tablet-only" style="margin-top:-3.5rem">
				        

    <ul class="rrssb-buttons clearfix rrssb-1">
        <li id="ctl00_SocialLike_Email" class="email compact">
            <a href="mailto:?subject=COM%20in%20plain%20C%2c%20Part%202%20-%20CodeProject&amp;body=Here%27s%20an%20interesting%20article%20on%20for%20you%20on%20codeproject.com%0a%0aHow%20to%20write%20a%20COM%20component%20in%20C%20that%20can%20be%20used%20by%20script%20languages%20such%20as%20VBscript%2c%20Visual%20BASIC%2c%20jscript%2c%20etc.%0a%0ahttps%3a%2f%2fwww.codeproject.com%2fArticles%2f13862%2fCOM-in-plain-C-Part-2%0a">
                <span class="icon">
                    <svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                        <g>
                            <path d="M20.111 26.147c-2.336 1.051-4.361 1.401-7.125 1.401c-6.462 0-12.146-4.633-12.146-12.265 
                                c0-7.94 5.762-14.833 14.561-14.833c6.853 0 11.8 4.7 11.8 11.252c0 5.684-3.194 9.265-7.399 
                                9.3 c-1.829 0-3.153-0.934-3.347-2.997h-0.077c-1.208 1.986-2.96 2.997-5.023 2.997c-2.532 
                                0-4.361-1.868-4.361-5.062 c0-4.749 3.504-9.071 9.111-9.071c1.713 0 3.7 0.4 4.6 0.973l-1.169 
                                7.203c-0.388 2.298-0.116 3.3 1 3.4 c1.673 0 3.773-2.102 3.773-6.58c0-5.061-3.27-8.994-9.303-8.994c-5.957 
                                0-11.175 4.673-11.175 12.1 c0 6.5 4.2 10.2 10 10.201c1.986 0 4.089-0.43 5.646-1.245L20.111 
                                26.147z M16.646 10.1 c-0.311-0.078-0.701-0.155-1.207-0.155c-2.571 0-4.595 2.53-4.595 5.529c0 
                                1.5 0.7 2.4 1.9 2.4 c1.441 0 2.959-1.828 3.311-4.087L16.646 10.068z"></path>
                        </g>
                    </svg>
                </span>
                
            </a>
        </li><li id="ctl00_SocialLike_Twitter" class="twitter compact">
            <a href="http://twitter.com/home?status=COM+in+plain+C%2c+Part+2+-+CodeProject+-+https%3a%2f%2fwww.codeproject.com%2fArticles%2f13862%2fCOM-in-plain-C-Part-2" class="popup">
                <span class="icon">
                    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                    <path d="M24.253,8.756C24.689,17.08,18.297,24.182,9.97,24.62c-3.122,0.162-6.219-0.646-8.861-2.32
                        c2.703,0.179,5.376-0.648,7.508-2.321c-2.072-0.247-3.818-1.661-4.489-3.638c0.801,0.128,1.62,0.076,2.399-0.155
                        C4.045,15.72,2.215,13.6,2.115,11.077c0.688,0.275,1.426,0.407,2.168,0.386c-2.135-1.65-2.729-4.621-1.394-6.965
                        C5.575,7.816,9.54,9.84,13.803,10.071c-0.842-2.739,0.694-5.64,3.434-6.482c2.018-0.623,4.212,0.044,5.546,1.683
                        c1.186-0.213,2.318-0.662,3.329-1.317c-0.385,1.256-1.247,2.312-2.399,2.942c1.048-0.106,2.069-0.394,3.019-0.851
                        C26.275,7.229,25.39,8.196,24.253,8.756z"></path>
                    </svg>
                </span>
                
            </a>
        </li><li id="ctl00_SocialLike_Facebook" class="facebook compact">
            
            <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.codeproject.com%2fArticles%2f13862%2fCOM-in-plain-C-Part-2" class="popup">
                <span class="icon">
                    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                        <path d="M27.825,4.783c0-2.427-2.182-4.608-4.608-4.608H4.783c-2.422,0-4.608,2.182-4.608,4.608v18.434
                            c0,2.427,2.181,4.608,4.608,4.608H14V17.379h-3.379v-4.608H14v-1.795c0-3.089,2.335-5.885,5.192-5.885h3.718v4.608h-3.726
                            c-0.408,0-0.884,0.492-0.884,1.236v1.836h4.609v4.608h-4.609v10.446h4.916c2.422,0,4.608-2.188,4.608-4.608V4.783z"></path>
                    </svg>
                </span>
                
            </a>
        </li><li id="ctl00_SocialLike_LinkedIn" class="linkedin compact">
            <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.codeproject.com%2fArticles%2f13862%2fCOM-in-plain-C-Part-2&amp;title=COM+in+plain+C%2c+Part+2+-+CodeProject&amp;summary=How+to+write+a+COM+component+in+C+that+can+be+used+by+script+languages+such+as+VBscript%2c+Visual+BASIC%2c+jscript%2c+etc.&amp;source=codeproject.com" class="popup">
                <span class="icon">
                    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                        <path d="M25.424,15.887v8.447h-4.896v-7.882c0-1.979-0.709-3.331-2.48-3.331c-1.354,0-2.158,0.911-2.514,1.803
                            c-0.129,0.315-0.162,0.753-0.162,1.194v8.216h-4.899c0,0,0.066-13.349,0-14.731h4.899v2.088c-0.01,0.016-0.023,0.032-0.033,0.048
                            h0.033V11.69c0.65-1.002,1.812-2.435,4.414-2.435C23.008,9.254,25.424,11.361,25.424,15.887z M5.348,2.501
                            c-1.676,0-2.772,1.092-2.772,2.539c0,1.421,1.066,2.538,2.717,2.546h0.032c1.709,0,2.771-1.132,2.771-2.546
                            C8.054,3.593,7.019,2.501,5.343,2.501H5.348z M2.867,24.334h4.897V9.603H2.867V24.334z"></path>
                    </svg>
                </span>
                
            </a>
        </li><li id="ctl00_SocialLike_Reddit" class="reddit compact">
            <a href="http://www.reddit.com/submit?url=https%3a%2f%2fwww.codeproject.com%2fArticles%2f13862%2fCOM-in-plain-C-Part-2&amp;title=COM+in+plain+C%2c+Part+2+-+CodeProject">
                <span class="icon">
                    <svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve"><g>
                    <path d="M11.794 15.316c0-1.029-0.835-1.895-1.866-1.895c-1.03 0-1.893 0.865-1.893 1.895s0.863 1.9 1.9 1.9 C10.958 17.2 11.8 16.3 11.8 15.316z"></path>
                    <path d="M18.1 13.422c-1.029 0-1.895 0.864-1.895 1.895c0 1 0.9 1.9 1.9 1.865c1.031 0 1.869-0.836 1.869-1.865 C19.969 14.3 19.1 13.4 18.1 13.422z"></path>
                    <path d="M17.527 19.791c-0.678 0.678-1.826 1.006-3.514 1.006c-0.004 0-0.009 0-0.014 0c-0.004 0-0.01 0-0.015 0 
                    c-1.686 0-2.834-0.328-3.51-1.005c-0.264-0.265-0.693-0.265-0.958 0c-0.264 0.265-0.264 0.7 0 1 c0.943 0.9 2.4 1.4 
                    4.5 1.402c0.005 0 0 0 0 0c0.005 0 0 0 0 0c2.066 0 3.527-0.459 4.47-1.402 c0.265-0.264 0.265-0.693 0.002-0.958C18.221 
                    19.5 17.8 19.5 17.5 19.791z"></path><path d="M27.707 13.267c0-1.785-1.453-3.237-3.236-3.237c-0.793 0-1.518 0.287-2.082 
                    0.761c-2.039-1.295-4.646-2.069-7.438-2.219 l1.483-4.691l4.062 0.956c0.071 1.4 1.3 2.6 2.7 2.555c1.488 0 2.695-1.208 
                    2.695-2.695C25.881 3.2 24.7 2 23.2 2 c-1.059 0-1.979 0.616-2.42 1.508l-4.633-1.091c-0.344-0.081-0.693 0.118-0.803 
                    0.455l-1.793 5.7 C10.548 8.6 7.7 9.4 5.6 10.75C5.006 10.3 4.3 10 3.5 10.029c-1.785 0-3.237 1.452-3.237 3.2 c0 1.1 0.6 
                    2.1 1.4 2.69c-0.04 0.272-0.061 0.551-0.061 0.831c0 2.3 1.3 4.4 3.7 5.9 c2.299 1.5 5.3 2.3 8.6 2.325c3.228 0 6.271-0.825 
                    8.571-2.325c2.387-1.56 3.7-3.66 3.7-5.917 c0-0.26-0.016-0.514-0.051-0.768C27.088 15.5 27.7 14.4 27.7 13.267z M23.186 
                    3.355c0.74 0 1.3 0.6 1.3 1.3 c0 0.738-0.6 1.34-1.34 1.34s-1.342-0.602-1.342-1.34C21.844 4 22.4 3.4 23.2 3.355z M1.648 
                    13.3 c0-1.038 0.844-1.882 1.882-1.882c0.31 0 0.6 0.1 0.9 0.209c-1.049 0.868-1.813 1.861-2.26 2.9 C1.832 14.2 1.6 13.8 1.6 
                    13.267z M21.773 21.57c-2.082 1.357-4.863 2.105-7.831 2.105c-2.967 0-5.747-0.748-7.828-2.105 
                    c-1.991-1.301-3.088-3-3.088-4.782c0-1.784 1.097-3.484 3.088-4.784c2.081-1.358 4.861-2.106 7.828-2.106 c2.967 0 5.7 
                    0.7 7.8 2.106c1.99 1.3 3.1 3 3.1 4.784C24.859 18.6 23.8 20.3 21.8 21.57z M25.787 14.6 
                    c-0.432-1.084-1.191-2.095-2.244-2.977c0.273-0.156 0.59-0.245 0.928-0.245c1.035 0 1.9 0.8 1.9 1.9 
                    C26.354 13.8 26.1 14.3 25.8 14.605z"></path></g></svg>
                </span>
                
            </a>
        </li><li id="ctl00_SocialLike_Pinterest" class="pinterest compact">
            <a href="http://pinterest.com/pin/create/bookmarklet/?is_video=false&amp;url=https%3a%2f%2fwww.codeproject.com%2fArticles%2f13862%2fCOM-in-plain-C-Part-2&amp;description=COM+in+plain+C%2c+Part+2+-+CodeProject">
                <span class="icon">
                    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                    <path d="M14.021,1.57C6.96,1.57,1.236,7.293,1.236,14.355c0,7.062,5.724,12.785,12.785,12.785c7.061,0,12.785-5.725,12.785-12.785
                        C26.807,7.294,21.082,1.57,14.021,1.57z M15.261,18.655c-1.161-0.09-1.649-0.666-2.559-1.219c-0.501,2.626-1.113,5.145-2.925,6.458
                        c-0.559-3.971,0.822-6.951,1.462-10.116c-1.093-1.84,0.132-5.545,2.438-4.632c2.837,1.123-2.458,6.842,1.099,7.557
                        c3.711,0.744,5.227-6.439,2.925-8.775c-3.325-3.374-9.678-0.077-8.897,4.754c0.19,1.178,1.408,1.538,0.489,3.168
                        C7.165,15.378,6.53,13.7,6.611,11.462c0.131-3.662,3.291-6.227,6.46-6.582c4.007-0.448,7.771,1.474,8.29,5.239
                        c0.579,4.255-1.816,8.865-6.102,8.533L15.261,18.655z"></path>
                    </svg>
                </span>
                
            </a>
        </li>

    </ul>



			        </div><a class="float-left" name="_comments" id="_comments">&nbsp;</a><div id="_MessageBoardctl00_MessageBoard" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(event, null)">
<table id="ForumTable" class="forum relaxed" cellpadding="0" cellspacing="0">
<tbody><tr>
<td class="header1"><div class="callout">
	<b>You must <a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fArticles%2f13862%2fCOM-in-plain-C-Part-2%3ffid%3d295130%26df%3d90%26mpp%3d25%26sort%3dPosition%26view%3dNormal%26spc%3dRelaxed%26prof%3dTrue">Sign In</a> to use this message board.</b>
</div></td>
</tr><tr>
<td><table width="100%" border="0" cellpadding="3px" cellspacing="0">
<tbody><tr class="header1">
<td colspan="2" style="white-space:nowrap;"><div class="container">
<div class="float-right">
<form action="/Search.aspx?sbo=fm" method="get" class="searchbar">
<input type="hidden" name="fid" value="295130"><input type="hidden" name="sbo" value="fm"><input id="search_forumCtrl_ctl00_MessageBoard" type="search" class="search subdue" autocomplete="off" name="q" value="Search Comments"><input type="image" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/search.gif">
</form>
</div>
</div></td>
</tr><tr class="header2">
<td></td><td style="width:100%;"><div style="text-align:right;">
<form action="/script/Forums/SetOptions.aspx?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;view=Normal&amp;spc=Relaxed&amp;prof=True&amp;floc=%2fArticles%2f13862%2fCOM-in-plain-C-Part-2" method="get" style="margin:0;padding:0;">
<input type="hidden" name="fid" value="295130"><input type="hidden" name="currentQS" value="fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;view=Normal&amp;spc=Relaxed&amp;prof=True&amp;floc=%2fArticles%2f13862%2fCOM-in-plain-C-Part-2"><input type="hidden" name="floc" value="/Articles/13862/COM-in-plain-C-Part-2">Spacing<select size="1" class="dropdown" name="spc" data-ddg-inputtype="unknown">
<option selected="selected" value="Relaxed">Relaxed</option><option value="Compact">Compact</option><option value="Tight">Tight</option>
</select>&nbsp;&nbsp;Layout<select size="1" class="dropdown" name="view" data-ddg-inputtype="unknown">
<option selected="selected" value="Normal">Normal</option><option value="Topic">Open Topics</option><option value="Expanded">Open All</option><option value="Thread">Thread View</option>
</select>&nbsp;&nbsp;Per page<select size="1" class="dropdown" name="mpp" data-ddg-inputtype="unknown">
<option value="10">10</option><option selected="selected" value="25">25</option><option value="50">50</option>
</select>&nbsp;&nbsp;&nbsp;<input type="submit" value="Update" name="SetOpt" class="button">
</form>
</div></td>
</tr>
</tbody></table></td>
</tr><tr>
<td><a name="xx0xx"></a><table border="0" cellpadding="2px" cellspacing="0" width="100%">
<tbody><tr class="navbar">
<td></td><td style="text-align:right;width:50%;"></td><td style="text-align:right;white-space:nowrap;"><span class="nav-link disabled">First</span> <span class="nav-link disabled">Prev</span><a class="nav-link" name="Frm_HoverNL" href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;view=Normal&amp;spc=Relaxed&amp;prof=True&amp;fr=26#xx0xx">Next</a></td>
</tr>
</tbody></table></td>
</tr><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%" class="fixed-layout blank-background msg-list">
<tbody><tr id="F5069301_h0" class="header hover-row root">
<td class="subject-line normal vote-hi" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx5069301xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_question.gif" alt="Question" title="Question"></td><td class="subject hover-container"><a class="message-link" name="5069301" parent="0" thread="5069301" href="https://www.codeproject.com/Messages/5069301/For-64-bit-OS">For 64-bit OS</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">dc_2000</span><span class="date">3-Jun-15  22:50</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=660507">dc_2000</a></span></td><td class="date"><span>3-Jun-15  22:50&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F5069301_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">I'm not sure if it was mentioned anywhere, if you want 
this to work on a 64-bit OS you will need to also build this in-proc DLL
 as a 64-bit project (otherwise the 32-bit version will not be able to 
be loaded into 64-bit processes and you'll get a lot of weird errors.)<br>
<br>
Also the registration/un-registration part needs to be adjusted for 
64-bit OS. For (un-)registration of the 64-bit in-proc DLL from a 32-bit
 process use the KEY_WOW64_64KEY flag when creating/opening keys. And 
for (un-)registration of the 32-bit in-proc DLL from a 64-bit process 
use the KEY_WOW64_32KEY flag.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/13862/COM-in-plain-C-Part-2" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=5069301" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_5069301" name="react-item_5069301" id="MRF5069301" class="reaction-result"></span><span data-objectref="3_5069301" data-votingtype="GoodOrBad" name="RateItem_5069301" id="MVF5069301" class="rating-result"><span>5.00/5 (1 vote)</span></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="5069301" href="https://www.codeproject.com/Messages/5069301/For-64-bit-OS" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4504477_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx4504477xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_question.gif" alt="Question" title="Question"></td><td class="subject hover-container"><a class="message-link" name="4504477" parent="0" thread="4504477" href="https://www.codeproject.com/Messages/4504477/Error-on-invoking-a-method">Error on invoking a method</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">ATILLA67</span><span class="date">25-Feb-13  12:18</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=1207124">ATILLA67</a></span></td><td class="date"><span>25-Feb-13  12:18&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4504477_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Hello I have a strange error. I can create the com component with create instance, but invoking a method<br>
gives me : GetTypeInfo: failed (8002801d; Bibliothek nicht registriert.)<br>
<br>
What is that? I register the com component with the register example?<br>
<br>
<br>
Yours,<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/13862/COM-in-plain-C-Part-2" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=4504477" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_4504477" name="react-item_4504477" id="MRF4504477" class="reaction-result"></span><span data-objectref="3_4504477" data-votingtype="GoodOrBad" name="RateItem_4504477" id="MVF4504477" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="4504477" href="https://www.codeproject.com/Messages/4504477/Error-on-invoking-a-method" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4500573_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx4500573xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_question.gif" alt="Question" title="Question"></td><td class="subject hover-container"><a class="message-link" name="4500573" parent="0" thread="4500573" href="https://www.codeproject.com/Messages/4500573/Register-as-Service">Register as Service</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">ATILLA67</span><span class="date">20-Feb-13  5:47</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=1207124">ATILLA67</a></span></td><td class="date"><span>20-Feb-13  5:47&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4500573_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">What step are evident to make the com exe  running as service??<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/13862/COM-in-plain-C-Part-2" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=4500573" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_4500573" name="react-item_4500573" id="MRF4500573" class="reaction-result"></span><span data-objectref="3_4500573" data-votingtype="GoodOrBad" name="RateItem_4500573" id="MVF4500573" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="4500573" href="https://www.codeproject.com/Messages/4500573/Register-as-Service" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4481214_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx4481214xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_question.gif" alt="Question" title="Question"></td><td class="subject hover-container"><a class="message-link" name="4481214" parent="0" thread="4481214" href="https://www.codeproject.com/Messages/4481214/Is-that-an-error">Is that an error???</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">ligand</span><span class="date">25-Jan-13  19:16</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=3756817">ligand</a></span></td><td class="date"><span>25-Jan-13  19:16&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4481214_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">In RegIExampleExe.c file which I got from the source code zip file, the  5th line is <br>
<br>
<div class="pre-lang" id="premain29750"><div>C++</div><div class="pre-action-link"><span class="code-collapse" data-index="29750" id="preShrink29750">Shrink ▲</span> &nbsp; <span id="copycode29750" class="copy-code" data-index="29750" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve">
<g>
<path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272
    c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729
    c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path>
<path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272
    c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068
    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001
    C291.206,428.715,289.92,430,288.341,430z"></path>	
</g>
</svg></span></div></div>
<pre id="pre29750" style="margin-top:0;" class="lang-cplusplus notranslate" data-language="c++" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true"><span class="code-keyword">#include</span><span class="code-preprocessor"> <span class="code-string">"</span><span class="code-string">../IExample2/IExample2.h"</span></span></pre><br>
<br>
Obviously, it should be<br>
 <br>
<div class="pre-lang" id="premain507311"><div>C++</div><div class="pre-action-link"><span class="code-collapse" data-index="507311" id="preShrink507311">Shrink ▲</span> &nbsp; <span id="copycode507311" class="copy-code" data-index="507311" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve">
<g>
<path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272
    c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729
    c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path>
<path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272
    c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068
    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001
    C291.206,428.715,289.92,430,288.341,430z"></path>	
</g>
</svg></span></div></div>
<pre id="pre507311" style="margin-top:0;" class="lang-cplusplus notranslate" data-language="c++" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true"><span class="code-keyword">#include</span><span class="code-preprocessor"> <span class="code-string">"</span><span class="code-string">../iexampleexe/IExampleExe.h"</span></span></pre><br>
<br>
Otherwise, I used the old  "REGIEXAMPLEEXE.exe" to register the 
"IExample.exe" as COM, but found the IExampleExe registrated with the 
CLSID of IExample2<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/13862/COM-in-plain-C-Part-2" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=4481214" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_4481214" name="react-item_4481214" id="MRF4481214" class="reaction-result"></span><span data-objectref="3_4481214" data-votingtype="GoodOrBad" name="RateItem_4481214" id="MVF4481214" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="4481214" href="https://www.codeproject.com/Messages/4481214/Is-that-an-error" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4446960_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx4446960xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_question.gif" alt="Question" title="Question"></td><td class="subject hover-container"><a class="message-link" name="4446960" parent="0" thread="4446960" href="https://www.codeproject.com/Messages/4446960/0x80080005-on-IExampleExe">0x80080005 on IExampleExe</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">ATILLA67</span><span class="date">7-Dec-12  5:46</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=1207124">ATILLA67</a></span></td><td class="date"><span>7-Dec-12  5:46&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4446960_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Hello Mr. Glatt,<br>
<br>
compiling the src is straitforward, it registers correct( I assume) but 
when I try a createInstance(from cpp, and from scriptingside)<br>
I get an 0x80080005 Error in starting the Server.-&gt; CoCreateInstance: failed<br>
<br>
Should I make some other tweaks??<br>
<br>
Yours,<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/13862/COM-in-plain-C-Part-2" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=4446960" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_4446960" name="react-item_4446960" id="MRF4446960" class="reaction-result"></span><span data-objectref="3_4446960" data-votingtype="GoodOrBad" name="RateItem_4446960" id="MVF4446960" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="4446960" href="https://www.codeproject.com/Messages/4446960/0x80080005-on-IExampleExe" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4478480_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="38px" class="indent"><a name="xx4478480xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_answer.gif" alt="Answer" title="Answer"></td><td class="subject hover-container"><a class="message-link" name="4478480" parent="4446960" thread="4446960" href="https://www.codeproject.com/Messages/4478480/Re-0x80080005-on-IExampleExe">Re: 0x80080005 on IExampleExe</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">ligand</span><span class="date">22-Jan-13  21:21</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=3756817">ligand</a></span></td><td class="date"><span>22-Jan-13  21:21&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4478480_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,4446960);" href="https://www.codeproject.com/Messages/4446960/0x80080005-on-IExampleExe"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>This
 maybe less administrator access right. Restart your Visual Studio or 
Command Prompt console with administrator privilege, and try it.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/13862/COM-in-plain-C-Part-2" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=4446960" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_4478480" name="react-item_4478480" id="MRF4478480" class="reaction-result"></span><span data-objectref="3_4478480" data-votingtype="GoodOrBad" name="RateItem_4478480" id="MVF4478480" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="4478480" href="https://www.codeproject.com/Messages/4478480/Re-0x80080005-on-IExampleExe" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4076757_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx4076757xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_question.gif" alt="Question" title="Question"></td><td class="subject hover-container"><a class="message-link" name="4076757" parent="0" thread="4076757" href="https://www.codeproject.com/Messages/4076757/Typelib-essential-with-COM-component-in-an-EXE">Typelib essential with COM component in an EXE</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Reinier T</span><span class="date">13-Nov-11  14:57</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=8398163">Reinier T</a></span></td><td class="date"><span>13-Nov-11  14:57&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4076757_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Thank you very much for this excellent set of articles. I
 have done some COM programming fifteen years ago, but only now, after 
reading your work, I start to understand what I was doing back then.<br>
I had one remark about the last section "A COM component in an EXE". I 
have been able to do that in plain C for a custom interface (derived 
from IUnknown, not IDispatch), but not before making the mistake first 
of omitting the typelib. From your article, it looks like the typelib is
 required for dual interfaces only.<br>
It would be nice to mention in that section that COM now has to marshal 
the data since it has to travel between processes, and that it can do 
that in a generic way only if it has a typelibrary available. Much 
better than implementing your own marshaling routines.<br><br><div class="modified">modified  13-Nov-11 21:07pm.</div><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/13862/COM-in-plain-C-Part-2" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=4076757" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_4076757" name="react-item_4076757" id="MRF4076757" class="reaction-result"></span><span data-objectref="3_4076757" data-votingtype="GoodOrBad" name="RateItem_4076757" id="MVF4076757" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="4076757" href="https://www.codeproject.com/Messages/4076757/Typelib-essential-with-COM-component-in-an-EXE" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F3758803_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx3758803xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="3758803" parent="0" thread="3758803" href="https://www.codeproject.com/Messages/3758803/My-vote-of-5">My vote of 5</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">LittleEd</span><span class="date">4-Feb-11  5:21</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=1159653">LittleEd</a></span></td><td class="date"><span>4-Feb-11  5:21&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F3758803_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">more of the same, excellent<br>
regarding the COM registration how do we know what fields are required 
by the registry, u kind of pull them out the air? Gooled and MSDN'd but 
no joy<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/13862/COM-in-plain-C-Part-2" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=3758803" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_3758803" name="react-item_3758803" id="MRF3758803" class="reaction-result"></span><span data-objectref="3_3758803" data-votingtype="GoodOrBad" name="RateItem_3758803" id="MVF3758803" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="3758803" href="https://www.codeproject.com/Messages/3758803/My-vote-of-5" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F3672556_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx3672556xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="3672556" parent="0" thread="3672556" href="https://www.codeproject.com/Messages/3672556/My-vote-of-5">My vote of 5</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">yao2007</span><span class="date">20-Nov-10  23:55</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=5666108">yao2007</a></span></td><td class="date"><span>20-Nov-10  23:55&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F3672556_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">excellent<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/13862/COM-in-plain-C-Part-2" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=3672556" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_3672556" name="react-item_3672556" id="MRF3672556" class="reaction-result"></span><span data-objectref="3_3672556" data-votingtype="GoodOrBad" name="RateItem_3672556" id="MVF3672556" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="3672556" href="https://www.codeproject.com/Messages/3672556/My-vote-of-5" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F3519477_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx3519477xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="3519477" parent="0" thread="3519477" href="https://www.codeproject.com/Messages/3519477/My-vote-of-5">My vote of 5</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">sprice86</span><span class="date">29-Jun-10  8:35</span>
</div></td><td class="icon"><img border="0" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/icn-pro-16.png" title="Professional" alt="professional" height="16px" width="16px"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=736400">sprice86</a></span></td><td class="date"><span>29-Jun-10  8:35&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F3519477_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">This is the best written article I have seen on CodeProject<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/13862/COM-in-plain-C-Part-2" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=3519477" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_3519477" name="react-item_3519477" id="MRF3519477" class="reaction-result"></span><span data-objectref="3_3519477" data-votingtype="GoodOrBad" name="RateItem_3519477" id="MVF3519477" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="3519477" href="https://www.codeproject.com/Messages/3519477/My-vote-of-5" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F3299389_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx3299389xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_question.gif" alt="Question" title="Question"></td><td class="subject hover-container"><a class="message-link" name="3299389" parent="0" thread="3299389" href="https://www.codeproject.com/Messages/3299389/Why-same-dispatch-ID-in-IExample2-idl">Why same dispatch ID in IExample2.idl?</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Hou Tianze</span><span class="date">9-Dec-09  22:37</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=2407417">Hou Tianze</a></span></td><td class="date"><span>9-Dec-09  22:37&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F3299389_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Hi Jeff,<br>
<br>
Can you help to explain the following two lines inside IExample2.idl:<br>
[id(<b>1</b>), propput] HRESULT Buffer([in] BSTR);<br>
[id(<b>1</b>), propget] HRESULT Buffer([out, retval] BSTR *);<br>
<br>
Why are the two Buffer() functions having the same ID 1 instead of two different IDs?<br>
<br>
Thanks.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/13862/COM-in-plain-C-Part-2" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=3299389" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_3299389" name="react-item_3299389" id="MRF3299389" class="reaction-result"></span><span data-objectref="3_3299389" data-votingtype="GoodOrBad" name="RateItem_3299389" id="MVF3299389" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="3299389" href="https://www.codeproject.com/Messages/3299389/Why-same-dispatch-ID-in-IExample2-idl" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4135720_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="38px" class="indent"><a name="xx4135720xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_answer.gif" alt="Answer" title="Answer"></td><td class="subject hover-container"><a class="message-link" name="4135720" parent="3299389" thread="3299389" href="https://www.codeproject.com/Messages/4135720/Re-Why-same-dispatch-ID-in-IExample2-idl">Re: Why same dispatch ID in IExample2.idl?</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Jeff Glatt</span><span class="date">22-Jan-12  19:13</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=88625">Jeff Glatt</a></span></td><td class="date"><span>22-Jan-12  19:13&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4135720_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,3299389);" href="https://www.codeproject.com/Messages/3299389/Why-same-dispatch-ID-in-IExample2-idl"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Because these two lines are <u>both</u>
 defining the same, one function called Buffer(). You must have only one
 DISPID (number) per function, and I chose the number 1 for Buffer(). 
What we're doing is telling the script engine there are two different 
ways of calling Buffer(). One way the engine can pass us a BSTR it want 
us to store. Well, actually we store a copy of it. A second way the 
engine can pass us a handle where we return a copy of the BSTR we 
stored. The first way is the propput version. The second way is the 
propget version.<br>
<br>
It's more or less the same concept as an overloaded function in a C++ 
class. But this is not a C++ class, and this is not a C++ include. This 
is our language-independent type library. This is how we specify the 
overloaded function here.<br>
<br>
And as my article notes, now there are two different ways that VBScript 
(or JScript, or Python, or C/C++, etc) can call Buffer() depending upon 
which of the two things it wants to do (ie, give one piece of data to my
 COM object, or retrieve one piece of data from my COM object. Note: 
this propput/propput stuff is just to let a script writer set/retrieve 
data using syntax that looks more natural/commonplace to him).<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/13862/COM-in-plain-C-Part-2" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=3299389" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_4135720" name="react-item_4135720" id="MRF4135720" class="reaction-result"></span><span data-objectref="3_4135720" data-votingtype="GoodOrBad" name="RateItem_4135720" id="MVF4135720" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="4135720" href="https://www.codeproject.com/Messages/4135720/Re-Why-same-dispatch-ID-in-IExample2-idl" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F3299330_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx3299330xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="3299330" parent="0" thread="3299330" href="https://www.codeproject.com/Messages/3299330/Trivial-errors-typos">Trivial errors/typos</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Hou Tianze</span><span class="date">9-Dec-09  21:33</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=2407417">Hou Tianze</a></span></td><td class="date"><span>9-Dec-09  21:33&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F3299330_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">First, I'd like to thank Jeff for this great series of 
articles which have given an in-depth view of the COM technology. It is 
especially useful for a COM novice like me to grasp the concept and 
understand how this massive beast works internally <img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/smiley_smile.gif" align="top" alt="Smile | :)"> <br>
<br>
Here are some, what I think, trivial typos/errors I've found in this Part 2 post:<br>
<br>
To modify IExample2App.c to IExampleExeApp.c which is to test out the 
EXE COM object, additional to the changes mentioned in the article, you 
have also make the following change, otherwise, CoGetClassObject() 
function call will fail:<br>
In line 20, change the second parameter of the CoGetClassObject() from <b>CLSCTX_INPROC_SERVER</b> to <b>CLSCTX_LOCAL_SERVER</b><br>
<br>
Also, you don't actually have to run IExample.exe prior to running the 
testing exe (IExampleExeApp.exe), it seems that the COM library will 
handle this for us.<br>
<br>
Others:<br>
Typo: But in order to declare a function as <b>propget</b>,<br>
Fix: But in order to declare a function as <b>propput</b>,<br>
<br>
Typo: And in order to declare a function as <b>propput</b><br>
Fix: And in order to declare a function as <b>propget</b><br>
<br>
Line 522 of iexampleexe\IExampleExe.c:<br>
Typo: <b>#define</b> ALLOW_UNLOADING<br>
Fix: <b>#ifdef</b> ALLOW_UNLOADING<br>
<br>
regiexampleexe\RegIExampleExe.c:<br>
Line 5:<br>
Typo: #include "<b>../IExample/IExampleExe.h</b>"<br>
Fix: #include "<b>../IExampleExe/IExampleExe.h</b>"<br>
<br>
Then you need to replace all <b>CLSID_IExample2</b> with <b>CLSID_IExampleExe</b><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/13862/COM-in-plain-C-Part-2" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=3299330" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_3299330" name="react-item_3299330" id="MRF3299330" class="reaction-result"></span><span data-objectref="3_3299330" data-votingtype="GoodOrBad" name="RateItem_3299330" id="MVF3299330" class="rating-result"><span>1.00/5 (1 vote)</span></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="3299330" href="https://www.codeproject.com/Messages/3299330/Trivial-errors-typos" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F2844764_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx2844764xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="2844764" parent="0" thread="2844764" href="https://www.codeproject.com/Messages/2844764/re-A-VBScript-example">re: A VBScript example</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">kennn</span><span class="date">15-Dec-08  5:19</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=208547">kennn</a></span></td><td class="date"><span>15-Dec-08  5:19&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F2844764_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">The Article section entitled "A VBScript example" gives a
 detailed explanation of when the script engine calls GetIDsOfNames and 
Invoke. But when does the script engine call GetTypeInfoCount and 
GetTypeInfo?<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/13862/COM-in-plain-C-Part-2" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=2844764" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_2844764" name="react-item_2844764" id="MRF2844764" class="reaction-result"></span><span data-objectref="3_2844764" data-votingtype="GoodOrBad" name="RateItem_2844764" id="MVF2844764" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="2844764" href="https://www.codeproject.com/Messages/2844764/re-A-VBScript-example" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4135727_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="38px" class="indent"><a name="xx4135727xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="4135727" parent="2844764" thread="2844764" href="https://www.codeproject.com/Messages/4135727/Re-re-A-VBScript-example">Re: re: A VBScript example</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Jeff Glatt</span><span class="date">22-Jan-12  19:24</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=88625">Jeff Glatt</a></span></td><td class="date"><span>22-Jan-12  19:24&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4135727_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,2844764);" href="https://www.codeproject.com/Messages/2844764/re-A-VBScript-example"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Typically,
 the script engine does this when the script writer puts a line in his 
code, telling the engine he wants to load a particular COM object. In 
VBScript, that happens with the Createobject() call. The engine gets 
both a pointer to the COM object, and its ITypeInfo object (and then 
holds both until the script "deletes/frees" the COM object, or just 
terminates).<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/13862/COM-in-plain-C-Part-2" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=2844764" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_4135727" name="react-item_4135727" id="MRF4135727" class="reaction-result"></span><span data-objectref="3_4135727" data-votingtype="GoodOrBad" name="RateItem_4135727" id="MVF4135727" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="4135727" href="https://www.codeproject.com/Messages/4135727/Re-re-A-VBScript-example" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F2569705_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx2569705xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="2569705" parent="0" thread="2569705" href="https://www.codeproject.com/Messages/2569705/everything-works-You-are-number-one-Many-thanks">everything works! You are number one. Many thanks...</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">mustafa_badici</span><span class="date">26-May-08  2:02</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=5110849">mustafa_badici</a></span></td><td class="date"><span>26-May-08  2:02&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F2569705_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">everything works! You are number one. Many thanks...<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/13862/COM-in-plain-C-Part-2" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=2569705" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_2569705" name="react-item_2569705" id="MRF2569705" class="reaction-result"></span><span data-objectref="3_2569705" data-votingtype="GoodOrBad" name="RateItem_2569705" id="MVF2569705" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="2569705" href="https://www.codeproject.com/Messages/2569705/everything-works-You-are-number-one-Many-thanks" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F3008789_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="38px" class="indent"><a name="xx3008789xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="3008789" parent="2569705" thread="2569705" href="https://www.codeproject.com/Messages/3008789/Re-everything-works-You-are-number-one-Many-thanks">Re: everything works! You are number one. Many thanks...</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Member 3710051</span><span class="date">17-Apr-09  13:21</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=3710051">Member 3710051</a></span></td><td class="date"><span>17-Apr-09  13:21&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F3008789_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,2569705);" href="https://www.codeproject.com/Messages/2569705/everything-works-You-are-number-one-Many-thanks"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Everything compiles well in VC++ 6 but the registration fails ...<br>
<br>
How did you get the part 2 code to compile and work?<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/13862/COM-in-plain-C-Part-2" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=2569705" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_3008789" name="react-item_3008789" id="MRF3008789" class="reaction-result"></span><span data-objectref="3_3008789" data-votingtype="GoodOrBad" name="RateItem_3008789" id="MVF3008789" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="3008789" href="https://www.codeproject.com/Messages/3008789/Re-everything-works-You-are-number-one-Many-thanks" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F2496058_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx2496058xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="2496058" parent="0" thread="2496058" href="https://www.codeproject.com/Messages/2496058/Make-it-work-as-activeX-and-display-in-internet-ex">Make it work as activeX and display in internet explorer</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">DrunkenMonster</span><span class="date">7-Apr-08  0:35</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=5037740">DrunkenMonster</a></span></td><td class="date"><span>7-Apr-08  0:35&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F2496058_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">how to display this to an internet explorer....<br>
<br>
using ur code i created an directx based application..<br>
<br>
where i have initilizedirecx(void * hWnd) , draw() and release() functions..<br>
<br>
how to call the initializedirectx function from IE..<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/13862/COM-in-plain-C-Part-2" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=2496058" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_2496058" name="react-item_2496058" id="MRF2496058" class="reaction-result"></span><span data-objectref="3_2496058" data-votingtype="GoodOrBad" name="RateItem_2496058" id="MVF2496058" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="2496058" href="https://www.codeproject.com/Messages/2496058/Make-it-work-as-activeX-and-display-in-internet-ex" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F2493459_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx2493459xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="2493459" parent="0" thread="2493459" href="https://www.codeproject.com/Messages/2493459/I-think-the-registry-example-is-not-fully-correct">I think the registry example is not fully correct</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">FriedrichDominicus</span><span class="date">4-Apr-08  1:22</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=3382646">FriedrichDominicus</a></span></td><td class="date"><span>4-Apr-08  1:22&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F2493459_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Well may be that I'm wrong about it but it seems you are using the wrong <br>
UUID for the registration. It should IMHO not be the CoClass UUID but the <br>
UUID of the type library. IIUC then this should be the LIBID_xxxx.<br>
<br>
But anyway I learned very much from it, so thanks.<br>
<br>
Regards<br>
Friedrich<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/13862/COM-in-plain-C-Part-2" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=2493459" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_2493459" name="react-item_2493459" id="MRF2493459" class="reaction-result"></span><span data-objectref="3_2493459" data-votingtype="GoodOrBad" name="RateItem_2493459" id="MVF2493459" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="2493459" href="https://www.codeproject.com/Messages/2493459/I-think-the-registry-example-is-not-fully-correct" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F2423720_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx2423720xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_question.gif" alt="Question" title="Question"></td><td class="subject hover-container"><a class="message-link" name="2423720" parent="0" thread="2423720" href="https://www.codeproject.com/Messages/2423720/Invoking-methods-without-a-h">Invoking methods without a .h</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Member 4134890</span><span class="date">11-Feb-08  19:03</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=4134890">Member 4134890</a></span></td><td class="date"><span>11-Feb-08  19:03&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F2423720_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">I need to call methods of a COM object but I don't have 
the .h file. Scripting languages work with it. I need to do it from 
C(++), so I guess I would need to do something like what the scripting 
engines do.<br>
<br>
You said "In the next chapter, we'll look at the IDispatch functions 
from the point of view of a script engine. How does a script engine 
translate some code in its own language to a call to our object's 
IDispatch functions?" but part 3 talks about collections, and as far as I
 can see, none of the following chapters talk about this!<br>
<br>
So, from C++, how can I load a COM object from the GUID (or better: from
 a name like Excel.Application), and call its methods based on the type 
library, lacking the header file?<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/13862/COM-in-plain-C-Part-2" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=2423720" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_2423720" name="react-item_2423720" id="MRF2423720" class="reaction-result"></span><span data-objectref="3_2423720" data-votingtype="GoodOrBad" name="RateItem_2423720" id="MVF2423720" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="2423720" href="https://www.codeproject.com/Messages/2423720/Invoking-methods-without-a-h" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F2375663_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx2375663xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="2375663" parent="0" thread="2375663" href="https://www.codeproject.com/Messages/2375663/VB-ERROR-430-Class-Doesnt-support-automation">VB ERROR 430: Class Doesn't support automation...</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author"><font color="maroon">gUrM33T</font></span><span class="date">2-Jan-08  8:00</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=547523"><font color="maroon">gUrM33T</font></a></span></td><td class="date"><span>2-Jan-08  8:00&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F2375663_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">When library is used in VB, everything works fine the 
first time and then I start getting this error message. Can you please 
explain why? If I restart VB, it again works for first time and then 
start giving the same error in further tries.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/13862/COM-in-plain-C-Part-2" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=2375663" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_2375663" name="react-item_2375663" id="MRF2375663" class="reaction-result"></span><span data-objectref="3_2375663" data-votingtype="GoodOrBad" name="RateItem_2375663" id="MVF2375663" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="2375663" href="https://www.codeproject.com/Messages/2375663/VB-ERROR-430-Class-Doesnt-support-automation" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F2375671_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="38px" class="indent"><a name="xx2375671xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="2375671" parent="2375663" thread="2375663" href="https://www.codeproject.com/Messages/2375671/Re-VB-ERROR-430-Class-Doesnt-support-automation">Re: VB ERROR 430: Class Doesn't support automation...</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author"><font color="maroon">gUrM33T</font></span><span class="date">2-Jan-08  8:26</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=547523"><font color="maroon">gUrM33T</font></a></span></td><td class="date"><span>2-Jan-08  8:26&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F2375671_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,2375663);" href="https://www.codeproject.com/Messages/2375663/VB-ERROR-430-Class-Doesnt-support-automation"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Now
 I tried to set the ThreadingModel to Apartment and it's working fine 
now. Please can you explain the difference between Apartment and Both 
threading model and which one is better to use?<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/13862/COM-in-plain-C-Part-2" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=2375663" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_2375671" name="react-item_2375671" id="MRF2375671" class="reaction-result"></span><span data-objectref="3_2375671" data-votingtype="GoodOrBad" name="RateItem_2375671" id="MVF2375671" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="2375671" href="https://www.codeproject.com/Messages/2375671/Re-VB-ERROR-430-Class-Doesnt-support-automation" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F2260238_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx2260238xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="2260238" parent="0" thread="2260238" href="https://www.codeproject.com/Messages/2260238/Invoke-a-Method">Invoke a Method</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">xfinger</span><span class="date">6-Oct-07  11:11</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=203993">xfinger</a></span></td><td class="date"><span>6-Oct-07  11:11&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F2260238_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Jeff, would you show us how to invoke a method by its IDs?<br>
thanks<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/13862/COM-in-plain-C-Part-2" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=2260238" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_2260238" name="react-item_2260238" id="MRF2260238" class="reaction-result"></span><span data-objectref="3_2260238" data-votingtype="GoodOrBad" name="RateItem_2260238" id="MVF2260238" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="2260238" href="https://www.codeproject.com/Messages/2260238/Invoke-a-Method" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F2260535_h0" class="header hover-row">
<td class="subject-line normal vote-hi" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="38px" class="indent"><a name="xx2260535xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="2260535" parent="2260238" thread="2260238" href="https://www.codeproject.com/Messages/2260535/Re-Invoke-a-Method">Re: Invoke a Method</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Jeff Glatt</span><span class="date">7-Oct-07  6:25</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=88625">Jeff Glatt</a></span></td><td class="date"><span>7-Oct-07  6:25&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F2260535_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,2260238);" href="https://www.codeproject.com/Messages/2260238/Invoke-a-Method"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Oh
 that's easy. If you already know the ID of the function, then you just 
pass that to Invoke(). You don't need to call GetIDsOfNames(). The whole
 point of GetIDsOfNames is if you know only the name of the function, 
but not its ID. Once you have the ID, then you can call Invoke to 
(indirectly) call that function.<br>
<br>
Note that some programmers use a "TypeInfo browser" to find out the IDs 
of the various functions in a COM object. Then the programmer simply 
uses those IDs, instead of bothering with GetIDsOfNames. After all, 
GetIDsOfNames can incur extra overhead. This works ok as long as the 
author of the COM object doesn't create a new version in which he has 
changed all the previous ID numbers of the functions (which would be a 
foolish and unnecessary thing to do).<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/13862/COM-in-plain-C-Part-2" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=2260238" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_2260535" name="react-item_2260535" id="MRF2260535" class="reaction-result"></span><span data-objectref="3_2260535" data-votingtype="GoodOrBad" name="RateItem_2260535" id="MVF2260535" class="rating-result"><span>5.00/5 (1 vote)</span></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="2260535" href="https://www.codeproject.com/Messages/2260535/Re-Invoke-a-Method" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F2263662_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="56px" class="indent"><a name="xx2263662xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="2263662" parent="2260535" thread="2260238" href="https://www.codeproject.com/Messages/2263662/Re-Invoke-a-Method">Re: Invoke a Method</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">xfinger</span><span class="date">9-Oct-07  8:23</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=203993">xfinger</a></span></td><td class="date"><span>9-Oct-07  8:23&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F2263662_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:56px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,2260535);" href="https://www.codeproject.com/Messages/2260535/Re-Invoke-a-Method"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Ok, with the help of Ole i came up with the function to call a method  with its ID:<br>
void InvokeHelperV(SOMECOMSERVER *this, const DISPID dwDispID, WORD 
wFlags, VARTYPE vtRet, void* pvRet, const BYTE* pbParamInfo, va_list 
argList);<br>
after of course, prepare the parameters.<br>
<br>
so, let's pretend i have a <b>COMSERVER</b>, i dont have the C style Interface but have its ID and want to receive the <b>Event message</b>, how should i tell the SOMECOMSERVER i want that ID event?<br>
<br>
C++ compiler do this:<br>
<div class="pre-lang" id="premain224935"><div></div><div class="pre-action-link"><span class="code-collapse" data-index="224935" id="preShrink224935">Shrink ▲</span> &nbsp; <span id="copycode224935" class="copy-code" data-index="224935" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve">
<g>
<path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272
    c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729
    c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path>
<path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272
    c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068
    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001
    C291.206,428.715,289.92,430,288.341,430z"></path>	
</g>
</svg></span></div></div>
<pre id="pre224935" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">BEGIN_EVENTSINK_MAP(CMyDlg, CDialog)&lt;br /&gt;
	ON_EVENT(SOMECOMSERVER, IDC_MONITOR_COM, <span class="code-digit">1</span>, OnComEvent, VTS_I4 VTS_I4 VTS_I4 VTS_I4 VTS_I4 VTS_I4 VTS_I4 VTS_I4 VTS_I4 VTS_I4 )&lt;br /&gt;
END_EVENTSINK_MAP()</pre><br>
<br>
and i know the typelib is like:<br>
<br>
<div class="pre-lang" id="premain603288"><div></div><div class="pre-action-link"><span class="code-collapse" data-index="603288" id="preShrink603288">Shrink ▲</span> &nbsp; <span id="copycode603288" class="copy-code" data-index="603288" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve">
<g>
<path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272
    c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729
    c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path>
<path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272
    c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068
    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001
    C291.206,428.715,289.92,430,288.341,430z"></path>	
</g>
</svg></span></div></div>
<pre id="pre603288" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">library <b>somecomserver</b>&lt;br /&gt;
{&lt;br /&gt;
  importlib(<span class="code-string">"</span><span class="code-string">stdole2.tlb"</span>);&lt;br /&gt;
&lt;br /&gt;
  <span class="code-comment">//</span><span class="code-comment"> Forward declare all types defined in this typelib&lt;br /&gt;</span>
  dispinterface _SOMECOMEvents;&lt;br /&gt;
  <span class="code-keyword">interface</span> ISOMECOM;&lt;br /&gt;
&lt;br /&gt;
  [&lt;br /&gt;
    uuid(CA345660-7738-9C95-044E-34567506DF55),&lt;br /&gt;
    helpstring(<span class="code-string">"</span><span class="code-string">ISOMECOMSERVER Event Interface"</span>)&lt;br /&gt;
  ]&lt;br /&gt;
  dispinterface _ISOMECOMEvents {&lt;br /&gt;
      properties:&lt;br /&gt;
      methods:&lt;br /&gt;
          [id(<span class="code-digit">0x00000001</span>), helpstring(<span class="code-string">"</span><span class="code-string">Event OnComEvent"</span>)]&lt;br /&gt;
          <span class="code-keyword">void</span> OnComEvent(&lt;br /&gt;
                          [in] <span class="code-keyword">long</span> Parm1, &lt;br /&gt;
                          [in] <span class="code-keyword">long</span> Parm2, &lt;br /&gt;
                          [in] <span class="code-keyword">long</span> Parm3, &lt;br /&gt;
                          [in] <span class="code-keyword">long</span> Parm4, &lt;br /&gt;
                          [in] <span class="code-keyword">long</span> Parm5, &lt;br /&gt;
                          [in] <span class="code-keyword">long</span> Parm6, &lt;br /&gt;
                          [in] <span class="code-keyword">long</span> Parm7, &lt;br /&gt;
                          [in] <span class="code-keyword">long</span> Parm8, &lt;br /&gt;
                          [in] <span class="code-keyword">long</span> Parm9, &lt;br /&gt;
                          [in] <span class="code-keyword">long</span> Parm10);&lt;br /&gt;
  }; &lt;br /&gt;
   [&lt;br /&gt;
      uuid(0ABC7719-B341-415B-6669-788BEa45679F),&lt;br /&gt;
      version(<span class="code-digit">1</span>.<span class="code-digit">0</span>),&lt;br /&gt;
      helpstring(<span class="code-string">"</span><span class="code-string">SOMECOM Class"</span>)&lt;br /&gt;
    ]&lt;br /&gt;
    coclass SOMECOM {&lt;br /&gt;
        [default] <span class="code-keyword">interface</span> ISOMECOM;&lt;br /&gt;
        [default, source] dispinterface _ISOMECOMEvents;&lt;br /&gt;
    };&lt;br /&gt;
}</pre><br>
<br>
Do you know how to acomplish it?<br>
 <br>
<br>
Best Regards<br>
Alexander<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/13862/COM-in-plain-C-Part-2" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=2260238" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_2263662" name="react-item_2263662" id="MRF2263662" class="reaction-result"></span><span data-objectref="3_2263662" data-votingtype="GoodOrBad" name="RateItem_2263662" id="MVF2263662" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="2263662" href="https://www.codeproject.com/Messages/2263662/Re-Invoke-a-Method" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr>
<td><table width="100%" cellpadding="2px" cellspacing="0">
<tbody><tr class="footer">
<td><span class="last-visit desktop-only tablet-only">Last Visit: 31-Dec-99  18:00 &nbsp; &nbsp; Last Update: 27-Aug-23  0:42</span></td><td><a rel="nofollow" href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;prof=True&amp;view=Normal">Refresh</a></td><td style="text-align:right;white-space:nowrap;"><input id="_mbnUrl" type="hidden" value="/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;prof=True&amp;view=Normal&amp;fr=26"><span class="nav-link selected">1</span><a class="nav-link" name="Frm_HoverNL" href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;prof=True&amp;view=Normal&amp;fr=26#xx0xx">2</a><a class="nav-link" name="Frm_HoverNL" href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;prof=True&amp;view=Normal&amp;fr=51#xx0xx">3</a> <a class="nav-link" name="Frm_HoverNL" href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?fid=295130&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;prof=True&amp;view=Normal&amp;fr=26#xx0xx">Next ᐅ</a></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table>
</div><p class="small-text"><img align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_general.gif" width="16px" height="16px" alt="General"> General &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_news.gif" width="16px" height="16px" alt="News"> News &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_idea.gif" width="16px" height="16px" alt="Suggestion"> Suggestion &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_question.gif" width="16px" height="16px" alt="Question"> Question &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_bug.gif" width="16px" height="16px" alt="Bug"> Bug &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_answer.gif" width="16px" height="16px" alt="Answer"> Answer &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_joke.gif" width="16px" height="16px" alt="Joke"> Joke &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_kudos.gif" width="16px" height="16px" alt="Praise"> Praise &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_rant.gif" width="16px" height="16px" alt="Rant"> Rant &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/msg_admin.gif" width="16px" height="16px" alt="Admin"> Admin &nbsp;&nbsp; </p><p class="small-text">Use Ctrl+Left/Right to switch messages, Ctrl+Up/Down to switch threads, Ctrl+Shift+Left/Right to switch pages.</p>
				

			</div>
			

            
            <div id="ctl00_RightSideBar" class="article-right-sidebar">

				
				

				

                <div id="ctl00_RHSticky" class="container-article-info-sticky sticky">

					<div class="padded-top" style="height:250px;width:300px">
						<div class="msg-300x250" data-format="300x250" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="senseai" data-country="US" data-tags="VC6, C++, C, Windows, Visual-Studio, Dev, COM, Beginner,rating4.5"><noscript><a href="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/senseai&sz=300x250&c=371656"><img src="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/senseai&sz=300x250&c=371656"  width="300px" height="250px" target="_blank"/></a></noscript></div>
					</div>

        		    

<div class="article-summary">

    
    

</div>

				    

                    

				    

				    

					<div class="padded-top" style="height:250px;width:300px">
						<div class="msg-300x250" data-format="300x250" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="Programming-LanguagesC" data-country="US" data-loadonview="true" data-tags="VC6, C++, C, Windows, Visual-Studio, Dev, COM, Beginner,rating4.5"><noscript><a href="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Programming-LanguagesC&sz=300x250&c=371656"><img src="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Programming-LanguagesC&sz=300x250&c=371656"  width="300px" height="250px" target="_blank"/></a></noscript></div>
					</div>

                    <div class="anchorLink gototop" id="gototop">
                        <a id="ctl00_GoToTop" href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2#_articleTop">Go to top</a>
                    </div>

			    </div>
            </div>
            

        </div>
        

		
		<div class="site-footer">
			<div class="align-left">
				<a id="ctl00_PermaLink" href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2">Permalink</a><br>
				<a id="ctl00_AdvertiseLink" href="http://developermedia.com/">Advertise </a><br>
				<a id="ctl00_PrivacyLink" href="https://www.codeproject.com/info/privacy.aspx">Privacy</a><br>
    			<a id="ctl00_CookiePolicyLink" href="https://www.codeproject.com/info/cookie.aspx">Cookies</a><br>
                <a id="ctl00_TermsOfUseLink" href="https://www.codeproject.com/info/TermsOfUse.aspx">Terms of Use</a><br>
			</div>

            <div class="align-center">
				


<div class="page-width">
    Layout: <a id="ctl00_PageWidth_FixedT" title="Fixed width layout" rel="nofollow" class=" active" href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?PageFlow=FixedWidth">fixed</a>
    |
    <a id="ctl00_PageWidth_FluidT" title="Fluid layout" rel="nofollow" href="https://www.codeproject.com/Articles/13862/COM-in-plain-C-Part-2?PageFlow=Fluid">fluid</a>
</div>


				

				

	            

                <br>
			</div>
                
			<div class="align-right">
				Article Copyright 2006 by Jeff Glatt<br>Everything else
				Copyright © <a href="mailto:webmaster@codeproject.com">CodeProject</a>, 1999-2023 <br>
                <br>
				Web03 
				2.8:2023-08-14:1<br>
			</div>
		</div>
		

		<br clear="all">
		
			

	</div> 
	</div> 
</div>



<img id="ctl00_Audience" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/DFPAudiencePixel" style="border-width:0px;height:1px;width:1px;">



<script type="text/javascript"> // IMMEDIATE script

function Join() {
    document.location.href = 'https://www.codeproject.com/script/Membership/Modify.aspx';
    return false;
}

var ufjqkjgfrf = function(n){var t=!1;n=n||{};var r=n.RetrievalServiceUrl||"/script/content/webservices/RetrieveContent.aspx/GetContent",u=n.RetrievalServiceRetries||3,f=n.RetrievalServiceTimeout||5e3,e=function(){t||(t=!0,$(window).on("resize scroll",i),i())},i=function(){if(typeof DMAds=="undefined"){var n=$('[data-type="ad"]');n.each(function(){var n=$(this),u=n.attr("data-format")||"",f=n.attr("data-publisher")||"",e=n.attr("data-zone")||"",t=n.attr("data-loadonview"),i=n.attr("data-noadx"),h=n.attr("data-tags")||"",c=n.find("iframe").length!==0||n.find("img").length!==0,r=n.attr("data-processed");t=typeof t=="string"&&t.toLowerCase()==="true";i=typeof i=="string"&&i.toLowerCase()==="true";r=typeof r=="string"&&r.toLowerCase()==="true";r||c||t&&!s(this)||(o(n,u,f,e,i,h),n.attr("data-processed","true"))})}},o=function(n,t,i,e,o,s){var h=new $.Deferred,c=JSON.stringify({format:t,publisherCode:i,zone:e,noAdX:o,keywords:s});$.ajax({url:r,cache:!1,type:"POST",data:c,contentType:"application/json; charset=utf-8",dataType:"json",tryCount:0,retryLimit:u,timeout:f}).done(function(t){var i=t?t.d:null;h.resolve(i); i && i.html && n.html(i.html)}).fail(function(n,t){h.reject(t)})},s=function(n){var t,f,e,o;if(!h(n))return!1;var u=!1,i=0,r=0;try{t=n.getBoundingClientRect();typeof innerWidth=="number"?(i=window.innerWidth,r=window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?(i=document.documentElement.clientWidth,r=document.documentElement.clientHeight):document.body&&(document.body.clientWidth||document.body.clientHeight)&&(i=document.body.clientWidth,r=document.body.clientHeight);f=-200;t.top===t.bottom&&(f+=n.height*-1);e=t.top>=0&&t.top-200<=r||t.top<=0&&t.top>=f;o=i>t.left&&t.right>=0;u=e&&o}catch(s){u=!0}return u},h=function(n){var t=!1,i;return n&&n.style.position!=="fixed"&&n.offsetParent?t=!0:n&&n.style.position==="fixed"&&(i=window.getComputedStyle(n),t=i&&i.display!=="none"),t&&c()},c=function(){var t=!0,n="";return typeof document.hidden!="undefined"?n="hidden":typeof document.mozHidden!="undefined"?n="mozHidden":typeof document.msHidden!="undefined"?n="msHidden":typeof document.webkitHidden!="undefined"&&(n="webkitHidden"),n!==null&&document[n]&&(t=!1),t};return{init:e}};
document.addEventListener('DOMContentLoaded', function() {
var n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP"),t;n.onreadystatechange=function(){try{if(n.readyState==4)if(n.status==200){var t=document.createElement("script");t.type="text/javascript";t.innerHTML=n.responseText;document.getElementsByTagName("body")[0].appendChild(t)}else(new ufjqkjgfrf).init()}catch(i){(new ufjqkjgfrf).init()}};try{t='/a.min.js?v=1.3';n.open("GET",t,!0);n.send()}catch(i){(new ufjqkjgfrf).init()}

  $('div[data-type="ad"][data-showindicator="true"]').before('<div class="small-text muted hidden">Advertisement</div>');
  setTimeout(function(){ 
    $('div[data-type="ad"][data-showindicator="true"]').each(function( index ) {
      if ($(this).height() > 0) {
       $(this).prev().removeClass('hidden');
      }
    });
  }, 2000);

});

var ratingCtrl_ctl00_RateArticle;

var forumConfig_ctl00_MessageBoard;
var forumCtrl_ctl00_MessageBoard;
var forumCtrl_ctl00_MessageBoard_forumMsgFlag;
var forumCtrl_ctl00_MessageBoard_rating;
var forumCtrl_ctl00_MessageBoard_ratingConfig;
var forumCtrl_ctl00_MessageBoard_reaction;
var forumCtrl_ctl00_MessageBoard__reactionConfig;

var subscriptionConfig_ctl00_MessageBoard = {
 ParentId      : 'ctl00_MessageBoard_SubscribeDiv',
 NewId         : 'ctl00_MessageBoard_SubscribeNew',
 ReplyId       : 'ctl00_MessageBoard_SubscribeReplies',
 InstantId     : 'ctl00_MessageBoard_SubscribeInstant',
 DailyId       : 'ctl00_MessageBoard_SubscribeDaily',
 MessageTypeId : 'ctl00_MessageBoard_MessageType',
 GetInfoUrl    : '/script/Forums/WebServices/ForumSubscriptionServices.aspx/GetSubscriptions',
 UpdateInfoUrl : '/script/Forums/WebServices/ForumSubscriptionServices.aspx/UpdateSubscription',
 ForumId       : 295130,
};
var subscriptions_ctl00_MessageBoard;
</script>

<script type="text/javascript"> // DEFERRED script

document.addEventListener('DOMContentLoaded', function() {

	new CodeBlocks().initialise('#contentdiv');
	
	$('.author-wrapper .description').shorten({showChars: 400});
	
	anchorAnimate();
	
	$('#__EVENTVALIDATION').attr('autocomplete', 'off');
	
	$('#joinBtn').css('visibility', 'visible');
	
	MicroModal.init();
	
	$('.oauth').click(function () {
	    $this = $(this);
	    href = $this.attr('href');
	    var myWindow = window.open(href, 'popup',
	                              'width=800,height=600,location=0,menubar=0,resizeable=0,scrollbars=0,toolbar=0');
	    myWindow.focus();
	    var timer = setInterval(function () {
	        if (myWindow.closed) {
	            clearInterval(timer);
	            // window.location.reload(); // May do a POST reload, shows a warning
	            window.location = window.location; // force a GET reload
	        }
	    }, 200);
	    return false;
	});
	
	var oSrchFlt = false, oSrchBox=false, srchBoxFoc=false;
	var sbar     = $('#sb_tb');
	var sfilter  = $('#SearchFilter');
	
	if (typeof(InitWatermark) !== 'undefined')
	  InitWatermark('sb_tb', 'Search for articles, questions, tips');
	if (sbar && sfilter) {
	  sfilter.removeClass('popup'); sfilter.hide(); sfilter.removeClass('open');
	  sbar.blur(function() {
	    if (!oSrchFlt) { sfilter.hide(); sfilter.removeClass('open'); }
	    srchBoxFoc = false;
	  });
	  sbar.focus(function() {
	    oSrchFlt   = false;
	    srchBoxFoc = true;
	    sfilter.show();
	    sfilter.addClass('open');
	  });
	  sbar.mouseleave(function()    { oSrchBox = false; });
	  sbar.mouseover(function()     { oSrchBox = true; });
	  sfilter.mouseleave(function() {
	    oSrchFlt=false;
	    if (!srchBoxFoc && !oSrchBox) { sfilter.hide(); sfilter.removeClass('open'); }
	  });
	  sfilter.mouseover(function()  { oSrchFlt = true; });
	}
	
	var ratingConfig_ctl00_RateArticle = {
	  objectRef:          '2_13862_1',
	  objectSubtypeId:    1,
	  objectTypeName:     'article',
	  ownerId:            88625,
	  votingType:         'None',
	  ratingDisplayMode:  'LargeStars',
	  resultDisplayMode:  'LargeStars',
	  ratingCallback:     null,
	  staticServer:       'https://codeproject.freetls.fastly.net',
	  baseDir:            '/script/Ratings/',
	  ratingUrl:          'ajax/RateItem.aspx',
	  histogramUrl:       'ajax/Histogram.aspx',
	  getRatingUrl:       'ajax/GetRatings.aspx',
	  width:              130,
	  forceComment:       false,
	  lowVoteThreshold:   0,
	  minRating:          1,
	  maxRating:          5
	};
	ratingCtrl_ctl00_RateArticle = new RatingControl('#ctl00_RateArticle_RatingTable',ratingConfig_ctl00_RateArticle);
	
	forumConfig_ctl00_MessageBoard_ratingConfig = {
	  objectTypeId:       3,
	  objectTypeName:     'message',
	  bulkResultSelector: '#_MessageBoardctl00_MessageBoard',
	  votingType:         'GoodOrBad',
	  staticServer:       'https://codeproject.freetls.fastly.net',
	  forceComment:       false,
	  ratingDisplayMode:  'TextOnly',
	  resultDisplayMode:  'TextOnly'
	};
	forumCtrl_ctl00_MessageBoard_rating = new RatingControl('#_MessageBoardctl00_MessageBoard .content', forumConfig_ctl00_MessageBoard_ratingConfig);
	forumConfig_ctl00_MessageBoard = {
	    objectName          : 'forumCtrl_ctl00_MessageBoard',
	    messageTypeId       : 3,
	    searchPrompt        : 'Search Comments',
	    smoothScroll        : true,
	    allowReporting      : false,
	    allowRating         : false,
	    allowRatingDisplay  : true,
	    allowReactions      : false,
	    forumDir            : '/script/Forums/',
	    staticServer        : 'https://codeproject.freetls.fastly.net',
	    switchMsgCallback   : null,
	    ratingControl       : forumCtrl_ctl00_MessageBoard_rating,
	    reactionControl     : null,
	    codeblockProcessor  : new CodeBlocks(),
	    getReportFormMethod : getReportFormHtml,
	    voteHiThreshold     : 5 - 0.5,
	    reportOptions       : [
	       { reportTypeId : 19, name : 'Abusive / Trolling'},
	       { reportTypeId : 20, name : 'Inappropriate'},
	       { reportTypeId : 5, name : 'Spam'},
	    ],
	};
	forumCtrl_ctl00_MessageBoard = new ForumControl('#ForumTable',forumConfig_ctl00_MessageBoard, -1);
	forumCtrl_ctl00_MessageBoard_rating.setConfig('ratingCallback', forumCtrl_ctl00_MessageBoard.showMessageRating);
	forumCtrl_ctl00_MessageBoard.Initialise();
	
	subscriptions_ctl00_MessageBoard = new Subscriptions(subscriptionConfig_ctl00_MessageBoard);
	subscriptions_ctl00_MessageBoard.initialise();
	
	cookieconsent.initialise({
	                                    enabled : true,
	                                    cookie  : { domain: 'codeproject.com' },
	                                    palette : {
	                                        popup: { background: '#ff9900' },
	                                        button: { background: '#f5d948' }
	                                    },
	                                    law :  {
	                                        showForAllRegions : true, 
	                                        countryCode : 'US' 
	                                    },
	                                    theme: 'edgeless',
	                                    type : 'opt-in-out',
	                                    content: {
	                                        message: 'Like every other website we use cookies. By using our site you acknowledge that you have read and understand our <a href=\'/info/cookie.aspx\'>Cookie Policy</a>, <a href=\'/info/privacy.aspx\'>Privacy Policy</a>, and our <a href=\'/info/TermsOfUse.aspx\'>Terms of Service</a>.',
	                                        href:    'https://www.codeproject.com/info/privacy.aspx',
	                                        dismiss: 'Ask me later'
	                                    },
	                                    revokable:true,
	                                    onStatusChange: function(status) {
	                                        $.ajax({
	                                		    dataType  : 'json',
	                                            data: JSON.stringify({ allowCookies : this.hasConsented() }),
	                                            url: '/script/membership/webservices/LoggedOnMemberservices.aspx/SetCookieConsent',
	                                            cache: false,
	                                            type: 'POST',
	                                            contentType: 'application/json'
	                                        })
	                                        console.log(this.hasConsented() ? 'enable cookies' : 'disable cookies');
	                                        console.log(this.hasAnswered() ? 'has answered' : 'did not answer');
	                                    },
	                                });

})
</script>










<style type="text/css">.copied::after {  position: absolute;  right: 0;  display: inline-block; white-space: nowrap; content: 'copied'; color: #fff; background-color: #f90;  border-radius: 3px; padding:1px 8px; opacity: 0;  will-change: opacity, transform; animation: showcopied 1.5s ease; } @keyframes showcopied { 0% { opacity: 0; } 70% { opacity: 1; } 100% { opacity: 0; } } </style><style type="text/css">.copied::after {  position: absolute;  right: 0;  display: inline-block; white-space: nowrap; content: 'copied'; color: #fff; background-color: #f90;  border-radius: 3px; padding:1px 8px; opacity: 0;  will-change: opacity, transform; animation: showcopied 1.5s ease; } @keyframes showcopied { 0% { opacity: 0; } 70% { opacity: 1; } 100% { opacity: 0; } } </style><script type="text/javascript">if(typeof DMAds=="undefined"){var SendDmAdUid=!1,SendSearchTermsToServer=!0,CodeProjectPublisherId="lqm.codeproject.site",EnableMutableAds=!0,EnableViewOnScroll=!0,adServer=adServer||window.location.protocol+"//ads.DeveloperMedia.com/",SearchTermUrl="https://apps.developermedia.com/Ads/PageTerms/GetTerms",AdClickUrl="https://apps.developermedia.com/Ads/PageTerms/LogClick",DownvoteUrl="https://apps.developermedia.com/Ads/AdVote/DownvoteByFingerprint",UndoDownvoteUrl="https://apps.developermedia.com/Ads/AdVote/UndoDownvote",ReportAdUrl="https://apps.developermedia.com/Ads/AdVote/ReportAd",GlobalIdUrl="https://apps.developermedia.com/Ads/GlobalUserIdentification/",CloseAdImageUrl="https://cdn1.developermedia.com/Content/images/undo.png",UndoCloseAdImageUrl="https://cdn1.developermedia.com/Content/images/redo.png",DmLogoImageUrl="https://cdn1.developermedia.com/Content/images/dm-logo-150x23.png";String.prototype.includes||(String.prototype.includes=function(n,t){"use strict";return(typeof t!="number"&&(t=0),t+n.length>this.length)?!1:this.indexOf(n,t)!==-1});var DMAdXHelper=function(){var n=[],t={},s=!1,r=!1,v=0,f=null,y=function(n){try{var i=p(n),t=w(n),r=b(n);t.insertBefore(r,t.children[0]);n.closeAdButton=i;n.reportAdDiv=t;n.adContainer.appendChild(i);n.adContainer.parentNode.appendChild(t);n.reportButton=t.getElementsByClassName("reportButton")[0];n.reportButton.disabled=!0;n.reportButton.onclick=function(){return l(n),!1}}catch(u){console.log(u)}},p=function(n){var i=document.createElement("input");return i.type="image",i.src=t.CloseAdImageUrl,i.title="Report Ad",i.align="left",i.style.cssText="z-index:1000; position:relative; left:0px; top:-"+n.height+"px; margin-top: 0px; margin-left: 0px; display:block; font-size:0px; border: 0px; padding: 0px; height:14px; width:14px",i.onclick=n.width===125&&n.height===125?function(){return c(n),l(n),!1}:function(){return c(n),!1},i},w=function(n){var t=n.width,i=n.height,r=document.createElement("div"),u="<select class='reportReason' style='max-width:150px !important; padding: 0px !important'><option>Offensive<\/option><option>Abusive<\/option><option>Off topic<\/option><option>Don't like the Ad<\/option > <option>Wrong language<\/option><\/select > ",f="<input type='button' disabled class='reportButton' style='padding: 0px !important' value='Report'><\/input>";return t===728&&i===90?k(r,u,f):t===300&&i===250?d(r,u,f):t===160&&i===600?g(r,u,f):t===125&&i===125&&nt(r),(t===728&&i===90||t===300&&i===250||t===160&&i===600)&&tt(n,r),r},b=function(n){var i=document.createElement("input");return i.type="image",i.src=t.UndoCloseAdImageUrl,i.title="Show Ad",i.style.cssText="z-index:1000; position:relative; left:0px; top:0px; width:14px; height:14px;margin-top: 0px; margin-left: 0px; font-size:0px; display:block; padding: 0px; border: 0px",i.onclick=function(){return h(n),!1},i},k=function(n,i,r){n.innerHTML="<div class='sendReportContainer' style='padding-left: 2px; display:block; line-height:initial !important'><div style='display:inline-block; font:14px/18px \"Segoe UI\", Arial'><b>Don't like this Ad?<\/b><\/div><div class='dropzone' contenteditable='true' style='margin-left:10px; height:60px; width: 250px; background-color:lightgray; border-style:dotted; border-color:black; border-radius: 5px; border-width: 2px; text-align: center; display:inline-block; white-space:normal'>1. Hit the refresh icon to show the ad again and take a screenshot. 2. Drag and Drop or paste the screenshot here<\/div><div style='margin-left:10px; display:inline-block; font:14px/18px \"Segoe UI\", Arial;'> "+i+"&nbsp;"+r+"<\/div><\/div><div class='reportSentContainer' style='display:none; padding: 15px 20px; font:14px/18px \"Segoe UI\", Arial;'><span style='color:#999'>Thank you for the report!<\/span><\/div><a href='http://www.developermedia.com/' target='_blank'><img src='"+t.DmLogoImageUrl+"' style='max-width:100%;position:absolute; right:10px; top:10px;'><\/a>";n.style.cssText="display:none; width:728px; height:90px; z-index:100; text-align:left;border-style:solid; border-width:1px; position:relative; background-color:white;box-sizing:border-box; top:0px; left:0px"},d=function(n,i,r){n.innerHTML="<div class='sendReportContainer' style='padding: 5px 5px; display:block; line-height:initial !important'><div style='padding-bottom:5px; font:14px/18px \"Segoe UI\", Arial;'><b>Don't like this Ad?<\/b><\/div><div class='dropzone' contenteditable='true' style='height:100px; width: 290px; margin-top:20px; margin-bottom: 20px; background-color:lightgray; border-style:dotted; border-color:black; border-radius: 5px; border-width: 2px; text-align: center; box-sizing:border-box; white-space:normal'>1. Hit the refresh icon to show the ad again so you can take a screenshot <br/>2. Drag and Drop or paste the screenshot here<\/div><div style='margin-top:5px; font:14px/18px \"Segoe UI\", Arial; '> "+i+"<\/div><div style='margin-top:5px; display:block; font:14px/18px \"Segoe UI\", Arial;'>"+r+"<\/div><\/div><div class='reportSentContainer' style='display:none; padding: 15px 20px; font:14px/18px \"Segoe UI\", Arial; '><span style='color:#999;'>Thank you for the report!<\/span><\/div><a href='http://www.developermedia.com/' target='_blank'><img src='"+t.DmLogoImageUrl+"' style='max-width:100%;position:absolute; right:20px; bottom:10px;'><\/a>";n.style.cssText="display:none; width:300px; height:250px; z-index:100; text-align:left;border-style:solid; border-width:1px; position:relative; background-color:white;box-sizing:border-box; top:0px; left:0px"},g=function(n,i,r){n.innerHTML="<div class='sendReportContainer' style='padding: 20px 15px; display:block; line-height:initial !important'><div style='padding-bottom:20px; display:block; font:14px/18px \"Segoe UI\", Arial;'><b>Don't like this Ad?<\/b><\/div><div class='dropzone' contenteditable='true' style='height:180px; width: 130px; margin-top:20px; margin-bottom: 20px; background-color:lightgray; border-style:dotted; border-color:black; border-radius: 5px; border-width: 2px; text-align: center; box-sizing:border-box; white-space:normal'>1. Hit the refresh icon to show the ad again so you can take a screenshot <br/><br/>2. Drag and Drop or paste the screenshot here<\/div><div style='padding-bottom:10px; padding-top: 10px display:block; font:14px/18px \"Segoe UI\", Arial;'> "+i+"<\/div><div style='font:14px/18px \"Segoe UI\", Arial;'>"+r+"<\/div><\/div><div class='reportSentContainer' style='display:none; padding: 15px 20px; font:14px/18px \"Segoe UI\", Arial;'><span style='color:#999;'>Thank you for the report!<\/span><\/div><a href='http://www.developermedia.com/' target='_blank'><img src='"+t.DmLogoImageUrl+"' style='max-width:120px;position:absolute; right:20px; bottom:20px;'><\/a>";n.style.cssText="display:none; width:160px; height:600px; z-index:100; text-align:left;border-style:solid; border-width:1px; position:relative; background-color:white;box-sizing:border-box; top:0px; left:0px"},nt=function(n){n.innerHTML="<div class='reportSentContainer' style='padding: 5px 5px;font:14px/18px \"Segoe UI\", Arial; width: 100px; height: 100px'><span style='color:#999;'>Thank you for the report!<\/span><\/div>";n.style.cssText="display:none; width:125px; height:125px; z-index:100; text-align:left;border-style:solid; border-width:1px; position:relative; background-color:white;box-sizing:border-box; top:0px; left:0px"},tt=function(n,t){if(n&&n.adContainer){var i=t.getElementsByClassName("dropzone")[0];i.dropzoneFor=n.adContainer.id;n.dropzone=i;s&&(i.ondragenter=function(n){n.currentTarget.style.backgroundColor="yellow";n.currentTarget.innerHTML="<br/><br/>Drag and Drop the ad here"},i.ondragleave=function(n){n.currentTarget.style.backgroundColor="lightgray";u(n.currentTarget.dropzoneFor)},i.ondragover=function(n){n.stopPropagation();n.preventDefault();n.currentTarget.style.backgroundColor="yellow"},i.ondrop=function(n){n.currentTarget.style.backgroundColor="lightgreen";rt(n)});r?f?f.observe(i,{childList:!0}):i.addEventListener("DOMSubtreeModified",function(){a(i)}):i.addEventListener("paste",it,!1)}},h=function(n){n.reportAdDiv.style.display==="none"?(n.reportAdDiv.style.display="table",n.closeAdButton.style.display="none",n.adContainer.style.display="none",n.dropzone.focus()):(n.reportAdDiv.style.display="none",n.closeAdButton.style.display="block",n.adContainer.style.display="block")},e=function(n){var t=i(n),r=t.dropzone;r.style.backgroundColor="lightgreen";r.innerHTML=t.width===160&&t.height===600?"<br/> Your screenshot has been received – thanks! <br/><br/> Next step: What’s wrong with the ad":t.width===300&&t.height===250?"<br/> Your screenshot has been received – thanks! <br/><br/> Next step: What’s wrong with the ad":t.width===728&&t.height===90?"Your screenshot has been received – thanks! Next step: What’s wrong with the ad":"Ad info received. Press Report to submit"},o=function(n){var t=i(n);t&&(t.reportButton.disabled=!1)},u=function(n){var t=i(n);t&&(t.reportButton.disabled=!0)},c=function(n){h(n)},l=function(n){var r=n.reportAdDiv.getElementsByClassName("reportReason")[0],s=r&&r.options[r.selectedIndex].value||"Unspecified",u=n.reportAdDiv.getElementsByClassName("sendReportContainer")[0],f=n.reportAdDiv.getElementsByClassName("reportSentContainer")[0];u&&(u.style.display="none");f&&(f.style.display="block");try{var e=new XMLHttpRequest,i=new FormData,h=DMUserIdentityHelper&&DMUserIdentityHelper.getGlobalUserId()||0,o=null;n.fileList&&n.fileList.length>0&&(o=n.fileList[0]);e.open("POST",t.DownvoteUrl,!0);i.append("adScreenshot",o);i.append("reason",s);i.append("DmGlobalUserId",h);e.send(i)}catch(c){console.log(c)}},it=function(n){var t,h,l,s,c,a,f,v;if(!r){if(n.preventDefault(),t=[],h=!1,window.clipboardData)t=window.clipboardData.files,h=!0;else if((n.clipboardData||n.originalEvent.clipboardData)&&(l=n.clipboardData||n.originalEvent.clipboardData,s=l&&l.items||[],t=[],s&&s.length>0))for(h=!0,c=0;c<s.length;c++)a=s[c],a.kind==="file"&&(t[t.length]=a.getAsFile());f=n.currentTarget.dropzoneFor;t&&t.length>0?(v=i(f),v&&(v.fileList=t),o(f),e(f)):h?(n.currentTarget.innerHTML="<br/><br/> No files found on clipboard <br/>",u(f)):(n.currentTarget.innerHTML="<br/><br/> Paste not supported on your browser <br/>",u(f))}},rt=function(n){var f,r,t;if(n.stopPropagation(),n.preventDefault(),f=i(n.currentTarget.dropzoneFor),r=[],n.dataTransfer.files&&n.dataTransfer.files.length>0)for(t=0;t<n.dataTransfer.files.length;t++)n.dataTransfer.files[t].type&&n.dataTransfer.files[t].type.indexOf("image")>=0&&(r[r.length]=n.dataTransfer.files[t]);r.length>0?(f&&(f.fileList=r),e(n.currentTarget.dropzoneFor),o(n.currentTarget.dropzoneFor)):(n.currentTarget.style.backgroundColor="yellow",n.currentTarget.innerHTML="<br/><br/>The dropped item was not an image",u(n.currentTarget.dropzoneFor))},a=function(n){for(var t,i=0;i<n.children.length;i++)t=n.children[i],t.nodeName.toLowerCase()==="img"&&t.style.display!=="none"&&t.src&&(t.style.display="none",ut(t.src,n))},ut=function(n,t){if(n){var f=n.indexOf(","),r=n.substring(0,f),h=r.indexOf(":"),c=r.indexOf(";"),l=r.substring(h+1,c),a=n.substring(f+1),v=ot(a,l,512),u=t.dropzoneFor,s=i(u);s&&(s.fileList=[v]);e(u);o(u)}},ft=function(){var n=document.createElement("div");return"draggable"in n||"ondragstart"in n&&"ondrop"in n},et=function(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1},i=function(t){for(var i=0,r=n.length;i<r;i++)if(n[i]&&n[i].adContainer&&n[i].adContainer.id===t)return n[i];return null},ot=function(n,t,i){var e,o,r,f,s,u,h;for(t=t||"",i=i||512,e=atob(n),o=[],r=0;r<e.length;r+=i){for(f=e.slice(r,r+i),s=new Array(f.length),u=0;u<f.length;u++)s[u]=f.charCodeAt(u);h=new Uint8Array(s);o.push(h)}return new Blob(o,{type:t})};return{appendAd:function(t){n.push(t)},init:function(i,u){n=i;t=u;s=ft();r=et();r&&window.MutationObserver&&(f=new MutationObserver(function(n){n.forEach(function(n){a(n.target)})}))},showAdReportingInterface:function(n){var t=i(n);t&&y(t)},setGlobalUserId:function(n){v=n}}}(),DMUserIdentityHelper=function(){var r,t,u="dmaduid",f="dmaduid_confirm",e,o,i=[],n=0,l=function(){return SendDmAdUid?navigator.cookieEnabled!==void 0?navigator.cookieEnabled:(document.cookie="testcookie=test; max-age=10000",document.cookie.indexOf("testcookie=test")>=0):!1},a=function(){var t=document.location.hostname,n=/([^.]+\.[^.]{3,})$/i.exec(t);return n?n[1]:(n=/([^.]+\.[^.]+\.[^.]{2})$/i.exec(t),n!==null?n[1]:t)},s=function(n,t,i,r,u,f){var e="",o;e=n+"="+t;i>0&&(o=new Date,o.setTime(o.getTime()+i*864e5))&&(e+="; expires="+o.toGMTString());r&&(e+="; path="+r);u&&u.indexOf(".")!==-1&&(e+="; domain="+u);f&&(e+="; secure");document.cookie=e},h=function(n){var r=document.cookie,u=null,t,i;if(r!=="")for(t=r.split(";"),index=0;index<t.length;index++)if(i=t[index].replace(/^\s+/,""),i.substring(0,n.length+1)===n+"="){u=i.substring(n.length+1);break}return u},v=function(n){var t=document.createElement("IFRAME");return t.width=1,t.height=1,t.src=e,t.id="DMGlobalUserIdetifierIFRAME",t.name="DMGlobalUserIdetifierIFRAME",t.style.display="none",document.body.appendChild(t),t.onload=n,t},y=function(){var i,l,n,a,e;if(r)if(i=h(u),l=h(f),!l&&JSON){if(n={},n.sender=location.href,n.Id=Math.random(),a=function(){o.contentWindow.postMessage(JSON.stringify(n),GlobalIdUrl)},e=function(i){var r=null,e;try{r=JSON.parse(i.data)}catch(o){}r&&r.Id&&r.Id===n.Id&&(e=r.DmGlobalUserId,s(u,e,365,"/",t,!1),s(f,r.DmGlobalUserConfirmResponse,365,"/",t,!1),c(e))},window.addEventListener)window.addEventListener("message",e,!1);else try{window.attachEvent("message",e)}catch(y){}o=v(a)}else i&&c(i)},c=function(t){for(n=t;i.length>0;){var r=i.pop();typeof r=="function"&&r()}};return{init:function(n){e=n;r=l();t=a();y()},getGlobalUserId:function(t){return n!==0?n:t?(i.push(t),n):void 0}}}(),DMAds={PageQueryTerms:"",PageTags:null,Tile:1,CurrentDocument:null,PublisherCode:"",PublisherPageViewID:0,PublisherPageViewGuid:null,CreateAdsCalled:!1,GetTermsCalled:!1,Ads:[],GPTRenderingMode:"loading",PIIViolatingUrls:["http://www.aspsnippets.com/handlers/comments.ashx","codeproject.com/script/membership/sendpassword.aspx","http://www.dailyfreecode.com/userlogin.aspx","codeproject.com/script/membership/modify.aspx","dotnetspider.com/account/login.aspx","codeproject.com/script/membership/logon.aspx"],SetQueryTerms:function(){function u(n){for(var i,u="",t=0;t<r.length;t++)if(i=r[t],n.indexOf(i.d)>=0){u=i.q;break}return u}function f(n,t){var r=t.toLowerCase().indexOf(n),u,i;return r<0||r+n.length>=t.length?"":(u=t.indexOf("&",r),u<0&&(u=t.length),i=t.substring(r+n.length,u),i=i.replace(/\+/gi," "),i=decodeURIComponent(i),i.replace(/\"/gi,""))}function e(n){if(n===undefined)return"";var t=n.replace(/^\s+|\s+$/gi,"");return t?(t=t.replace(/\bAND\b|\bNOT\b|^NOT\b|\bOR\b|[^A-Z0-9\+\-\#\._\s]+|\b[A-Z0-9]+:/gi," "),t.replace(/\s+/g," ")):""}var r=[{d:"www.google.",q:"q="},{d:"www.bing.com",q:"q="},{d:"search.live.com",q:"q="},{d:"search.yahoo.com",q:"p="},{d:"codeproject.com",q:"q="},{d:"msdn.microsoft.com",q:"query="},{d:"www.ask.com",q:"q="},{d:"yandex.com",q:"text="},{d:"yandex.ru",q:"text="},{d:"www.baidu.com",q:"wd="},{d:"localhost",q:"q="},{d:"mkyong.com",q:"q="},{d:"codeplex.com",q:"query="},{d:"aspsnippets.com",q:"q="},{d:"trirand.com",q:"s="}],i="",n=document.URL,t=u(n);if(t!==""&&(i=e(f(t,n))),i===""){if(n=document.referrer.toLocaleLowerCase(),!n)return"";t=u(n);t!==""&&(i=e(f(t,n)))}DMAds.PageQueryTerms=i},SetPageTagsAndPixels:function(n){var t,i,r,u;if(JSON){if(DMAds.GetTermsCalled){n&&n();return}DMAds.GetTermsCalled=!0;t=document.URL;t.indexOf("?")>0&&(t=t.substring(0,t.indexOf("?")));try{i=top.document.title}catch(f){i="FAILED TO GET DOCUMENT TITLE"}r={terms:DMAds.PageQueryTerms,title:i,url:t,publisher:DMAds.PublisherCode,DmGlobalUserId:DMUserIdentityHelper&&DMUserIdentityHelper.getGlobalUserId()||0,numberOfAdsOnPage:DMAds.Ads.length};u=function(t){if(t){var i;try{i=JSON.parse(t)}catch(r){}i&&(i.SearchTerms&&(DMAds.PageTags=i.SearchTerms),i.PublisherPageViewGuid&&(DMAds.PublisherPageViewGuid=i.PublisherPageViewGuid),i.aid&&i.aid.length&&i.aid.length>0&&DMAds.InsertAudiencePixels(i.aid))}DMAds.PublisherPageViewGuid||(DMAds.PublisherPageViewGuid=1);n&&n()};DMAds.POSTJson(SearchTermUrl,r,u,!0,500)}},InsertAudiencePixels:function(n){var t,i;try{for(t=0,i=n.length;t<i;t++){var r=Math.random()+"",u=r*1e13,f=new Image;f.src="https://pubads.g.doubleclick.net/activity;dc_iu=/6839/DFPAudiencePixel;ord="+u+";dc_seg="+n[t]+"?"}}catch(e){}},GetRandom:function(n,t){for(var u,i="",r=0;r<n;r++)u=Math.floor(Math.random()*t).toString(t).toUpperCase(),i=i+u;return i},POSTJson:function(n,t,i,r,u){var f;if(JSON&&(f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP"),f)){var s=!1,o=function(n){s||(s=!0,i&&i(n))},e=null;r&&(e=setTimeout(function(){try{f.abort()}catch(n){}o(null)},u));f.onreadystatechange=function(){try{f.readyState===4&&(e&&clearTimeout(e),f.status===200?o(f.responseText):o(null))}catch(n){e&&clearTimeout(e);o(null)}};try{f.open("POST",n,!0);f.setRequestHeader("Content-Type","application/json");f.send(JSON.stringify(t))}catch(h){e&&clearTimeout(e);o(null)}}},SignalSuccess:function(n){window.top&&window.top.postMessage&&setTimeout(function(){window.top.postMessage(n?"DM-enabled":"DM-disabled","*")},1e3)},CreateAds:function(n){this.PageRandomNumber=DMAds.GetRandom(32,16);var e=function(n){var t=DMAds.Ads[n];t.rendered=!0;DMAds.GPTRenderingMode==="weLoadedGPT"?DMAds.BuildGPTTag(t):DMAds.BuildInlineGPTTag(t)},l=function(n){var e=DMAds.Ads[n],h=e.theAdDiv,u=!1,i=0,r=0,t,f,o,s;try{t=h.getBoundingClientRect();typeof innerWidth=="number"?(i=window.innerWidth,r=window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?(i=document.documentElement.clientWidth,r=document.documentElement.clientHeight):document.body&&(document.body.clientWidth||document.body.clientHeight)&&(i=document.body.clientWidth,r=document.body.clientHeight);f=-200;t.top===t.bottom&&(f+=e.height*-1);o=t.top>=0&&t.top-200<=r||t.top<=0&&t.top>=f;s=i>t.left&&t.right>=0;u=o&&s}catch(c){u=!0}return u},t=function(){for(var t,i=0,n=0;n<DMAds.Ads.length;n++)t=DMAds.Ads[n],!t.rendered&&l(n)&&u(n)&&e(n),t.rendered&&(i++,t.sticky&&!t.stickySettings&&(t.stickySettings=s(t)),c(n));i===DMAds.Ads.length&&clearInterval(f)},o=function(){var n=function(){for(var c,i,r,o,s=EnableViewOnScroll,n=0;n<DMAds.Ads.length;n++)c=DMAds.Ads[n],c.rendered=!1,i=c.displayOverride,i==="onscroll"||i==="true"?s=!0:(i==="always"||i==="false")&&(s=!1),!s&&u(n)&&e(n);if(t(),window.addEventListener)window.addEventListener("resize",function(){t();h()},!1),window.addEventListener("scroll",t,!1);else try{window.attachEvent("onresize",function(){t();h()});window.attachEvent("onscroll",t)}catch(l){}for(a(),r=!1,o=0;o<DMAds.Ads.length&&!r;o++)if(r=!u(o),r)break;r&&(f=setInterval(t,100))};DMAds.GPTRenderingMode==="loading"?googletag.cmd.push(function(){n()}):n()},a=function(){var n=null;typeof document.hidden!="undefined"?n="visibilitychange":typeof document.mozHidden!="undefined"?n="mozvisibilitychange":typeof document.msHidden!="undefined"?n="msvisibilitychange":typeof document.webkitHidden!="undefined"&&(n="webkitvisibilitychange");n&&document.addEventListener&&document.addEventListener(n,t,!1)},s=function(n){var u=null,i,t;return n.adContainer&&(i=r(n.adContainer),t={},t.isStickyRequired=n.sticky&&n.sticky==="top",t.absoluteTop=i.y,t.absoluteLeft=i.x,t.absoluteTop!==-1&&(t.originalPosition=n.theAdDiv.style.position,u=t)),u},h=function(){for(i=0;i<DMAds.Ads.length;i++){var n=DMAds.Ads[i];n.stickySettings&&n.adContainer&&(n.adContainer.style.position=n.stickySettings.originalPosition,n.stickySettings=s(n),c(i))}},c=function(n){var t=DMAds.Ads[n].adContainer,i=DMAds.Ads[n].stickySettings,f=DMAds.Ads[n].theAdDiv,u,h,s;if(i&&i.isStickyRequired&&t.getBoundingClientRect&&document.getElementsByClassName){u=document.getElementsByClassName("sticky-stop")[0];u&&(h=r(u),s=u.getBoundingClientRect());var c=r(t),e=t.getBoundingClientRect(),o,l=c.y+e.height+Math.abs(e.top)>h.y;u&&l&&s.top<e.height?o=s.top-e.height+"px":window.pageYOffset+10>=i.absoluteTop&&(o="10px");o?(t.style.position="fixed",t.style.top=o,t.style.left=i.absoluteLeft-window.pageXOffset+"px",f.clientHeight===0&&(f.style.height=t.clientHeight+"px"),f.clientWidth===0&&(f.style.width=t.clientWidth+"px")):t.style.position=i.originalPosition}},r=function(n){var t={};if(t.x=-1,t.y=-1,n.getBoundingClientRect){var r=n.getBoundingClientRect(),i=document.documentElement,u=window.pageYOffset||i.scrollTop||document.body.scrollTop||0,f=window.pageXOffset||i.scrollLeft||document.body.scrollLeft||0,e=i.clientTop||document.body.clientTop||0,o=i.clientLeft||document.body.clientLeft||0;t.y=r.top+u-e;t.x=r.left+f-o}return t},u=function(n){var t=DMAds.Ads[n].theAdDiv,i=!1,r;return t&&t.style.position!=="fixed"&&t.offsetParent?i=!0:t&&t.style.position==="fixed"&&(r=window.getComputedStyle(t),i=r&&r.display!=="none"),i&&v()},v=function(){var t=!0,n="";return typeof document.hidden!="undefined"?n="hidden":typeof document.mozHidden!="undefined"?n="mozHidden":typeof document.msHidden!="undefined"?n="msHidden":typeof document.webkitHidden!="undefined"&&(n="webkitHidden"),n!==null&&document[n]&&(t=!1),t},f=f||null;n||DMAds.CreateAdsCalled?n&&(DMAds.Ads[DMAds.Ads.length]=DMAds.GetDivRequestData(n,DMAds.Ads.length-1),DMAds.PublisherCode=DMAds.Ads[0].publisher,DMAds.SetPageTagsAndPixels(o)):(DMAds.CreateAdsCalled=!0,DMAds.SetAdRequestData(),DMAds.Ads.length>0&&(DMAds.PublisherCode=DMAds.Ads[0].publisher,DMAds.SetPageTagsAndPixels(o)))},ShowAd:function(n){var t=DMAds.Ads,i;if(n&&(DMAds.GPTRenderingMode!=="weLoadedGPT"||!DMAds.PublisherPageViewGuid))t.push(n),DMAds.GetTermsCalled||(DMAds.PublisherCode=n.sitename,DMAds.SetPageTagsAndPixels(DMAds.ShowAd));else if(DMAds.GPTRenderingMode==="weLoadedGPT"&&DMAds.PublisherPageViewGuid){while(t&&t.length>0)i=t.pop(),DMAds.RequestQueuedAd(i);n&&DMAds.RequestQueuedAd(n)}},InitGPTLibrary:function(){if(googletag){var n=function(){if(googletag.pubadsReady)DMAds.GPTRenderingMode!=="weLoadedGPT"&&(DMAds.GPTRenderingMode="gptAlreadyLoaded");else{if(googletag.pubads().enableSingleRequest(),googletag.pubads().disableInitialLoad(),DMAds.Ads&&DMAds.Ads[0]&&typeof DMAds.Ads[0].cookieConsent!="undefined"){var n=DMAds.Ads[0].cookieConsent?1:0;googletag.pubads().setRequestNonPersonalizedAds(n?0:1)}googletag.pubads().enableAsyncRendering();googletag.enableServices();DMAds.GPTRenderingMode="weLoadedGPT";googletag.pubads().addEventListener("slotRenderEnded",function(n){DMAds.OnSlotRendered(n)})}};googletag.apiReady?n():googletag.cmd.push(function(){n()})}},BuildIFrameTag:function(n){var t=document.createElement("IFRAME"),i;return t.allowtransparency=!1,t.id="dm-gpt-iframe-"+n.tile,t.width=n.width,t.height=n.height,t.marginWidth=0,t.marginHeight=0,t.frameBorder=0,t.scrolling="no",i=encodeURIComponent(location.href),i.length<2048&&(t.dc_ref=i),t},BuildInlineGPTTagScript:function(n){var t="div-gpt-ad-"+n.publisher+"-"+n.zone+"-"+n.tile,i="/6839/"+n.publisher+"/"+n.zone,r="["+n.width+", "+n.height+"]",u=(n.tags||"")+","+(DMAds.PageSearchTerms||"")+","+(DMAds.PageQueryTerms||""),f=n.cookieConsent!==undefined,e=n.cookieConsent?1:0,o="<div id='"+t+"'>     <script type='text/javascript'>         googletag.cmd.push(function() {             if ( "+f+" && typeof googletag.pubads == 'function') {               googletag.pubads().setRequestNonPersonalizedAds("+e+" ? 0 : 1);            }            googletag.defineSlot('"+i+"', "+r+",'"+t+"')                 .addService(googletag.pubads())                 .setTargeting('kw', '"+u+"');             googletag.enableServices();             googletag.display('"+t+"');         });     <\/script> <\/div>";return"<script type='text/javascript'> var googletag = googletag || {}; googletag.cmd = googletag.cmd || []; (function() {     var gads = document.createElement('script');     gads.async = true;     gads.type = 'text/javascript';     var useSSL = 'https:' == document.location.protocol;     gads.src = (useSSL ? 'https:' : 'http:') + '//www.googletagservices.com/tag/js/gpt.js';     var node =document.getElementsByTagName('script')[0];     node.parentNode.insertBefore(gads, node); })(); <\/script>"+o},BuildGPTTag:function(n){var t=document.createElement("DIV"),i;t.style.height=n.height+"px";t.style.width=n.width+"px";t.style.boxSizing="border-box";t.style.border="0px";t.style.fontSize="0px";i="div-gpt-ad-"+n.publisher+"/"+n.zone+"-"+n.tile;t.id=i;t.adIndex=n.index;n.theAdDiv.appendChild(t);n.adContainer=t;googletag.cmd.push(function(){var u="/6839/"+n.publisher+"/"+n.zone,r=(n.tags||"")+","+(DMAds.PageSearchTerms||"")+","+(DMAds.PageQueryTerms||""),t;r=DMAds.EscapeSpecialCharacters({tags:r});t=googletag.defineSlot(u,[n.width,n.height],i).setTargeting("kw",r);n.articleid&&n.articleid>0&&t.setTargeting("articleid",n.articleid);t.addService(googletag.pubads());n.collapse_empty&&t.setCollapseEmptyDiv(!0,!0);googletag.display(i);googletag.pubads().refresh([t],{changeCorrelator:!1})})},RequestQueuedAd:function(n){googletag.cmd.push(function(){var r="/6839/"+n.sitename+"/"+n.zonename,i=(n.tags||"")+","+(DMAds.PageSearchTerms||""),t;i=DMAds.EscapeSpecialCharacters({tags:i});t=googletag.defineSlot(r,[n.width,n.height],n.targetDivId).setTargeting("kw",i);n.articleid&&n.articleid>0&&t.setTargeting("articleid",n.articleid);t.addService(googletag.pubads());n.collapse_empty&&t.setCollapseEmptyDiv(!0,!0);googletag.display(n.targetDivId);googletag.pubads().refresh([t],{changeCorrelator:!1})})},BuildInlineGPTTag:function(n){var t=DMAds.BuildIFrameTag(n),i;n.theAdDiv.appendChild(t);i=t.contentDocument||t.contentWindow.document||t.contentWindow.window.document;i.write(DMAds.BuildInlineGPTTagScript(n))},EscapeSpecialCharacters:function(n){var t=n.tags,i;t=t.replace(/\+/gi,"{plus}");t=t.replace(/\#/gi,"{sharp}");t=t.replace(/\./gi,"{dot}");t=t.replace(/[\#\*\.\(\)\+\<\>\[\]]/gi,"");for(var r=t.split(","),u=[];r.length>0;)i=r.shift(),/[^\u0020-\u007f]/.test(i)||u.push(i);return u.join(",")},GetArticleId:function(n){var t=0,i,r;if(n&&n===CodeProjectPublisherId)try{i="Articles";r=window.location.href.indexOf(i);r>=0&&(t=window.location.href.substring(r+i.length+1),t=t.substring(0,t.indexOf("/")),t=parseInt(t),isNaN(t)&&(t=0))}catch(u){t=0}return t},IsPagePIICompliant:function(){var t=!0,i,n,r;try{for(i=window.location.href.toLowerCase(),n=0,r=DMAds.PIIViolatingUrls.length;n<r&&t;n++)t=!(i.indexOf(DMAds.PIIViolatingUrls[n])>=0)}catch(u){console.log("Error in IsPagePIICompliant: "+u)}return t},OnSlotRendered:function(n){if(window.location.href&&window.location.href.includes("show_creative_id=1")&&n&&n.creativeId&&console.log(n.creativeId),EnableMutableAds&&n&&!n.isEmpty&&(!n.lineItemId||n.lineItemId&&n.lineItemId===0))DMAdXHelper.showAdReportingInterface(n.slot.getSlotElementId());else if(n&&n.isEmpty){var t=document.getElementById(n.slot.getSlotElementId());t.style.width="0px";t.style.height="0px";t.style.display="none"}DMAds.SignalSuccess(!0)},DetermineTagSize:function(n){if(n.format){var t=n.format.split("x");t.length===2&&(n.width=parseInt(t[0]),n.height=parseInt(t[1]))}},GetElementsByAttr:function(n,t,i,r){var o=[],u,e;i||(i=document);r||(r="*");var f=i.getElementsByTagName(r),s=f.length,h=new RegExp("(^|\\s)"+t+"(\\s|$)");for(u=0,e=0;u<s;u++)h.test(f[u].getAttribute(n))&&(o[e]=f[u],e++);return o},GetElementsByClass:function(n,t,i){var e=[],r,f;t||(t=document);i||(i="*");var u=t.getElementsByTagName(i),o=u.length,s=new RegExp("(^|\\s)"+n+"(\\s|$)");for(r=0,f=0;r<o;r++)s.test(u[r].className)&&(e[f]=u[r],f++);return e},SetAdRequestData:function(){var n=DMAds.GetElementsByAttr("data-type","ad",document,"div"),t;for((n===null||n.length<=0)&&(n=DMAds.GetElementsByClass("lqm_ad",document,"div")),t=0;t<n.length;t++)DMAds.Ads[DMAds.Ads.length]=DMAds.GetDivRequestData(n[t],t)},GetDivRequestData:function(n,t){for(var u,f,r,o=n.attributes,s=o.length,i={},e=0;e<s;e++)u=o.item(e),u.nodeName.indexOf("lqm_")===0&&(f=u.nodeName.slice(4),i[f]=u.value||u.nodeValue),u.nodeName.indexOf("data-")===0&&(f=u.nodeName.slice(5),i[f]=u.value||u.nodeValue);return r={height:0,width:0,publisher:i.publisher,zone:i.zone||"ros",site:i.site,tags:i.tags,sitename:undefined,zonename:undefined,target:"_blank",format:i.format,index:t,tile:t+1,type:i.type,noadx:i.noadx,collapse_empty:i.collapse_empty,displayOverride:i.display||i.loadOnView,sticky:i.sticky,charity:i.charity,cookieConsent:i.cookieconsent,theAdDiv:n},r.tags&&(r.tags=decodeURIComponent(r.tags)),DMAds.DetermineTagSize(r),r.publisher&&r.publisher===CodeProjectPublisherId&&(r.articleid=DMAds.GetArticleId(r.publisher)),r},SetupAds:function(){DMAds.IsPagePIICompliant()&&(DMAds.InitGPTLibrary(),DMAds.SetQueryTerms(),DMAdXHelper.init(DMAds.Ads,{DownvoteUrl:DownvoteUrl,UndoDownvoteUrl:UndoDownvoteUrl,ReportAdUrl:ReportAdUrl,CloseAdImageUrl:CloseAdImageUrl,UndoCloseAdImageUrl:UndoCloseAdImageUrl,DmLogoImageUrl:DmLogoImageUrl}),DMUserIdentityHelper.init(GlobalIdUrl),DMAds.CreateAds())},Initialise:function(){if(DMAds.IsPagePIICompliant())if(window.googletag)DMAds.SetupAds();else{var t="https:"===document.location.protocol,n=document.createElement("script");n.async=!0;n.type="text/javascript";n.src=(t?"https:":"http:")+"//www.googletagservices.com/tag/js/gpt.js";n.onload=this.SetupAds;document.body.appendChild(n)}}};window.DMAds=DMAds}if(DMAds.IsPagePIICompliant())if(window.addEventListener)window.addEventListener("load",function(){DMAds.Initialise()},!1);else try{window.attachEvent("onload",function(){DMAds.Initialise()})}catch(e){DMAds.Initialise()}</script><script async="" type="text/javascript" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/gpt.js"></script><script async="" type="text/javascript" src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/gpt.js"></script><div style="position: fixed; z-index: 9999; height: 289px;" id="credential_picker_container"><iframe src="COM%20in%20plain%20C,%20Part%202%20-%20CodeProject_files/select.html" title="Sign in with Google Dialog" style="height: 289px; width: 391px; overflow: hidden;"></iframe></div><canvas id="cv1" width="1px" height="1px" style="position:absolute;left:0;top:0;pointer-events:none"></canvas><canvas id="cv2" width="1px" height="1px" style="position:absolute;left:0;top:0;pointer-events:none"></canvas><div id="MemberProfilePopupDiv" class="raised box" style="display: none; position: absolute;"></div><div id="MemberProfilePopupDiv" class="raised box" style="display: none; position: absolute;"></div><div id="MemberProfilePopupDiv" class="raised box" style="display: none; position: absolute;"></div></body></html>