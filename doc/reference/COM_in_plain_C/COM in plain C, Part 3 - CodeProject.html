<!DOCTYPE html>
<html lang="en" class=" jcqvht idc0_348"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">

	

	
	<link rel="preconnect" href="https://apps.developermedia.com/">
	<link rel="preconnect" href="https://cdn1.developermedia.com/">
	<link rel="preconnect" href="https://cdn.ampproject.org/">
	<link rel="preconnect" href="https://fonts.googleapis.com/">
	<link rel="preconnect" href="https://ajax.googleapis.com/">
	<link rel="preconnect" href="https://adservice.google.com/">
	<link rel="preconnect" href="https://www.googletagservices.com/">
	<link rel="preconnect" href="https://www.googletagmanager.com/">
	<link rel="preconnect" href="https://www.google.com/">
	<link rel="preconnect" href="https://www.google-analytics.com/">
	<link rel="preconnect" href="https://pagead2.googlesyndication.com/">

	<link rel="preconnect" href="https://codeproject.freetls.fastly.net/">


	<link rel="preload" href="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/logo250x135.gif" as="image">


	<link rel="preload" href="https://www.codeproject.com/App_Themes/CodeProject/Img/logo135-bg.gif" as="image">
	<link rel="preload" href="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/jquery-3.4.1.min.js" as="script" type="text/javascript">


	<title>COM in plain C, Part 3 - CodeProject</title> 
    
	<!-- inlined file /App_Themes/CodeProject/Css/article.critical.min.css. Minimized in Release. -->
<style type="text/css">
.blank-background{background-color:#fff}html,div,span,applet,object,iframe,a,abbr,acronym,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,fieldset,form,label,table,tbody,tfoot,thead,tr,th,td,li,ol,ul{margin:0;padding:0;border:0}html{font-size:16px;-webkit-font-smoothing:antialiased;font-smooth:always}body,p,h1,h2,h3,h4,h5,h6,li,tr,td,th,dd,dt{font-family:"Segoe UI",Arial,Sans-Serif;font-size:16px;line-height:1.4;color:#111}body{margin:0}h1,h3,h4,h5,th{font-weight:bold}h1{color:#333;padding:0;margin:0 0 7px;text-align:left}h2{margin:20px 0 11px;padding:0;padding-bottom:10px;color:#333}h1{font-size:38px;font-weight:400}h2{font-size:29px;font-weight:400}h4{font-size:17px}table{background-color:Transparent}img{-ms-interpolation-mode:bicubic}a{text-decoration:none;color:#005782}a:visited{color:#800080}a:hover{text-decoration:underline}a:not([href]){color:inherit;text-decoration:none}input[type="text"],input[type="url"],input[type="search"],input[type="email"],input[type="number"],input[type="password"],select,textarea{border:1px solid #d7d7d7;font-size:16px;padding:5px}a.button,a.button-large,.button,.button-large{color:#fff;background-color:#e08900;border:1px solid #ccc;text-decoration:none;white-space:nowrap;font-size:100%;padding:4px;cursor:pointer;border-radius:3px;-webkit-border-radius:3px;-moz-border-radius:3px}table.small-text td,ul.small-text li,ol.small-text li,.small-text{font-size:14px}.invisible{display:none}.subdue,.subdue li,tr.subdue td{color:#808080}.align-left{text-align:left}.align-right{text-align:right}.align-center{text-align:center}.float-right{float:right}.float-left{float:left}.sticky{position:sticky;top:0}.extended{width:100%;box-sizing:border-box}.padded-top{padding-top:20px}.tight{margin:0;padding:0}.nowrap{white-space:nowrap}.fixed-layout{table-layout:fixed}.clipped{overflow:hidden}.raised{background-color:#fff8df;border:1px solid #ccc;-moz-box-shadow:4px 4px 16px 1px rgba(0,0,0,.25);-webkit-box-shadow:4px 4px 16px 1px rgba(0,0,0,.25);box-shadow:4px 4px 16px 1px rgba(0,0,0,.25)}ol,ul{padding-left:40px;margin:10px 0}ol.compact li,ul.compact li,ol li.compact,ul li.compact{font-size:14px}.callout{margin:20px 0;background-color:#ffffe1;color:#333;border:1px solid #ccc;padding:15px;border-radius:3px;-webkit-border-radius:3px;-moz-border-radius:3px}.trace{padding:20px;background-color:#eee;color:#333;border:1px solid #f00;font-size:13px}textarea,input[type="text"],input[type="button"],input[type="submit"]{-webkit-appearance:none;border-radius:0}.container-content{background-color:#fff;position:relative;zoom:1;padding:0 9px;cursor:default}.container-content-wrap{margin:auto;max-width:1270px}.flex-container{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex}.flex-extend{justify-content:space-between}.flex-wrap{flex-wrap:wrap}.flex-item{-webkit-box-flex:1;-moz-box-flex:1;-webkit-flex:1;-ms-flex:1;flex:1}.flex-item-tight{flex:0 1 auto}.hover-container{display:block;position:relative}.clearfix:after,.container:after{display:block;content:'.';visibility:hidden;height:0;clear:both}.clearfix,.container{display:inline-block;display:block}.access-link,.access-link img{position:absolute;top:0;left:0;width:1px;height:1px;z-index:101;border-style:none;margin-top:-1px;overflow:hidden}.site-top-menu{white-space:nowrap;position:absolute;z-index:101;width:100%}.site-top-menu .main-content{width:100%}.site-top-menu .main-content .memberbar{margin-left:90px;margin-right:10px}.site-top-menu.fixed .main-content{margin:auto;max-width:1270px}.site-header{background-image:url('/App_Themes/CodeProject/Img/logo135-bg.gif');white-space:nowrap;overflow:hidden}.site-header .main-content{position:relative;overflow:hidden;white-space:nowrap}.site-header .logo{display:inline-block}.site-header .promo{display:inline-block;position:absolute;top:33px;right:0}.site-header.fixed .main-content{margin:auto;max-width:1270px}.sub-headerbar{padding-right:9px;position:relative;margin:auto;max-width:1270px}.sub-headerbar-divider{margin-left:10px;height:1px;border-bottom:1px solid #ccc;position:absolute;bottom:2px;left:0;right:9px}.memberbar{height:25px;padding-top:10px;color:#999;font-size:14px}.memberbar a{color:#808080;font-size:14px}div.navbar{white-space:nowrap}.navmenu{background:#fff;color:#4d4d4d;padding:0;margin:0;list-style:none;height:25px}.navmenu ul,.navmenu li{margin:0;padding:0}.navmenu .has-submenu{position:absolute;right:5px;padding-left:10px}.navmenu>li:hover>a,.navmenu>li>a:active{border:1px solid #ccc}.navmenu ul,.navmenu>li.open:hover>a,.navmenu>li.open>a:active{border:1px solid #ccc;border-bottom-color:#fff}.navmenu>li{margin:0 11px 2px 2px}.navmenu>li:active,.navmenu>li:active>a,.navmenu>li:hover,.navmenu>li>a:active{background:#fff;color:#4d4d4d}.navmenu>li>a{padding:2px 7px 6px 7px;border:1px solid transparent;font-weight:bold}.navmenu a{display:block;float:left;color:#666;background:#fff;font-size:17px;padding:0 9px;text-decoration:none;white-space:nowrap}.navmenu a.fly{white-space:nowrap}.navmenu ul{background:#fff;position:absolute;left:-9999px;top:-9999px;list-style:none}.navmenu li{float:left;color:#4d4d4d}.navmenu li.last{height:9px}.navmenu li a:active,.navmenu li a:hover{color:#fff;background-color:#f90}.navmenu li>a:active,.navmenu li:hover,.navmenu li:hover>a,.navmenu li:hover.heading,.navmenu li a.selected{position:relative;color:#fff;background-color:#f90}.navmenu li.openable:hover ul{left:0;top:30px;z-index:500}.navmenu li.openable:hover>ul ul{position:absolute;left:-9999px;top:-9999px;width:auto}.navmenu li.open{position:relative}.navmenu li.open a{color:#fff;background-color:#f90}.navmenu li.open ul{left:0;top:30px;z-index:500}.navmenu li ul{border-bottom:5px solid #f90}.navmenu li li{float:none}.navmenu li li:active>a.fly,.navmenu li li:hover>a.fly{color:#fff;background-color:#f90}.navmenu li li a{float:none;font-size:16px;font-weight:normal}.navmenu li li a.fly{color:#4d4d4d;background-color:#fff;padding:2px 20px}.navmenu li li a.break{margin-bottom:15px}.navmenu li li a.highlight1,.navmenu li li a.highlight1:active,.navmenu li li a.highlight1:hover{background-color:#090}.navmenu li li a.highlight2,.navmenu li li a.highlight2:active,.navmenu li li a.highlight2:hover{background-color:#f90}.navmenu li li a.highlight3,.navmenu li li a.highlight3:active,.navmenu li li a.highlight3:hover{background-color:#000}.navmenu li li a.highlight1,.navmenu li li a.highlight2,.navmenu li li a.highlight3{color:#fff;font-size:16px;margin:5px 0;padding:9px 20px}.site-footer{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;padding-top:5px;width:100%;font-size:13px;color:#999}.site-footer .align-left,.site-footer .align-center,.site-footer .align-right{-webkit-box-flex:1;-moz-box-flex:1;-webkit-flex:1;-ms-flex:1;flex:1}.site-footer .align-left{flex:1 0 100px}.site-footer .align-center{flex:0 1 0%;white-space:nowrap}.site-footer .align-right{flex:1 0 100px}.site-footer .page-width .active{border-bottom:2px solid #f90}.searchbar{padding:0}.searchbar .search{margin-bottom:4px;padding:2px 5px 0;border:1px solid #ccc}.searchbar .search.subdue{color:#ccc}.searchbar input.search{width:190px;border:none;font-size:13px;padding:4px 2px}.searchbar .search-advanced{padding:8px;width:203px;z-index:1000;background-color:#fff;border:solid 1px #ccc;position:absolute;top:-4px;right:0}.searchbar .popup{display:none}.search td{background-color:#fff}.article-container-parts{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex}.article-container{-webkit-box-flex:1;-moz-box-flex:1;-webkit-flex:1;-ms-flex:1;flex:1;background-color:#fff;color:#111;zoom:1;position:relative;max-width:100%;min-height:675px}.article-container .article{margin:0 20px 0 10px;line-height:143%}.article-container span.stats{margin-left:30px}.article-left-sidebar{width:120px;min-width:120px;min-height:400px;font-size:14px;border-right:1px solid #f2f2f2;padding:0}.article-left-sidebar .article-left-sidebar-inner{width:120px;min-width:120px}.article-left-sidebar .tabs>div{padding:5px 0 5px 10px}.article-left-sidebar .selected{font-weight:bold;background:transparent url("/images/right-selected.gif") no-repeat scroll right 9px}.article-left-sidebar .original{color:#808080;margin:-10px 0 0 15px}.article-left-sidebar h4{color:#f90;font-size:14px;font-weight:bold}.article-left-sidebar .stats div div div{padding:0 0 10px 10px;color:#666}.article-right-sidebar{width:300px;margin-left:10px;font-size:14px}.article-right-sidebar .gototop{text-align:center;padding:10px 0;opacity:0;-webkit-transition:opacity .3s linear 0ms;-moz-transition:opacity .3s linear 0ms;-o-transition:opacity .3s linear 0ms;transition:opacity .3s linear 0ms}.container-content .edit-links{margin:21px 0 0 10px}.article-summary{padding:0 10px 0 10px;overflow:hidden}.article h1{margin:0 0 15px 0}.article h2{color:#f90}.article .header .title{color:#808080}.article .header .author{font-weight:bold;min-width:100px}.article .header .author a{color:#808080}.article .header .avatar{max-width:48px;max-height:48px;overflow:unset}.article .header .avatar-wrap{width:48px;height:48px;margin-right:10px;text-align:center}.article .header .date{white-space:nowrap}.article .header .license{margin-left:15px}.article .header .stats{margin-left:30px}.article .summary{color:#808080;padding:40px 0 15px 0}.article .text{padding-top:10px}.article-nav{text-align:right;margin-top:21px;vertical-align:middle;line-height:15px}span.math{display:inline-block}.msg-728x90{width:728px;height:90px;overflow:hidden}.msg-300x250{width:300px;height:250px;overflow:hidden}.tags{line-height:190%}.tags .t{background:none repeat scroll 0 0 transparent;border:1px solid #fbedbb;border-radius:12px 0 0 12px;line-height:1.4;padding:0 2px 2px 3px;position:relative;text-decoration:none;margin:2px 5px 4px 0;white-space:nowrap}.tags .t a{color:#666;display:inline-block;margin-right:3px;padding-left:5px;text-overflow:ellipsis}.container-breadcrumb{font-size:14px;margin-top:7px;color:#808080;margin:12px 0 35px}.container-breadcrumb a{color:#808080}.speech-bubble-container-down,.speech-bubble-container-up,.speech-bubble-container-up-right,.speech-bubble-container-left,.speech-bubble-container-right{position:relative}.ie .speech-bubble-container-up,.firefox .speech-bubble-container-up,.chrome .speech-bubble-container-up,.ie .speech-bubble-container-up-right,.firefox .speech-bubble-container-up-right,.chrome .speech-bubble-container-up-right{margin-top:-4px}.tooltip{position:relative;text-decoration:none}.tooltip .speech-bubble-container-up,.tooltip .speech-bubble-container-down,.tooltip .speech-bubble-container-left,.tooltip .speech-bubble-container-right,.tooltip .speech-bubble-container-up-right,.tooltip .tooltip-flyout{display:none;opacity:0;-webkit-transition:opacity .5s linear 0ms;-moz-transition:opacity .5s linear 0ms;-o-transition:opacity .5s linear 0ms;transition:opacity .5s linear 0ms}.micromodal{display:none}.bottom-promo{height:90px;margin-top:10px;overflow:hidden}.bottom-promo .msg-728x90{width:728px;margin:0 auto}.msg-728x90{overflow:hidden;position:relative;height:90px;min-width:728px}body .msg-728x90{*float:right}body .bottom-promo .msg-728x90{*float:none}table.forum{table-layout:fixed;margin:0 0 20px 0;padding:0;width:100%}.forum table{border-collapse:separate}.forum .header1,.forum .header1 TD{color:#333;font-size:14px;vertical-align:middle}.forum .header2,.forum .header2 TD{color:#fff;background-color:#f90;font-size:14px;vertical-align:middle}.forum .header2 input,.forum .header2 TD input,.forum .header2 select,.forum .header2 TD select{padding:2px}.forum .button{border:1px solid #fc6;margin:1px}.forum .searchbar{border:1px solid #ccc;padding:4px 0 0 0;margin:3px 0}.forum .searchbar .search{width:200px}.forum .searchbar input[type=image]{vertical-align:middle}.forum .dropdown{background-color:#fffdfa;font-size:95%;margin-left:5px}.forum .footer,.forum .footer td,.forum .navbar,.forum .navbar td{font-size:14px;padding:8px 0;border:0;border-top:1px solid #808080}.author-wrapper{position:relative}.author-wrapper .profile-pic{border:1px solid #333;margin:0 13px 0 0;padding:10px;-moz-box-shadow:3px 3px 5px 1px rgba(0,0,0,.2);-webkit-box-shadow:3px 3px 5px 1px rgba(0,0,0,.2);box-shadow:3px 3px 5px 1px rgba(0,0,0,.2);max-height:100px}.author-wrapper .container-member .author{font-size:29px;color:#333;font-weight:600}.rating-container .rating-prompt{padding-right:5px;white-space:nowrap;line-height:25px;margin-right:2px;font-weight:bold;color:#808080}.rating-container .rating-votes{margin-left:5px}.rating-container.large-stars,.rating-container.medium-stars,.rating-container.small-stars{margin-left:7px}.rating-container.large-stars .rating-votes,.rating-container.large-stars .rating-prompt,.rating-container.large-stars .rating-poor,.rating-container.large-stars .rating-good{line-height:25px}@media(min-width:1024px){.desktop-lg-block-only{display:none}.desktop-only{display:inherit}.desktop-block-only{display:block}.tablet-only,.tablet-block-only{display:none}.mobile-only,.mobile-block-only{display:none}.desktop-only.tablet-only{display:inherit}.desktop-block-only.tablet-block-only{display:block}}@media(min-width:821px){.desktop-lg-block-only{display:none}.tablet-only,.mobile-only{display:none}.tablet-block-only,.mobile-block-only{display:none}.tablet-only.desktop-only{display:inherit}.tablet-block-only.desktop-block-only{display:block}}.rrssb-buttons,.rrssb-buttons li,.rrssb-buttons li a{-moz-box-sizing:border-box;box-sizing:border-box}.clearfix{*zoom:1}.clearfix:after{clear:both}.clearfix:before,.clearfix:after{content:" ";display:table}.rrssb-buttons{font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;height:40px;margin:0;padding:0;width:100%}.rrssb-buttons li{float:left;height:100%;list-style:none;margin:0;padding:0 2.5px;line-height:13px}.rrssb-buttons li.email a{background-color:#0a88ff}.rrssb-buttons li.facebook a{background-color:#306199}.rrssb-buttons li.linkedin a{background-color:#007bb6}.rrssb-buttons li.twitter a{background-color:#26c4f1}.rrssb-buttons li.reddit a{background-color:#8bbbe3}.rrssb-buttons li.pinterest a{background-color:#b81621}.rrssb-buttons li.compact{padding:0 4.5px}.rrssb-buttons li.compact a{border-radius:50%;padding:0 7px 0 32px}.rrssb-buttons li.compact a .icon{left:7px;top:-3px;width:5%;transform:scale(.85)}.rrssb-buttons li.compact a .icon svg{height:auto;width:auto}.rrssb-buttons li a{background-color:#ccc;border-radius:3px;display:block;font-size:11px;font-weight:bold;height:100%;padding:11px 7px 12px 27px;position:relative;text-align:center;text-decoration:none;text-transform:uppercase;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;width:100%;-webkit-transition:background-color .2s ease-in-out;-moz-transition:background-color .2s ease-in-out;-o-transition:background-color .2s ease-in-out;transition:background-color .2s ease-in-out}.rrssb-buttons li a .icon{display:block;height:100%;left:10px;padding-top:9px;position:absolute;top:0;width:10%}.rrssb-buttons li a .icon svg{height:17px;width:17px}.rrssb-buttons li a .icon svg path,.rrssb-buttons li a .icon svg polygon{fill:#fff}
</style>
<link rel="stylesheet" type="text/css" href="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/Main.min.css" media="all" onload="if(media!='all')media='all'">
<noscript><link rel="stylesheet" type="text/css" href="https://codeproject.freetls.fastly.net/App_Themes/CodeProject/Css/Main.min.css?dt=2.8:2023-08-14:1"></noscript>


    <script type="text/javascript" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/jquery-3.4.1.min.js" defer="defer"></script>
<script type="text/javascript" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/article.min.js" defer="defer"></script>
<script type="text/javascript" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/client" defer="defer" async=""></script>
<script type="text/javascript" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/MemberProfilePopup.min.js" defer="defer"></script>
<script type="text/javascript" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/a.min.js" defer="defer"></script>

	
<meta http-equiv="content-language" content="en-US">
<meta charset="UTF-8">
<meta name="Description" content="COM collections in C">
<meta name="Keywords" content="C++, C, VBScript, Windows, Visual-Studio, Dev, COM, Beginner">
<meta name="Author" content="Jeff Glatt">
<meta name="Rating" content="General">
<meta name="Revisit-After" content="1 days">
<meta name="application-name" content="CodeProject">
<meta name="google-translate-customization" content="d908bb7ce7aff658-4c2f3a504525c916-g629383f736781a8a-13">

<link rel="dns-prefetch" href="https://ajax.googleapis.com/"> 
<link rel="canonical" href="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/COM-in-plain-C-Part-3.html">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@CodeProject">
<meta name="og:site_name" content="CodeProject">
<meta name="twitter:creator" content="@CodeProject">
<meta property="og:type" content="article">
<meta property="article:published_time" content="5/7/2006 8:39:00 PM">
<meta property="article:modified_time" content="5/7/2006 8:39:00 PM">
<meta name="twitter:label1" content="Written by">
<meta name="twitter:data1" content="Jeff Glatt">
<meta name="twitter:label2" content="Reading time">
<meta name="twitter:data2" content="30 min read">
<meta property="og:url" content="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3">
<meta property="og:title" content="COM in plain C, Part 3">
<meta property="og:description" content="COM collections in C">

<link rel="alternate" type="application/rss+xml" title="CodeProject Latest articles - All Topics" href="https://www.codeproject.com/WebServices/ArticleRSS.aspx?cat=1">
<link rel="alternate" type="application/rss+xml" title="CodeProject Latest articles - Python" href="https://www.codeproject.com/WebServices/ArticleRSS.aspx?cat=34">
<link rel="alternate" type="application/rss+xml" title="CodeProject Lounge Postings" href="https://www.codeproject.com/webservices/LoungeRSS.aspx">
<meta name="robots" content="index, follow">

<link rel="search" type="application/opensearchdescription+xml" title="CodeProject" href="https://www.codeproject.com/info/OpenSearch.xml">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="apple-touch-icon" sizes="144x144" href="https://www.codeproject.com/favicon/apple-touch-icon.png"> 
<link rel="icon" type="image/png" sizes="32x32" href="https://www.codeproject.com/favicon/favicon-32x32.png"> 
<link rel="icon" type="image/png" sizes="16x16" href="https://www.codeproject.com/favicon/favicon-16x16.png"> 
<link rel="manifest" href="https://www.codeproject.com/favicon/manifest.json"> 
<link rel="mask-icon" href="https://www.codeproject.com/favicon/safari-pinned-tab.svg" color="#ff9900">
	<script type="application/ld+json">{
  "@context": "http://schema.org",
  "@type": "TechArticle",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3"
   },
  "name": "COM in plain C, Part 3",
  "headline": "COM in plain C, Part 3",
  "url": "https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3",
  "discussionUrl": "https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3#_comments",
  "isFamilyFriendly": "true",
  "image": "https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/Article100.png",
  "keywords": "C++,C,VBScript,Windows,Visual-Studio,Dev,COM,Beginner",
  "commentCount": "15",
  "editor" : {
    "@type" : "Person",
    "name" : "Smitha Nishant",
    "url" : "https://www.codeproject.com/script/Membership/View.aspx?mid=28970"
  },
  "license": "http://www.codeproject.com/info/cpol10.aspx",
  "publisher" : {
    "@type" : "Organization",
    "name" : "CodeProject"
  },
  "description": "COM collections in C",
  "articleSection": "VBScript",
  "author" : [{
      "@type" : "Person",
      "name" : "Jeff Glatt",
      "url" : "https://www.codeproject.com/script/Membership/View.aspx?mid=88625"
    }],
  "datePublished": "2006-05-07",
  "dateCreated": "2006-05-07",
  "dateModified": "2006-05-07"
,
  "contentRating" : {
    "@type" : "Rating",
    "ratingValue" : 4.90,
    "bestRating" : 5,
    "worstRating" : 1
  }
}</script>

<script type="application/ld+json">{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
    "@type": "ListItem",
    "position": 1,
    "item" : {
      "@id" : "/script/Content/Tag.aspx?tags=Languages",
      "name" : "Programming Languages"
    }
  },{
    "@type": "ListItem",
    "position": 2,
    "item" : {
      "@id" : "/script/Content/Tag.aspx?tags=VBScript",
      "name" : "VBScript"
    }
  }]
}</script>


	<!-- base href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3" -->
	
    


<script type="text/javascript">
function defrm () { /* thanks twitter */
    document.write = '';
    window.top.location = window.self.location;
    setTimeout(function() { document.body.innerHTML = ''; }, 0);
    window.self.onload = function(evt) { document.body.innerHTML = ''; };
}

if (window.top !== window.self) {
    try {
        if (window.top.location.host) { /* will throw for all except chrome */ }
        else { defrm(); /* chrome */ }
    } catch (ex) { defrm(); /* everyone else */ }
}

// Specific case where a site is screwing with us.
if (typeof(DemoUrl) !== 'undefined') {
    document.write(unescape('%3Cme') + 'ta http' + '-equiv="re' + 'fresh con' +
                           'tent="1;url=' + DemoUrl + unescape('"%3CE'));
}
</script>
	





    <script async="" type="text/javascript" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/js"></script>
    <script type="text/javascript">
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-YZNPNQ0F2S' , {'user_id': '9bd02f62-656b-43b1-a8e3-74fba4e7f215'});
    </script>

<style id="googleidentityservice_button_styles">.qJTHM{-moz-user-select:none;color:#202124;direction:ltr;font-family:"Roboto-Regular",arial,sans-serif;font-weight:400;margin:0;overflow:hidden}.ynRLnc{left:-9999px;position:absolute;top:-9999px}.L6cTce{display:none}.bltWBb{word-break:break-all}.hSRGPd{color:#1a73e8;cursor:pointer;font-weight:500;text-decoration:none}.Bz112c-W3lGp{height:16px;width:16px}.Bz112c-E3DyYd{height:20px;width:20px}.Bz112c-r9oPif{height:24px;width:24px}.Bz112c-uaxL4e{-moz-border-radius:10px;border-radius:10px}.LgbsSe-Bz112c{display:block}.S9gUrf-YoZ4jf,.S9gUrf-YoZ4jf *{border:none;margin:0;padding:0}.fFW7wc-ibnC6b>.aZ2wEe>div{border-color:#4285f4}.P1ekSe-ZMv3u>div:nth-child(1){background-color:#1a73e8!important}.P1ekSe-ZMv3u>div:nth-child(2),.P1ekSe-ZMv3u>div:nth-child(3){background-image:linear-gradient(to right,rgba(255,255,255,.7),rgba(255,255,255,.7)),linear-gradient(to right,#1a73e8,#1a73e8)!important}.haAclf{display:inline-block}.nsm7Bb-HzV7m-LgbsSe{border-radius:4px;box-sizing:border-box;transition:background-color .218s,border-color .218s;-moz-user-select:none;background-color:#fff;background-image:none;border:1px solid #dadce0;color:#3c4043;cursor:pointer;font-family:"Google Sans",arial,sans-serif;font-size:14px;height:40px;letter-spacing:0.25px;outline:none;overflow:hidden;padding:0 12px;position:relative;text-align:center;vertical-align:middle;white-space:nowrap;width:auto}@media screen and (-ms-high-contrast:active){.nsm7Bb-HzV7m-LgbsSe{border:2px solid windowText;color:windowText}}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe{font-size:14px;height:32px;letter-spacing:0.25px;padding:0 10px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe{font-size:11px;height:20px;letter-spacing:0.3px;padding:0 8px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe{padding:0;width:40px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.pSzOP-SxQuSe{width:32px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.purZT-SxQuSe{width:20px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK{border-radius:20px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK.pSzOP-SxQuSe{border-radius:16px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK.purZT-SxQuSe{border-radius:10px}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc{border:none;color:#fff}.nsm7Bb-HzV7m-LgbsSe.MFS4be-v3pZbf-Ia7Qfc{background-color:#1a73e8}.nsm7Bb-HzV7m-LgbsSe.MFS4be-JaPV2b-Ia7Qfc{background-color:#202124;color:#e8eaed}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:18px;margin-right:8px;min-width:18px;width:18px}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:14px;min-width:14px;width:14px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:10px;min-width:10px;width:10px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin-left:8px;margin-right:-4px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin:0;padding:10px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{padding:8px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{padding:4px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-top-left-radius:3px;border-bottom-left-radius:3px;display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;justify-content:center;align-items:center;background-color:#fff;height:36px;margin-left:-10px;margin-right:12px;min-width:36px;width:36px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf .nsm7Bb-HzV7m-LgbsSe-Bz112c,.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin:0;padding:0}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{height:28px;margin-left:-8px;margin-right:10px;min-width:28px;width:28px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{height:16px;margin-left:-6px;margin-right:8px;min-width:16px;width:16px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:3px;margin-left:2px;margin-right:0;padding:0}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:18px}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:14px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:8px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-bN97Pc-sM5MNb{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;align-items:center;flex-direction:row;justify-content:space-between;flex-wrap:nowrap;height:100%;position:relative;width:100%}.nsm7Bb-HzV7m-LgbsSe .oXtfBe-l4eHX{justify-content:center}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-BPrWId{flex-grow:1;font-family:"Google Sans",arial,sans-serif;font-weight:500;overflow:hidden;text-overflow:ellipsis;vertical-align:top}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-BPrWId{font-weight:300}.nsm7Bb-HzV7m-LgbsSe .oXtfBe-l4eHX .nsm7Bb-HzV7m-LgbsSe-BPrWId{flex-grow:0}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-MJoBVe{transition:background-color .218s;bottom:0;left:0;position:absolute;right:0;top:0}.nsm7Bb-HzV7m-LgbsSe:hover,.nsm7Bb-HzV7m-LgbsSe:focus{box-shadow:none;border-color:#d2e3fc;outline:none}.nsm7Bb-HzV7m-LgbsSe:hover .nsm7Bb-HzV7m-LgbsSe-MJoBVe,.nsm7Bb-HzV7m-LgbsSe:focus .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(66,133,244,.04)}.nsm7Bb-HzV7m-LgbsSe:active .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(66,133,244,.1)}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:hover .nsm7Bb-HzV7m-LgbsSe-MJoBVe,.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:focus .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(255,255,255,.24)}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:active .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(255,255,255,.32)}.nsm7Bb-HzV7m-LgbsSe .n1UuX-DkfjY{border-radius:50%;display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;height:20px;margin-left:-4px;margin-right:8px;min-width:20px;width:20px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId{font-family:"Roboto";font-size:12px;text-align:left}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .ssJRIf,.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff .fmcmS{overflow:hidden;text-overflow:ellipsis}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;align-items:center;color:#5f6368;fill:#5f6368;font-size:11px;font-weight:400}.nsm7Bb-HzV7m-LgbsSe.jVeSEe.MFS4be-Ia7Qfc .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff{color:#e8eaed;fill:#e8eaed}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff .Bz112c{height:18px;margin:-3px -3px -3px 2px;min-width:18px;width:18px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-top-left-radius:0;border-bottom-left-radius:0;border-top-right-radius:3px;border-bottom-right-radius:3px;margin-left:12px;margin-right:-10px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:18px}.L5Fo6c-sM5MNb{border:0;display:block;left:0;position:relative;top:0}.L5Fo6c-bF1uUb{-moz-border-radius:4px;border-radius:4px;bottom:0;cursor:pointer;left:0;position:absolute;right:0;top:0}.L5Fo6c-bF1uUb:focus{border:none;outline:none}sentinel{}</style><style type="text/css"></style><link id="googleidentityservice" type="text/css" media="all" rel="stylesheet" href="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/style.css"><style></style><link href="data:text/css,%5Bid*%3D'google_ads_iframe'%5D%2C%5Bid*%3D'taboola-'%5D%2C.taboolaHeight%2C.taboola-placeholder%2C%23credential_picker_container%2C%23credentials-picker-container%2C%23credential_picker_iframe%2C%5Bid*%3D'google-one-tap-iframe'%5D%2C%23google-one-tap-popup-container%2C.google-one-tap-modal-div%2C%23amp_floatingAdDiv%2C%23ez-content-blocker-container%2C%23notify-adblock%7Bdisplay%3Anone!important%3Bmin-height%3A0!important%3Bheight%3A0!important%3B%7D" rel="stylesheet" type="text/css"></head>	

<body class="firefox firefox116"><div class="cc-revoke cc-bottom cc-animate cc-color-override--316233370" style="display: none;">Cookie Policy</div><div role="dialog" aria-live="polite" aria-label="cookieconsent" aria-describedby="cookieconsent:desc" class="cc-window cc-banner cc-type-opt-in-out cc-theme-edgeless cc-bottom cc-color-override--316233370 " style=""><!--googleoff: all--><span id="cookieconsent:desc" class="cc-message">Like every other website we use cookies. By using our site you acknowledge that you have read and understand our <a href="https://www.codeproject.com/info/cookie.aspx">Cookie Policy</a>, <a href="https://www.codeproject.com/info/privacy.aspx">Privacy Policy</a>, and our <a href="https://www.codeproject.com/info/TermsOfUse.aspx">Terms of Service</a>. <a aria-label="learn more about cookies" role="button" tabindex="0" class="cc-link" href="https://www.codeproject.com/info/privacy.aspx" rel="noopener noreferrer nofollow" target="_blank">Learn more</a></span><div class="cc-compliance cc-highlight"><a aria-label="dismiss cookie message" role="button" tabindex="0" class="cc-btn cc-dismiss">Ask me later</a><a aria-label="deny cookies" role="button" tabindex="0" class="cc-btn cc-deny">Decline</a><a aria-label="allow cookies" role="button" tabindex="0" class="cc-btn cc-allow">Allow cookies</a></div><!--googleon: all--></div>

	<div id="ctl00_OneTap_OneTap">
    <div id="g_id_onload" data-client_id="857795997829.apps.googleusercontent.com" data-login_uri="/script/Membership/OAuthLogOn.aspx?auth=Google">
    </div>
</div>



	<a class="access-link" href="#Main"><img alt="Click here to Skip to main content" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/t.gif"></a>




<div class="page-background">

	
	

	

	
    <div id="ctl00_STM" class="site-top-menu fixed">
        <div class="main-content">
            

<div class="container memberbar clearfix flex-container flex-extend">

	<div id="ctl00_MemberBar_GenInfo" class="flex-item align-left">15,723,416 members</div>

	<div class="flex-item">
		
	</div>

	<div class="flex-item align-right">

		

		

		

			<script type="text/javascript">//<!--
			function doSubmit(secure)
			{
				if (secure)
					document.signinForm.action = "https://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fArticles%2f14037%2fCOM-in-plain-C-Part-3"
				else
					document.signinForm.action = "https://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fArticles%2f14037%2fCOM-in-plain-C-Part-3"
				document.signinForm.submit();
				return true;
			}//-->
			</script>

			<a name="SignUp"></a>
			<span class="member-signin">
				<a data-micromodal-trigger="modal-1" href="javascript:;">Sign in</a>
				<!--<a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fArticles%2f14037%2fCOM-in-plain-C-Part-3">Sign in</a>-->

				<div class="micromodal" id="modal-1" aria-hidden="true">

					<div class="modal__overlay" tabindex="-1" data-micromodal-close="">
					  <div class="modal__container" role="dialog" aria-modal="true" aria-labelledby="modal-1-title">

						<header class="modal_header">
							<h4 class="modal_title" id="modal-1-title">
								Sign in
							</h4>
							<button class="modal_close" aria-label="Close modal" data-micromodal-close=""></button>
						</header>

						<form name="signinForm" id="signinForm" action="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fArticles%2f14037%2fCOM-in-plain-C-Part-3" method="post" class="tight align-left">

							
							<input id="FormName" name="FormName" value="MenuBarForm" type="hidden">

							<div>Email</div>
							<div><input type="email" name="Email" id="Email" autocomplete="email" data-ddg-inputtype="credentials.username"></div>
							<div>Password</div>
							<div><input type="password" name="Password" id="Password" autocomplete="current-password" data-ddg-inputtype="credentials.password"></div>
							<div class="action">
								<input id="joinBtn" type="button" class="create hidden" onclick="return Join();" value="Join" style="visibility: visible;">
								<input type="hidden" name="fld_quicksign" value="true">
								<input type="submit" value="Sign in" class="signin" onclick="return doSubmit(false);">
							</div>

							<div class="container">						
								<a id="ctl00_MemberBar_SendPassword" class="forgot float-right" href="https://www.codeproject.com/script/Membership/SendPassword.aspx?rp=/Articles/14037/COM-in-plain-C-Part-3">Forgot your password?</a>
							</div>
						</form>

						<hr class="divider-dark">

						Sign in with &nbsp;<a class="oauth" alt="Sign in using Github" title="Sign in using Github" href="https://www.codeproject.com/script/Membership/OAuthLogOn.aspx?auth=GitHub"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/octicons_github-lg.png" style="vertical-align:middle;padding-right:3px;border:0;"></a>
<a class="oauth" alt="Sign in using Facebook" title="Sign in using Facebook" href="https://www.codeproject.com/script/Membership/OAuthLogOn.aspx?auth=Facebook"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/facebook-lg.png" style="vertical-align:middle;padding-right:3px;border:0;"></a>
<a class="oauth" alt="Sign in using Google" title="Sign in using Google" href="https://www.codeproject.com/script/Membership/OAuthLogOn.aspx?auth=Google"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/google-plus-lg.png" style="vertical-align:middle;padding-right:3px;border:0;"></a>
<a class="oauth" alt="Sign in using Microsoft" title="Sign in using Microsoft" href="https://www.codeproject.com/script/Membership/OAuthLogOn.aspx?auth=Microsoft"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/microsoft-lg.png" style="vertical-align:middle;padding-right:3px;border:0;"></a>



					  </div>
					</div>
				  </div>

            </span>
		
	</div>
</div>
        </div>
    </div>

	
    <div id="ctl00_SH" class="site-header fixed">
        <div class="main-content">
            <div class="logo"><a href="https://www.codeproject.com/"><img id="ctl00_Logo" tabindex="1" title="CodeProject" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/logo250x135.gif" alt="Home" style="height:135px;width:250px;border-width:0px;"></a></div>
            <div class="promo"><div class="msg-728x90" data-format="728x90" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="Programming-LanguagesVBScript" data-country="US" data-tags="C++, C, VBScript, Windows, Visual-Studio, Dev, COM, Beginner,rating4.5"><noscript><a href="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Programming-LanguagesVBScript&sz=728x90&c=778894"><img src="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Programming-LanguagesVBScript&sz=728x90&c=778894"  width="728px" height="90px" target="_blank"/></a></noscript><iframe id="dm-gpt-iframe-1" width="728" height="90" marginwidth="0" marginheight="0" frameborder="0" scrolling="no"></iframe></div></div>
        </div>
    </div>

	
	<div id="ctl00_TPR" class="sub-headerbar flex-container flex-extend flex-wrap fixed">
		<div class="flex-item" style="min-width:20rem">
			

<div class="navbar clearfix">
<ul class="navmenu openable">

<li class="desktop-only"><a id="ctl00_TopNavBar_Home" href="https://www.codeproject.com/">home</a>


</li><li class="openable"><a id="ctl00_TopNavBar_Art" class="down selected" href="https://www.codeproject.com/script/Articles/Latest.aspx">articles</a>

	<ul>
		<li class="openable"><a id="ctl00_TopNavBar_ArtTopicList" class="fly" onmouseover="navBarMenu.ShowMap(this, 'ctl00_TopNavBar_MapFlyout');" href="https://www.codeproject.com/script/Content/SiteMap.aspx">Browse Topics<span class="has-submenu">&gt;</span></a><ul id="ctl00_TopNavBar_MapFlyout" class="taxonomy">
			<li>
				<div id="siteMap"></div>
			</li>
			</ul>
		</li>
		<li><a id="ctl00_TopNavBar_ArtLatestArts" class="fly" href="https://www.codeproject.com/script/Articles/Latest.aspx">Latest Articles</a></li>
		<li><a id="ctl00_TopNavBar_ArtTop" class="fly" href="https://www.codeproject.com/script/Articles/TopArticles.aspx?ta_so=5">Top Articles</a></li>
		<li><a id="ctl00_TopNavBar_ArtGuide" class="fly" href="https://www.codeproject.com/info/Submit.aspx">Posting/Update Guidelines</a></li>
		<li><a id="ctl00_TopNavBar_ArtHelpForum" class="fly" href="https://www.codeproject.com/Forums/1641/Article-Writing">Article Help Forum</a></li>
		<li><a id="ctl00_TopNavBar_ArtPostArticle" class="fly highlight1" href="https://www.codeproject.com/script/Articles/Submit.aspx">
			<img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/write13.png" width="13" height="13"> Submit an article or tip
			</a></li>
        
		<li><a id="ctl00_TopNavBar_ArtImportGitHub" class="fly highlight3" href="https://www.codeproject.com/script/Articles/ImportArticle.aspx">
			<img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/write13.png" width="13" height="13"> Import GitHub Project
			</a></li>
        
		<li><a id="ctl00_TopNavBar_ArtPostBlog" class="fly highlight2" href="https://www.codeproject.com/script/Articles/BlogFeed.aspx">
			<img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/write13.png" width="13" height="13"> Import your Blog
			</a></li>		
        
        <li class="last"></li>
	</ul>

</li>



<li class="openable">
<a id="ctl00_TopNavBar_Answers" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active">
    <span class="desktop-only tablet-only">quick answers</span><span class="mobile-only">Q&amp;A</span>
</a>
	<ul>
		<li id="ctl00_TopNavBar_AQL"><a id="ctl00_TopNavBar_ArticleQuestion" class="fly highlight1" href="#_comments">
			<img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/write13.png" width="13" height="13"> Ask a Question about this 
			article</a>
		</li>

		<li><a id="ctl00_TopNavBar_QAAsk" class="fly highlight2" href="https://www.codeproject.com/Questions/ask.aspx"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/write13.png" width="13" height="13"> Ask a Question</a></li>

		<li><a id="ctl00_TopNavBar_QAUnanswered" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=unanswered">View Unanswered Questions</a></li>
		<li><a id="ctl00_TopNavBar_QALatest" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active">View All Questions</a></li>
        
				<li><a id="ctl00_TopNavBar_QATR_ctl00_Tag" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;amp;alltags=true&amp;amp;tags=81" style="padding-left:30px">View C# questions</a></li>
			
				<li><a id="ctl00_TopNavBar_QATR_ctl01_Tag" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;amp;alltags=true&amp;amp;tags=87" style="padding-left:30px">View Javascript questions</a></li>
			
				<li><a id="ctl00_TopNavBar_QATR_ctl02_Tag" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;amp;alltags=true&amp;amp;tags=268" style="padding-left:30px">View Python questions</a></li>
			
				<li><a id="ctl00_TopNavBar_QATR_ctl03_Tag" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;amp;alltags=true&amp;amp;tags=78" style="padding-left:30px">View C++ questions</a></li>
			
				<li><a id="ctl00_TopNavBar_QATR_ctl04_Tag" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;amp;alltags=true&amp;amp;tags=91" style="padding-left:30px">View Java questions</a></li>
			
    
		<li class="last"></li>
	</ul>

</li>



<li class="openable"><a id="ctl00_TopNavBar_Forums" href="https://www.codeproject.com/script/Forums/List.aspx">
        <span class="desktop-only tablet-only">discussions</span><span class="mobile-only">forums</span>
</a>

	<ul>
		<li><a id="ctl00_TopNavBar_CodeProjectAI" class="fly" href="https://www.codeproject.com/Feature/CodeProjectAI-Discussions.aspx">CodeProject.AI Server</a></li>
		<li><a id="ctl00_TopNavBar_MessageBoardsAll" class="fly" href="https://www.codeproject.com/script/Forums/List.aspx">All Message Boards...</a></li>
		<li class="openable"><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1580997/Application-Lifecycle">Application Lifecycle<span class="has-submenu">&gt;</span></a>
<ul class="openable"><li><a class="fly" href="https://www.codeproject.com/Forums/1533717/Running-a-Business">Running a Business</a></li>
<li><a class="fly" href="https://www.codeproject.com/Forums/1533716/Sales-Marketing">Sales / Marketing</a></li>
<li><a class="fly" href="https://www.codeproject.com/Forums/1651/Collaboration-Beta-Testing">Collaboration / Beta Testing</a></li>
<li><a class="fly" href="https://www.codeproject.com/Forums/3304/Work-Issues">Work  Issues</a></li>
</ul></li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/369270/Design-and-Architecture">Design and Architecture</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1969389/Artificial-Intelligence">Artificial Intelligence</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/12076/ASP-NET">ASP.NET</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1580226/JavaScript">JavaScript</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1969388/Internet-of-Things">Internet of Things</a>
</li>
<li class="openable"><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1647/C-Cplusplus-MFC">C / C++ / MFC<span class="has-submenu">&gt;</span></a>
<ul class="openable"><li><a class="fly" href="https://www.codeproject.com/Forums/4486/ATL-WTL-STL">ATL /  WTL / STL</a></li>
<li><a class="fly" href="https://www.codeproject.com/Forums/3785/Managed-Cplusplus-CLI">Managed C++/CLI</a></li>
</ul></li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1649/Csharp">C#</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1627782/Free-Tools">Free Tools</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1827460/Objective-C-and-Swift">Objective-C and Swift</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1725/Database">Database</a>
</li>
<li class="openable"><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/186301/Hardware-Devices">Hardware &amp; Devices<span class="has-submenu">&gt;</span></a>
<ul class="openable"><li><a class="fly" href="https://www.codeproject.com/Forums/1644/System-Admin">System Admin</a></li>
</ul></li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1606152/Hosting-and-Servers">Hosting and Servers</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1643/Java">Java</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1942421/Linux-Programming">Linux Programming</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1988311/Python">Python</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1650/NET-Core-and-Framework">.NET (Core and Framework)</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1848626/Android">Android</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1876716/iOS">iOS</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/13695/Mobile">Mobile</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1004257/WPF">WPF</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1646/Visual-Basic">Visual Basic</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1640/Web-Development">Web Development</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/suggestions.aspx">Site Bugs / Suggestions</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1652005/Spam-and-Abuse-Watch">Spam and Abuse Watch</a>
</li>

		<li class="last"></li>
	</ul>

</li>

<li class="openable"><a id="ctl00_TopNavBar_Features" href="https://www.codeproject.com/Feature/">
      <span class="desktop-only tablet-only">features</span><span class="mobile-only">features</span>
</a>

	<ul>
		<li><a id="ctl00_TopNavBar_Comps" class="fly" href="https://www.codeproject.com/script/Contests/CurrentCompetitions.aspx?cmpTpId=3&amp;amp;awsac=true">Competitions</a></li>
        
		<li><a id="ctl00_TopNavBar_News" class="fly" href="https://www.codeproject.com/script/News/List.aspx">News</a></li>
		<li><a id="ctl00_TopNavBar_Insider" class="fly" href="https://www.codeproject.com/Feature/Insider/">The Insider Newsletter</a></li>
    	<li><a id="ctl00_TopNavBar_DailyBuild" class="fly" href="https://www.codeproject.com/Feature/DailyBuild">The Daily Build Newsletter</a></li>
		<li><a id="ctl00_TopNavBar_Newsletters" class="fly" href="https://www.codeproject.com/script/Mailouts/Archive.aspx?mtpid=1">Newsletter archive</a></li>
		<li><a id="ctl00_TopNavBar_Surveys" class="fly" href="https://www.codeproject.com/script/Surveys/List.aspx">Surveys</a></li>
		
        
		<li><a id="ctl00_TopNavBar_Stuff" class="fly" href="https://www.codeproject.com/Info/Stuff.aspx">CodeProject Stuff</a></li>
		<li class="last"></li>
	</ul>

</li>


<li class="openable"><a id="ctl00_TopNavBar_Lounge" href="https://www.codeproject.com/Lounge.aspx">
            <span class="desktop-only tablet-only">community</span><span class="mobile-only">lounge</span>
</a>

	<ul>
		<li><a id="ctl00_TopNavBar_WhosWho" class="fly" href="https://www.codeproject.com/script/Membership/Profiles.aspx">Who's Who</a></li>
		<li><a id="ctl00_TopNavBar_MVPs" class="fly break" href="https://www.codeproject.com/script/Contests/Winners.aspx?obtid=1&amp;amp;cmpTpId=2&amp;amp;cid=0">Most Valuable Professionals</a></li>

		<li><a id="ctl00_TopNavBar_LoungeLnk" class="fly highlight2" href="https://www.codeproject.com/Lounge.aspx">The Lounge &nbsp;</a></li>
		<li><a id="ctl00_TopNavBar_SiteBlog" class="fly break" href="https://www.codeproject.com/Members/CodeProject#_comments">The CodeProject Blog</a></li>

		<li><a id="ctl00_TopNavBar_WhereAmILink" class="fly" href="https://www.codeproject.com/Forums/1939564/Where-I-am-Member-Photos">Where I Am: Member Photos</a></li>
		<li><a id="ctl00_TopNavBar_InsiderLnk" class="fly" href="https://www.codeproject.com/Insider.aspx">The Insider News</a></li>
		<li><a id="ctl00_TopNavBar_WeirdWonderful" class="fly" href="https://www.codeproject.com/Feature/WeirdAndWonderful.aspx">The Weird &amp; The Wonderful</a></li>

		<li class="last"></li>
	</ul>

</li>


<li class="openable" style="margin-left:20px"><a id="ctl00_TopNavBar_Help" href="https://www.codeproject.com/KB/FAQs/">
    <span class="desktop-only tablet-only">help</span><span class="mobile-only">?</span>
</a>


	<ul>
		<li><a id="ctl00_TopNavBar_HelpWhatIs" class="fly" href="https://www.codeproject.com/info/guide.aspx">What is 'CodeProject'?</a></li>
		<li><a id="ctl00_TopNavBar_HelpGeneral" class="fly break" href="https://www.codeproject.com/KB/FAQs/">General FAQ</a></li>
		<li><a id="ctl00_TopNavBar_HelpPostQuestion" class="fly break highlight2" href="https://www.codeproject.com/Questions/ask.aspx">Ask a Question</a></li>
		<li><a id="ctl00_TopNavBar_HelpBugs" class="fly" href="https://www.codeproject.com/suggestions.aspx">Bugs and Suggestions</a></li>
		<li><a id="ctl00_TopNavBar_HelpArticles" class="fly" href="https://www.codeproject.com/Forums/1641/Article-Writing">Article Help Forum</a></li>
		
		
		
		
		<li><a id="ctl00_TopNavBar_HelpAboutUs" class="fly" href="https://www.codeproject.com/info/about.aspx">About Us</a></li>
		<li class="last"></li>
	</ul>

</li>

</ul>

</div>
		</div>
		<div class="flex-item-tight align-right">
			

<div class="searchbar">

<form method="get" action="/search.aspx?sbo=kw" name="Search" class="tight">


<table border="0" cellspacing="0" cellpadding="0" class="search"><tbody><tr><td><input tabindex="2" class="search subdue" id="sb_tb" autocomplete="off" value="Search for articles, questions, tips" name="q" data-ddg-inputtype="unknown"></td><td><input type="image" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/search.gif"></td></tr></tbody></table>

<div class="hover-container">
	<div id="SearchFilter" class="search-advanced small-text align-left" style="display: none;">
	<b>Search within:<br></b>
		
		<input type="radio" id="sb_kw" name="sbo" value="kw" checked="checked"><label for="sb_kw">Articles</label><br>
<input type="radio" id="sb_qa" name="sbo" value="qa"><label for="sb_qa">Quick Answers</label><br>
<input type="radio" id="sb_fm" name="sbo" value="fm"><label for="sb_fm">Messages</label><br>


		
		

		
		
	</div>
</div>
</form>

</div>
		</div>
		<div class="sub-headerbar-divider"></div>
	</div>		
	

	<div id="A" class="container-content-wrap fixed"> 

	<div class="container-content">

        
		<div class="clearfix">
			<div class="container-breadcrumb float-left ">
				<div><a rel="nofollow" href="https://www.codeproject.com/script/Content/SiteMap.aspx">Articles</a> / <a rel="nofollow" href="https://www.codeproject.com/script/Content/Tag.aspx?tags=Languages">Programming Languages</a> / <a rel="nofollow" href="https://www.codeproject.com/script/Content/Tag.aspx?tags=VBScript">VBScript</a></div>
			</div>

            <div class="float-left">
				
			</div>

			<div class="edit-links float-right">
				



 
&nbsp;










			</div>

			<div class="article-nav float-right">
				


<div style="display:inline-block;position:relative;top:-6px;margin-right:20px">
    
</div>



 

<a id="ctl00_ActionLinks_PrintMd" data-tooltip="Print" data-enabletooltip="true" data-width="auto" href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?display=Print" class="tooltip" title="">
   <img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/print48.png" width="24" height="24" style="border:0">
<div class="speech-bubble-container-up" style="width:auto">  <div class="speech-bubble-up" style="text-align:center"> Print</div>  <div class="speech-bubble-pointer-up">    <div class="speech-bubble-pointer-up-inner"></div>  </div></div></a>



<span id="ctl00_ActionLinks_R">
    
    
</span>
			</div>
		</div>

        
		<div class="extended article-container-parts">

			
		    <div id="ctl00_LeftSideBar" class="article-left-sidebar">

                <div id="ctl00_StickyBlock" class="article-left-sidebar-inner sticky">

                    
    		        

<div class="tabs">
	<div class=" selected">Article</div>
<div class="browse-code"><a href="https://www.codeproject.com/script/Articles/ViewDownloads.aspx?aid=14037">Browse Code</a></div>
<div><a href="https://www.codeproject.com/script/Articles/Statistics.aspx?aid=14037">View Stats</a></div>
<div><a href="https://www.codeproject.com/script/Articles/ListVersions.aspx?aid=14037">Revisions</a></div>
<div><a href="#_comments">Comments (15)</a></div>
<div>Posted 7 May 2006</div>


    
</div>



			        

			        <div>
                        <h4 id="ctl00_TaggedAsWrapper">Tagged as</h4>
			            <span id="ctl00_TagList_TagWrp" class="tags vertical">

	
	

	
	<span id="ctl00_TagList_VisibleTags"><div class="t"><a rel="tag" href="https://www.codeproject.com/Tags/Cplusplus" data-id="78">C++</a></div><div class="t"><a rel="tag" href="https://www.codeproject.com/Tags/C" data-id="80">C</a></div><div class="t"><a rel="tag" href="https://www.codeproject.com/Tags/VBScript" data-id="86">VBScript</a></div><div class="t"><a rel="tag" href="https://www.codeproject.com/Tags/Windows" data-id="94">Windows</a></div><div class="t"><a rel="tag" href="https://www.codeproject.com/Tags/Visual-Studio" data-id="103">Visual-Studio</a></div><div class="t"><a rel="tag" href="https://www.codeproject.com/Tags/COM" data-id="130">COM</a></div></span> 

	
	
</span>


			        </div>

                    <div id="ctl00_VerticalStatsWrapper" class="stats">
                    <h4>Stats</h4>
                    <div id="ctl00_VerticalStats"><div class="stats"><div>106K views</div><div>2.3K downloads</div><div>116 bookmarked</div></div></div>
                    </div>

                    
                </div>
		    </div>
            

			
			<div id="AT" class="article-container  fixed"> 

				<div class="article">

					<form name="aspnetForm" method="post" action="./View.aspx" id="aspnetForm" style="margin:0;padding:0">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="VXcw/brRwYA0xerh5PzWkMRq3oh4i+lH+sb6taAhT7E6KZfRTthLm0WtnTOnEmQFlp3iaLQwRq5AfaqeWRzupE5UCcOPfDyDKhoYs90j/pFuZ8Lh+IH9LcUJLN9JcELssxHlDBFErhNytNhtXa63cZYZqQfKZDrnNC68lfn1AYpzSghDFUrMe9Oc9hYl1Dbq1LL8u91euCuEj8JAdzjge4u9TCSAxWnV7p+vOlBzJytQbCQILHUnDTqvD20PC7xELavWlAQV6FDYPSMUmIWhBeWYKXBU2HZGJf/1pWxIMH5dJVs7Ht3FVSAZF2+/Mqc7UaNTUQ93TXfqb+ZarsTtm7jV8wsd9za4dpj8K9rxWT6DUEEJiiQZ8TmYBEiqZ/rOcIEVHFxuWYQP7f7wFH9yHT1dOI/sOZ5D+Z8GSVZZ2gIASpcNGWVfeY/adN70G4JJFrz2WTGMxgocPaUymfh9fyEK71l4AaxmZdyjPutYT0tidNXUd4JC4mtSBY98BeZYGcMpoDkFeiyuMZAKyG8bAdMD1FmG+hQyySDCqmS4TYeFoQv/dS/P23/Jy1pni/TNGw48JYzeICQu00obV+AFkkaJTdHmQkrlnr9kK/R2eljHouLJV5KYjRhayB4QxYIb2nb/v0jGf42d8Bg0dJjAPGlKCJCRI0jQ6m1dmKC4xAJNn4O80ur7uKq0oyN9fZnJlCvMUxOLADA5102qUMvJlV4v3Co/x6enczgv4k5LHCeqUNdC4yTCYEGuMVxRc35xV1VIOkKf+DVn9+Os3ElzAcHCIxFHgNOzlPzHRn61TutGI049bONqIwGMIakD6oJhcfklHWS3BWVNU1fsyY1pPlOtmI0E9792k8YhsPe5ISv6fPJEOqd7jSEVTuoi0Umq10WGw/CefHIEfoa5Qp7YizpLof6MKJ1ZVMNp+pODDnDNEhpaBjngQ/NGL1cfOK/y+8zr76//8kiz5ejRKyll3H6QqXAsz2IhtP/r3NbMSI2OJSpRY+qFVA1ZGjxw6CqtwxhEaHR6rSGHjmHu0NP8li1GDCKbeNwqouKIHcULLggUmxer2FeTz/K2OHZCYEsAW0ddUtdhiozZP+a8/gW9t+AhoA8akLHEWEA4apKu6S5DEOqMBL2AO+oJZbrPO6isYt444W/2zijsZFnCfmla+G/251GOyK53klevbZ9OoUDihYTHgMSUPYD2zBhMqeei7E+O+ffnEfNxqZAQCIAQ+khMSgbl6fXJ5RYNPrj/7F710DKaGezRhvn4QtyAFh2ZKoe7yTg2LyT43Emupty9dmjZ3gmoPL0DevBsFUfMZppzkydj2FIWk3k1l+c1GVcEhuM1H5YKaAvqG0zXwz1u4pvTc5itvlMjbZZ0gjxsbkq/H+6iM3cNsV6fkbpm9uoeaO1DIqdW+ECdd5DdxVD2BstmMtqA6iLxKdoTv8yD6vRhT2+2I0iXMrQAJ+XYNic5uclpUW82lURNI4UbQOHr7J599j9quJaAmqMFm9Iub4NTzeU24pZfqC/BmKQXjJQl8S3LvbGJjrq1j1QkvX8VHVa7mBdsCVdHYYPM0L9MH8Ftmw9D+FuEQWbsm4swCrF9qWq9rbn/uBOk5NnDrZv+u54OxjHcBIrxB6nDxBpL72MMuGKodlkDLV/BJPEhsM95oR7iwVj9y4P7VGxl3bhJM/Jvp84Y17whm6DX5eUoVfx2i+EadPWRhwP02dTwnC65PfADqzUqOI2/NvdrSmxi25po5XW4MrRPqEBizIeqPgKi5HtmdZ/5r1GBHWp+ZZt8z67nUMhT8TLGal8xyJlINZ5OMQSepT/X+qn0oE3yzy4YEUT8lY5f4KFyZM1TPpjXQAHzGxn/EWvJZTamIr1vB/pKdeT3s2HuVyx3qodkmHImYZ8w0D4agSnwm3LOzYMceoaNIA==">
</div>

<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="10C1FD69">
</div>

					
					 
					<div class="header">
					    <a name="Main"></a>

					    
					    <a name="_articleTop" id="_articleTop"></a>
					    <div class="title">
					        <h1 id="ctl00_ArticleTitle">COM in plain C, Part 3</h1>
					    </div>

                        <div>
					        
					        <div class="entry flex-container">

								

                                <div class="flex-item" style="flex:1 1 auto">
                                    <div class="flex-container" style="justify-content:space-between;flex-wrap:wrap-reverse">
                                       <span id="ctl00_Authors" class="author flex-item"><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=88625" rel="author">Jeff Glatt</a></span> 

                                        <div class="flex-item" style="margin-top:-4px;">
                                            <div id="ctl00_RateArticle_RatingTable" class="small-text" data-objectref="2_14037_1">

	<meta itemprop="upvoteCount" content="36">


	<div id="ctl00_RateArticle_RatingRow" class="flex-container rating-container large-stars">

					
		<div id="ctl00_RateArticle_Prompt" class="rating-prompt nowrap">Rate me:</div>

		
		<div class="nowrap tooltip">

			
			
			

			
			<div id="ctl00_RateArticle_RatingHistWrap" class="tooltip">

				
				<div id="ctl00_RateArticle_ResultWithHist" class="rating-result"><div class="flex-container rating-stars large-stars"><div><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/star-fill-lg.png" style="width:24px;height:24px"></div><div><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/star-fill-lg.png" style="width:24px;height:24px"></div><div><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/star-fill-lg.png" style="width:24px;height:24px"></div><div><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/star-fill-lg.png" style="width:24px;height:24px"></div><div style="width:21px;" class="clipped"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/star-fill-lg.png" style="width:24px;height:24px"></div><div style="width:3px;position:relative" class="clipped"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/star-empty-lg.png" style="width:24px;height:24px;position:absolute;top:0px;right:0"></div></div></div>
				

				<div class="speech-bubble-container-up-right" style="width:170px">
					<div class="speech-bubble-up-right">
						<div class="histogram"></div>
					</div>
					<div class="speech-bubble-pointer-up-right">
						<div class="speech-bubble-pointer-up-right-inner"></div>
					</div>
				</div>
			</div>

			
            

			
            <span id="ctl00_RateArticle_RatingSignin" class="speech-bubble-container-down">
		        <div class="speech-bubble-down">
                    Please <a id="ctl00_RateArticle_SignUp" href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fArticles%2f14037%2fCOM-in-plain-C-Part-3">Sign up or sign in</a> 
                    to vote.
		        </div>
		        <div class="speech-bubble-pointer-down">
			        <div class="speech-bubble-pointer-down-inner"></div>
		        </div>
	        </span>    

		</div>
		
	
		
		<div id="ctl00_RateArticle_VoteCountNoHist" class="rating-votes nowrap">4.90/5  (42 votes)</div>	

		

		
		<div class="rating-undo" title="Undo vote" style="margin-left:5px;display:none"></div>

		
		
	</div>

	
	

</div>

                                        </div>
                                    </div>

                                    <div class="flex-container">
                                        <span id="ctl00_LastUpdated" class="date flex-item-tight" title="Date last updated">7 May 2006</span><a id="ctl00_LicenseLink" title="The Code Project Open License (CPOL)" class="license flex-item-tight" href="http://www.codeproject.com/info/cpol10.aspx">CPOL</a><span id="ctl00_ReadingTime" class="stats flex-item-tight">30 min read</span>
                                    </div>
                                </div>
					        </div>

                            

                        </div>

                        <div id="ctl00_DescriptionSpot" class="summary">COM collections in C</div><span id="ctl00_ThumbnailUrl" class="date" content="https://codeproject.global.ssl.fastly.net/script/Articles/Images/article100x80.png"></span>			

                    </div>
                    
					
					

					

					
					

					
					

						
					

					

						
						<div id="contentdiv" class="text">
						



<ul class="download">
<li><a href="https://www.codeproject.com/KB/COM/com_in_c3/com_in_c3_src.zip">Download source files - 174 Kb</a> </li></ul>
<h2>Contents</h2>
<ul>
<li><a href="#Intro">Introduction</a> 
</li><li><a href="#DEFINE">Defining a collection object</a> 
</li><li><a href="#BOOK">Some helper functions</a> 
</li><li><a href="#COLLECT">Our collection object's functions</a> 
</li><li><a href="#HOW">How an application obtains our collection object</a> 
</li><li><a href="#VB1">A VBScript example</a> 
</li><li><a href="#C1">A C example</a> 
</li><li><a href="#ENUM">An IEnumVARIANT object</a> 
</li><li><a href="#VB2">Another VBScript example</a> 
</li><li><a href="#C2">Another C example</a> 
</li><li><a href="#GENERIC">A more generic approach</a> 
</li><li><a href="#ADD">Add/Remove items</a> </li></ul>
<h2><a name="intro">Introduction</a></h2>
<p>Sometimes, we may need to maintain a list of items. For example, 
let's say that our COM component is designed to operate some hardware 
PCI card we've designed. And, let's say that a user can install several 
of these cards into one computer, and we want our component to control 
all of the available cards, letting an application retrieve information 
about each card, and access each card individually.</p>
<p>In other words, when our component runs, it needs to query what cards
 are in the system, and make available to an application, a list of 
information about all of them. For the sake of argument, let's assume 
that the only information we need to make available is the "name" of 
each card, where the first card in the system will be named "Port 1", 
the second card will be named "Port 2", etc.</p>
<p>Since we don't know ahead of time how many cards will be in a system,
 the best approach would be to create some struct that can be linked to 
others of its kind, in a linked list. For example, maybe we'll define an
 <code>IENUMITEM</code> struct to hold information about a card:</p><div class="pre-lang" id="premain455556"><div></div><div class="pre-action-link"><span id="copycode455556" class="copy-code" data-index="455556" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre455556" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">typedef <span class="code-keyword">struct</span> _IENUMITEM {
   <span class="code-comment">//</span><span class="code-comment"> To link several IENUMITEMs into a list.</span>
   <span class="code-keyword">struct</span> _IENUMITEM  *next;
   <span class="code-comment">//</span><span class="code-comment"> This item's value (ie, its port name).</span>
   <span class="code-keyword">char</span>               *value;
} IENUMITEM;</pre>
<p>And if we have three ports, our linked list of <code>IENUMITEM</code>s would look something like this (where we normally would <code>GlobalAlloc</code> the <code>IENUMITEM</code>s, but I'll just statically declare/initialize them below for quick edification):</p><div class="pre-lang" id="premain451881"><div></div><div class="pre-action-link"><span id="copycode451881" class="copy-code" data-index="451881" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre451881" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">IENUMITEM Port1 = {&amp;Port2, <span class="code-string">"</span><span class="code-string">Port 1"</span>};
IENUMITEM Port2 = {&amp;Port3, <span class="code-string">"</span><span class="code-string">Port 2"</span>};
IENUMITEM Port3 = {<span class="code-digit">0</span>, <span class="code-string">"</span><span class="code-string">Port 3"</span>};</pre>
<p>In COM lingo, we refer to a group of related items as a "collection".
 So, the linked list of three items above would be our collection.</p>
<p>But there's one problem with our <code>IENUMITEM</code> above. It has a <code>char *</code> member, which is not automation compatible. We could change this to a <code>BSTR</code>, which is automation compatible. Better yet, let's put a <code>VARIANT</code> right in the <code>IENUMITEM</code>. This has the advantage of making an <code>IENUMITEM</code>
 generic (i.e., it can store any kind of automation data type). And as 
we'll see later, we have to return an item's value to an application, 
using a <code>VARIANT</code>. So, since we need to deal with a <code>VARIANT</code> anyway, let's store it in our <code>IENUMITEM</code> that way. Here's the new definition of an <code>IENUMITEM</code>:</p><div class="pre-lang" id="premain263954"><div></div><div class="pre-action-link"><span id="copycode263954" class="copy-code" data-index="263954" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre263954" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">typedef <span class="code-keyword">struct</span> _IENUMITEM {
   <span class="code-keyword">struct</span> _IENUMITEM  *next;
   VARIANT            *value;
} IENUMITEM;</pre>
<p>And, here is how we may allocate one, and set its value to "Port 1" (error checking omitted):</p><div class="pre-lang" id="premain152154"><div></div><div class="pre-action-link"><span id="copycode152154" class="copy-code" data-index="152154" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre152154" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">IENUMITEM  *enumItem;

enumItem = (IENUMITEM *)GlobalAlloc(GMEM_FIXED, <span class="code-keyword">sizeof</span>(IENUMITEM));
enumItem-&gt;next = <span class="code-digit">0</span>;
enumItem-&gt;value.vt = VT_BSTR;
enumItem-&gt;value.bstrVal = SysAllocString(L<span class="code-string">"</span><span class="code-string">Port 1"</span>);</pre>
<h2><a name="DEFINE">Defining</a> a collection object</h2>
<p>Remember that some script languages do not have the concept of a 
pointer. Such a language can't possibly walk the above list on its own, 
because the first member of each <code>IENUMITEM</code> is a pointer to the next <code>IENUMITEM</code>. So, we need to provide an object that helps the application (using our COM object) walk this list, fetching each item's value.</p>
<p>Because Microsoft left it up to the Visual Basic programmers (ugh) to come up with this object, they chose to base it upon an <code>IDispatch</code>. In other words, the VTable for our object must start with the three <code>IUnknown</code> functions as all COM objects do (<code>QueryInterface</code>, <code>AddRef</code>, and <code>Release</code>), and then must be followed immediately with the four standard <code>IDispatch</code> functions (<code>GetTypeInfoCount</code>, <code>GetTypeInfo</code>, <code>GetIDsOfNames</code>, and <code>Invoke</code>).
 Our object must then have three more functions. In our IDL file, when 
we define the VTable (i.e., the interface) for this object we'll create,
 we must name these three extra functions <code>Count</code>, <code>Item</code>, and <code>_NewEnum</code>.
 In our actual VTable for the object, we can use any name we want for 
the pointers (although I'll stick to those names). Why? Because no one 
is ever going to directly call them. No one will ever even know that 
we're going to add these three functions to our VTable. These functions 
must be called only indirectly via the <code>Invoke</code> function of our object -- even if you're using a language like C that <b>could</b>
 have called them directly if only Microsoft's Visual Basic programmers 
had designed this to accommodate more powerful languages. That's the 
terrible price we all pay for letting Visual Basic programmers design 
this. Furthermore, in our IDL file, we must assign the ID <code>DISPID_VALUE</code> to the <code>Item</code> function, and <code>DISPID_NEWENUM</code> to the <code>_NewEnum</code> function. We <b>must</b>. The <code>Count</code>
 function can be assigned any positive number of our choosing for its 
ID. Does there appear to be any sense of consistency or logic to this 
whatsoever? No? Remember -- Visual Basic programmers.</p>
<p>We'll also need to generate a new GUID for this object's VTable, for use in our IDL file (i.e., the type library).</p>
<p>Let's look at the definition of this object. We can call it anything we like. I'll choose to call it an <code>ICollection</code>:</p><div class="pre-lang" id="premain652577"><div></div><div class="pre-action-link"><span class="code-collapse" data-index="652577" id="preShrink652577">Shrink ▲</span> &nbsp; <span id="copycode652577" class="copy-code" data-index="652577" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre652577" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-comment">//</span><span class="code-comment"> Our ICollection VTable's GUID</span>
<span class="code-comment">//</span><span class="code-comment"> {F69902B1-20A0-4e99-97ED-CD671AA87B5C}</span>
DEFINE_GUID(IID_ICollection, <span class="code-digit">0xf69902b1</span>, <span class="code-digit">0x20a0</span>, <span class="code-digit">0x4e99</span>, <span class="code-digit">0x97</span>, 
            <span class="code-digit">0xed</span>, <span class="code-digit">0xcd</span>, <span class="code-digit">0x67</span>, <span class="code-digit">0x1a</span>, <span class="code-digit">0xa8</span>, <span class="code-digit">0x7b</span>, <span class="code-digit">0x5c</span>);

<span class="code-comment">//</span><span class="code-comment"> Our ICollection's VTable</span>
<span class="code-preprocessor">#undef  INTERFACE
</span><span class="code-preprocessor">#define INTERFACE ICollection
</span>DECLARE_INTERFACE_ (INTERFACE, IDispatch)
{
   <span class="code-comment">//</span><span class="code-comment"> IUnknown functions</span>
   STDMETHOD  (QueryInterface) (THIS_ REFIID, <span class="code-keyword">void</span> **) PURE;
   STDMETHOD_ (ULONG, AddRef)  (THIS) PURE;
   STDMETHOD_ (ULONG, Release) (THIS) PURE;
   <span class="code-comment">//</span><span class="code-comment"> IDispatch functions</span>
   STDMETHOD_ (ULONG, GetTypeInfoCount) (THIS_ UINT *) PURE;
   STDMETHOD_ (ULONG, GetTypeInfo) (THIS_ UINT, LCID, 
                                    ITypeInfo **) PURE;
   STDMETHOD_ (ULONG, GetIDsOfNames) (THIS_ REFIID, LPOLESTR *,
               UINT, LCID, DISPID *) PURE;
   STDMETHOD_ (ULONG, Invoke) (THIS_ DISPID, 
               REFIID, LCID, WORD, DISPPARAMS *,
               VARIANT *, EXCEPINFO *, UINT *) PURE;
   <span class="code-comment">//</span><span class="code-comment"> Extra functions</span>
   STDMETHOD (Count) (THIS_ <span class="code-keyword">long</span> *);
   STDMETHOD (Item) (THIS_ <span class="code-keyword">long</span>, VARIANT *);
   STDMETHOD (_NewEnum) (THIS_ IUnknown **);  
};</pre>
<p>This shouldn't look totally unfamiliar. First, I ran <i>GUIDGEN.EXE</i> to create another GUID. I pasted it above, and gave it the variable name <code>IID_ICollection</code>. That's the GUID for our <code>ICollection</code> object's VTable.</p>
<p>Next, we define our <code>ICollection</code> object's VTable. We're using the same macro we used when we defined our <code>IExample2</code> VTable in the last article. And as mentioned earlier, it starts with the three <code>IUnknown</code> functions, followed by the four <code>IDispatch</code> functions, just like <code>IExample2</code>
 did when we added support for scripting languages. These functions are 
going to perform the same duties as the respective functions did in <code>IExample2</code>.</p>
<p>Finally, we add the three extra functions <code>Count</code>, <code>Item</code>, and <code>_NewEnum</code>. Later, we'll examine what they do.</p>
<p>Remember that the above macro automatically defines our <code>ICollection</code> object as so:</p><div class="pre-lang" id="premain686807"><div></div><div class="pre-action-link"><span id="copycode686807" class="copy-code" data-index="686807" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre686807" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">typedef <span class="code-keyword">struct</span> {
   ICollectionVtbl  *lpVtbl;
} ICollection;</pre>
<p>In other words, it is defined to have only one data member -- a pointer to our <code>ICollection</code>'s VTable. This member is named <code>lpVtbl</code>, of course. But, we need to add an extra <code>DWORD</code> member to keep a reference count (just like we did to <code>IExample2</code>, and consequently defined a <code>MyRealIExample2</code> to accommodate any extra data members). So, we'll define a <code>MyRealICollection</code> as so:</p><div class="pre-lang" id="premain678749"><div></div><div class="pre-action-link"><span id="copycode678749" class="copy-code" data-index="678749" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre678749" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">typedef <span class="code-keyword">struct</span> {
   ICollectionVtbl  *lpVtbl;
   DWORD            count;
} MyRealICollection;</pre>
<p>Now, let's take a look at how we'll define the VTable (interface) in our IDL file:</p><div class="pre-lang" id="premain957098"><div></div><div class="pre-action-link"><span id="copycode957098" class="copy-code" data-index="957098" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre957098" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-bracket">[</span><span class="code-sdkkeyword">uuid</span>(F69902B1-20A0-4e99-97ED-CD671AA87B5C), oleautomation, object]
<span class="code-keyword">interface</span> ICollection : IDispatch
{
   [propget, id(<span class="code-digit">1</span>)] 
   HRESULT Count([out, retval] <span class="code-keyword">long</span> *);
   [propget, id(DISPID_VALUE)] 
   HRESULT Item([in] <span class="code-keyword">long</span>, [out, retval] VARIANT *);
   [propget, id(DISPID_NEWENUM), restricted]
   HRESULT _NewEnum([out, retval] IUnknown **);
};</pre>
<p>Note that we've used the new GUID created for our <code>ICollection</code> VTable.</p>
<p>We use the <code>oleautomation</code> keyword because our functions will accept only automation compatible data types, and return such.</p>
<p>Finally, we use the <code>object</code> keyword to indicate that this
 VTable belongs to some object. It's not going to be an object that an 
application gets hold of via our <code>IClassFactory</code>. (Later, we'll see how an application gets hold of one of our <code>ICollection</code> objects.) In fact, an application is never going to be told that our <code>ICollection</code> object is anything except a standard <code>IDispatch</code> object (i.e., our <code>ICollection</code> object is going to masquerade as an ordinary <code>IDispatch</code> as far as an application or script engine is concerned). Since our object is going to masquerade as an ordinary <code>IDispatch</code>, there's no need to specifically define our <code>ICollection</code> object itself inside of our IDL file (unlike we had to do with <code>IExample2</code>
 when we listed what interfaces were in it, and which interface was the 
default). All scripting languages and applications already know all 
about an ordinary <code>IDispatch</code> object, so there's no need to put any information about this <code>IDispatch</code>-impersonator (<code>ICollection</code>) object itself in our IDL file. We need to define only its VTable as above, and mark that VTable as belonging to some object.</p>
<p>Note that, on the interface line, we do specify that this VTable contains <code>IDispatch</code> functions in the expected place and order. So, it certainly can masquerade as an <code>IDispatch</code>.</p>
<p>We, then, list the three extra functions. Notice that they are all defined as <code>propget</code>. Also notice that the <code>Item</code> function has an ID (DISPID) of <code>DISPID_VALUE</code>, and the <code>_NewEnum</code> function has an ID of <code>DISPID_NEWENUM</code>. (We also use the <code>restricted</code> keyword on that latter one, because an object browser is not supposed to show the <code>_NewEnum</code>
 function. It is supposed to be a function that only a script engine 
would call internally, but an actual script would never call.) For the <code>Count</code> function, we can choose any positive ID number, so I arbitrarily chose 1. (It doesn't matter that <code>IExample2</code>'s <code>Buffer</code>
 function also has an ID of 1. These VTables are used in two different 
objects, so their IDs do not need to be unique between the two VTables).</p>
<p>Later, we'll actually get into writing these functions.</p>
<p>Before we change our <code>IExample2</code> sources, let's just copy the entire <i>IExample2</i> directory to a new directory named <i>IExample3</i>. We'll also rename all of the files to reflect this new directory (i.e., <i>IExample2.h</i> becomes <i>IExample3.h</i>, and <i>IExample2.c</i> becomes <i>IExample3.c</i>, etc.). And while we're at it, let's edit the files in this new directory, renaming our <code>IExample2</code> object to an <code>IExample3</code>,
 to distinguish it from our previous sources. All we do is search and 
replace every instance of "IExample2" with "IExample3". And, don't 
forget to run <i>GUIDGEN.EXE</i> to make new GUIDs for <code>IExample3</code>, its VTable, and the type library. Replace the old GUIDs in <i>IExample3.h</i>, and update the UUIDs in <i>IExample3.idl</i>. After all, we don't want our new DLL (which we'll name <i>IExample3.dll</i>) to conflict with our previous <i>IExample2.dll</i>. I've done all this for you, and put the resulting files in an <i>IExample3</i> directory.</p>
<h2><a name="BOOK">Some</a> helper functions</h2>
<p>We need to construct our list of port names. Let's write a helper 
function to do that. We'll arbitrarily assume we have three ports, and 
so create three <code>IENUMITEM</code>s. We'll store the head of this list in a global variable <code>PortsList</code>. And, we also need a helper function to free the list when we're done with it.</p><div class="pre-lang" id="premain151579"><div></div><div class="pre-action-link"><span class="code-collapse" data-index="151579" id="preShrink151579">Shrink ▲</span> &nbsp; <span id="copycode151579" class="copy-code" data-index="151579" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre151579" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">IENUMITEM  *PortsList;

<span class="code-comment">//</span><span class="code-comment"> This is just a helper function to free</span>
<span class="code-comment">//</span><span class="code-comment"> up our PortsList. Called when our DLL unloads.</span>
<span class="code-keyword">void</span> freePortsCollection(<span class="code-keyword">void</span>)
{
   IENUMITEM *item;

   item = PortsList;

   <span class="code-comment">//</span><span class="code-comment"> Is there another item in the list?</span>
   <span class="code-keyword">while</span> ((item = PortsList))
   {
      <span class="code-comment">//</span><span class="code-comment"> Get the next item *before* we delete this one</span>
      PortsList = item-&gt;next;

      <span class="code-comment">//</span><span class="code-comment"> If the item's value is an object, we need to Release()</span>
      <span class="code-comment">//</span><span class="code-comment"> it. If it's a BSTR, we need to SysFreeString() it.</span>
      <span class="code-comment">//</span><span class="code-comment"> VariantClear does this for us.</span>
      VariantClear(&amp;item-&gt;value);

      <span class="code-comment">//</span><span class="code-comment"> Free the IENUMITEM.</span>
      GlobalFree(item);
   }
}

<span class="code-comment">//</span><span class="code-comment"> This is just a helper function to initialize our Ports list.</span>
<span class="code-comment">//</span><span class="code-comment"> Called when our DLL first loads.</span>
HRESULT initPortsCollection(<span class="code-keyword">void</span>)
{
   IENUMITEM *item;

   <span class="code-comment">//</span><span class="code-comment"> Add a "Port 1" IENUMITEM to our list.</span>
   <span class="code-keyword">if</span> ((PortsList = item = 
       (IENUMITEM *)GlobalAlloc(GMEM_FIXED, 
       <span class="code-keyword">sizeof</span>(IENUMITEM))))
   {
      item-&gt;next = <span class="code-digit">0</span>;
      item-&gt;value.vt = VT_BSTR;
      <span class="code-keyword">if</span> ((item-&gt;value.bstrVal = SysAllocString(L<span class="code-string">"</span><span class="code-string">Port 1"</span>)))
      {
         <span class="code-comment">//</span><span class="code-comment"> Add a "Port 2" IENUMITEM to our list.</span>
         <span class="code-keyword">if</span> ((item-&gt;next = (IENUMITEM *)GlobalAlloc(
                               GMEM_FIXED, <span class="code-keyword">sizeof</span>(IENUMITEM))))
         {
            item = item-&gt;next;
            item-&gt;value.vt = VT_BSTR;
            <span class="code-keyword">if</span> ((item-&gt;value.bstrVal = SysAllocString(L<span class="code-string">"</span><span class="code-string">Port 2"</span>)))
            {
               <span class="code-comment">//</span><span class="code-comment"> Add a "Port 3" IENUMITEM to our list.</span>
               <span class="code-keyword">if</span> ((item-&gt;next = (IENUMITEM *)GlobalAlloc(
                                     GMEM_FIXED, <span class="code-keyword">sizeof</span>(IENUMITEM))))
               {
                  item = item-&gt;next;
                  item-&gt;next = <span class="code-digit">0</span>;
                  item-&gt;value.vt = VT_BSTR;
                  <span class="code-keyword">if</span> ((item-&gt;value.bstrVal = 
                       SysAllocString(L<span class="code-string">"</span><span class="code-string">Port 3"</span>)))
                     <span class="code-keyword">return</span>(S_OK);
               }
            }
         }
      }
   }

   <span class="code-comment">//</span><span class="code-comment"> Error</span>
   freePortsCollection();
   <span class="code-keyword">return</span>(E_FAIL);
}</pre>
<p>We're also going to add a second global variable named <code>CollectionTypeInfo</code> to hold a <code>ITypeInfo</code> for our <code>ICollection</code>... uh, the <code>IDispatch</code>
 object. (We'll talk about why we need this, later). So, we need to add 
that global variable, and then let's write two helper functions -- one 
to initialize the variable to zero, and one to Release the <code>ITypeInfo</code>:</p><div class="pre-lang" id="premain4701"><div></div><div class="pre-action-link"><span class="code-collapse" data-index="4701" id="preShrink4701">Shrink ▲</span> &nbsp; <span id="copycode4701" class="copy-code" data-index="4701" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre4701" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-comment">//</span><span class="code-comment"> Our ICollection's ITypeInfo. We need only one of these so</span>
<span class="code-comment">//</span><span class="code-comment"> we can make it global</span>
ITypeInfo    *CollectionTypeInfo;

<span class="code-comment">//</span><span class="code-comment"> This helper function initializes our ICollection TypeInfo.</span>
<span class="code-comment">//</span><span class="code-comment"> It's called when our DLL is loading.</span>
<span class="code-keyword">void</span> initCollectionTypeInfo(<span class="code-keyword">void</span>)
{
   <span class="code-comment">//</span><span class="code-comment"> We haven't yet created the ITypeInfo for our ICollection</span>
   CollectionTypeInfo = <span class="code-digit">0</span>;
}

<span class="code-comment">//</span><span class="code-comment"> This helper function just Release()'s our ICollection TypeInfo.</span>
<span class="code-comment">//</span><span class="code-comment"> It's called when our DLL is unloading.</span>
<span class="code-keyword">void</span> freeCollectionTypeInfo(<span class="code-keyword">void</span>)
{
   <span class="code-keyword">if</span> (CollectionTypeInfo)
       CollectionTypeInfo-&gt;lpVtbl-&gt;AddRef(CollectionTypeInfo);
}</pre>
<p>Now, we need to modify our <code>DllMain</code> to call these helper functions:</p><div class="pre-lang" id="premain977229"><div></div><div class="pre-action-link"><span class="code-collapse" data-index="977229" id="preShrink977229">Shrink ▲</span> &nbsp; <span id="copycode977229" class="copy-code" data-index="977229" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre977229" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">BOOL WINAPI DllMain(HINSTANCE instance, DWORD fdwReason, LPVOID lpvReserved)
{
   <span class="code-keyword">switch</span> (fdwReason)
   {
      <span class="code-keyword">case</span> DLL_PROCESS_ATTACH:
      {
         MyTypeInfo = <span class="code-digit">0</span>;

         <span class="code-comment">//</span><span class="code-comment"> Initialize our ICollection stuff</span>
         initCollectionTypeInfo();

         <span class="code-comment">//</span><span class="code-comment"> Initialize our Ports list</span>
         <span class="code-keyword">if</span> (initPortsCollection())
         {
            MessageBox(<span class="code-digit">0</span>, <span class="code-string">"</span><span class="code-string">Can't allocate the PortsList"</span>, <span class="code-string">"</span><span class="code-string">ERROR"</span>, MB_OK);
            <span class="code-keyword">return</span>(<span class="code-digit">0</span>);
         }

         OutstandingObjects = LockCount = <span class="code-digit">0</span>;

         MyIClassFactoryObj.lpVtbl = (IClassFactoryVtbl *)&amp;IClassFactory_Vtbl;

         DisableThreadLibraryCalls(instance);
         <span class="code-keyword">break</span>;
      }

      <span class="code-keyword">case</span> DLL_PROCESS_DETACH:
      {
         <span class="code-comment">//</span><span class="code-comment"> Free our Ports list</span>
         freePortsCollection();

         <span class="code-comment">//</span><span class="code-comment"> Free our ICollection ITypeInfo</span>
         freeCollectionTypeInfo();

         <span class="code-keyword">if</span> (MyTypeInfo) MyTypeInfo-&gt;lpVtbl-&gt;Release(MyTypeInfo);
      }
   }

   <span class="code-keyword">return</span>(<span class="code-digit">1</span>);
}</pre>
<h2><a name="COLLECT">Our</a> collection object's functions</h2>
<p>Now, let's write the actual functions for our <code>ICollection</code> (actually, our <code>MyRealICollection</code>). Rather than put this code in <i>IExample3.c</i>, let's create a separate source file for it, called <i>PortNames.c</i>. And, we'll put the definition of our <code>ICollection</code> VTable and its GUID in a separate <i>PortNames.h</i> file. (We can also put our above helper functions in <i>PortNames.c</i>.)</p>
<p>The <code>IUnknown</code> functions (<code>QueryInterface</code>, <code>AddRef</code>, and <code>Release</code>) and <code>IDispatch</code> functions (<code>GetTypeInfoCount</code>, <code>GetTypeInfo</code>, <code>GetIDsOfNames</code>, and <code>Invoke</code>) are almost the same as the respective functions for our <code>IExample3</code> object. So rather than reproduce the code here, I'll refer you to the file <i>PortNames.c</i> (in the directory <i>IExample3</i>).</p>
<p>One difference is that our <code>ICollection</code> functions are passed an <code>ICollection</code> object pointer (instead of an <code>IExample3</code> object pointer), of course. And, <code>ICollection</code>'s <code>Release</code> function is slightly different (since unlike <code>IExample3</code>'s <code>Release</code>, there is no buffer member to free).</p>
<p>The other key difference is the call to <code>GetTypeInfoOfGuid</code>. Note that we're passing the GUID for our <code>ICollection</code> VTable (instead of the GUID for our <code>IExample3</code> VTable, like we do in <i>IExample3.c</i>). Here's the deal. When we get an <code>ITypeInfo</code> for <code>IExample3</code> (by calling <code>loadMyTypeInfo</code> in <i>IExample3.c</i>), we pass the GUID of <code>IExample3</code>'s VTable to the OLE function <code>GetTypeInfoOfGuid</code>. The implication of this is that the default <code>ITypeInfo</code> Microsoft creates for us is good for getting information <b>only</b> about the functions in our <code>IExample3</code> VTable. <b>It cannot be used to get information about the functions in another object's VTable.</b> But, we <b>do</b> need an <code>ITypeInfo</code> that will provide us with information about our <code>ICollection</code>'s functions. So now, we have to call <code>GetTypeInfoOfGuid</code> again, but this time we pass the GUID for our <code>ICollection</code> object's VTable (i.e., the new GUID I created). This will return a second <code>ITypeInfo</code> (which we store in that global variable we added, named <code>CollectionTypeInfo</code>). This second <code>ITypeInfo</code> can be used with <code>ICollection</code>'s <code>IDispatch</code> functions to get information about <code>ICollection</code>'s functions. And it can be used with <code>DispInvoke</code> and <code>DispGetIDsOfNames</code> in <code>ICollection</code>'s <code>Invoke</code> and <code>GetIDsOfNames</code> functions to do almost all of the work for us -- just like we did with <code>IExample3</code>'s <code>ITypeInfo</code>.</p>
<p>Notice that <code>ICollection</code>'s <code>IDispatch</code> functions use this new <code>ITypeInfo</code>, whereas <code>IExample3</code>'s <code>IDispatch</code> functions use <code>IExample3</code>'s <code>ITypeInfo</code>. They are not the same <code>ITypeInfo</code>, and cannot be used interchangeably.</p>
<p>All that's left is to write the three extra functions, <code>Count</code>, <code>Item</code>, and <code>_NewEnum</code>.</p>
<p>The <code>Count</code> function is simple. It is passed a pointer to a <code>long</code>. <code>Count</code> fills in that pointer with the total number of items in our list. For example, above we have three ports (<code>IENUMITEM</code> structs) in our list, so we would return a 3.</p>
<p>Here's our <code>Count</code> function:</p><div class="pre-lang" id="premain816290"><div></div><div class="pre-action-link"><span id="copycode816290" class="copy-code" data-index="816290" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre816290" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">STDMETHODIMP Count(ICollection *this, <span class="code-keyword">long</span> *total)
{
   DWORD     count;
   IENUMITEM *item;

   <span class="code-comment">//</span><span class="code-comment"> Count how many items in the list by just walking it all</span>
   <span class="code-comment">//</span><span class="code-comment"> the way to the last IENUMITEM, incrementing a count for</span>
   <span class="code-comment">//</span><span class="code-comment"> each item.</span>
   count = <span class="code-digit">0</span>;
   item = (IENUMITEM *)&amp;PortsList;
   <span class="code-keyword">while</span> ((item = item-&gt;next)) ++count;

   <span class="code-comment">//</span><span class="code-comment"> Return the total.</span>
   *total = count;

   <span class="code-keyword">return</span>(S_OK);
}</pre>
<p>The <code>Item</code> function is also simple. It is passed a <code>long</code> that tells us which item is being queried (where 0 is the first item, 1 is the second item, etc.). It is also passed a <code>VARIANT</code> into which we copy the value of that item.</p>
<p>Here's our <code>Item</code> function:</p><div class="pre-lang" id="premain764788"><div></div><div class="pre-action-link"><span class="code-collapse" data-index="764788" id="preShrink764788">Shrink ▲</span> &nbsp; <span id="copycode764788" class="copy-code" data-index="764788" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre764788" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">STDMETHODIMP Item(ICollection *this, <span class="code-keyword">long</span> index, VARIANT *ret)
{
   IENUMITEM  *item;

   <span class="code-comment">//</span><span class="code-comment"> Assume we have nothing to return.</span>
   ret-&gt;vt = VT_EMPTY;

   <span class="code-comment">//</span><span class="code-comment"> Locate to the item that the caller wants.</span>
   item = (IENUMITEM *)PortsList;
   <span class="code-keyword">while</span> (item &amp;&amp; index--) item = item-&gt;next;

   <span class="code-comment">//</span><span class="code-comment"> Any more items left?</span>
   <span class="code-keyword">if</span> (item)
   {
      <span class="code-comment">//</span><span class="code-comment"> Copy the item's value to the VARIANT that the caller supplied.</span>
      <span class="code-comment">//</span><span class="code-comment"> If what we're returning to the caller is an object, we must AddRef()</span>
      <span class="code-comment">//</span><span class="code-comment"> it on the caller's behalf. The caller is expected to Release() it</span>
      <span class="code-comment">//</span><span class="code-comment"> when done with it. If what we're returning is a BSTR, then we must</span>
      <span class="code-comment">//</span><span class="code-comment"> SysAllocString a copy of it. Caller is expected to SysFreeString it.</span>
      <span class="code-comment">//</span><span class="code-comment"> Other datatypes are simply copied to the caller's VARIANT as is.</span>
      <span class="code-comment">//</span><span class="code-comment"> VariantCopy() does all this for us. It also returns S_OK if all</span>
      <span class="code-comment">//</span><span class="code-comment"> went well.</span>
      <span class="code-keyword">return</span>(VariantCopy(ret, &amp;item-&gt;value));
   }

   <span class="code-comment">//</span><span class="code-comment"> If no more items, return S_FALSE.</span>
   <span class="code-keyword">return</span>(S_FALSE);
}</pre>
<p>As you'll note from the comment above, the OLE function <code>VariantCopy</code> does half the work for us.</p>
<p>For now, we'll gloss over the <code>_NewEnum</code> function. We'll stick in a dummy one that returns <code>E_NOTIMPL</code>.</p>
<p>Once we have all the <code>ICollection</code> functions written, we can statically declare its VTable:</p><div class="pre-lang" id="premain920921"><div></div><div class="pre-action-link"><span id="copycode920921" class="copy-code" data-index="920921" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre920921" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-keyword">static</span> <span class="code-keyword">const</span> ICollectionVtbl ICollectionVTable = 
      {Collection_QueryInterface,
       Collection_AddRef,
       Collection_Release,
       GetTypeInfoCount,
       GetTypeInfo,
       GetIDsOfNames,
       Invoke,
       Count,
       Item,
       _NewEnum};</pre>
<h2><a name="HOW">How</a> an application obtains our collection object</h2>
<p>Let's consider how an application gets hold of one of our <code>MyRealICollection</code> objects. The easiest thing to do is to add another (extra) function to our <code>IExample3</code> object. The application will call this new function to allocate and receive one of our <code>MyRealICollection</code> objects. (But we're going to lie to the application and tell it that it's just an ordinary <code>IDispatch</code>.)</p>
<p>We need to change the definition of <code>IExample3</code>'s VTable (in <i>IExample3.h</i>), to add this new function, which I'll arbitrarily call <code>GetPorts</code>. I'll define it as being passed a handle to an <code>IDispatch</code>, which is where we'll return the pointer to our newly allocated <code>MyRealICollection</code>... er, <code>IDispatch</code>. Yeah, that's it. It's just an <code>IDispatch</code>. Wink, wink. Here's our updated <code>IExample3</code> VTable:</p><div class="pre-lang" id="premain556012"><div></div><div class="pre-action-link"><span class="code-collapse" data-index="556012" id="preShrink556012">Shrink ▲</span> &nbsp; <span id="copycode556012" class="copy-code" data-index="556012" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre556012" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-comment">//</span><span class="code-comment"> IExample3's VTable</span>
<span class="code-preprocessor">#undef  INTERFACE
</span><span class="code-preprocessor">#define INTERFACE IExample3
</span>DECLARE_INTERFACE_ (INTERFACE, IDispatch)
{
    <span class="code-comment">//</span><span class="code-comment"> IUnknown functions</span>
    STDMETHOD  (QueryInterface) (THIS_ REFIID, <span class="code-keyword">void</span> **) PURE;
    STDMETHOD_ (ULONG, AddRef) (THIS) PURE;
    STDMETHOD_ (ULONG, Release) (THIS) PURE;
    <span class="code-comment">//</span><span class="code-comment"> IDispatch functions</span>
    STDMETHOD_ (ULONG, GetTypeInfoCount)(THIS_ UINT *) PURE;
    STDMETHOD_ (ULONG, GetTypeInfo) (THIS_ UINT, LCID, ITypeInfo **) PURE;
    STDMETHOD_ (ULONG, GetIDsOfNames) (THIS_ REFIID, LPOLESTR *, 
                UINT, LCID, DISPID *) PURE;
    STDMETHOD_ (ULONG, Invoke) (THIS_ DISPID, REFIID, LCID, 
                WORD, DISPPARAMS *, VARIANT *, EXCEPINFO *, UINT *) PURE;
    <span class="code-comment">//</span><span class="code-comment"> Extra functions</span>
    STDMETHOD  (SetString) (THIS_ BSTR) PURE;
    STDMETHOD  (GetString) (THIS_ BSTR *) PURE;
    STDMETHOD  (GetPorts) (THIS_ IDispatch **) PURE;  <span class="code-comment">//</span><span class="code-comment"> &lt;--- Added GetPorts here</span>
};</pre>
<p>Notice that I added <code>GetPorts</code> to the end of the VTable. Also notice, I'm specifying that <code>GetPorts</code> will fill in an <code>IDispatch</code> pointer (even though it will really be our <code>MyRealICollection</code>). It's an <code>IDispatch</code>. Honest. Would I lie?</p>
<p>And I have to make the same change in the IDL file for our <code>IExample3</code> VTable:</p><div class="pre-lang" id="premain374248"><div></div><div class="pre-action-link"><span id="copycode374248" class="copy-code" data-index="374248" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre374248" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-bracket">[</span><span class="code-sdkkeyword">uuid</span>(CFADB388-<span class="code-digit">9563</span>-<span class="code-digit">4591</span>-AABB-BE7794AEC17C), dual, 
             oleautomation, hidden, nonextensible]
<span class="code-keyword">interface</span> IExample3VTbl : IDispatch
{
   [helpstring(<span class="code-string">"</span><span class="code-string">Sets the test string."</span>)]
   [id(<span class="code-digit">1</span>), propput] HRESULT Buffer([in] BSTR);
   [helpstring(<span class="code-string">"</span><span class="code-string">Gets the test string."</span>)]
   [id(<span class="code-digit">1</span>), propget] HRESULT Buffer([out, retval] BSTR *);
   [helpstring(<span class="code-string">"</span><span class="code-string">Gets the enumeration for our hardware ports."</span>)]
   [id(<span class="code-digit">2</span>), propget] HRESULT Ports([out, 
           retval] IDispatch **);  <span class="code-comment">//</span><span class="code-comment"> &lt;--- Added GetPorts here</span>
};</pre>
<p>Notice, I made this newly added function a <code>propget</code>, just like <code>Buffer</code>. This is so that a script can use an ordinary assignment instruction to get our <code>MyRealICollection</code>... duh!... <code>IDispatch</code> object. The member is called "<code>Ports</code>" as far as the script is concerned. Never mind that we don't actually have a <code>Ports</code> data member in our <code>IExample3</code> object. This is sort of a phony member. But the script doesn't need to know that.</p>
<p>And, I arbitrarily gave it a DISPID of 2.</p>
<p>Don't forget that we need to add this function to our statically declared <code>IExample3Vtbl</code> in <i>IExample3.c</i>:</p><div class="pre-lang" id="premain855270"><div></div><div class="pre-action-link"><span id="copycode855270" class="copy-code" data-index="855270" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre855270" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-keyword">static</span> <span class="code-keyword">const</span> IExample3Vtbl IExample3_Vtbl = {QueryInterface,
AddRef,
Release,
GetTypeInfoCount,
GetTypeInfo,
GetIDsOfNames,
Invoke,
SetString,
GetString,
GetPorts}; <span class="code-comment">//</span><span class="code-comment"> &lt;--- Added GetPorts here</span></pre>
<p>So, we need to write the <code>GetPorts</code> function:</p><div class="pre-lang" id="premain211282"><div></div><div class="pre-action-link"><span id="copycode211282" class="copy-code" data-index="211282" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre211282" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-keyword">static</span> HRESULT STDMETHODCALLTYPE GetPorts(IExample3 *this, IDispatch **portsObj)
{
   <span class="code-comment">//</span><span class="code-comment"> Create an IDispatch to enumerate our port names.</span>
   <span class="code-comment">//</span><span class="code-comment"> Caller is responsible for Release()'ing</span>
   <span class="code-comment">//</span><span class="code-comment"> it. NOTE: We're really returning a MyRealICollection,</span>
   <span class="code-comment">//</span><span class="code-comment"> but the caller doesn't know that.</span>
   <span class="code-comment">//</span><span class="code-comment"> He thinks we're returning an IDispatch,</span>
   <span class="code-comment">//</span><span class="code-comment"> which is ok because a MyRealICollection's</span>
   <span class="code-comment">//</span><span class="code-comment"> VTable starts with the 3 IUnknown functions</span>
   <span class="code-comment">//</span><span class="code-comment"> followed by the 4 IDispatch functions, just</span>
   <span class="code-comment">//</span><span class="code-comment"> like a real IDispatch object's VTable</span>
   <span class="code-keyword">if</span> (!(*portsObj = allocPortsCollection()))
      <span class="code-keyword">return</span>(E_OUTOFMEMORY);
}</pre>
<p>The above simply calls another helper function (named <code>allocPortsCollection</code>) we'll put in <i>PortNames.c</i>. This helper function does the work of <code>GlobalAlloc</code>'ing a <code>MyRealICollection</code> and initializing it. It's fairly similar to how our <code>IClassFactory</code>'s <code>CreateInstance</code> <code>GlobalAlloc</code>s an <code>IExample3</code> and initializes it. We even bump up the count of outstanding objects because our <code>MyRealICollection</code>... er, <code>IDispatch</code> object is going to be given to some application (which is expected to later <code>Release</code> it).</p><div class="pre-lang" id="premain15061"><div></div><div class="pre-action-link"><span class="code-collapse" data-index="15061" id="preShrink15061">Shrink ▲</span> &nbsp; <span id="copycode15061" class="copy-code" data-index="15061" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre15061" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">IDispatch * allocPortsCollection(<span class="code-keyword">void</span>)
{
   MyRealICollection *collection;

   <span class="code-comment">//</span><span class="code-comment"> Allocate a MyRealICollection</span>
   <span class="code-keyword">if</span> ((collection = (MyRealICollection *)GlobalAlloc(
                      GMEM_FIXED, <span class="code-keyword">sizeof</span>(MyRealICollection))))
   {
      <span class="code-comment">//</span><span class="code-comment"> Store its VTable</span>
      collection-&gt;lpVtbl = (ICollectionVtbl *)&amp;ICollectionVTable;

      <span class="code-comment">//</span><span class="code-comment"> AddRef it</span>
      collection-&gt;count = <span class="code-digit">1</span>;

      <span class="code-comment">//</span><span class="code-comment"> Indicate another outstanding object since we'll be returning it</span>
      <span class="code-comment">//</span><span class="code-comment"> to an application which is expected to Release() it</span>
      InterlockedIncrement(&amp;OutstandingObjects);
   }

   <span class="code-comment">//</span><span class="code-comment"> Return it as if it were an IDispatch (which it can be used as)</span>
   <span class="code-keyword">return</span>((IDispatch *)collection);
}</pre>
<p>We're done. You can compile the <i>IExample3.dll</i>. To register it, just take <code>IExample2</code>'s register utility (<i>RegIExample2</i>) and replace every "IExample2" with "IExample3". After all, there is nothing about <code>IExample3</code> which requires us to register it any differently than <code>IExample2</code>. Likewise, to un-register it, modify <code>IExample2</code>'s un-register utility (<i>UnregIExample2</i>).</p>
<h2><a name="VB1">A</a> VBScript example</h2>
<p>Let's write a VBScript example that uses our collection to display the port names. I've written such an example (<i>IExample3.vbs</i>), and placed it in the <i>IExample3</i> directory.</p>
<p>Of course, the VBScript needs to first call <code>CreateObject</code> to get one of our <code>IExample3</code> objects. If you installed it properly, it should have a ProdID of "<code>IExample3.object</code>". Now that the script has our <code>IExample3</code>, it can simply access that phony "<code>Ports</code>" member to get one of our <code>MyRealICollection</code>... damn!... <code>IDispatch</code> objects to use. Here, we assign it to a variable named "<code>coll</code>".</p><div class="pre-lang" id="premain421029"><div>VBScript</div><div class="pre-action-link"><span id="copycode421029" class="copy-code" data-index="421029" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre421029" style="margin-top:0;" class="lang-vbscript notranslate" data-language="vbscript" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true"><span class="code-keyword">Set</span> coll = myObj.Ports</pre>
<p>Next, we can call the <code>Count</code> function to determine how many port names there are. Actually, because our type library defined this function as <code>propget</code>, the script can use an assignment.</p><div class="pre-lang" id="premain70674"><div>VBScript</div><div class="pre-action-link"><span id="copycode70674" class="copy-code" data-index="70674" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre70674" style="margin-top:0;" class="lang-vbscript notranslate" data-language="vbscript" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true">count = coll.Count</pre>
<p>Now, we loop around, calling the <code>Item</code> function to get each port name, and display it:</p><div class="pre-lang" id="premain345719"><div>VBScript</div><div class="pre-action-link"><span id="copycode345719" class="copy-code" data-index="345719" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre345719" style="margin-top:0;" class="lang-vbscript notranslate" data-language="vbscript" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true"><span class="code-keyword">For</span> i = <span class="code-digit">0</span> To count - <span class="code-digit">1</span>
   MsgBox coll.Item(i)
<span class="code-keyword">Next</span></pre>
<p>And, that's it.</p>
<h2><a name="C1">A</a> C example</h2>
<p>For a C/C++ application to use our collection object, it needs to call our <code>Count</code> and <code>Item</code> functions indirectly, through the <code>Invoke</code> function. Hold on to your seats because this is going to be a bumpy ride. The MS Visual Basic programmers designed the <code>IDispatch</code>
 functions to be passed arguments, and return values, such that those 
folks could easily add COM support to VB and get it out the door 
quickly. But they didn't give any concern to how easy it would be to 
utilize the <code>IDispatch</code> functions from any other language. It's a major pain in the butt from C/C++.</p>
<p>In the directory <i>IExample3App</i>, is an example C application that does just what the VBScript above does. It obtains our <code>Ports</code> collection object, and uses it to display the names of all ports. I'm not going to discuss how the C app gets our <code>IExample3</code> object. That is exactly the same as how it gets an <code>IExample2</code> object (except we <code>#include IExample3.h</code>, and use the <code>IExample3</code> object's GUID).</p>
<p>The main point of interest begins where we call our <code>IExample3</code>'s <code>GetPorts</code> function to get our <code>MyRealICollection</code>... *cough*... <code>IDispatch</code> object. That starts where I put the following comment (in <i>IExample3App.c</i>):</p><div class="pre-lang" id="premain332972"><div></div><div class="pre-action-link"><span id="copycode332972" class="copy-code" data-index="332972" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre332972" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-comment">//</span><span class="code-comment"> STUDY THIS</span></pre>
<p>Peruse all of that code and read the comments. They detail the steps you need to jump though to use <code>IDispatch</code>
 functions from C/C++. Then, take an MS Visual Basic programmer out to 
lunch to "thank" him, and slip lots of hot pepper into his food when he 
isn't looking.</p>
<h2><a name="ENUM">An</a> IEnumVARIANT object</h2>
<p>If we look at the following lines in our <code>Item</code> function, something may alarm us:</p><div class="pre-lang" id="premain242214"><div></div><div class="pre-action-link"><span id="copycode242214" class="copy-code" data-index="242214" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre242214" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-comment">//</span><span class="code-comment"> Locate to the item that the caller wants.</span>
item = (IENUMITEM *)PortsList;
<span class="code-keyword">while</span> (item &amp;&amp; index--) item = item-&gt;next;</pre>
<p>Every time someone calls our <code>Item</code> function, we have to 
start at the head of the list and search to the desired item. Assume we 
have 30,000 items in the list. Say, an application asks us to fetch item
 28,000. We have to walk through 27,000 items before we get to the 
desired item. Now, let's say the application calls <code>Item</code> 
again to request item 29,000. Even though it's only one more link away, 
we start all over from the head of the list and walk though the 28,000 
items. Obviously, this isn't very efficient.</p>
<p>We could perhaps add another data member to our <code>MyRealICollection</code>.
 This member would store the "position" where we last left off in the 
list. Microsoft thought about this, and then decided, instead of 
monkey-ing around with the collection object (which really isn't 
designed to be efficiently called from C/C++ anyway, thanks to VB 
developers), a second standard COM object, called an <code>IEnumVARIANT</code>, would be defined. The main purpose of an <code>IEnumVARIANT</code>
 is to store the current position that an application has "read from" 
within the list. But given how inefficient and troublesome it is for a 
C/C++ app to call our collection's <code>Item</code> function indirectly via <code>Invoke</code>, MS decided to have some functions in the <code>IEnumVARIANT</code> that an app can <b>directly</b> call to do what we previously did with the collection's <code>Item</code> function... and more. Specifically, an <code>IEnumVARIANT</code> has four functions in it (plus the three <code>IUnknown</code> functions, of course) named <code>Next</code>, <code>Skip</code>, <code>Reset</code>, and <code>Clone</code>.</p>
<ul>
<li>The <code>IEnumVARIANT</code>'s <code>Next</code> function makes our collection object's <code>Item</code> function superfluous. With a single call to <code>Next</code>, an app can return the values of several items at once (by supplying a count of how many items to return, and an array of <code>VARIANT</code>s to store all the values). So, an app could call <code>Next</code> to read four items. On the next call to <code>Next</code>, our <code>IEnumVARIANT</code> will automatically start reading at the fifth item in the list, and return however many values the app requests. 
</li><li>The <code>IEnumVARIANT</code>'s <code>Reset</code> simply resets the position back to the start of the list. 
</li><li>The <code>IEnumVARIANT</code>'s <code>Skip</code> sets the 
position to a particular point (i.e., it's analogous to seeking within a
 disk file, except, here it sets the position within our list). 
</li><li>The <code>IEnumVARIANT</code>'s <code>Clone</code> allocates (and returns to the app) another <code>IEnumVARIANT</code> object whose position is the same as the <code>IEnumVARIANT</code>
 being cloned. This is used in case an app wants to nest loops where 
it's necessary to remember more than one position in a particular list. </li></ul>
<p>Microsoft has already defined (in an include file that ships with your compiler) an <code>IEnumVARIANT</code>
 object and its VTable (i.e., Microsoft has already decided what 
functions are in the VTable, what those functions are passed, and what 
they return). So, we don't need to do that. But like with all the 
objects we've created so far, we need to add a couple extra data members
 to our <code>IEnumVARIANT</code>. So once again, we'll define a <code>MyRealIEnumVariant</code> that has these extra members.</p>
<p>But before we modify our <code>IExample3</code> sources, let's again make a new directory named <i>IExample4</i>.
 We'll do that thing where we copy the sources to this new directory, 
and rename/edit them. Search and replace "IExample3" with "IExample4". 
Run <i>GUIDGEN.EXE</i> to create new GUIDs, and put them in <i>IExample4.h</i>, <i>PortNames.h</i>, and <i>IExample4.idl</i>. Once again, I've done this for you, and created an <i>IExample4</i> directory with the new files.</p>
<p>In <i>PortNames.c</i>, we'll add the definition of our <code>MyRealIEnumVariant</code> object, write all its functions, and statically declare its VTable. This all done starting at the comment:</p><div class="pre-lang" id="premain345832"><div></div><div class="pre-action-link"><span id="copycode345832" class="copy-code" data-index="345832" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre345832" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-comment">//</span><span class="code-comment">==============================================================</span>
<span class="code-comment">//</span><span class="code-comment">=================== IEnumVARIANT functions ===================</span>
<span class="code-comment">//</span><span class="code-comment">==============================================================</span></pre>
<p>In fact, you should now be quite familiar with what its <code>QueryInterface</code>, <code>AddRef</code>, and <code>Release</code>
 functions do. And the other four functions are rather trivial, so you 
can peruse the source code comments to get details about those 
functions.</p>
<p>The real question is <i>"How does an app get hold of one of my <code>IEnumVARIANT</code> objects?"</i>. Remember before, how we ignored our collection object's <code>_NewEnum</code> function, and just had it return <code>E_NOTIMPL</code>? Well, guess what. That's the function an app calls to get one of our <code>IEnumVARIANT</code> objects, so now we have to write some real code for it.</p>
<p>In other words, to get one of our <code>IEnumVARIANT</code>s, the app must first get our <code>IExample4</code> object, call our <code>IExample4</code>'s <code>GetPorts</code> function to get our collection object, and then call our collection's <code>_NewEnum</code> function to get an <code>IEnumVARIANT</code>. It's not the short way home, but that's how it works. Some bad news: a C/C++ app can't directly call our collection's <code>_NewEnum</code> function. Just like with our collection's <code>Count</code> and <code>Item</code> functions, a C/C++ app has to indirectly call <code>_NewEnum</code> through <code>Invoke</code>. Blech. The good news is that, once our C/C++ app has the <code>IEnumVARIANT</code>, the collection object can be <code>Release()</code>d and we're done with that latter aberration.</p>
<p>So, let's examine our collection's <code>_NewEnum</code> function:</p><div class="pre-lang" id="premain259971"><div></div><div class="pre-action-link"><span id="copycode259971" class="copy-code" data-index="259971" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre259971" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">STDMETHODIMP _NewEnum(ICollection *this, IUnknown **enumObj)
{
   IEnumVARIANT *enumVariant;

   <span class="code-keyword">if</span> (!(enumVariant = allocIEnumVARIANT())) <span class="code-keyword">return</span>(E_OUTOFMEMORY);
   *enumObj = (IUnknown *)enumVariant;
   <span class="code-keyword">return</span>(S_OK);
}</pre>
<p>This just calls our helper function named <code>allocIEnumVARIANT</code> which allocates and initializes our <code>IEnumVARIANT</code> (actually, a <code>MyRealIEnumVariant</code>) much like how our <code>IClassFactory</code>'s <code>CreateInstance</code> allocates our <code>IExample4</code> object, or our <code>IExample4</code>'s <code>GetPorts</code> function allocates our collection object. There's really nothing new here.</p>
<p>But notice that <code>_NewEnum</code> asks the app to pass a handle where we return an <code>IUnknown</code> object -- not an <code>IEnumVARIANT</code>. Yes, it's true that we're really returning our <code>IEnumVARIANT</code>, but it is masquerading as an <code>IUnknown</code> object, and it can do that because its VTable starts with the three <code>IUnknown</code> functions.</p>
<p><i>"But why masquerade? Didn't you just say that <code>_NewEnum</code> is used to get hold of our <code>IEnumVARIANT</code>?"</i></p>
<p>Yes... in a roundabout manner. [Cue scary monster movie soundtrack.]</p>
<p>In a previous article, I alluded to the fact that a COM object could 
actually have many VTables inside of it. We say that such an object has 
"multiple interfaces". Microsoft decided that <code>_NewEnum</code> should be able to pass back an object that could have multiple interfaces, and the <code>IEnumVARIANT</code>
 may be just one of many VTables in it (and not even the first VTable in
 the object). So, what an app is expected to do is take this <code>IUnknown</code> object we give it, and call that object's <code>QueryInterface</code>, passing the GUID for an <code>IEnumVARIANT</code> (<code>IID_IEnumVARIANT</code>, which is defined in Microsoft's include files for us). And then, <code>QueryInterface</code> will return a pointer to the <code>IEnumVARIANT</code> VTable (i.e., essentially, the <code>IEnumVARIANT</code> embedded inside of whatever object that <code>IUnknown</code> object really is -- because you just know it's something else masquerading as an <code>IUnknown</code>).</p>
<p>In our case, the app is going to call our <code>IEnumVARIANT</code>'s <code>QueryInterface</code>, asking us for an <code>IEnumVARIANT</code>.
 And, we're just going to return the same pointer again. Totally 
unnecessary. Inefficient. Illogical. But, that's sometimes how COM is 
when you've got parts of it that are designed by MS VB developers (who 
had a vested interest in making the whole <code>IDispatch</code> thing a
 lot like how VB internally calls its own built-in functions, thus 
minimizing their work, and foisting this design on everyone else 
regardless of how inconvenient and unwieldy that can be), and other 
programmers who wanted to use things like multiple interfaces (which a 
VBScript can't even directly use -- talk about a comedy of errors).</p>
<p>Anyway, we've got our <code>IEnumVARIANT</code> support done, so we can compile <i>IExample4.dll</i>. To register it, once again, you can modify <i>RegIExample2.c</i>, searching and replacing "IExample2" with "IExample4".</p>
<h2><a name="VB2">Another</a> VBScript example</h2>
<p>A VBScript can absolutely not call our collection's <code>_NewEnum</code> function (because this may return an object with multiple interfaces that need to be <code>QueryInterface</code>d -- and a VBScript can't deal with such an object). So, a VBScript cannot obtain our <code>IEnumVARIANT</code> and call its functions.</p>
<p>Does this mean an <code>IEnumVARIANT</code> is useless to a VBScript? Nope. The VBScript engine can itself use our <code>IEnumVARIANT</code>. When does the engine do that? When the script uses a <code>For Each</code> loop to enumerate the items in our collection. In the directory <i>IExample4</i> is a VBScript named <i>IExample4.vbs</i> which uses such a <code>For Each</code> loop. This is a slightly different way for the script to do the same thing that <i>IExample3.vbs</i> did, but it's more efficient under-the-hood (because the engine uses our <code>IEnumVARIANT</code>'s <code>Next</code> function, instead of the VBScript using our collection object's <code>Item</code>
 function). And, it's slightly less coding on the part of the script 
because the engine retrieves the item's value on behalf of the script. 
Here's how it's done:</p><div class="pre-lang" id="premain559263"><div>VBScript</div><div class="pre-action-link"><span id="copycode559263" class="copy-code" data-index="559263" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre559263" style="margin-top:0;" class="lang-vbscript notranslate" data-language="vbscript" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true"><span class="code-keyword">set</span> myObj = <span class="code-keyword">CreateObject</span>(<span class="code-string">"</span><span class="code-string">IExample4.object"</span>)
<span class="code-keyword">Set</span> coll = myObj.Ports
<span class="code-keyword">For</span> <span class="code-keyword">Each</span> elem In coll
   MsgBox elem
<span class="code-keyword">Next</span></pre>
<p>The first two lines are the same as <i>IExample3.vbs</i> (except that we use the ProdID for <i>IExample4.dll</i> now).</p>
<p>But the loop is different. When the VBScript engine executes that <code>For Each</code> line, it gets hold of our <code>IEnumVARIANT</code> (by calling our collection's <code>_NewEnum</code>, and doing a <code>QueryInterface</code> for <code>IID_IEnumVARIANT</code>). It stores away this <code>IEnumVARIANT</code> internally so it can be used on subsequent iterations of the loop. Then, it calls our <code>IEnumVARIANT</code>'s <code>Next</code> function, asking for an item's value to be returned. Of course, the first time <code>Next</code>
 is called, we return the port name for the first item (i.e., the string
 "Port 1"). The VB engine stuffs this string into the variable "<code>elem</code>". This is all done in that one VBScript instruction. Now, the script simply displays the value of "<code>elem</code>" (which is the string "Port 1"). On the next iteration of the loop, the VB engine once again calls our <code>IEnumVARIANT</code>'s <code>Next</code> function, asking for one more item's value. This is the second time <code>Next</code> has been called, so of course, we return the second item's value, which is the string "Port 2". The VB engine now updates the <code>elem</code> variable to this new value. And the script displays "Port 2". This continues on until the VB engine calls our <code>IEnumVARIANT</code>'s <code>Next</code>, and we have no more items to return. At that point, <code>Next</code> returns <code>S_FALSE</code> (instead of <code>S_OK</code>) to the engine. And, the engine drops out of the loop (and <code>Release</code>s our <code>IEnumVARIANT</code>).</p>
<h2><a name="C2">Another</a> C example</h2>
<p>In the directory <i>IExample4App</i>, there is a C example that demonstrates how to get and use our <code>IEnumVARIANT</code>. We still have to mess with the collection object and its <code>Invoke</code>. But at least, the loop is more efficient. And the whole thing is less involved than using the collection object's <code>Item</code> function.</p>
<h2><a name="GENERIC">A</a> more generic approach</h2>
<p>If you look at the <code>IEnumVARIANT</code> and the collection functions in <i>PortName.c</i>, you'll see that these are hard-wired to work upon only our list of port names (i.e., <code>PortsList</code>). But with a small bit of retooling, we can rewrite those functions to work upon any linked list of <code>IENUMITEM</code>s
 we throw at them. In other words, we can make these functions generic, 
so if our component needs to maintain several different types of lists, 
we can more easily provide further collection and <code>IEnumVARIANT</code> objects that reuse these same functions without any further modification. So, let's separate just the <code>IEnumVARIANT</code> and the collection functions into a new, separate source file named <i>IEnumVariant.c</i>. The only stuff we'll leave in <i>PortNames.c</i> is the code that specifically accesses our <code>PortsList</code>.</p>
<p>But first, we'll do that thing where we create a new <i>IExample5</i> directory, copy the files there, and rename/edit them. You should know the routine by now. I've done the work, and created an <i>IExample5</i> directory.</p>
<p>Instead of simply declaring a global variable that is the list itself, we'll wrap the list in another struct we'll call a <code>IENUMLIST</code>, as so:</p><div class="pre-lang" id="premain372249"><div></div><div class="pre-action-link"><span id="copycode372249" class="copy-code" data-index="372249" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre372249" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">typedef <span class="code-keyword">struct</span> {
   <span class="code-keyword">struct</span> _IENUMITEM *head;
   DWORD             count;
} IENUMLIST;</pre>
<p>The <code>head</code> member is where the list is stored. And we've added a <code>count</code> field that will be incremented each time we create another collection or <code>IEnumVARIANT</code> object that uses this particular list.</p>
<p>Now, we change our <code>PortsList</code> global to this new struct:</p><div class="pre-lang" id="premain10126"><div></div><div class="pre-action-link"><span id="copycode10126" class="copy-code" data-index="10126" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre10126" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">IENUMLIST    PortsList;</pre>
<p>The key to making our collection and <code>IEnumVARIANT</code> functions more generic is adding an extra data member to our <code>MyRealIEnumVariant</code> and <code>MyRealICollection</code> objects. We'll add a member to our <code>MyRealICollection</code> that holds a pointer to the <code>IENUMLIST</code> it should operate upon. And, we'll write a new helper function that will allocate a <code>MyRealICollection</code> object. This helper function will be passed that <code>IENUMLIST</code> pointer, and will store it in this new data member added to our <code>MyRealICollection</code>. I've written such a function (<code>allocICollection</code>) and put it in <i>IEnumVariant.c</i>. It's passed a pointer to whatever <code>IENUMLIST</code> we want our collection object to operate upon.</p>
<p>We'll also add a data member to our <code>MyRealIEnumVariant</code>. It will do the same thing as the new data member added to our <code>MyRealICollection</code> (i.e., hold a pointer to the <code>IENUMLIST</code> that our <code>IEnumVARIANT</code> operates upon).</p>
<p>Other changes are trivial, but what we're left with in <i>PortNames.c</i> is just a little bit of code to create and delete our <code>PortsList</code>, and to create a collection object specifically to wrap <code>PortsList</code>.</p>
<p>To create another list, and add support for a collection and <code>IEnumVARIANT</code> objects, all we need do is create another source file, much like what is in <i>PortNames.c</i>. In fact, let's do this.</p>
<p>Let's assume that we want to create a list of network cards in a 
system. And for each network card, we want to provide two pieces of 
information: the name of the network card, and its MAC address. We'll 
put the code in <i>NetCards.c</i> and <i>NetCards.h</i>.</p>
<p>We want to return more than one piece of information per item. (I.e., each <code>IENUMITEM</code>
 will pertain to a single network card. And for each network card, we 
want to let the script know the card's name and its MAC address.) The 
best way to approach this is to create a "sub-object" which we'll 
arbitrarily call a <code>INetwork</code> object. We'll put two functions in this object, <code>Name</code> and <code>Address</code>. The <code>Name</code> function will return a <code>BSTR</code> of the network card's name, and the <code>Address</code> function will return a <code>BSTR</code> of the MAC address.</p>
<p>We're going to create an <code>INetwork</code> object for each network card in the computer. Then, we're going to create an <code>IENUMITEM</code> in our list for that card. We'll stuff the <code>INetwork</code> pointer into the <code>IENUMITEM</code> <code>VARIANT</code>'s <code>punkVal</code> field, and set the <code>vt</code> field to <code>VT_DISPATCH</code>. This list of <code>IENUMITEM</code>s (containing <code>INetwork</code> objects) is created in <code>allocNetworkObjectsCollection</code> (in <i>NetCards.c</i>).</p>
<p>In order to be accessible from VBScript, we'll need to include the <code>IDispatch</code> functions in our <code>INetwork</code>'s VTable. Of course, this means that we'll need an <code>ITypeInfo</code> for our <code>INetwork</code>'s VTable. So, we'll have to generate a new GUID for its VTable. And, we'll have to call <code>GetTypeInfoOfGuid</code>, passing that new GUID, to get an <code>ITypeInfo</code> for it. We'll save this in a global variable named <code>NetTypeInfo</code>. All this code is in <i>NetCards.c</i>. This code should look remarkably similar to what you saw with our collection and <code>IExample5</code> objects, because those also have <code>IDispatch</code> functions and need their <code>ITypeInfo</code> objects.</p>
<p>And to make our <code>INetwork</code>'s extra functions (i.e., <code>Name</code> and <code>Address</code>) directly callable from C/C++, we'll need to declare its VTable as "<code>dual</code>" in our IDL file. We'll also have to include its VTable definition in <i>IExample5.h</i> so a C/C++ app knows exactly what order and arguments those extra functions involve. I've added the definition of our <code>INetwork</code>'s VTable to both <i>IExample5.h</i> and <i>IExample5.idl</i>. Note that it looks remarkably similar to our <code>IExample5</code> object. Both contain <code>IDispatch</code> functions. Both are declared <code>dual</code>. Their only differences are in their extra functions. But like our <code>IEnumVARIANT</code> object, our <code>INetwork</code> object itself doesn't need to be declared in our IDL. Only its VTable needs to be declared. After all, our <code>INetwork</code> is going to look like a standard <code>IDispatch</code> object to an app, except that its extra functions <b>will</b> be in its VTable, and a C/C++ app can call them directly.</p>
<p>By giving our <code>IENUMLIST</code> a <code>count</code> field, we can determine when all the collection and <code>IEnumVARIANT</code>
 objects are done with its list, and therefore delete the list whenever 
we want. (I.e., unlike the previous example, we aren't restricted to 
deleting the list only when our DLL terminates.) In fact, you'll notice 
that we don't actually create our list of <code>INetwork</code> objects until an app actually asks us for our collection of network cards. And then, we delete the list of <code>INetwork</code> objects as soon as the last collection/<code>IEnumVARIANT</code> using that list is <code>Release()</code>d.</p>
<p>In the <i>IExample5</i> directory is a VBScript example that does a <code>For Each</code> loop to gain access to each one of our <code>INetwork</code> objects, and then calls the <code>Name</code> and <code>Address</code> functions to display the card's name and MAC address.</p>
<h2><a name="ADD">Add/Remove</a> items</h2>
<p>Sometimes, we may want to give a script/app the ability to add or 
remove items from our list. The traditional approach for this is to put <code>Add</code> and <code>Remove</code>
 functions in our collection object. Because each list may contain 
different kinds of items, requiring different kinds of data, you'll have
 to define another collection object specific to a particular list. 
You'll define its VTable, and put these extra two functions (<code>Add</code> and <code>Remove</code>) in it. The <code>Add</code>
 function will have to be written so that the script/app can pass in 
whatever data is needed to create the new item. (And, the function may 
first search the list to see if there's already a matching item, so that
 duplicate items are avoided). The <code>Remove</code> function should be passed some arg(s) that allow you to locate the desired item to delete.</p>
<p>Of course, you'll need to generate a GUID for this new collection's VTable. And, you'll need to create an <code>ITypeInfo</code> for it by passing its GUID to <code>GetTypeInfoOfGuid</code>, and storing the <code>ITypeInfo</code> in a global that is used by <code>Invoke</code>, <code>GetTypeInfo</code>, and <code>GetIDsOfNames</code>.</p>
<p>The good news is that you can use many of the same functions (in <i>IEnumVariant.c</i>) that our original collection (<code>ICollection</code>) and <code>IEnumVARIANT</code> uses. So, there is not as much new code to write as you may expect.</p>


						</div>
						

						
						<h2>License</h2>
						<div id="LicenseTerms"><p>This article, along with any associated source code and files, is licensed under <a href="http://www.codeproject.com/info/cpol10.aspx" rel="license">The Code Project Open License (CPOL)</a></p></div>
						

						
						<br>
						
						    

<div class="author-wrapper">

    <div class="desktop-only tablet-only" style="position:absolute; top:-30px;right:20px">
        <img id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberPhoto" class="profile-pic" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/member_unknown.gif" style="border-width:0px;transform:rotate(1deg);">
    </div>

    <div style="padding-right:100px">
        <div class="subdue" style="margin-bottom:7px">Written By</div>

        <div class="container-member">
             <b><a id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberProfileLink" class="author" href="https://www.codeproject.com/Members/Jeff-Glatt">Jeff Glatt</a></b>
        </div>

        <div class="company text-nowrap">
            <span id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberJobTitle"></span>
	        <span id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberCompany"></span>
        </div>

        <div class="text-nowrap">
            <span id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberLocation"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/US.gif" alt="United States" width="16" height="11">&nbsp;United States</span>
        </div>
    </div>

</div>

<div class="description" style="padding-top:1rem">
    This member has not yet provided a Biography. Assume it's 
interesting and varied, and probably something to do with programming.
</div>

<div id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_SocialRow" class="follow flex-container flex-extend" style="margin-top:20px">
    <div class="flex-item">
        
    </div>
    <div class="flex-item-tight" style="margin-right:25px">
        
    </div>
</div>

<br>
						
						

						<div class="clearfix"></div>

						<div style="padding-top:8px">
							
						</div>

					

				    
					</form>

				</div>

				
				<div class="bottom-promo"> 
				    <div class="msg-728x90" data-format="728x90" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="Programming-LanguagesVBScript" data-country="US" data-loadonview="true" data-tags="C++, C, VBScript, Windows, Visual-Studio, Dev, COM, Beginner,rating4.5,pos_bottom"><noscript><a href="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Programming-LanguagesVBScript&sz=728x90&c=778894"><img src="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Programming-LanguagesVBScript&sz=728x90&c=778894"  width="728px" height="90px" target="_blank"/></a></noscript></div>
				</div>
				
                
                

				
				

					<h2 class="padded-top">Comments and Discussions</h2>

                    
			        <div id="ctl00_SharePH" class="share-list float-right desktop-only tablet-only" style="margin-top:-3.5rem">
				        

    <ul class="rrssb-buttons clearfix rrssb-1">
        <li id="ctl00_SocialLike_Email" class="email compact">
            <a href="mailto:?subject=COM%20in%20plain%20C%2c%20Part%203%20-%20CodeProject&amp;body=Here%27s%20an%20interesting%20article%20on%20for%20you%20on%20codeproject.com%0a%0aCOM%20collections%20in%20C%0a%0ahttps%3a%2f%2fwww.codeproject.com%2fArticles%2f14037%2fCOM-in-plain-C-Part-3%0a">
                <span class="icon">
                    <svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                        <g>
                            <path d="M20.111 26.147c-2.336 1.051-4.361 1.401-7.125 1.401c-6.462 0-12.146-4.633-12.146-12.265 
                                c0-7.94 5.762-14.833 14.561-14.833c6.853 0 11.8 4.7 11.8 11.252c0 5.684-3.194 9.265-7.399 
                                9.3 c-1.829 0-3.153-0.934-3.347-2.997h-0.077c-1.208 1.986-2.96 2.997-5.023 2.997c-2.532 
                                0-4.361-1.868-4.361-5.062 c0-4.749 3.504-9.071 9.111-9.071c1.713 0 3.7 0.4 4.6 0.973l-1.169 
                                7.203c-0.388 2.298-0.116 3.3 1 3.4 c1.673 0 3.773-2.102 3.773-6.58c0-5.061-3.27-8.994-9.303-8.994c-5.957 
                                0-11.175 4.673-11.175 12.1 c0 6.5 4.2 10.2 10 10.201c1.986 0 4.089-0.43 5.646-1.245L20.111 
                                26.147z M16.646 10.1 c-0.311-0.078-0.701-0.155-1.207-0.155c-2.571 0-4.595 2.53-4.595 5.529c0 
                                1.5 0.7 2.4 1.9 2.4 c1.441 0 2.959-1.828 3.311-4.087L16.646 10.068z"></path>
                        </g>
                    </svg>
                </span>
                
            </a>
        </li><li id="ctl00_SocialLike_Twitter" class="twitter compact">
            <a href="http://twitter.com/home?status=COM+in+plain+C%2c+Part+3+-+CodeProject+-+https%3a%2f%2fwww.codeproject.com%2fArticles%2f14037%2fCOM-in-plain-C-Part-3" class="popup">
                <span class="icon">
                    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                    <path d="M24.253,8.756C24.689,17.08,18.297,24.182,9.97,24.62c-3.122,0.162-6.219-0.646-8.861-2.32
                        c2.703,0.179,5.376-0.648,7.508-2.321c-2.072-0.247-3.818-1.661-4.489-3.638c0.801,0.128,1.62,0.076,2.399-0.155
                        C4.045,15.72,2.215,13.6,2.115,11.077c0.688,0.275,1.426,0.407,2.168,0.386c-2.135-1.65-2.729-4.621-1.394-6.965
                        C5.575,7.816,9.54,9.84,13.803,10.071c-0.842-2.739,0.694-5.64,3.434-6.482c2.018-0.623,4.212,0.044,5.546,1.683
                        c1.186-0.213,2.318-0.662,3.329-1.317c-0.385,1.256-1.247,2.312-2.399,2.942c1.048-0.106,2.069-0.394,3.019-0.851
                        C26.275,7.229,25.39,8.196,24.253,8.756z"></path>
                    </svg>
                </span>
                
            </a>
        </li><li id="ctl00_SocialLike_Facebook" class="facebook compact">
            
            <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.codeproject.com%2fArticles%2f14037%2fCOM-in-plain-C-Part-3" class="popup">
                <span class="icon">
                    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                        <path d="M27.825,4.783c0-2.427-2.182-4.608-4.608-4.608H4.783c-2.422,0-4.608,2.182-4.608,4.608v18.434
                            c0,2.427,2.181,4.608,4.608,4.608H14V17.379h-3.379v-4.608H14v-1.795c0-3.089,2.335-5.885,5.192-5.885h3.718v4.608h-3.726
                            c-0.408,0-0.884,0.492-0.884,1.236v1.836h4.609v4.608h-4.609v10.446h4.916c2.422,0,4.608-2.188,4.608-4.608V4.783z"></path>
                    </svg>
                </span>
                
            </a>
        </li><li id="ctl00_SocialLike_LinkedIn" class="linkedin compact">
            <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.codeproject.com%2fArticles%2f14037%2fCOM-in-plain-C-Part-3&amp;title=COM+in+plain+C%2c+Part+3+-+CodeProject&amp;summary=COM+collections+in+C&amp;source=codeproject.com" class="popup">
                <span class="icon">
                    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                        <path d="M25.424,15.887v8.447h-4.896v-7.882c0-1.979-0.709-3.331-2.48-3.331c-1.354,0-2.158,0.911-2.514,1.803
                            c-0.129,0.315-0.162,0.753-0.162,1.194v8.216h-4.899c0,0,0.066-13.349,0-14.731h4.899v2.088c-0.01,0.016-0.023,0.032-0.033,0.048
                            h0.033V11.69c0.65-1.002,1.812-2.435,4.414-2.435C23.008,9.254,25.424,11.361,25.424,15.887z M5.348,2.501
                            c-1.676,0-2.772,1.092-2.772,2.539c0,1.421,1.066,2.538,2.717,2.546h0.032c1.709,0,2.771-1.132,2.771-2.546
                            C8.054,3.593,7.019,2.501,5.343,2.501H5.348z M2.867,24.334h4.897V9.603H2.867V24.334z"></path>
                    </svg>
                </span>
                
            </a>
        </li><li id="ctl00_SocialLike_Reddit" class="reddit compact">
            <a href="http://www.reddit.com/submit?url=https%3a%2f%2fwww.codeproject.com%2fArticles%2f14037%2fCOM-in-plain-C-Part-3&amp;title=COM+in+plain+C%2c+Part+3+-+CodeProject">
                <span class="icon">
                    <svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve"><g>
                    <path d="M11.794 15.316c0-1.029-0.835-1.895-1.866-1.895c-1.03 0-1.893 0.865-1.893 1.895s0.863 1.9 1.9 1.9 C10.958 17.2 11.8 16.3 11.8 15.316z"></path>
                    <path d="M18.1 13.422c-1.029 0-1.895 0.864-1.895 1.895c0 1 0.9 1.9 1.9 1.865c1.031 0 1.869-0.836 1.869-1.865 C19.969 14.3 19.1 13.4 18.1 13.422z"></path>
                    <path d="M17.527 19.791c-0.678 0.678-1.826 1.006-3.514 1.006c-0.004 0-0.009 0-0.014 0c-0.004 0-0.01 0-0.015 0 
                    c-1.686 0-2.834-0.328-3.51-1.005c-0.264-0.265-0.693-0.265-0.958 0c-0.264 0.265-0.264 0.7 0 1 c0.943 0.9 2.4 1.4 
                    4.5 1.402c0.005 0 0 0 0 0c0.005 0 0 0 0 0c2.066 0 3.527-0.459 4.47-1.402 c0.265-0.264 0.265-0.693 0.002-0.958C18.221 
                    19.5 17.8 19.5 17.5 19.791z"></path><path d="M27.707 13.267c0-1.785-1.453-3.237-3.236-3.237c-0.793 0-1.518 0.287-2.082 
                    0.761c-2.039-1.295-4.646-2.069-7.438-2.219 l1.483-4.691l4.062 0.956c0.071 1.4 1.3 2.6 2.7 2.555c1.488 0 2.695-1.208 
                    2.695-2.695C25.881 3.2 24.7 2 23.2 2 c-1.059 0-1.979 0.616-2.42 1.508l-4.633-1.091c-0.344-0.081-0.693 0.118-0.803 
                    0.455l-1.793 5.7 C10.548 8.6 7.7 9.4 5.6 10.75C5.006 10.3 4.3 10 3.5 10.029c-1.785 0-3.237 1.452-3.237 3.2 c0 1.1 0.6 
                    2.1 1.4 2.69c-0.04 0.272-0.061 0.551-0.061 0.831c0 2.3 1.3 4.4 3.7 5.9 c2.299 1.5 5.3 2.3 8.6 2.325c3.228 0 6.271-0.825 
                    8.571-2.325c2.387-1.56 3.7-3.66 3.7-5.917 c0-0.26-0.016-0.514-0.051-0.768C27.088 15.5 27.7 14.4 27.7 13.267z M23.186 
                    3.355c0.74 0 1.3 0.6 1.3 1.3 c0 0.738-0.6 1.34-1.34 1.34s-1.342-0.602-1.342-1.34C21.844 4 22.4 3.4 23.2 3.355z M1.648 
                    13.3 c0-1.038 0.844-1.882 1.882-1.882c0.31 0 0.6 0.1 0.9 0.209c-1.049 0.868-1.813 1.861-2.26 2.9 C1.832 14.2 1.6 13.8 1.6 
                    13.267z M21.773 21.57c-2.082 1.357-4.863 2.105-7.831 2.105c-2.967 0-5.747-0.748-7.828-2.105 
                    c-1.991-1.301-3.088-3-3.088-4.782c0-1.784 1.097-3.484 3.088-4.784c2.081-1.358 4.861-2.106 7.828-2.106 c2.967 0 5.7 
                    0.7 7.8 2.106c1.99 1.3 3.1 3 3.1 4.784C24.859 18.6 23.8 20.3 21.8 21.57z M25.787 14.6 
                    c-0.432-1.084-1.191-2.095-2.244-2.977c0.273-0.156 0.59-0.245 0.928-0.245c1.035 0 1.9 0.8 1.9 1.9 
                    C26.354 13.8 26.1 14.3 25.8 14.605z"></path></g></svg>
                </span>
                
            </a>
        </li><li id="ctl00_SocialLike_Pinterest" class="pinterest compact">
            <a href="http://pinterest.com/pin/create/bookmarklet/?is_video=false&amp;url=https%3a%2f%2fwww.codeproject.com%2fArticles%2f14037%2fCOM-in-plain-C-Part-3&amp;description=COM+in+plain+C%2c+Part+3+-+CodeProject">
                <span class="icon">
                    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                    <path d="M14.021,1.57C6.96,1.57,1.236,7.293,1.236,14.355c0,7.062,5.724,12.785,12.785,12.785c7.061,0,12.785-5.725,12.785-12.785
                        C26.807,7.294,21.082,1.57,14.021,1.57z M15.261,18.655c-1.161-0.09-1.649-0.666-2.559-1.219c-0.501,2.626-1.113,5.145-2.925,6.458
                        c-0.559-3.971,0.822-6.951,1.462-10.116c-1.093-1.84,0.132-5.545,2.438-4.632c2.837,1.123-2.458,6.842,1.099,7.557
                        c3.711,0.744,5.227-6.439,2.925-8.775c-3.325-3.374-9.678-0.077-8.897,4.754c0.19,1.178,1.408,1.538,0.489,3.168
                        C7.165,15.378,6.53,13.7,6.611,11.462c0.131-3.662,3.291-6.227,6.46-6.582c4.007-0.448,7.771,1.474,8.29,5.239
                        c0.579,4.255-1.816,8.865-6.102,8.533L15.261,18.655z"></path>
                    </svg>
                </span>
                
            </a>
        </li>

    </ul>



			        </div><a class="float-left" name="_comments" id="_comments">&nbsp;</a><div id="_MessageBoardctl00_MessageBoard" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(event, null)">
<table id="ForumTable" class="forum relaxed" cellpadding="0" cellspacing="0">
<tbody><tr>
<td class="header1"><div class="callout">
	<b>You must <a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fArticles%2f14037%2fCOM-in-plain-C-Part-3%3ffid%3d302281%26df%3d90%26mpp%3d25%26sort%3dPosition%26view%3dNormal%26spc%3dRelaxed%26prof%3dTrue">Sign In</a> to use this message board.</b>
</div></td>
</tr><tr>
<td><table width="100%" border="0" cellpadding="3px" cellspacing="0">
<tbody><tr class="header1">
<td colspan="2" style="white-space:nowrap;"><div class="container">
<div class="float-right">
<form action="/Search.aspx?sbo=fm" method="get" class="searchbar">
<input type="hidden" name="fid" value="302281"><input type="hidden" name="sbo" value="fm"><input id="search_forumCtrl_ctl00_MessageBoard" type="search" class="search subdue" autocomplete="off" name="q" value="Search Comments"><input type="image" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/search.gif">
</form>
</div>
</div></td>
</tr><tr class="header2">
<td></td><td style="width:100%;"><div style="text-align:right;">
<form action="/script/Forums/SetOptions.aspx?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;view=Normal&amp;spc=Relaxed&amp;prof=True&amp;floc=%2fArticles%2f14037%2fCOM-in-plain-C-Part-3" method="get" style="margin:0;padding:0;">
<input type="hidden" name="fid" value="302281"><input type="hidden" name="currentQS" value="fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;view=Normal&amp;spc=Relaxed&amp;prof=True&amp;floc=%2fArticles%2f14037%2fCOM-in-plain-C-Part-3"><input type="hidden" name="floc" value="/Articles/14037/COM-in-plain-C-Part-3">Spacing<select size="1" class="dropdown" name="spc" data-ddg-inputtype="unknown">
<option selected="selected" value="Relaxed">Relaxed</option><option value="Compact">Compact</option><option value="Tight">Tight</option>
</select>&nbsp;&nbsp;Layout<select size="1" class="dropdown" name="view" data-ddg-inputtype="unknown">
<option selected="selected" value="Normal">Normal</option><option value="Topic">Open Topics</option><option value="Expanded">Open All</option><option value="Thread">Thread View</option>
</select>&nbsp;&nbsp;Per page<select size="1" class="dropdown" name="mpp" data-ddg-inputtype="unknown">
<option value="10">10</option><option selected="selected" value="25">25</option><option value="50">50</option>
</select>&nbsp;&nbsp;&nbsp;<input type="submit" value="Update" name="SetOpt" class="button">
</form>
</div></td>
</tr>
</tbody></table></td>
</tr><tr>
<td><a name="xx0xx"></a><table border="0" cellpadding="2px" cellspacing="0" width="100%">
<tbody><tr class="navbar">
<td></td><td style="text-align:right;width:50%;"></td><td style="text-align:right;white-space:nowrap;"><span class="nav-link disabled">First</span> <span class="nav-link disabled">Prev</span> <span class="nav-link disabled">Next</span></td>
</tr>
</tbody></table></td>
</tr><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%" class="fixed-layout blank-background msg-list">
<tbody><tr id="F4481834_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx4481834xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_question.gif" alt="Question" title="Question"></td><td class="subject hover-container"><a class="message-link" name="4481834" parent="0" thread="4481834" href="https://www.codeproject.com/Messages/4481834/In-the-IExample4-function-next-may-less-some-sente">In the IExample4, function "next" may less some sentences</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">ligand</span><span class="date">27-Jan-13  14:59</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=3756817">ligand</a></span></td><td class="date"><span>27-Jan-13  14:59&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4481834_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="pre-lang" id="premain597022"><div>C++</div><div class="pre-action-link"><span class="code-collapse" data-index="597022" id="preShrink597022">Shrink ▲</span> &nbsp; <span id="copycode597022" class="copy-code" data-index="597022" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve">
<g>
<path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272
    c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729
    c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path>
<path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272
    c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068
    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001
    C291.206,428.715,289.92,430,288.341,430z"></path>	
</g>
</svg></span></div></div>
<pre id="pre597022" style="margin-top:0;" class="lang-cplusplus notranslate" data-language="c++" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true">count = <span class="code-digit">0</span>;

	<span class="code-comment">// Any more items left?
</span>	<span class="code-keyword">if</span> (item)
	{
		<span class="code-comment">// Retrieve the next numItemsDesired items
</span>		<span class="code-keyword">while</span> (item &amp;&amp; numItemsDesired--)
		{
			<span class="code-comment">// If what we're returning to the caller is an object, we must AddRef()
</span>			<span class="code-comment">// it on the caller's behalf. The caller is expected to Release() it
</span>			<span class="code-comment">// when done with it. If what we're returning is a BSTR, then we must
</span>			<span class="code-comment">// SysAllocString a copy of it. Caller is expected to SysFreeString it.
</span>			<span class="code-comment">// Other datatypes are simply copied to the caller's VARIANT as is.
</span>			<span class="code-comment">// VariantCopy() does all this for us
</span>			VariantCopy(&amp;rgVar[count], &amp;item-<span class="code-keyword">&gt;</span><span class="code-keyword">value</span>);

			<span class="code-comment">// Another item fetched
</span>			++count;
		}</pre><br>
<br>
It seems loss some necessary sentences to alter the "item" pointer to 
point the next one.  In the test applications of IExample4.vbs and 
"IExmaple4App",  the "next" function only return one item. Thus that 
error is not exposed. If you use "next" function in  "IExmaple4App" with
 the parameter "numItemsDesired" greater than 1, you will find the 
results always the "Port 1". The correct souce code should be <br>
<br>
<br>
<div class="pre-lang" id="premain601031"><div>C++</div><div class="pre-action-link"><span class="code-collapse" data-index="601031" id="preShrink601031">Shrink ▲</span> &nbsp; <span id="copycode601031" class="copy-code" data-index="601031" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve">
<g>
<path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272
    c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729
    c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path>
<path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272
    c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068
    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001
    C291.206,428.715,289.92,430,288.341,430z"></path>	
</g>
</svg></span></div></div>
<pre id="pre601031" style="margin-top:0;" class="lang-cplusplus notranslate" data-language="c++" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true">count = <span class="code-digit">0</span>;

	<span class="code-comment">// Any more items left?
</span>	<span class="code-keyword">if</span> (item)
	{
		<span class="code-comment">// Retrieve the next numItemsDesired items
</span>		<span class="code-keyword">while</span> (item &amp;&amp; numItemsDesired--)
		{
			<span class="code-comment">// If what we're returning to the caller is an object, we must AddRef()
</span>			<span class="code-comment">// it on the caller's behalf. The caller is expected to Release() it
</span>			<span class="code-comment">// when done with it. If what we're returning is a BSTR, then we must
</span>			<span class="code-comment">// SysAllocString a copy of it. Caller is expected to SysFreeString it.
</span>			<span class="code-comment">// Other datatypes are simply copied to the caller's VARIANT as is.
</span>			<span class="code-comment">// VariantCopy() does all this for us
</span>			VariantCopy(&amp;rgVar[count], &amp;item-<span class="code-keyword">&gt;</span><span class="code-keyword">value</span>);

			<span class="code-comment">// Another item fetched
</span>			++count;
                        <b>item = item-<span class="code-keyword">&gt;</span>next;</b>
		}</pre><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14037/COM-in-plain-C-Part-3" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=4481834" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_4481834" name="react-item_4481834" id="MRF4481834" class="reaction-result"></span><span data-objectref="3_4481834" data-votingtype="GoodOrBad" name="RateItem_4481834" id="MVF4481834" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="4481834" href="https://www.codeproject.com/Messages/4481834/In-the-IExample4-function-next-may-less-some-sente" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F3678268_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx3678268xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="3678268" parent="0" thread="3678268" href="https://www.codeproject.com/Messages/3678268/My-vote-of-5">My vote of 5</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">yao2007</span><span class="date">25-Nov-10  22:00</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=5666108">yao2007</a></span></td><td class="date"><span>25-Nov-10  22:00&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F3678268_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Excellent<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14037/COM-in-plain-C-Part-3" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=3678268" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_3678268" name="react-item_3678268" id="MRF3678268" class="reaction-result"></span><span data-objectref="3_3678268" data-votingtype="GoodOrBad" name="RateItem_3678268" id="MVF3678268" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="3678268" href="https://www.codeproject.com/Messages/3678268/My-vote-of-5" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F3674547_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx3674547xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="3674547" parent="0" thread="3674547" href="https://www.codeproject.com/Messages/3674547/My-vote-of-5">My vote of 5</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">yao2007</span><span class="date">22-Nov-10  23:12</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=5666108">yao2007</a></span></td><td class="date"><span>22-Nov-10  23:12&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F3674547_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">excellent<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14037/COM-in-plain-C-Part-3" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=3674547" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_3674547" name="react-item_3674547" id="MRF3674547" class="reaction-result"></span><span data-objectref="3_3674547" data-votingtype="GoodOrBad" name="RateItem_3674547" id="MVF3674547" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="3674547" href="https://www.codeproject.com/Messages/3674547/My-vote-of-5" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F3300391_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx3300391xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="3300391" parent="0" thread="3300391" href="https://www.codeproject.com/Messages/3300391/Trivial-typos">Trivial typos</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Hou Tianze</span><span class="date">10-Dec-09  16:08</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=2407417">Hou Tianze</a></span></td><td class="date"><span>10-Dec-09  16:08&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F3300391_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">In line 6 of IExample3\IExample3.vbs:<br>
Typo: MsgBox <b>coll.(i)</b><br>
Fix:  MsgBox <b>coll(i)</b><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14037/COM-in-plain-C-Part-3" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=3300391" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_3300391" name="react-item_3300391" id="MRF3300391" class="reaction-result"></span><span data-objectref="3_3300391" data-votingtype="GoodOrBad" name="RateItem_3300391" id="MVF3300391" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="3300391" href="https://www.codeproject.com/Messages/3300391/Trivial-typos" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F3054623_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx3054623xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="3054623" parent="0" thread="3054623" href="https://www.codeproject.com/Messages/3054623/Nothing-of-examples-works-properly">Nothing of examples works properly</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Member 1669820</span><span class="date">26-May-09  2:10</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=1669820">Member 1669820</a></span></td><td class="date"><span>26-May-09  2:10&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F3054623_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">I've compiled some of them using VS. But when I've tryed
 to register some DLLs from examples in Component Serivce I've got only a
 message that the DLL contains no components or classes. I've tryed the 
example that by description can register a DLL. But when I try it I get a
 message of succesful registration for any DLL but realy such succesful 
registration has no effects, because the list of available components (I
 need to use some ActiveX in Matlab) doesn't change after it. <br>
<br>
<div class="ForumSig">cogito ergo sum</div><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14037/COM-in-plain-C-Part-3" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=3054623" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_3054623" name="react-item_3054623" id="MRF3054623" class="reaction-result"></span><span data-objectref="3_3054623" data-votingtype="GoodOrBad" name="RateItem_3054623" id="MVF3054623" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="3054623" href="https://www.codeproject.com/Messages/3054623/Nothing-of-examples-works-properly" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F3300394_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="38px" class="indent"><a name="xx3300394xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="3300394" parent="3054623" thread="3054623" href="https://www.codeproject.com/Messages/3300394/Re-Nothing-of-examples-works-properly">Re: Nothing of examples works properly</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Hou Tianze</span><span class="date">10-Dec-09  16:12</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=2407417">Hou Tianze</a></span></td><td class="date"><span>10-Dec-09  16:12&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F3300394_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,3054623);" href="https://www.codeproject.com/Messages/3054623/Nothing-of-examples-works-properly"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>You
 need to do a find-and-replace over the regiexample2 for example 3, 4, 5
 to register the COM *.dlls. You can't use regsvr32 to register, because
 there is DllRegisterServer() function exported/implemented int the 
example code.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14037/COM-in-plain-C-Part-3" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=3054623" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_3300394" name="react-item_3300394" id="MRF3300394" class="reaction-result"></span><span data-objectref="3_3300394" data-votingtype="GoodOrBad" name="RateItem_3300394" id="MVF3300394" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="3300394" href="https://www.codeproject.com/Messages/3300394/Re-Nothing-of-examples-works-properly" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F2694350_h0" class="header hover-row root">
<td class="subject-line normal vote-hi" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx2694350xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="2694350" parent="0" thread="2694350" href="https://www.codeproject.com/Messages/2694350/Link-error-error-LNK2005-IID-ICollection-already-d">Link error:error LNK2005: _IID_ICollection already defined in IExample3.obj</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Member 4298929</span><span class="date">26-Aug-08  2:11</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=4298929">Member 4298929</a></span></td><td class="date"><span>26-Aug-08  2:11&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F2694350_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">when i compiled IExample3, some link errors appeared, why?<br>
<br>
--------------------Configuration: IExample3 - Win32 Debug--------------------<br>
Linking...<br>
PortNames.obj : error LNK2005: _IID_ICollection already defined in IExample3.obj<br>
PortNames.obj : error LNK2005: _IID_IExample3 already defined in IExample3.obj<br>
PortNames.obj : error LNK2005: _CLSID_IExample3 already defined in IExample3.obj<br>
PortNames.obj : error LNK2005: _CLSID_TypeLib already defined in IExample3.obj<br>
PortNames.obj : warning LNK4006: _IID_ICollection already defined in IExample3.obj; second definition ignored<br>
PortNames.obj : warning LNK4006: _IID_IExample3 already defined in IExample3.obj; second definition ignored<br>
PortNames.obj : warning LNK4006: _CLSID_IExample3 already defined in IExample3.obj; second definition ignored<br>
PortNames.obj : warning LNK4006: _CLSID_TypeLib already defined in IExample3.obj; second definition ignored<br>
   Creating library Debug/IExample3.lib and object Debug/IExample3.exp<br>
Debug/IExample3.dll : fatal error LNK1169: one or more multiply defined symbols found<br>
Error executing link.exe.<br>
<br>
IExample3.dll - 5 error(s), 4 warning(s)<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14037/COM-in-plain-C-Part-3" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=2694350" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_2694350" name="react-item_2694350" id="MRF2694350" class="reaction-result"></span><span data-objectref="3_2694350" data-votingtype="GoodOrBad" name="RateItem_2694350" id="MVF2694350" class="rating-result"><span>5.00/5 (2 votes)</span></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="2694350" href="https://www.codeproject.com/Messages/2694350/Link-error-error-LNK2005-IID-ICollection-already-d" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F2695622_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="38px" class="indent"><a name="xx2695622xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="2695622" parent="2694350" thread="2694350" href="https://www.codeproject.com/Messages/2695622/Re-I-solve-this-problem">Re: I solve this problem</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Member 4298929</span><span class="date">26-Aug-08  20:33</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=4298929">Member 4298929</a></span></td><td class="date"><span>26-Aug-08  20:33&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F2695622_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,2694350);" href="https://www.codeproject.com/Messages/2694350/Link-error-error-LNK2005-IID-ICollection-already-d"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Just include file "initguid.h" in file "PortNames.c", before include &lt;objbase.h&gt;<br>
<br>
just like this:<br>
#include &lt;windows.h&gt;<br>
#include &lt;initguid.h&gt;<br>
#include &lt;objbase.h&gt;<br>
#include "IExample3.h"<br>
#include "PortNames.h"<br>
<br>
<br>
delete the "include &lt;initguid.h&gt;" in file "IExample3.h"<br>
<br>
Good luck!!!<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14037/COM-in-plain-C-Part-3" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=2694350" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_2695622" name="react-item_2695622" id="MRF2695622" class="reaction-result"></span><span data-objectref="3_2695622" data-votingtype="GoodOrBad" name="RateItem_2695622" id="MVF2695622" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="2695622" href="https://www.codeproject.com/Messages/2695622/Re-I-solve-this-problem" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F2207042_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx2207042xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="2207042" parent="0" thread="2207042" href="https://www.codeproject.com/Messages/2207042/IExample4-lost-something">IExample4 lost something</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">scz</span><span class="date">30-Aug-07  22:04</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=986372">scz</a></span></td><td class="date"><span>30-Aug-07  22:04&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F2207042_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Your IExample4 of com_in_c3_src.zip lost something, it's
 not working code. At least, where is IEnumVariant.h, where is struct 
IENUMVARIANT?<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14037/COM-in-plain-C-Part-3" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=2207042" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_2207042" name="react-item_2207042" id="MRF2207042" class="reaction-result"></span><span data-objectref="3_2207042" data-votingtype="GoodOrBad" name="RateItem_2207042" id="MVF2207042" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="2207042" href="https://www.codeproject.com/Messages/2207042/IExample4-lost-something" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F5100101_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="38px" class="indent"><a name="xx5100101xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="5100101" parent="2207042" thread="2207042" href="https://www.codeproject.com/Messages/5100101/Re-IExample4-lost-something">Re: IExample4 lost something</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">while loop</span><span class="date">29-Jul-15  19:10</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=3568099">while loop</a></span></td><td class="date"><span>29-Jul-15  19:10&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F5100101_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,2207042);" href="https://www.codeproject.com/Messages/2207042/IExample4-lost-something"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>IENUMVARIANT in IEnumVariant.c is the same as MyRealIEnumVariant in PortNames.c<br>
For example4, IEnumVariant.c is redundant. The Next and Skip functions 
in PortNames.c still have bugs but they are not difficult to be fixed.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14037/COM-in-plain-C-Part-3" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=2207042" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_5100101" name="react-item_5100101" id="MRF5100101" class="reaction-result"></span><span data-objectref="3_5100101" data-votingtype="GoodOrBad" name="RateItem_5100101" id="MVF5100101" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="5100101" href="https://www.codeproject.com/Messages/5100101/Re-IExample4-lost-something" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1636153_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx1636153xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="1636153" parent="0" thread="1636153" href="https://www.codeproject.com/Messages/1636153/About-of-freeCollectionTypeInfo">About of freeCollectionTypeInfo</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Black.Stone</span><span class="date">21-Aug-06  22:52</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=55612">Black.Stone</a></span></td><td class="date"><span>21-Aug-06  22:52&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1636153_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Should the helper funtion's body  be is as so?<br>
void freeCollectionTypeInfo(void)<br>
{<br>
   if (CollectionTypeInfo)<br>
       CollectionTypeInfo-&gt;lpVtbl-&gt;<code>Release</code>(CollectionTypeInfo);<br>
}<br>
 <br>
<br>
<div class="ForumSig">I'm sorry for my poor english!</div><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14037/COM-in-plain-C-Part-3" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1636153" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_1636153" name="react-item_1636153" id="MRF1636153" class="reaction-result"></span><span data-objectref="3_1636153" data-votingtype="GoodOrBad" name="RateItem_1636153" id="MVF1636153" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="1636153" href="https://www.codeproject.com/Messages/1636153/About-of-freeCollectionTypeInfo" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1637139_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="38px" class="indent"><a name="xx1637139xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="1637139" parent="1636153" thread="1636153" href="https://www.codeproject.com/Messages/1637139/Re-About-of-freeCollectionTypeInfo">Re: About of freeCollectionTypeInfo</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Jeff Glatt</span><span class="date">22-Aug-06  8:44</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=88625">Jeff Glatt</a></span></td><td class="date"><span>22-Aug-06  8:44&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1637139_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,1636153);" href="https://www.codeproject.com/Messages/1636153/About-of-freeCollectionTypeInfo"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Oops. Yes, it should be a call to Release, instead of AddRef.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14037/COM-in-plain-C-Part-3" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1636153" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_1637139" name="react-item_1637139" id="MRF1637139" class="reaction-result"></span><span data-objectref="3_1637139" data-votingtype="GoodOrBad" name="RateItem_1637139" id="MVF1637139" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="1637139" href="https://www.codeproject.com/Messages/1637139/Re-About-of-freeCollectionTypeInfo" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1478132_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx1478132xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="1478132" parent="0" thread="1478132" href="https://www.codeproject.com/Messages/1478132/Definition-of-a-collection">Definition of a collection</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Vlad Vissoultchev</span><span class="date">8-May-06  2:09</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=68200">Vlad Vissoultchev</a></span></td><td class="date"><span>8-May-06  2:09&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1478132_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">The only required part is the dispinterface to have a method with DISPID_NEWENUM (-4).<br>
<br>
There is no requirement on the method name -- NewEnum, _NewEnum, MyEnum,
 whatever. Also usually it's marked as hidden in the typelib but this is
 not a requirement. There is no requirement for Count, Item, Add, 
Remove, Clear or whatever props/methods. Usually DISPID_VALUE (0) is 
used on the Item property for convenience when consumed -- m_oCol(3) 
instead of m_oCol.Item(3). E.g. some of the Shell and AD interfaces 
don't have Item/Count props but do support DISPID_NEWENUM through 
IDispatch.<br>
<br>
So basicly your complaints on the wrong design are baseless when most of
 the things are not part of the design per se. I agree that IEnumXxxx 
class of interfaces usually encapsulate just a current pointer, but one 
has to realize that collections (IEnumVARIANT based) are a convenience 
for "higher" COM consumer languages, not C/C++.<br>
<br>
cheers,<br>
&lt;/wqw&gt;<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14037/COM-in-plain-C-Part-3" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1478132" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_1478132" name="react-item_1478132" id="MRF1478132" class="reaction-result"></span><span data-objectref="3_1478132" data-votingtype="GoodOrBad" name="RateItem_1478132" id="MVF1478132" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="1478132" href="https://www.codeproject.com/Messages/1478132/Definition-of-a-collection" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1478681_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="38px" class="indent"><a name="xx1478681xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="1478681" parent="1478132" thread="1478132" href="https://www.codeproject.com/Messages/1478681/Re-Definition-of-a-collection">Re: Definition of a collection</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Jeff Glatt</span><span class="date">8-May-06  7:20</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=88625">Jeff Glatt</a></span></td><td class="date"><span>8-May-06  7:20&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1478681_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,1478132);" href="https://www.codeproject.com/Messages/1478132/Definition-of-a-collection"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Yes,
 I do know that there is no requirement for Add or Remove (and I never 
described them as "required" in my article). I never mentioned a Clear 
method at all. As far as the other comments:<br>
<br>
I refer you to <a href="http://msdn.microsoft.com/library/default.asp?url=/archive/en-us/dnarguion/html/drgui042099.asp" rel="nofollow noopener">http://msdn.microsoft.com/library/default.asp?url=/archive/en-us/dnarguion/html/drgui042099.asp</a>[<a href="http://msdn.microsoft.com/library/default.asp?url=/archive/en-us/dnarguion/html/drgui042099.asp" target="_blank" rel="nofollow noopener" title="New Window">^</a>]<br>
<br>
Note the URL. And pertinent excerpts from the article:<br>
<br>
"The simplest standard way to access the data [in a collection] is to expose a property called Count and a method called Item."<br>
<br>
"Collections that are compatible with For Each must have a method called
 _NewEnum that has the dispid DISPID_NEWENUM. Note that the leading 
underscore in the name _NewEnum indicates that the method should be 
hidden from object browsers."<br>
<br>
Here's another URL (and again note where it comes from):<br>
<br>
<a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dncomg/html/msdn_cpptocom.asp" rel="nofollow noopener">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dncomg/html/msdn_cpptocom.asp</a>[<a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dncomg/html/msdn_cpptocom.asp" target="_blank" rel="nofollow noopener" title="New Window">^</a>]<br>
<br>
And pertinent quotes:<br>
<br>
"Collection objects have a Count property that allows users to determine
 the number of items in a collection. You should provide your collection
 object with this property."<br>
<br>
"Collection objects have an Item(Index) property."<br>
<br>
"In order to support [a For Each loop], a collection object needs to have a hidden method that is defined in IDL as follows:<br>
<br>
[id(0xfffffffc)] HRESULT _NewEnum([out, retval] IUnknown** ppunk);<br>
<br>
The method name must be '_NewEnum'."<br>
<br>
Here's an except about ATL collections. Granted, an ATL collection is 
not necessarily a COM collection, but since ATL is very, very often used
 to create COM components, it does tend to speak to the design of a COM 
collection. <a href="http://msdn2.microsoft.com/en-us/library/x416d0xc.aspx" rel="nofollow noopener">http://msdn2.microsoft.com/en-us/library/x416d0xc.aspx</a>[<a href="http://msdn2.microsoft.com/en-us/library/x416d0xc.aspx" target="_blank" rel="nofollow noopener" title="New Window">^</a>]<br>
<br>
"At a minimum, collection interfaces must provide a Count property that 
returns the number of items in the collection, an Item property that 
returns an item from the collection based on an index, and a _NewEnum 
property that returns an enumerator for the collection."<br>
<br>
I did a search and did not come up with any MSDN document about COM 
collections that supports your assertations. In fact, as shown above, 
there is MSDN documentation that contradicts such, and supports what I 
stated in my article. Now, it certainly may be the case that there are 
script engines and applications out there whose only requirement of a 
COM Collection is that it meet your minimum requirements. (After all, 
why would an engine need both a collection's Item function as well as an
 IEnumVARIANT's Next?) And there may certainly be Microsoft components 
that adhere only to those minimum standards. But MSDN documentation 
confirms that your minimum requirements are not the "standard" design, 
and does not state the opposite.<br>
<br>
Ironically, it seems that you've come up with more examples where 
Microsoft is schizophrenic when it comes to COM software design (one 
group states something should be done as so, and another group does 
exactly the opposite. That's bound to happen at such a large software 
house).<br>
<br>
I therefore do stand by my comments/complaints, and disagree that they are "baseless".<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14037/COM-in-plain-C-Part-3" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1478132" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_1478681" name="react-item_1478681" id="MRF1478681" class="reaction-result"></span><span data-objectref="3_1478681" data-votingtype="GoodOrBad" name="RateItem_1478681" id="MVF1478681" class="rating-result"><span>2.00/5 (1 vote)</span></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="1478681" href="https://www.codeproject.com/Messages/1478681/Re-Definition-of-a-collection" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1480171_h0" class="header hover-row">
<td class="subject-line normal vote-hi" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="56px" class="indent"><a name="xx1480171xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="1480171" parent="1478681" thread="1478132" href="https://www.codeproject.com/Messages/1480171/Re-Definition-of-a-collection">Re: Definition of a collection</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Vlad Vissoultchev</span><span class="date">9-May-06  4:40</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=68200">Vlad Vissoultchev</a></span></td><td class="date"><span>9-May-06  4:40&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1480171_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:56px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,1478681);" href="https://www.codeproject.com/Messages/1478681/Re-Definition-of-a-collection"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>I
 see what you mean. My point is that a collection is a coclass that has a
 DISPID_NEWENUM method on the default dispinterface. This is everything 
that's required for a VB6/VBScript client to use For Each operator.<br>
<br>
There are collections with no Item/Count properties. Or the enumerator 
property is not hidden, or the enumerator property is with arbitrary 
name. I've seen ones with ItemByPosition property and 
Filter/Clear/ClearAll methods. The standard VB6 Collection has Item and 
Count methods (not properties). But these still are collections in the 
sense that they can be looped with For Each.<br>
<br>
The URLs you refer to do not "nail" the design -- these comment on 
common practices. The design seems to be loose but gives kind of 
implementation flexability. One can supercharge a collection coclass 
with utility props/methods.<br>
<br>
Wrinting a C/C++ consumer one has to call 
IDispatch::Invoke(DISPID_NEWENUM) to get an IEnumVARIANT interface to an
 enumerator -- kind of clumsy -- and this is the only supported way to 
emulate For Each syntax on an arbitrary collection. One can't depend on 
_NewEnum name, or early-bound calls, or early/late-bound calls to Item 
or Count properties.<br>
<br>
In fact VB6 supports implementing collection classes, but _NewEnum is 
not a valid name for a property so the common way is to expose just 
NewEnum/WhatEver and mark it as hidden -- it makes no difference to the 
consumers.<br>
<br>
cheers,<br>
&lt;/wqw&gt;<br>
<br>
 -- modified at 10:41 Tuesday 9th May, 2006<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14037/COM-in-plain-C-Part-3" rel="nofollow noopener">Sign In</a>·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1478132" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_1480171" name="react-item_1480171" id="MRF1480171" class="reaction-result"></span><span data-objectref="3_1480171" data-votingtype="GoodOrBad" name="RateItem_1480171" id="MVF1480171" class="rating-result"><span>5.00/5 (1 vote)</span></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="1480171" href="https://www.codeproject.com/Messages/1480171/Re-Definition-of-a-collection" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr>
<td><table width="100%" cellpadding="2px" cellspacing="0">
<tbody><tr class="footer">
<td><span class="last-visit desktop-only tablet-only">Last Visit: 31-Dec-99  18:00 &nbsp; &nbsp; Last Update: 27-Aug-23  0:42</span></td><td><a rel="nofollow" href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;prof=True&amp;view=Normal">Refresh</a></td><td style="text-align:right;white-space:nowrap;"><input id="_mbnUrl" type="hidden" value="/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;prof=True&amp;view=Normal&amp;fr=16"><span class="nav-link selected">1</span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table>
</div><p class="small-text"><img align="top" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" width="16px" height="16px" alt="General"> General &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_news.gif" width="16px" height="16px" alt="News"> News &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_idea.gif" width="16px" height="16px" alt="Suggestion"> Suggestion &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_question.gif" width="16px" height="16px" alt="Question"> Question &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_bug.gif" width="16px" height="16px" alt="Bug"> Bug &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_answer.gif" width="16px" height="16px" alt="Answer"> Answer &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_joke.gif" width="16px" height="16px" alt="Joke"> Joke &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_kudos.gif" width="16px" height="16px" alt="Praise"> Praise &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_rant.gif" width="16px" height="16px" alt="Rant"> Rant &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_admin.gif" width="16px" height="16px" alt="Admin"> Admin &nbsp;&nbsp; </p><p class="small-text">Use Ctrl+Left/Right to switch messages, Ctrl+Up/Down to switch threads, Ctrl+Shift+Left/Right to switch pages.</p>
				

			</div>
			

            
            <div id="ctl00_RightSideBar" class="article-right-sidebar">

				
				

				

                <div id="ctl00_RHSticky" class="container-article-info-sticky sticky">

					<div class="padded-top" style="height:250px;width:300px">
						<div class="msg-300x250" data-format="300x250" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="senseai" data-country="US" data-tags="C++, C, VBScript, Windows, Visual-Studio, Dev, COM, Beginner,rating4.5"><noscript><a href="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/senseai&sz=300x250&c=778894"><img src="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/senseai&sz=300x250&c=778894"  width="300px" height="250px" target="_blank"/></a></noscript></div>
					</div>

        		    

<div class="article-summary">

    
    

</div>

				    

                    

				    

				    

					<div class="padded-top" style="height:250px;width:300px">
						<div class="msg-300x250" data-format="300x250" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="Programming-LanguagesVBScript" data-country="US" data-loadonview="true" data-tags="C++, C, VBScript, Windows, Visual-Studio, Dev, COM, Beginner,rating4.5"><noscript><a href="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Programming-LanguagesVBScript&sz=300x250&c=778894"><img src="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Programming-LanguagesVBScript&sz=300x250&c=778894"  width="300px" height="250px" target="_blank"/></a></noscript></div>
					</div>

                    <div class="anchorLink gototop" id="gototop">
                        <a id="ctl00_GoToTop" href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3#_articleTop">Go to top</a>
                    </div>

			    </div>
            </div>
            

        </div>
        

		
		<div class="site-footer">
			<div class="align-left">
				<a id="ctl00_PermaLink" href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3">Permalink</a><br>
				<a id="ctl00_AdvertiseLink" href="http://developermedia.com/">Advertise </a><br>
				<a id="ctl00_PrivacyLink" href="https://www.codeproject.com/info/privacy.aspx">Privacy</a><br>
    			<a id="ctl00_CookiePolicyLink" href="https://www.codeproject.com/info/cookie.aspx">Cookies</a><br>
                <a id="ctl00_TermsOfUseLink" href="https://www.codeproject.com/info/TermsOfUse.aspx">Terms of Use</a><br>
			</div>

            <div class="align-center">
				


<div class="page-width">
    Layout: <a id="ctl00_PageWidth_FixedT" title="Fixed width layout" rel="nofollow" class=" active" href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?PageFlow=FixedWidth">fixed</a>
    |
    <a id="ctl00_PageWidth_FluidT" title="Fluid layout" rel="nofollow" href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?PageFlow=Fluid">fluid</a>
</div>


				

				

	            

                <br>
			</div>
                
			<div class="align-right">
				Article Copyright 2006 by Jeff Glatt<br>Everything else
				Copyright © <a href="mailto:webmaster@codeproject.com">CodeProject</a>, 1999-2023 <br>
                <br>
				Web03 
				2.8:2023-08-14:1<br>
			</div>
		</div>
		

		<br clear="all">
		
			

	</div> 
	</div> 
</div>



<img id="ctl00_Audience" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/DFPAudiencePixel" style="border-width:0px;height:1px;width:1px;">



<script type="text/javascript"> // IMMEDIATE script

function Join() {
    document.location.href = 'https://www.codeproject.com/script/Membership/Modify.aspx';
    return false;
}

var ajinoizhug = function(n){var t=!1;n=n||{};var r=n.RetrievalServiceUrl||"/script/content/webservices/RetrieveContent.aspx/GetContent",u=n.RetrievalServiceRetries||3,f=n.RetrievalServiceTimeout||5e3,e=function(){t||(t=!0,$(window).on("resize scroll",i),i())},i=function(){if(typeof DMAds=="undefined"){var n=$('[data-type="ad"]');n.each(function(){var n=$(this),u=n.attr("data-format")||"",f=n.attr("data-publisher")||"",e=n.attr("data-zone")||"",t=n.attr("data-loadonview"),i=n.attr("data-noadx"),h=n.attr("data-tags")||"",c=n.find("iframe").length!==0||n.find("img").length!==0,r=n.attr("data-processed");t=typeof t=="string"&&t.toLowerCase()==="true";i=typeof i=="string"&&i.toLowerCase()==="true";r=typeof r=="string"&&r.toLowerCase()==="true";r||c||t&&!s(this)||(o(n,u,f,e,i,h),n.attr("data-processed","true"))})}},o=function(n,t,i,e,o,s){var h=new $.Deferred,c=JSON.stringify({format:t,publisherCode:i,zone:e,noAdX:o,keywords:s});$.ajax({url:r,cache:!1,type:"POST",data:c,contentType:"application/json; charset=utf-8",dataType:"json",tryCount:0,retryLimit:u,timeout:f}).done(function(t){var i=t?t.d:null;h.resolve(i); i && i.html && n.html(i.html)}).fail(function(n,t){h.reject(t)})},s=function(n){var t,f,e,o;if(!h(n))return!1;var u=!1,i=0,r=0;try{t=n.getBoundingClientRect();typeof innerWidth=="number"?(i=window.innerWidth,r=window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?(i=document.documentElement.clientWidth,r=document.documentElement.clientHeight):document.body&&(document.body.clientWidth||document.body.clientHeight)&&(i=document.body.clientWidth,r=document.body.clientHeight);f=-200;t.top===t.bottom&&(f+=n.height*-1);e=t.top>=0&&t.top-200<=r||t.top<=0&&t.top>=f;o=i>t.left&&t.right>=0;u=e&&o}catch(s){u=!0}return u},h=function(n){var t=!1,i;return n&&n.style.position!=="fixed"&&n.offsetParent?t=!0:n&&n.style.position==="fixed"&&(i=window.getComputedStyle(n),t=i&&i.display!=="none"),t&&c()},c=function(){var t=!0,n="";return typeof document.hidden!="undefined"?n="hidden":typeof document.mozHidden!="undefined"?n="mozHidden":typeof document.msHidden!="undefined"?n="msHidden":typeof document.webkitHidden!="undefined"&&(n="webkitHidden"),n!==null&&document[n]&&(t=!1),t};return{init:e}};
document.addEventListener('DOMContentLoaded', function() {
var n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP"),t;n.onreadystatechange=function(){try{if(n.readyState==4)if(n.status==200){var t=document.createElement("script");t.type="text/javascript";t.innerHTML=n.responseText;document.getElementsByTagName("body")[0].appendChild(t)}else(new ajinoizhug).init()}catch(i){(new ajinoizhug).init()}};try{t='/a.min.js?v=1.3';n.open("GET",t,!0);n.send()}catch(i){(new ajinoizhug).init()}

  $('div[data-type="ad"][data-showindicator="true"]').before('<div class="small-text muted hidden">Advertisement</div>');
  setTimeout(function(){ 
    $('div[data-type="ad"][data-showindicator="true"]').each(function( index ) {
      if ($(this).height() > 0) {
       $(this).prev().removeClass('hidden');
      }
    });
  }, 2000);

});

var ratingCtrl_ctl00_RateArticle;

var forumConfig_ctl00_MessageBoard;
var forumCtrl_ctl00_MessageBoard;
var forumCtrl_ctl00_MessageBoard_forumMsgFlag;
var forumCtrl_ctl00_MessageBoard_rating;
var forumCtrl_ctl00_MessageBoard_ratingConfig;
var forumCtrl_ctl00_MessageBoard_reaction;
var forumCtrl_ctl00_MessageBoard__reactionConfig;

var subscriptionConfig_ctl00_MessageBoard = {
 ParentId      : 'ctl00_MessageBoard_SubscribeDiv',
 NewId         : 'ctl00_MessageBoard_SubscribeNew',
 ReplyId       : 'ctl00_MessageBoard_SubscribeReplies',
 InstantId     : 'ctl00_MessageBoard_SubscribeInstant',
 DailyId       : 'ctl00_MessageBoard_SubscribeDaily',
 MessageTypeId : 'ctl00_MessageBoard_MessageType',
 GetInfoUrl    : '/script/Forums/WebServices/ForumSubscriptionServices.aspx/GetSubscriptions',
 UpdateInfoUrl : '/script/Forums/WebServices/ForumSubscriptionServices.aspx/UpdateSubscription',
 ForumId       : 302281,
};
var subscriptions_ctl00_MessageBoard;
</script>

<script type="text/javascript"> // DEFERRED script

document.addEventListener('DOMContentLoaded', function() {

	new CodeBlocks().initialise('#contentdiv');
	
	$('.author-wrapper .description').shorten({showChars: 400});
	
	anchorAnimate();
	
	$('#__EVENTVALIDATION').attr('autocomplete', 'off');
	
	$('#joinBtn').css('visibility', 'visible');
	
	MicroModal.init();
	
	$('.oauth').click(function () {
	    $this = $(this);
	    href = $this.attr('href');
	    var myWindow = window.open(href, 'popup',
	                              'width=800,height=600,location=0,menubar=0,resizeable=0,scrollbars=0,toolbar=0');
	    myWindow.focus();
	    var timer = setInterval(function () {
	        if (myWindow.closed) {
	            clearInterval(timer);
	            // window.location.reload(); // May do a POST reload, shows a warning
	            window.location = window.location; // force a GET reload
	        }
	    }, 200);
	    return false;
	});
	
	var oSrchFlt = false, oSrchBox=false, srchBoxFoc=false;
	var sbar     = $('#sb_tb');
	var sfilter  = $('#SearchFilter');
	
	if (typeof(InitWatermark) !== 'undefined')
	  InitWatermark('sb_tb', 'Search for articles, questions, tips');
	if (sbar && sfilter) {
	  sfilter.removeClass('popup'); sfilter.hide(); sfilter.removeClass('open');
	  sbar.blur(function() {
	    if (!oSrchFlt) { sfilter.hide(); sfilter.removeClass('open'); }
	    srchBoxFoc = false;
	  });
	  sbar.focus(function() {
	    oSrchFlt   = false;
	    srchBoxFoc = true;
	    sfilter.show();
	    sfilter.addClass('open');
	  });
	  sbar.mouseleave(function()    { oSrchBox = false; });
	  sbar.mouseover(function()     { oSrchBox = true; });
	  sfilter.mouseleave(function() {
	    oSrchFlt=false;
	    if (!srchBoxFoc && !oSrchBox) { sfilter.hide(); sfilter.removeClass('open'); }
	  });
	  sfilter.mouseover(function()  { oSrchFlt = true; });
	}
	
	var ratingConfig_ctl00_RateArticle = {
	  objectRef:          '2_14037_1',
	  objectSubtypeId:    1,
	  objectTypeName:     'article',
	  ownerId:            88625,
	  votingType:         'None',
	  ratingDisplayMode:  'LargeStars',
	  resultDisplayMode:  'LargeStars',
	  ratingCallback:     null,
	  staticServer:       'https://codeproject.freetls.fastly.net',
	  baseDir:            '/script/Ratings/',
	  ratingUrl:          'ajax/RateItem.aspx',
	  histogramUrl:       'ajax/Histogram.aspx',
	  getRatingUrl:       'ajax/GetRatings.aspx',
	  width:              130,
	  forceComment:       false,
	  lowVoteThreshold:   0,
	  minRating:          1,
	  maxRating:          5
	};
	ratingCtrl_ctl00_RateArticle = new RatingControl('#ctl00_RateArticle_RatingTable',ratingConfig_ctl00_RateArticle);
	
	forumConfig_ctl00_MessageBoard_ratingConfig = {
	  objectTypeId:       3,
	  objectTypeName:     'message',
	  bulkResultSelector: '#_MessageBoardctl00_MessageBoard',
	  votingType:         'GoodOrBad',
	  staticServer:       'https://codeproject.freetls.fastly.net',
	  forceComment:       false,
	  ratingDisplayMode:  'TextOnly',
	  resultDisplayMode:  'TextOnly'
	};
	forumCtrl_ctl00_MessageBoard_rating = new RatingControl('#_MessageBoardctl00_MessageBoard .content', forumConfig_ctl00_MessageBoard_ratingConfig);
	forumConfig_ctl00_MessageBoard = {
	    objectName          : 'forumCtrl_ctl00_MessageBoard',
	    messageTypeId       : 3,
	    searchPrompt        : 'Search Comments',
	    smoothScroll        : true,
	    allowReporting      : false,
	    allowRating         : false,
	    allowRatingDisplay  : true,
	    allowReactions      : false,
	    forumDir            : '/script/Forums/',
	    staticServer        : 'https://codeproject.freetls.fastly.net',
	    switchMsgCallback   : null,
	    ratingControl       : forumCtrl_ctl00_MessageBoard_rating,
	    reactionControl     : null,
	    codeblockProcessor  : new CodeBlocks(),
	    getReportFormMethod : getReportFormHtml,
	    voteHiThreshold     : 5 - 0.5,
	    reportOptions       : [
	       { reportTypeId : 19, name : 'Abusive / Trolling'},
	       { reportTypeId : 20, name : 'Inappropriate'},
	       { reportTypeId : 5, name : 'Spam'},
	    ],
	};
	forumCtrl_ctl00_MessageBoard = new ForumControl('#ForumTable',forumConfig_ctl00_MessageBoard, -1);
	forumCtrl_ctl00_MessageBoard_rating.setConfig('ratingCallback', forumCtrl_ctl00_MessageBoard.showMessageRating);
	forumCtrl_ctl00_MessageBoard.Initialise();
	
	subscriptions_ctl00_MessageBoard = new Subscriptions(subscriptionConfig_ctl00_MessageBoard);
	subscriptions_ctl00_MessageBoard.initialise();
	
	cookieconsent.initialise({
	                                    enabled : true,
	                                    cookie  : { domain: 'codeproject.com' },
	                                    palette : {
	                                        popup: { background: '#ff9900' },
	                                        button: { background: '#f5d948' }
	                                    },
	                                    law :  {
	                                        showForAllRegions : true, 
	                                        countryCode : 'US' 
	                                    },
	                                    theme: 'edgeless',
	                                    type : 'opt-in-out',
	                                    content: {
	                                        message: 'Like every other website we use cookies. By using our site you acknowledge that you have read and understand our <a href=\'/info/cookie.aspx\'>Cookie Policy</a>, <a href=\'/info/privacy.aspx\'>Privacy Policy</a>, and our <a href=\'/info/TermsOfUse.aspx\'>Terms of Service</a>.',
	                                        href:    'https://www.codeproject.com/info/privacy.aspx',
	                                        dismiss: 'Ask me later'
	                                    },
	                                    revokable:true,
	                                    onStatusChange: function(status) {
	                                        $.ajax({
	                                		    dataType  : 'json',
	                                            data: JSON.stringify({ allowCookies : this.hasConsented() }),
	                                            url: '/script/membership/webservices/LoggedOnMemberservices.aspx/SetCookieConsent',
	                                            cache: false,
	                                            type: 'POST',
	                                            contentType: 'application/json'
	                                        })
	                                        console.log(this.hasConsented() ? 'enable cookies' : 'disable cookies');
	                                        console.log(this.hasAnswered() ? 'has answered' : 'did not answer');
	                                    },
	                                });

})
</script>










<style type="text/css">.copied::after {  position: absolute;  right: 0;  display: inline-block; white-space: nowrap; content: 'copied'; color: #fff; background-color: #f90;  border-radius: 3px; padding:1px 8px; opacity: 0;  will-change: opacity, transform; animation: showcopied 1.5s ease; } @keyframes showcopied { 0% { opacity: 0; } 70% { opacity: 1; } 100% { opacity: 0; } } </style><style type="text/css">.copied::after {  position: absolute;  right: 0;  display: inline-block; white-space: nowrap; content: 'copied'; color: #fff; background-color: #f90;  border-radius: 3px; padding:1px 8px; opacity: 0;  will-change: opacity, transform; animation: showcopied 1.5s ease; } @keyframes showcopied { 0% { opacity: 0; } 70% { opacity: 1; } 100% { opacity: 0; } } </style><script type="text/javascript">if(typeof DMAds=="undefined"){var SendDmAdUid=!1,SendSearchTermsToServer=!0,CodeProjectPublisherId="lqm.codeproject.site",EnableMutableAds=!0,EnableViewOnScroll=!0,adServer=adServer||window.location.protocol+"//ads.DeveloperMedia.com/",SearchTermUrl="https://apps.developermedia.com/Ads/PageTerms/GetTerms",AdClickUrl="https://apps.developermedia.com/Ads/PageTerms/LogClick",DownvoteUrl="https://apps.developermedia.com/Ads/AdVote/DownvoteByFingerprint",UndoDownvoteUrl="https://apps.developermedia.com/Ads/AdVote/UndoDownvote",ReportAdUrl="https://apps.developermedia.com/Ads/AdVote/ReportAd",GlobalIdUrl="https://apps.developermedia.com/Ads/GlobalUserIdentification/",CloseAdImageUrl="https://cdn1.developermedia.com/Content/images/undo.png",UndoCloseAdImageUrl="https://cdn1.developermedia.com/Content/images/redo.png",DmLogoImageUrl="https://cdn1.developermedia.com/Content/images/dm-logo-150x23.png";String.prototype.includes||(String.prototype.includes=function(n,t){"use strict";return(typeof t!="number"&&(t=0),t+n.length>this.length)?!1:this.indexOf(n,t)!==-1});var DMAdXHelper=function(){var n=[],t={},s=!1,r=!1,v=0,f=null,y=function(n){try{var i=p(n),t=w(n),r=b(n);t.insertBefore(r,t.children[0]);n.closeAdButton=i;n.reportAdDiv=t;n.adContainer.appendChild(i);n.adContainer.parentNode.appendChild(t);n.reportButton=t.getElementsByClassName("reportButton")[0];n.reportButton.disabled=!0;n.reportButton.onclick=function(){return l(n),!1}}catch(u){console.log(u)}},p=function(n){var i=document.createElement("input");return i.type="image",i.src=t.CloseAdImageUrl,i.title="Report Ad",i.align="left",i.style.cssText="z-index:1000; position:relative; left:0px; top:-"+n.height+"px; margin-top: 0px; margin-left: 0px; display:block; font-size:0px; border: 0px; padding: 0px; height:14px; width:14px",i.onclick=n.width===125&&n.height===125?function(){return c(n),l(n),!1}:function(){return c(n),!1},i},w=function(n){var t=n.width,i=n.height,r=document.createElement("div"),u="<select class='reportReason' style='max-width:150px !important; padding: 0px !important'><option>Offensive<\/option><option>Abusive<\/option><option>Off topic<\/option><option>Don't like the Ad<\/option > <option>Wrong language<\/option><\/select > ",f="<input type='button' disabled class='reportButton' style='padding: 0px !important' value='Report'><\/input>";return t===728&&i===90?k(r,u,f):t===300&&i===250?d(r,u,f):t===160&&i===600?g(r,u,f):t===125&&i===125&&nt(r),(t===728&&i===90||t===300&&i===250||t===160&&i===600)&&tt(n,r),r},b=function(n){var i=document.createElement("input");return i.type="image",i.src=t.UndoCloseAdImageUrl,i.title="Show Ad",i.style.cssText="z-index:1000; position:relative; left:0px; top:0px; width:14px; height:14px;margin-top: 0px; margin-left: 0px; font-size:0px; display:block; padding: 0px; border: 0px",i.onclick=function(){return h(n),!1},i},k=function(n,i,r){n.innerHTML="<div class='sendReportContainer' style='padding-left: 2px; display:block; line-height:initial !important'><div style='display:inline-block; font:14px/18px \"Segoe UI\", Arial'><b>Don't like this Ad?<\/b><\/div><div class='dropzone' contenteditable='true' style='margin-left:10px; height:60px; width: 250px; background-color:lightgray; border-style:dotted; border-color:black; border-radius: 5px; border-width: 2px; text-align: center; display:inline-block; white-space:normal'>1. Hit the refresh icon to show the ad again and take a screenshot. 2. Drag and Drop or paste the screenshot here<\/div><div style='margin-left:10px; display:inline-block; font:14px/18px \"Segoe UI\", Arial;'> "+i+"&nbsp;"+r+"<\/div><\/div><div class='reportSentContainer' style='display:none; padding: 15px 20px; font:14px/18px \"Segoe UI\", Arial;'><span style='color:#999'>Thank you for the report!<\/span><\/div><a href='http://www.developermedia.com/' target='_blank'><img src='"+t.DmLogoImageUrl+"' style='max-width:100%;position:absolute; right:10px; top:10px;'><\/a>";n.style.cssText="display:none; width:728px; height:90px; z-index:100; text-align:left;border-style:solid; border-width:1px; position:relative; background-color:white;box-sizing:border-box; top:0px; left:0px"},d=function(n,i,r){n.innerHTML="<div class='sendReportContainer' style='padding: 5px 5px; display:block; line-height:initial !important'><div style='padding-bottom:5px; font:14px/18px \"Segoe UI\", Arial;'><b>Don't like this Ad?<\/b><\/div><div class='dropzone' contenteditable='true' style='height:100px; width: 290px; margin-top:20px; margin-bottom: 20px; background-color:lightgray; border-style:dotted; border-color:black; border-radius: 5px; border-width: 2px; text-align: center; box-sizing:border-box; white-space:normal'>1. Hit the refresh icon to show the ad again so you can take a screenshot <br/>2. Drag and Drop or paste the screenshot here<\/div><div style='margin-top:5px; font:14px/18px \"Segoe UI\", Arial; '> "+i+"<\/div><div style='margin-top:5px; display:block; font:14px/18px \"Segoe UI\", Arial;'>"+r+"<\/div><\/div><div class='reportSentContainer' style='display:none; padding: 15px 20px; font:14px/18px \"Segoe UI\", Arial; '><span style='color:#999;'>Thank you for the report!<\/span><\/div><a href='http://www.developermedia.com/' target='_blank'><img src='"+t.DmLogoImageUrl+"' style='max-width:100%;position:absolute; right:20px; bottom:10px;'><\/a>";n.style.cssText="display:none; width:300px; height:250px; z-index:100; text-align:left;border-style:solid; border-width:1px; position:relative; background-color:white;box-sizing:border-box; top:0px; left:0px"},g=function(n,i,r){n.innerHTML="<div class='sendReportContainer' style='padding: 20px 15px; display:block; line-height:initial !important'><div style='padding-bottom:20px; display:block; font:14px/18px \"Segoe UI\", Arial;'><b>Don't like this Ad?<\/b><\/div><div class='dropzone' contenteditable='true' style='height:180px; width: 130px; margin-top:20px; margin-bottom: 20px; background-color:lightgray; border-style:dotted; border-color:black; border-radius: 5px; border-width: 2px; text-align: center; box-sizing:border-box; white-space:normal'>1. Hit the refresh icon to show the ad again so you can take a screenshot <br/><br/>2. Drag and Drop or paste the screenshot here<\/div><div style='padding-bottom:10px; padding-top: 10px display:block; font:14px/18px \"Segoe UI\", Arial;'> "+i+"<\/div><div style='font:14px/18px \"Segoe UI\", Arial;'>"+r+"<\/div><\/div><div class='reportSentContainer' style='display:none; padding: 15px 20px; font:14px/18px \"Segoe UI\", Arial;'><span style='color:#999;'>Thank you for the report!<\/span><\/div><a href='http://www.developermedia.com/' target='_blank'><img src='"+t.DmLogoImageUrl+"' style='max-width:120px;position:absolute; right:20px; bottom:20px;'><\/a>";n.style.cssText="display:none; width:160px; height:600px; z-index:100; text-align:left;border-style:solid; border-width:1px; position:relative; background-color:white;box-sizing:border-box; top:0px; left:0px"},nt=function(n){n.innerHTML="<div class='reportSentContainer' style='padding: 5px 5px;font:14px/18px \"Segoe UI\", Arial; width: 100px; height: 100px'><span style='color:#999;'>Thank you for the report!<\/span><\/div>";n.style.cssText="display:none; width:125px; height:125px; z-index:100; text-align:left;border-style:solid; border-width:1px; position:relative; background-color:white;box-sizing:border-box; top:0px; left:0px"},tt=function(n,t){if(n&&n.adContainer){var i=t.getElementsByClassName("dropzone")[0];i.dropzoneFor=n.adContainer.id;n.dropzone=i;s&&(i.ondragenter=function(n){n.currentTarget.style.backgroundColor="yellow";n.currentTarget.innerHTML="<br/><br/>Drag and Drop the ad here"},i.ondragleave=function(n){n.currentTarget.style.backgroundColor="lightgray";u(n.currentTarget.dropzoneFor)},i.ondragover=function(n){n.stopPropagation();n.preventDefault();n.currentTarget.style.backgroundColor="yellow"},i.ondrop=function(n){n.currentTarget.style.backgroundColor="lightgreen";rt(n)});r?f?f.observe(i,{childList:!0}):i.addEventListener("DOMSubtreeModified",function(){a(i)}):i.addEventListener("paste",it,!1)}},h=function(n){n.reportAdDiv.style.display==="none"?(n.reportAdDiv.style.display="table",n.closeAdButton.style.display="none",n.adContainer.style.display="none",n.dropzone.focus()):(n.reportAdDiv.style.display="none",n.closeAdButton.style.display="block",n.adContainer.style.display="block")},e=function(n){var t=i(n),r=t.dropzone;r.style.backgroundColor="lightgreen";r.innerHTML=t.width===160&&t.height===600?"<br/> Your screenshot has been received – thanks! <br/><br/> Next step: What’s wrong with the ad":t.width===300&&t.height===250?"<br/> Your screenshot has been received – thanks! <br/><br/> Next step: What’s wrong with the ad":t.width===728&&t.height===90?"Your screenshot has been received – thanks! Next step: What’s wrong with the ad":"Ad info received. Press Report to submit"},o=function(n){var t=i(n);t&&(t.reportButton.disabled=!1)},u=function(n){var t=i(n);t&&(t.reportButton.disabled=!0)},c=function(n){h(n)},l=function(n){var r=n.reportAdDiv.getElementsByClassName("reportReason")[0],s=r&&r.options[r.selectedIndex].value||"Unspecified",u=n.reportAdDiv.getElementsByClassName("sendReportContainer")[0],f=n.reportAdDiv.getElementsByClassName("reportSentContainer")[0];u&&(u.style.display="none");f&&(f.style.display="block");try{var e=new XMLHttpRequest,i=new FormData,h=DMUserIdentityHelper&&DMUserIdentityHelper.getGlobalUserId()||0,o=null;n.fileList&&n.fileList.length>0&&(o=n.fileList[0]);e.open("POST",t.DownvoteUrl,!0);i.append("adScreenshot",o);i.append("reason",s);i.append("DmGlobalUserId",h);e.send(i)}catch(c){console.log(c)}},it=function(n){var t,h,l,s,c,a,f,v;if(!r){if(n.preventDefault(),t=[],h=!1,window.clipboardData)t=window.clipboardData.files,h=!0;else if((n.clipboardData||n.originalEvent.clipboardData)&&(l=n.clipboardData||n.originalEvent.clipboardData,s=l&&l.items||[],t=[],s&&s.length>0))for(h=!0,c=0;c<s.length;c++)a=s[c],a.kind==="file"&&(t[t.length]=a.getAsFile());f=n.currentTarget.dropzoneFor;t&&t.length>0?(v=i(f),v&&(v.fileList=t),o(f),e(f)):h?(n.currentTarget.innerHTML="<br/><br/> No files found on clipboard <br/>",u(f)):(n.currentTarget.innerHTML="<br/><br/> Paste not supported on your browser <br/>",u(f))}},rt=function(n){var f,r,t;if(n.stopPropagation(),n.preventDefault(),f=i(n.currentTarget.dropzoneFor),r=[],n.dataTransfer.files&&n.dataTransfer.files.length>0)for(t=0;t<n.dataTransfer.files.length;t++)n.dataTransfer.files[t].type&&n.dataTransfer.files[t].type.indexOf("image")>=0&&(r[r.length]=n.dataTransfer.files[t]);r.length>0?(f&&(f.fileList=r),e(n.currentTarget.dropzoneFor),o(n.currentTarget.dropzoneFor)):(n.currentTarget.style.backgroundColor="yellow",n.currentTarget.innerHTML="<br/><br/>The dropped item was not an image",u(n.currentTarget.dropzoneFor))},a=function(n){for(var t,i=0;i<n.children.length;i++)t=n.children[i],t.nodeName.toLowerCase()==="img"&&t.style.display!=="none"&&t.src&&(t.style.display="none",ut(t.src,n))},ut=function(n,t){if(n){var f=n.indexOf(","),r=n.substring(0,f),h=r.indexOf(":"),c=r.indexOf(";"),l=r.substring(h+1,c),a=n.substring(f+1),v=ot(a,l,512),u=t.dropzoneFor,s=i(u);s&&(s.fileList=[v]);e(u);o(u)}},ft=function(){var n=document.createElement("div");return"draggable"in n||"ondragstart"in n&&"ondrop"in n},et=function(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1},i=function(t){for(var i=0,r=n.length;i<r;i++)if(n[i]&&n[i].adContainer&&n[i].adContainer.id===t)return n[i];return null},ot=function(n,t,i){var e,o,r,f,s,u,h;for(t=t||"",i=i||512,e=atob(n),o=[],r=0;r<e.length;r+=i){for(f=e.slice(r,r+i),s=new Array(f.length),u=0;u<f.length;u++)s[u]=f.charCodeAt(u);h=new Uint8Array(s);o.push(h)}return new Blob(o,{type:t})};return{appendAd:function(t){n.push(t)},init:function(i,u){n=i;t=u;s=ft();r=et();r&&window.MutationObserver&&(f=new MutationObserver(function(n){n.forEach(function(n){a(n.target)})}))},showAdReportingInterface:function(n){var t=i(n);t&&y(t)},setGlobalUserId:function(n){v=n}}}(),DMUserIdentityHelper=function(){var r,t,u="dmaduid",f="dmaduid_confirm",e,o,i=[],n=0,l=function(){return SendDmAdUid?navigator.cookieEnabled!==void 0?navigator.cookieEnabled:(document.cookie="testcookie=test; max-age=10000",document.cookie.indexOf("testcookie=test")>=0):!1},a=function(){var t=document.location.hostname,n=/([^.]+\.[^.]{3,})$/i.exec(t);return n?n[1]:(n=/([^.]+\.[^.]+\.[^.]{2})$/i.exec(t),n!==null?n[1]:t)},s=function(n,t,i,r,u,f){var e="",o;e=n+"="+t;i>0&&(o=new Date,o.setTime(o.getTime()+i*864e5))&&(e+="; expires="+o.toGMTString());r&&(e+="; path="+r);u&&u.indexOf(".")!==-1&&(e+="; domain="+u);f&&(e+="; secure");document.cookie=e},h=function(n){var r=document.cookie,u=null,t,i;if(r!=="")for(t=r.split(";"),index=0;index<t.length;index++)if(i=t[index].replace(/^\s+/,""),i.substring(0,n.length+1)===n+"="){u=i.substring(n.length+1);break}return u},v=function(n){var t=document.createElement("IFRAME");return t.width=1,t.height=1,t.src=e,t.id="DMGlobalUserIdetifierIFRAME",t.name="DMGlobalUserIdetifierIFRAME",t.style.display="none",document.body.appendChild(t),t.onload=n,t},y=function(){var i,l,n,a,e;if(r)if(i=h(u),l=h(f),!l&&JSON){if(n={},n.sender=location.href,n.Id=Math.random(),a=function(){o.contentWindow.postMessage(JSON.stringify(n),GlobalIdUrl)},e=function(i){var r=null,e;try{r=JSON.parse(i.data)}catch(o){}r&&r.Id&&r.Id===n.Id&&(e=r.DmGlobalUserId,s(u,e,365,"/",t,!1),s(f,r.DmGlobalUserConfirmResponse,365,"/",t,!1),c(e))},window.addEventListener)window.addEventListener("message",e,!1);else try{window.attachEvent("message",e)}catch(y){}o=v(a)}else i&&c(i)},c=function(t){for(n=t;i.length>0;){var r=i.pop();typeof r=="function"&&r()}};return{init:function(n){e=n;r=l();t=a();y()},getGlobalUserId:function(t){return n!==0?n:t?(i.push(t),n):void 0}}}(),DMAds={PageQueryTerms:"",PageTags:null,Tile:1,CurrentDocument:null,PublisherCode:"",PublisherPageViewID:0,PublisherPageViewGuid:null,CreateAdsCalled:!1,GetTermsCalled:!1,Ads:[],GPTRenderingMode:"loading",PIIViolatingUrls:["http://www.aspsnippets.com/handlers/comments.ashx","codeproject.com/script/membership/sendpassword.aspx","http://www.dailyfreecode.com/userlogin.aspx","codeproject.com/script/membership/modify.aspx","dotnetspider.com/account/login.aspx","codeproject.com/script/membership/logon.aspx"],SetQueryTerms:function(){function u(n){for(var i,u="",t=0;t<r.length;t++)if(i=r[t],n.indexOf(i.d)>=0){u=i.q;break}return u}function f(n,t){var r=t.toLowerCase().indexOf(n),u,i;return r<0||r+n.length>=t.length?"":(u=t.indexOf("&",r),u<0&&(u=t.length),i=t.substring(r+n.length,u),i=i.replace(/\+/gi," "),i=decodeURIComponent(i),i.replace(/\"/gi,""))}function e(n){if(n===undefined)return"";var t=n.replace(/^\s+|\s+$/gi,"");return t?(t=t.replace(/\bAND\b|\bNOT\b|^NOT\b|\bOR\b|[^A-Z0-9\+\-\#\._\s]+|\b[A-Z0-9]+:/gi," "),t.replace(/\s+/g," ")):""}var r=[{d:"www.google.",q:"q="},{d:"www.bing.com",q:"q="},{d:"search.live.com",q:"q="},{d:"search.yahoo.com",q:"p="},{d:"codeproject.com",q:"q="},{d:"msdn.microsoft.com",q:"query="},{d:"www.ask.com",q:"q="},{d:"yandex.com",q:"text="},{d:"yandex.ru",q:"text="},{d:"www.baidu.com",q:"wd="},{d:"localhost",q:"q="},{d:"mkyong.com",q:"q="},{d:"codeplex.com",q:"query="},{d:"aspsnippets.com",q:"q="},{d:"trirand.com",q:"s="}],i="",n=document.URL,t=u(n);if(t!==""&&(i=e(f(t,n))),i===""){if(n=document.referrer.toLocaleLowerCase(),!n)return"";t=u(n);t!==""&&(i=e(f(t,n)))}DMAds.PageQueryTerms=i},SetPageTagsAndPixels:function(n){var t,i,r,u;if(JSON){if(DMAds.GetTermsCalled){n&&n();return}DMAds.GetTermsCalled=!0;t=document.URL;t.indexOf("?")>0&&(t=t.substring(0,t.indexOf("?")));try{i=top.document.title}catch(f){i="FAILED TO GET DOCUMENT TITLE"}r={terms:DMAds.PageQueryTerms,title:i,url:t,publisher:DMAds.PublisherCode,DmGlobalUserId:DMUserIdentityHelper&&DMUserIdentityHelper.getGlobalUserId()||0,numberOfAdsOnPage:DMAds.Ads.length};u=function(t){if(t){var i;try{i=JSON.parse(t)}catch(r){}i&&(i.SearchTerms&&(DMAds.PageTags=i.SearchTerms),i.PublisherPageViewGuid&&(DMAds.PublisherPageViewGuid=i.PublisherPageViewGuid),i.aid&&i.aid.length&&i.aid.length>0&&DMAds.InsertAudiencePixels(i.aid))}DMAds.PublisherPageViewGuid||(DMAds.PublisherPageViewGuid=1);n&&n()};DMAds.POSTJson(SearchTermUrl,r,u,!0,500)}},InsertAudiencePixels:function(n){var t,i;try{for(t=0,i=n.length;t<i;t++){var r=Math.random()+"",u=r*1e13,f=new Image;f.src="https://pubads.g.doubleclick.net/activity;dc_iu=/6839/DFPAudiencePixel;ord="+u+";dc_seg="+n[t]+"?"}}catch(e){}},GetRandom:function(n,t){for(var u,i="",r=0;r<n;r++)u=Math.floor(Math.random()*t).toString(t).toUpperCase(),i=i+u;return i},POSTJson:function(n,t,i,r,u){var f;if(JSON&&(f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP"),f)){var s=!1,o=function(n){s||(s=!0,i&&i(n))},e=null;r&&(e=setTimeout(function(){try{f.abort()}catch(n){}o(null)},u));f.onreadystatechange=function(){try{f.readyState===4&&(e&&clearTimeout(e),f.status===200?o(f.responseText):o(null))}catch(n){e&&clearTimeout(e);o(null)}};try{f.open("POST",n,!0);f.setRequestHeader("Content-Type","application/json");f.send(JSON.stringify(t))}catch(h){e&&clearTimeout(e);o(null)}}},SignalSuccess:function(n){window.top&&window.top.postMessage&&setTimeout(function(){window.top.postMessage(n?"DM-enabled":"DM-disabled","*")},1e3)},CreateAds:function(n){this.PageRandomNumber=DMAds.GetRandom(32,16);var e=function(n){var t=DMAds.Ads[n];t.rendered=!0;DMAds.GPTRenderingMode==="weLoadedGPT"?DMAds.BuildGPTTag(t):DMAds.BuildInlineGPTTag(t)},l=function(n){var e=DMAds.Ads[n],h=e.theAdDiv,u=!1,i=0,r=0,t,f,o,s;try{t=h.getBoundingClientRect();typeof innerWidth=="number"?(i=window.innerWidth,r=window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?(i=document.documentElement.clientWidth,r=document.documentElement.clientHeight):document.body&&(document.body.clientWidth||document.body.clientHeight)&&(i=document.body.clientWidth,r=document.body.clientHeight);f=-200;t.top===t.bottom&&(f+=e.height*-1);o=t.top>=0&&t.top-200<=r||t.top<=0&&t.top>=f;s=i>t.left&&t.right>=0;u=o&&s}catch(c){u=!0}return u},t=function(){for(var t,i=0,n=0;n<DMAds.Ads.length;n++)t=DMAds.Ads[n],!t.rendered&&l(n)&&u(n)&&e(n),t.rendered&&(i++,t.sticky&&!t.stickySettings&&(t.stickySettings=s(t)),c(n));i===DMAds.Ads.length&&clearInterval(f)},o=function(){var n=function(){for(var c,i,r,o,s=EnableViewOnScroll,n=0;n<DMAds.Ads.length;n++)c=DMAds.Ads[n],c.rendered=!1,i=c.displayOverride,i==="onscroll"||i==="true"?s=!0:(i==="always"||i==="false")&&(s=!1),!s&&u(n)&&e(n);if(t(),window.addEventListener)window.addEventListener("resize",function(){t();h()},!1),window.addEventListener("scroll",t,!1);else try{window.attachEvent("onresize",function(){t();h()});window.attachEvent("onscroll",t)}catch(l){}for(a(),r=!1,o=0;o<DMAds.Ads.length&&!r;o++)if(r=!u(o),r)break;r&&(f=setInterval(t,100))};DMAds.GPTRenderingMode==="loading"?googletag.cmd.push(function(){n()}):n()},a=function(){var n=null;typeof document.hidden!="undefined"?n="visibilitychange":typeof document.mozHidden!="undefined"?n="mozvisibilitychange":typeof document.msHidden!="undefined"?n="msvisibilitychange":typeof document.webkitHidden!="undefined"&&(n="webkitvisibilitychange");n&&document.addEventListener&&document.addEventListener(n,t,!1)},s=function(n){var u=null,i,t;return n.adContainer&&(i=r(n.adContainer),t={},t.isStickyRequired=n.sticky&&n.sticky==="top",t.absoluteTop=i.y,t.absoluteLeft=i.x,t.absoluteTop!==-1&&(t.originalPosition=n.theAdDiv.style.position,u=t)),u},h=function(){for(i=0;i<DMAds.Ads.length;i++){var n=DMAds.Ads[i];n.stickySettings&&n.adContainer&&(n.adContainer.style.position=n.stickySettings.originalPosition,n.stickySettings=s(n),c(i))}},c=function(n){var t=DMAds.Ads[n].adContainer,i=DMAds.Ads[n].stickySettings,f=DMAds.Ads[n].theAdDiv,u,h,s;if(i&&i.isStickyRequired&&t.getBoundingClientRect&&document.getElementsByClassName){u=document.getElementsByClassName("sticky-stop")[0];u&&(h=r(u),s=u.getBoundingClientRect());var c=r(t),e=t.getBoundingClientRect(),o,l=c.y+e.height+Math.abs(e.top)>h.y;u&&l&&s.top<e.height?o=s.top-e.height+"px":window.pageYOffset+10>=i.absoluteTop&&(o="10px");o?(t.style.position="fixed",t.style.top=o,t.style.left=i.absoluteLeft-window.pageXOffset+"px",f.clientHeight===0&&(f.style.height=t.clientHeight+"px"),f.clientWidth===0&&(f.style.width=t.clientWidth+"px")):t.style.position=i.originalPosition}},r=function(n){var t={};if(t.x=-1,t.y=-1,n.getBoundingClientRect){var r=n.getBoundingClientRect(),i=document.documentElement,u=window.pageYOffset||i.scrollTop||document.body.scrollTop||0,f=window.pageXOffset||i.scrollLeft||document.body.scrollLeft||0,e=i.clientTop||document.body.clientTop||0,o=i.clientLeft||document.body.clientLeft||0;t.y=r.top+u-e;t.x=r.left+f-o}return t},u=function(n){var t=DMAds.Ads[n].theAdDiv,i=!1,r;return t&&t.style.position!=="fixed"&&t.offsetParent?i=!0:t&&t.style.position==="fixed"&&(r=window.getComputedStyle(t),i=r&&r.display!=="none"),i&&v()},v=function(){var t=!0,n="";return typeof document.hidden!="undefined"?n="hidden":typeof document.mozHidden!="undefined"?n="mozHidden":typeof document.msHidden!="undefined"?n="msHidden":typeof document.webkitHidden!="undefined"&&(n="webkitHidden"),n!==null&&document[n]&&(t=!1),t},f=f||null;n||DMAds.CreateAdsCalled?n&&(DMAds.Ads[DMAds.Ads.length]=DMAds.GetDivRequestData(n,DMAds.Ads.length-1),DMAds.PublisherCode=DMAds.Ads[0].publisher,DMAds.SetPageTagsAndPixels(o)):(DMAds.CreateAdsCalled=!0,DMAds.SetAdRequestData(),DMAds.Ads.length>0&&(DMAds.PublisherCode=DMAds.Ads[0].publisher,DMAds.SetPageTagsAndPixels(o)))},ShowAd:function(n){var t=DMAds.Ads,i;if(n&&(DMAds.GPTRenderingMode!=="weLoadedGPT"||!DMAds.PublisherPageViewGuid))t.push(n),DMAds.GetTermsCalled||(DMAds.PublisherCode=n.sitename,DMAds.SetPageTagsAndPixels(DMAds.ShowAd));else if(DMAds.GPTRenderingMode==="weLoadedGPT"&&DMAds.PublisherPageViewGuid){while(t&&t.length>0)i=t.pop(),DMAds.RequestQueuedAd(i);n&&DMAds.RequestQueuedAd(n)}},InitGPTLibrary:function(){if(googletag){var n=function(){if(googletag.pubadsReady)DMAds.GPTRenderingMode!=="weLoadedGPT"&&(DMAds.GPTRenderingMode="gptAlreadyLoaded");else{if(googletag.pubads().enableSingleRequest(),googletag.pubads().disableInitialLoad(),DMAds.Ads&&DMAds.Ads[0]&&typeof DMAds.Ads[0].cookieConsent!="undefined"){var n=DMAds.Ads[0].cookieConsent?1:0;googletag.pubads().setRequestNonPersonalizedAds(n?0:1)}googletag.pubads().enableAsyncRendering();googletag.enableServices();DMAds.GPTRenderingMode="weLoadedGPT";googletag.pubads().addEventListener("slotRenderEnded",function(n){DMAds.OnSlotRendered(n)})}};googletag.apiReady?n():googletag.cmd.push(function(){n()})}},BuildIFrameTag:function(n){var t=document.createElement("IFRAME"),i;return t.allowtransparency=!1,t.id="dm-gpt-iframe-"+n.tile,t.width=n.width,t.height=n.height,t.marginWidth=0,t.marginHeight=0,t.frameBorder=0,t.scrolling="no",i=encodeURIComponent(location.href),i.length<2048&&(t.dc_ref=i),t},BuildInlineGPTTagScript:function(n){var t="div-gpt-ad-"+n.publisher+"-"+n.zone+"-"+n.tile,i="/6839/"+n.publisher+"/"+n.zone,r="["+n.width+", "+n.height+"]",u=(n.tags||"")+","+(DMAds.PageSearchTerms||"")+","+(DMAds.PageQueryTerms||""),f=n.cookieConsent!==undefined,e=n.cookieConsent?1:0,o="<div id='"+t+"'>     <script type='text/javascript'>         googletag.cmd.push(function() {             if ( "+f+" && typeof googletag.pubads == 'function') {               googletag.pubads().setRequestNonPersonalizedAds("+e+" ? 0 : 1);            }            googletag.defineSlot('"+i+"', "+r+",'"+t+"')                 .addService(googletag.pubads())                 .setTargeting('kw', '"+u+"');             googletag.enableServices();             googletag.display('"+t+"');         });     <\/script> <\/div>";return"<script type='text/javascript'> var googletag = googletag || {}; googletag.cmd = googletag.cmd || []; (function() {     var gads = document.createElement('script');     gads.async = true;     gads.type = 'text/javascript';     var useSSL = 'https:' == document.location.protocol;     gads.src = (useSSL ? 'https:' : 'http:') + '//www.googletagservices.com/tag/js/gpt.js';     var node =document.getElementsByTagName('script')[0];     node.parentNode.insertBefore(gads, node); })(); <\/script>"+o},BuildGPTTag:function(n){var t=document.createElement("DIV"),i;t.style.height=n.height+"px";t.style.width=n.width+"px";t.style.boxSizing="border-box";t.style.border="0px";t.style.fontSize="0px";i="div-gpt-ad-"+n.publisher+"/"+n.zone+"-"+n.tile;t.id=i;t.adIndex=n.index;n.theAdDiv.appendChild(t);n.adContainer=t;googletag.cmd.push(function(){var u="/6839/"+n.publisher+"/"+n.zone,r=(n.tags||"")+","+(DMAds.PageSearchTerms||"")+","+(DMAds.PageQueryTerms||""),t;r=DMAds.EscapeSpecialCharacters({tags:r});t=googletag.defineSlot(u,[n.width,n.height],i).setTargeting("kw",r);n.articleid&&n.articleid>0&&t.setTargeting("articleid",n.articleid);t.addService(googletag.pubads());n.collapse_empty&&t.setCollapseEmptyDiv(!0,!0);googletag.display(i);googletag.pubads().refresh([t],{changeCorrelator:!1})})},RequestQueuedAd:function(n){googletag.cmd.push(function(){var r="/6839/"+n.sitename+"/"+n.zonename,i=(n.tags||"")+","+(DMAds.PageSearchTerms||""),t;i=DMAds.EscapeSpecialCharacters({tags:i});t=googletag.defineSlot(r,[n.width,n.height],n.targetDivId).setTargeting("kw",i);n.articleid&&n.articleid>0&&t.setTargeting("articleid",n.articleid);t.addService(googletag.pubads());n.collapse_empty&&t.setCollapseEmptyDiv(!0,!0);googletag.display(n.targetDivId);googletag.pubads().refresh([t],{changeCorrelator:!1})})},BuildInlineGPTTag:function(n){var t=DMAds.BuildIFrameTag(n),i;n.theAdDiv.appendChild(t);i=t.contentDocument||t.contentWindow.document||t.contentWindow.window.document;i.write(DMAds.BuildInlineGPTTagScript(n))},EscapeSpecialCharacters:function(n){var t=n.tags,i;t=t.replace(/\+/gi,"{plus}");t=t.replace(/\#/gi,"{sharp}");t=t.replace(/\./gi,"{dot}");t=t.replace(/[\#\*\.\(\)\+\<\>\[\]]/gi,"");for(var r=t.split(","),u=[];r.length>0;)i=r.shift(),/[^\u0020-\u007f]/.test(i)||u.push(i);return u.join(",")},GetArticleId:function(n){var t=0,i,r;if(n&&n===CodeProjectPublisherId)try{i="Articles";r=window.location.href.indexOf(i);r>=0&&(t=window.location.href.substring(r+i.length+1),t=t.substring(0,t.indexOf("/")),t=parseInt(t),isNaN(t)&&(t=0))}catch(u){t=0}return t},IsPagePIICompliant:function(){var t=!0,i,n,r;try{for(i=window.location.href.toLowerCase(),n=0,r=DMAds.PIIViolatingUrls.length;n<r&&t;n++)t=!(i.indexOf(DMAds.PIIViolatingUrls[n])>=0)}catch(u){console.log("Error in IsPagePIICompliant: "+u)}return t},OnSlotRendered:function(n){if(window.location.href&&window.location.href.includes("show_creative_id=1")&&n&&n.creativeId&&console.log(n.creativeId),EnableMutableAds&&n&&!n.isEmpty&&(!n.lineItemId||n.lineItemId&&n.lineItemId===0))DMAdXHelper.showAdReportingInterface(n.slot.getSlotElementId());else if(n&&n.isEmpty){var t=document.getElementById(n.slot.getSlotElementId());t.style.width="0px";t.style.height="0px";t.style.display="none"}DMAds.SignalSuccess(!0)},DetermineTagSize:function(n){if(n.format){var t=n.format.split("x");t.length===2&&(n.width=parseInt(t[0]),n.height=parseInt(t[1]))}},GetElementsByAttr:function(n,t,i,r){var o=[],u,e;i||(i=document);r||(r="*");var f=i.getElementsByTagName(r),s=f.length,h=new RegExp("(^|\\s)"+t+"(\\s|$)");for(u=0,e=0;u<s;u++)h.test(f[u].getAttribute(n))&&(o[e]=f[u],e++);return o},GetElementsByClass:function(n,t,i){var e=[],r,f;t||(t=document);i||(i="*");var u=t.getElementsByTagName(i),o=u.length,s=new RegExp("(^|\\s)"+n+"(\\s|$)");for(r=0,f=0;r<o;r++)s.test(u[r].className)&&(e[f]=u[r],f++);return e},SetAdRequestData:function(){var n=DMAds.GetElementsByAttr("data-type","ad",document,"div"),t;for((n===null||n.length<=0)&&(n=DMAds.GetElementsByClass("lqm_ad",document,"div")),t=0;t<n.length;t++)DMAds.Ads[DMAds.Ads.length]=DMAds.GetDivRequestData(n[t],t)},GetDivRequestData:function(n,t){for(var u,f,r,o=n.attributes,s=o.length,i={},e=0;e<s;e++)u=o.item(e),u.nodeName.indexOf("lqm_")===0&&(f=u.nodeName.slice(4),i[f]=u.value||u.nodeValue),u.nodeName.indexOf("data-")===0&&(f=u.nodeName.slice(5),i[f]=u.value||u.nodeValue);return r={height:0,width:0,publisher:i.publisher,zone:i.zone||"ros",site:i.site,tags:i.tags,sitename:undefined,zonename:undefined,target:"_blank",format:i.format,index:t,tile:t+1,type:i.type,noadx:i.noadx,collapse_empty:i.collapse_empty,displayOverride:i.display||i.loadOnView,sticky:i.sticky,charity:i.charity,cookieConsent:i.cookieconsent,theAdDiv:n},r.tags&&(r.tags=decodeURIComponent(r.tags)),DMAds.DetermineTagSize(r),r.publisher&&r.publisher===CodeProjectPublisherId&&(r.articleid=DMAds.GetArticleId(r.publisher)),r},SetupAds:function(){DMAds.IsPagePIICompliant()&&(DMAds.InitGPTLibrary(),DMAds.SetQueryTerms(),DMAdXHelper.init(DMAds.Ads,{DownvoteUrl:DownvoteUrl,UndoDownvoteUrl:UndoDownvoteUrl,ReportAdUrl:ReportAdUrl,CloseAdImageUrl:CloseAdImageUrl,UndoCloseAdImageUrl:UndoCloseAdImageUrl,DmLogoImageUrl:DmLogoImageUrl}),DMUserIdentityHelper.init(GlobalIdUrl),DMAds.CreateAds())},Initialise:function(){if(DMAds.IsPagePIICompliant())if(window.googletag)DMAds.SetupAds();else{var t="https:"===document.location.protocol,n=document.createElement("script");n.async=!0;n.type="text/javascript";n.src=(t?"https:":"http:")+"//www.googletagservices.com/tag/js/gpt.js";n.onload=this.SetupAds;document.body.appendChild(n)}}};window.DMAds=DMAds}if(DMAds.IsPagePIICompliant())if(window.addEventListener)window.addEventListener("load",function(){DMAds.Initialise()},!1);else try{window.attachEvent("onload",function(){DMAds.Initialise()})}catch(e){DMAds.Initialise()}</script><script async="" type="text/javascript" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/gpt.js"></script><script async="" type="text/javascript" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/gpt.js"></script><div style="position: fixed; z-index: 9999; height: 289px;" id="credential_picker_container"><iframe src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/select.html" title="Sign in with Google Dialog" style="height: 289px; width: 391px; overflow: hidden;"></iframe></div><canvas id="cv1" width="1px" height="1px" style="position:absolute;left:0;top:0;pointer-events:none"></canvas><canvas id="cv2" width="1px" height="1px" style="position:absolute;left:0;top:0;pointer-events:none"></canvas><div id="MemberProfilePopupDiv" class="raised box" style="display: none; position: absolute;"></div><div id="MemberProfilePopupDiv" class="raised box" style="display: none; position: absolute;"></div><div id="MemberProfilePopupDiv" class="raised box" style="display: none; position: absolute;"></div></body></html>