<!DOCTYPE html>
<html lang="en" class=" nrkent idc0_348"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">

	

	
	<link rel="preconnect" href="https://apps.developermedia.com/">
	<link rel="preconnect" href="https://cdn1.developermedia.com/">
	<link rel="preconnect" href="https://cdn.ampproject.org/">
	<link rel="preconnect" href="https://fonts.googleapis.com/">
	<link rel="preconnect" href="https://ajax.googleapis.com/">
	<link rel="preconnect" href="https://adservice.google.com/">
	<link rel="preconnect" href="https://www.googletagservices.com/">
	<link rel="preconnect" href="https://www.googletagmanager.com/">
	<link rel="preconnect" href="https://www.google.com/">
	<link rel="preconnect" href="https://www.google-analytics.com/">
	<link rel="preconnect" href="https://pagead2.googlesyndication.com/">

	<link rel="preconnect" href="https://codeproject.freetls.fastly.net/">


	<link rel="preload" href="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/logo250x135.gif" as="image">


	<link rel="preload" href="https://www.codeproject.com/App_Themes/CodeProject/Img/logo135-bg.gif" as="image">
	<link rel="preload" href="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/jquery-3.4.1.min.js" as="script" type="text/javascript">


	<title>COM in plain C, Part 5 - CodeProject</title> 
    
	<!-- inlined file /App_Themes/CodeProject/Css/article.critical.min.css. Minimized in Release. -->
<style type="text/css">
.blank-background{background-color:#fff}html,div,span,applet,object,iframe,a,abbr,acronym,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,fieldset,form,label,table,tbody,tfoot,thead,tr,th,td,li,ol,ul{margin:0;padding:0;border:0}html{font-size:16px;-webkit-font-smoothing:antialiased;font-smooth:always}body,p,h1,h2,h3,h4,h5,h6,li,tr,td,th,dd,dt{font-family:"Segoe UI",Arial,Sans-Serif;font-size:16px;line-height:1.4;color:#111}body{margin:0}h1,h3,h4,h5,th{font-weight:bold}h1{color:#333;padding:0;margin:0 0 7px;text-align:left}h2{margin:20px 0 11px;padding:0;padding-bottom:10px;color:#333}h1{font-size:38px;font-weight:400}h2{font-size:29px;font-weight:400}h4{font-size:17px}table{background-color:Transparent}img{-ms-interpolation-mode:bicubic}a{text-decoration:none;color:#005782}a:visited{color:#800080}a:hover{text-decoration:underline}a:not([href]){color:inherit;text-decoration:none}input[type="text"],input[type="url"],input[type="search"],input[type="email"],input[type="number"],input[type="password"],select,textarea{border:1px solid #d7d7d7;font-size:16px;padding:5px}a.button,a.button-large,.button,.button-large{color:#fff;background-color:#e08900;border:1px solid #ccc;text-decoration:none;white-space:nowrap;font-size:100%;padding:4px;cursor:pointer;border-radius:3px;-webkit-border-radius:3px;-moz-border-radius:3px}table.small-text td,ul.small-text li,ol.small-text li,.small-text{font-size:14px}.invisible{display:none}.subdue,.subdue li,tr.subdue td{color:#808080}.align-left{text-align:left}.align-right{text-align:right}.align-center{text-align:center}.float-right{float:right}.float-left{float:left}.sticky{position:sticky;top:0}.extended{width:100%;box-sizing:border-box}.padded-top{padding-top:20px}.tight{margin:0;padding:0}.nowrap{white-space:nowrap}.fixed-layout{table-layout:fixed}.clipped{overflow:hidden}.raised{background-color:#fff8df;border:1px solid #ccc;-moz-box-shadow:4px 4px 16px 1px rgba(0,0,0,.25);-webkit-box-shadow:4px 4px 16px 1px rgba(0,0,0,.25);box-shadow:4px 4px 16px 1px rgba(0,0,0,.25)}ol,ul{padding-left:40px;margin:10px 0}ol.compact li,ul.compact li,ol li.compact,ul li.compact{font-size:14px}.callout{margin:20px 0;background-color:#ffffe1;color:#333;border:1px solid #ccc;padding:15px;border-radius:3px;-webkit-border-radius:3px;-moz-border-radius:3px}.trace{padding:20px;background-color:#eee;color:#333;border:1px solid #f00;font-size:13px}textarea,input[type="text"],input[type="button"],input[type="submit"]{-webkit-appearance:none;border-radius:0}.container-content{background-color:#fff;position:relative;zoom:1;padding:0 9px;cursor:default}.container-content-wrap{margin:auto;max-width:1270px}.flex-container{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex}.flex-extend{justify-content:space-between}.flex-wrap{flex-wrap:wrap}.flex-item{-webkit-box-flex:1;-moz-box-flex:1;-webkit-flex:1;-ms-flex:1;flex:1}.flex-item-tight{flex:0 1 auto}.hover-container{display:block;position:relative}.clearfix:after,.container:after{display:block;content:'.';visibility:hidden;height:0;clear:both}.clearfix,.container{display:inline-block;display:block}.access-link,.access-link img{position:absolute;top:0;left:0;width:1px;height:1px;z-index:101;border-style:none;margin-top:-1px;overflow:hidden}.site-top-menu{white-space:nowrap;position:absolute;z-index:101;width:100%}.site-top-menu .main-content{width:100%}.site-top-menu .main-content .memberbar{margin-left:90px;margin-right:10px}.site-top-menu.fixed .main-content{margin:auto;max-width:1270px}.site-header{background-image:url('/App_Themes/CodeProject/Img/logo135-bg.gif');white-space:nowrap;overflow:hidden}.site-header .main-content{position:relative;overflow:hidden;white-space:nowrap}.site-header .logo{display:inline-block}.site-header .promo{display:inline-block;position:absolute;top:33px;right:0}.site-header.fixed .main-content{margin:auto;max-width:1270px}.sub-headerbar{padding-right:9px;position:relative;margin:auto;max-width:1270px}.sub-headerbar-divider{margin-left:10px;height:1px;border-bottom:1px solid #ccc;position:absolute;bottom:2px;left:0;right:9px}.memberbar{height:25px;padding-top:10px;color:#999;font-size:14px}.memberbar a{color:#808080;font-size:14px}div.navbar{white-space:nowrap}.navmenu{background:#fff;color:#4d4d4d;padding:0;margin:0;list-style:none;height:25px}.navmenu ul,.navmenu li{margin:0;padding:0}.navmenu .has-submenu{position:absolute;right:5px;padding-left:10px}.navmenu>li:hover>a,.navmenu>li>a:active{border:1px solid #ccc}.navmenu ul,.navmenu>li.open:hover>a,.navmenu>li.open>a:active{border:1px solid #ccc;border-bottom-color:#fff}.navmenu>li{margin:0 11px 2px 2px}.navmenu>li:active,.navmenu>li:active>a,.navmenu>li:hover,.navmenu>li>a:active{background:#fff;color:#4d4d4d}.navmenu>li>a{padding:2px 7px 6px 7px;border:1px solid transparent;font-weight:bold}.navmenu a{display:block;float:left;color:#666;background:#fff;font-size:17px;padding:0 9px;text-decoration:none;white-space:nowrap}.navmenu a.fly{white-space:nowrap}.navmenu ul{background:#fff;position:absolute;left:-9999px;top:-9999px;list-style:none}.navmenu li{float:left;color:#4d4d4d}.navmenu li.last{height:9px}.navmenu li a:active,.navmenu li a:hover{color:#fff;background-color:#f90}.navmenu li>a:active,.navmenu li:hover,.navmenu li:hover>a,.navmenu li:hover.heading,.navmenu li a.selected{position:relative;color:#fff;background-color:#f90}.navmenu li.openable:hover ul{left:0;top:30px;z-index:500}.navmenu li.openable:hover>ul ul{position:absolute;left:-9999px;top:-9999px;width:auto}.navmenu li.open{position:relative}.navmenu li.open a{color:#fff;background-color:#f90}.navmenu li.open ul{left:0;top:30px;z-index:500}.navmenu li ul{border-bottom:5px solid #f90}.navmenu li li{float:none}.navmenu li li:active>a.fly,.navmenu li li:hover>a.fly{color:#fff;background-color:#f90}.navmenu li li a{float:none;font-size:16px;font-weight:normal}.navmenu li li a.fly{color:#4d4d4d;background-color:#fff;padding:2px 20px}.navmenu li li a.break{margin-bottom:15px}.navmenu li li a.highlight1,.navmenu li li a.highlight1:active,.navmenu li li a.highlight1:hover{background-color:#090}.navmenu li li a.highlight2,.navmenu li li a.highlight2:active,.navmenu li li a.highlight2:hover{background-color:#f90}.navmenu li li a.highlight3,.navmenu li li a.highlight3:active,.navmenu li li a.highlight3:hover{background-color:#000}.navmenu li li a.highlight1,.navmenu li li a.highlight2,.navmenu li li a.highlight3{color:#fff;font-size:16px;margin:5px 0;padding:9px 20px}.site-footer{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;padding-top:5px;width:100%;font-size:13px;color:#999}.site-footer .align-left,.site-footer .align-center,.site-footer .align-right{-webkit-box-flex:1;-moz-box-flex:1;-webkit-flex:1;-ms-flex:1;flex:1}.site-footer .align-left{flex:1 0 100px}.site-footer .align-center{flex:0 1 0%;white-space:nowrap}.site-footer .align-right{flex:1 0 100px}.site-footer .page-width .active{border-bottom:2px solid #f90}.searchbar{padding:0}.searchbar .search{margin-bottom:4px;padding:2px 5px 0;border:1px solid #ccc}.searchbar .search.subdue{color:#ccc}.searchbar input.search{width:190px;border:none;font-size:13px;padding:4px 2px}.searchbar .search-advanced{padding:8px;width:203px;z-index:1000;background-color:#fff;border:solid 1px #ccc;position:absolute;top:-4px;right:0}.searchbar .popup{display:none}.search td{background-color:#fff}.article-container-parts{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex}.article-container{-webkit-box-flex:1;-moz-box-flex:1;-webkit-flex:1;-ms-flex:1;flex:1;background-color:#fff;color:#111;zoom:1;position:relative;max-width:100%;min-height:675px}.article-container .article{margin:0 20px 0 10px;line-height:143%}.article-container span.stats{margin-left:30px}.article-left-sidebar{width:120px;min-width:120px;min-height:400px;font-size:14px;border-right:1px solid #f2f2f2;padding:0}.article-left-sidebar .article-left-sidebar-inner{width:120px;min-width:120px}.article-left-sidebar .tabs>div{padding:5px 0 5px 10px}.article-left-sidebar .selected{font-weight:bold;background:transparent url("/images/right-selected.gif") no-repeat scroll right 9px}.article-left-sidebar .original{color:#808080;margin:-10px 0 0 15px}.article-left-sidebar h4{color:#f90;font-size:14px;font-weight:bold}.article-left-sidebar .stats div div div{padding:0 0 10px 10px;color:#666}.article-right-sidebar{width:300px;margin-left:10px;font-size:14px}.article-right-sidebar .gototop{text-align:center;padding:10px 0;opacity:0;-webkit-transition:opacity .3s linear 0ms;-moz-transition:opacity .3s linear 0ms;-o-transition:opacity .3s linear 0ms;transition:opacity .3s linear 0ms}.container-content .edit-links{margin:21px 0 0 10px}.article-summary{padding:0 10px 0 10px;overflow:hidden}.article h1{margin:0 0 15px 0}.article h2{color:#f90}.article .header .title{color:#808080}.article .header .author{font-weight:bold;min-width:100px}.article .header .author a{color:#808080}.article .header .avatar{max-width:48px;max-height:48px;overflow:unset}.article .header .avatar-wrap{width:48px;height:48px;margin-right:10px;text-align:center}.article .header .date{white-space:nowrap}.article .header .license{margin-left:15px}.article .header .stats{margin-left:30px}.article .summary{color:#808080;padding:40px 0 15px 0}.article .text{padding-top:10px}.article-nav{text-align:right;margin-top:21px;vertical-align:middle;line-height:15px}span.math{display:inline-block}.msg-728x90{width:728px;height:90px;overflow:hidden}.msg-300x250{width:300px;height:250px;overflow:hidden}.tags{line-height:190%}.tags .t{background:none repeat scroll 0 0 transparent;border:1px solid #fbedbb;border-radius:12px 0 0 12px;line-height:1.4;padding:0 2px 2px 3px;position:relative;text-decoration:none;margin:2px 5px 4px 0;white-space:nowrap}.tags .t a{color:#666;display:inline-block;margin-right:3px;padding-left:5px;text-overflow:ellipsis}.container-breadcrumb{font-size:14px;margin-top:7px;color:#808080;margin:12px 0 35px}.container-breadcrumb a{color:#808080}.speech-bubble-container-down,.speech-bubble-container-up,.speech-bubble-container-up-right,.speech-bubble-container-left,.speech-bubble-container-right{position:relative}.ie .speech-bubble-container-up,.firefox .speech-bubble-container-up,.chrome .speech-bubble-container-up,.ie .speech-bubble-container-up-right,.firefox .speech-bubble-container-up-right,.chrome .speech-bubble-container-up-right{margin-top:-4px}.tooltip{position:relative;text-decoration:none}.tooltip .speech-bubble-container-up,.tooltip .speech-bubble-container-down,.tooltip .speech-bubble-container-left,.tooltip .speech-bubble-container-right,.tooltip .speech-bubble-container-up-right,.tooltip .tooltip-flyout{display:none;opacity:0;-webkit-transition:opacity .5s linear 0ms;-moz-transition:opacity .5s linear 0ms;-o-transition:opacity .5s linear 0ms;transition:opacity .5s linear 0ms}.micromodal{display:none}.bottom-promo{height:90px;margin-top:10px;overflow:hidden}.bottom-promo .msg-728x90{width:728px;margin:0 auto}.msg-728x90{overflow:hidden;position:relative;height:90px;min-width:728px}body .msg-728x90{*float:right}body .bottom-promo .msg-728x90{*float:none}table.forum{table-layout:fixed;margin:0 0 20px 0;padding:0;width:100%}.forum table{border-collapse:separate}.forum .header1,.forum .header1 TD{color:#333;font-size:14px;vertical-align:middle}.forum .header2,.forum .header2 TD{color:#fff;background-color:#f90;font-size:14px;vertical-align:middle}.forum .header2 input,.forum .header2 TD input,.forum .header2 select,.forum .header2 TD select{padding:2px}.forum .button{border:1px solid #fc6;margin:1px}.forum .searchbar{border:1px solid #ccc;padding:4px 0 0 0;margin:3px 0}.forum .searchbar .search{width:200px}.forum .searchbar input[type=image]{vertical-align:middle}.forum .dropdown{background-color:#fffdfa;font-size:95%;margin-left:5px}.forum .footer,.forum .footer td,.forum .navbar,.forum .navbar td{font-size:14px;padding:8px 0;border:0;border-top:1px solid #808080}.author-wrapper{position:relative}.author-wrapper .profile-pic{border:1px solid #333;margin:0 13px 0 0;padding:10px;-moz-box-shadow:3px 3px 5px 1px rgba(0,0,0,.2);-webkit-box-shadow:3px 3px 5px 1px rgba(0,0,0,.2);box-shadow:3px 3px 5px 1px rgba(0,0,0,.2);max-height:100px}.author-wrapper .container-member .author{font-size:29px;color:#333;font-weight:600}.rating-container .rating-prompt{padding-right:5px;white-space:nowrap;line-height:25px;margin-right:2px;font-weight:bold;color:#808080}.rating-container .rating-votes{margin-left:5px}.rating-container.large-stars,.rating-container.medium-stars,.rating-container.small-stars{margin-left:7px}.rating-container.large-stars .rating-votes,.rating-container.large-stars .rating-prompt,.rating-container.large-stars .rating-poor,.rating-container.large-stars .rating-good{line-height:25px}@media(min-width:1024px){.desktop-lg-block-only{display:none}.desktop-only{display:inherit}.desktop-block-only{display:block}.tablet-only,.tablet-block-only{display:none}.mobile-only,.mobile-block-only{display:none}.desktop-only.tablet-only{display:inherit}.desktop-block-only.tablet-block-only{display:block}}@media(min-width:821px){.desktop-lg-block-only{display:none}.tablet-only,.mobile-only{display:none}.tablet-block-only,.mobile-block-only{display:none}.tablet-only.desktop-only{display:inherit}.tablet-block-only.desktop-block-only{display:block}}.rrssb-buttons,.rrssb-buttons li,.rrssb-buttons li a{-moz-box-sizing:border-box;box-sizing:border-box}.clearfix{*zoom:1}.clearfix:after{clear:both}.clearfix:before,.clearfix:after{content:" ";display:table}.rrssb-buttons{font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;height:40px;margin:0;padding:0;width:100%}.rrssb-buttons li{float:left;height:100%;list-style:none;margin:0;padding:0 2.5px;line-height:13px}.rrssb-buttons li.email a{background-color:#0a88ff}.rrssb-buttons li.facebook a{background-color:#306199}.rrssb-buttons li.linkedin a{background-color:#007bb6}.rrssb-buttons li.twitter a{background-color:#26c4f1}.rrssb-buttons li.reddit a{background-color:#8bbbe3}.rrssb-buttons li.pinterest a{background-color:#b81621}.rrssb-buttons li.compact{padding:0 4.5px}.rrssb-buttons li.compact a{border-radius:50%;padding:0 7px 0 32px}.rrssb-buttons li.compact a .icon{left:7px;top:-3px;width:5%;transform:scale(.85)}.rrssb-buttons li.compact a .icon svg{height:auto;width:auto}.rrssb-buttons li a{background-color:#ccc;border-radius:3px;display:block;font-size:11px;font-weight:bold;height:100%;padding:11px 7px 12px 27px;position:relative;text-align:center;text-decoration:none;text-transform:uppercase;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;width:100%;-webkit-transition:background-color .2s ease-in-out;-moz-transition:background-color .2s ease-in-out;-o-transition:background-color .2s ease-in-out;transition:background-color .2s ease-in-out}.rrssb-buttons li a .icon{display:block;height:100%;left:10px;padding-top:9px;position:absolute;top:0;width:10%}.rrssb-buttons li a .icon svg{height:17px;width:17px}.rrssb-buttons li a .icon svg path,.rrssb-buttons li a .icon svg polygon{fill:#fff}
</style>
<link rel="stylesheet" type="text/css" href="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/Main.min.css" media="all" onload="if(media!='all')media='all'">
<noscript><link rel="stylesheet" type="text/css" href="https://codeproject.freetls.fastly.net/App_Themes/CodeProject/Css/Main.min.css?dt=2.8:2023-08-14:1"></noscript>


    <script type="text/javascript" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/jquery-3.4.1.min.js" defer="defer"></script>
<script type="text/javascript" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/article.min.js" defer="defer"></script>
<script type="text/javascript" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/client" defer="defer" async=""></script>
<script type="text/javascript" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/MemberProfilePopup.min.js" defer="defer"></script>
<script type="text/javascript" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/a.min.js" defer="defer"></script>

	
<meta http-equiv="content-language" content="en-US">
<meta charset="UTF-8">
<meta name="Description" content="Add a connectable object (source/sink).">
<meta name="Keywords" content="C++, Windows, Visual-Studio, Dev, COM, Beginner">
<meta name="Author" content="Jeff Glatt">
<meta name="Rating" content="General">
<meta name="Revisit-After" content="1 days">
<meta name="application-name" content="CodeProject">
<meta name="google-translate-customization" content="d908bb7ce7aff658-4c2f3a504525c916-g629383f736781a8a-13">

<link rel="dns-prefetch" href="https://ajax.googleapis.com/"> 
<link rel="canonical" href="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/COM-in-plain-C-Part-5.html">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@CodeProject">
<meta name="og:site_name" content="CodeProject">
<meta name="twitter:creator" content="@CodeProject">
<meta property="og:type" content="article">
<meta property="article:published_time" content="5/22/2006 2:30:00 AM">
<meta property="article:modified_time" content="5/22/2006 2:30:00 AM">
<meta name="twitter:label1" content="Written by">
<meta name="twitter:data1" content="Jeff Glatt">
<meta name="twitter:label2" content="Reading time">
<meta name="twitter:data2" content="18 min read">
<meta property="og:url" content="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5">
<meta property="og:title" content="COM in plain C, Part 5">
<meta property="og:description" content="Add a connectable object (source/sink).">

<link rel="alternate" type="application/rss+xml" title="CodeProject Latest articles - All Topics" href="https://www.codeproject.com/WebServices/ArticleRSS.aspx?cat=1">
<link rel="alternate" type="application/rss+xml" title="CodeProject Latest articles - Python" href="https://www.codeproject.com/WebServices/ArticleRSS.aspx?cat=34">
<link rel="alternate" type="application/rss+xml" title="CodeProject Lounge Postings" href="https://www.codeproject.com/webservices/LoungeRSS.aspx">
<meta name="robots" content="index, follow">

<link rel="search" type="application/opensearchdescription+xml" title="CodeProject" href="https://www.codeproject.com/info/OpenSearch.xml">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="apple-touch-icon" sizes="144x144" href="https://www.codeproject.com/favicon/apple-touch-icon.png"> 
<link rel="icon" type="image/png" sizes="32x32" href="https://www.codeproject.com/favicon/favicon-32x32.png"> 
<link rel="icon" type="image/png" sizes="16x16" href="https://www.codeproject.com/favicon/favicon-16x16.png"> 
<link rel="manifest" href="https://www.codeproject.com/favicon/manifest.json"> 
<link rel="mask-icon" href="https://www.codeproject.com/favicon/safari-pinned-tab.svg" color="#ff9900">
	<script type="application/ld+json">{
  "@context": "http://schema.org",
  "@type": "TechArticle",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5"
   },
  "name": "COM in plain C, Part 5",
  "headline": "COM in plain C, Part 5",
  "url": "https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5",
  "discussionUrl": "https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5#_comments",
  "isFamilyFriendly": "true",
  "image": "https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/Article100.png",
  "keywords": "C++,Windows,Visual-Studio,Dev,COM,Beginner",
  "commentCount": "24",
  "editor" : {
    "@type" : "Person",
    "name" : "Smitha Nishant",
    "url" : "https://www.codeproject.com/script/Membership/View.aspx?mid=28970"
  },
  "license": "http://www.codeproject.com/info/cpol10.aspx",
  "publisher" : {
    "@type" : "Organization",
    "name" : "CodeProject"
  },
  "description": "Add a connectable object (source/sink).",
  "articleSection": "C++",
  "author" : [{
      "@type" : "Person",
      "name" : "Jeff Glatt",
      "url" : "https://www.codeproject.com/script/Membership/View.aspx?mid=88625"
    }],
  "datePublished": "2006-05-22",
  "dateCreated": "2006-05-22",
  "dateModified": "2006-05-22"
,
  "contentRating" : {
    "@type" : "Rating",
    "ratingValue" : 4.94,
    "bestRating" : 5,
    "worstRating" : 1
  }
}</script>

<script type="application/ld+json">{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
    "@type": "ListItem",
    "position": 1,
    "item" : {
      "@id" : "/script/Content/Tag.aspx?tags=Languages",
      "name" : "Programming Languages"
    }
  },{
    "@type": "ListItem",
    "position": 2,
    "item" : {
      "@id" : "/script/Content/Tag.aspx?tags=Cplusplus",
      "name" : "C++"
    }
  }]
}</script>


	<!-- base href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5" -->
	
    


<script type="text/javascript">
function defrm () { /* thanks twitter */
    document.write = '';
    window.top.location = window.self.location;
    setTimeout(function() { document.body.innerHTML = ''; }, 0);
    window.self.onload = function(evt) { document.body.innerHTML = ''; };
}

if (window.top !== window.self) {
    try {
        if (window.top.location.host) { /* will throw for all except chrome */ }
        else { defrm(); /* chrome */ }
    } catch (ex) { defrm(); /* everyone else */ }
}

// Specific case where a site is screwing with us.
if (typeof(DemoUrl) !== 'undefined') {
    document.write(unescape('%3Cme') + 'ta http' + '-equiv="re' + 'fresh con' +
                           'tent="1;url=' + DemoUrl + unescape('"%3CE'));
}
</script>
	





    <script async="" type="text/javascript" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/js"></script>
    <script type="text/javascript">
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-YZNPNQ0F2S' , {'user_id': '9bd02f62-656b-43b1-a8e3-74fba4e7f215'});
    </script>

<style id="googleidentityservice_button_styles">.qJTHM{-moz-user-select:none;color:#202124;direction:ltr;font-family:"Roboto-Regular",arial,sans-serif;font-weight:400;margin:0;overflow:hidden}.ynRLnc{left:-9999px;position:absolute;top:-9999px}.L6cTce{display:none}.bltWBb{word-break:break-all}.hSRGPd{color:#1a73e8;cursor:pointer;font-weight:500;text-decoration:none}.Bz112c-W3lGp{height:16px;width:16px}.Bz112c-E3DyYd{height:20px;width:20px}.Bz112c-r9oPif{height:24px;width:24px}.Bz112c-uaxL4e{-moz-border-radius:10px;border-radius:10px}.LgbsSe-Bz112c{display:block}.S9gUrf-YoZ4jf,.S9gUrf-YoZ4jf *{border:none;margin:0;padding:0}.fFW7wc-ibnC6b>.aZ2wEe>div{border-color:#4285f4}.P1ekSe-ZMv3u>div:nth-child(1){background-color:#1a73e8!important}.P1ekSe-ZMv3u>div:nth-child(2),.P1ekSe-ZMv3u>div:nth-child(3){background-image:linear-gradient(to right,rgba(255,255,255,.7),rgba(255,255,255,.7)),linear-gradient(to right,#1a73e8,#1a73e8)!important}.haAclf{display:inline-block}.nsm7Bb-HzV7m-LgbsSe{border-radius:4px;box-sizing:border-box;transition:background-color .218s,border-color .218s;-moz-user-select:none;background-color:#fff;background-image:none;border:1px solid #dadce0;color:#3c4043;cursor:pointer;font-family:"Google Sans",arial,sans-serif;font-size:14px;height:40px;letter-spacing:0.25px;outline:none;overflow:hidden;padding:0 12px;position:relative;text-align:center;vertical-align:middle;white-space:nowrap;width:auto}@media screen and (-ms-high-contrast:active){.nsm7Bb-HzV7m-LgbsSe{border:2px solid windowText;color:windowText}}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe{font-size:14px;height:32px;letter-spacing:0.25px;padding:0 10px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe{font-size:11px;height:20px;letter-spacing:0.3px;padding:0 8px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe{padding:0;width:40px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.pSzOP-SxQuSe{width:32px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.purZT-SxQuSe{width:20px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK{border-radius:20px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK.pSzOP-SxQuSe{border-radius:16px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK.purZT-SxQuSe{border-radius:10px}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc{border:none;color:#fff}.nsm7Bb-HzV7m-LgbsSe.MFS4be-v3pZbf-Ia7Qfc{background-color:#1a73e8}.nsm7Bb-HzV7m-LgbsSe.MFS4be-JaPV2b-Ia7Qfc{background-color:#202124;color:#e8eaed}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:18px;margin-right:8px;min-width:18px;width:18px}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:14px;min-width:14px;width:14px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:10px;min-width:10px;width:10px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin-left:8px;margin-right:-4px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin:0;padding:10px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{padding:8px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{padding:4px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-top-left-radius:3px;border-bottom-left-radius:3px;display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;justify-content:center;align-items:center;background-color:#fff;height:36px;margin-left:-10px;margin-right:12px;min-width:36px;width:36px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf .nsm7Bb-HzV7m-LgbsSe-Bz112c,.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin:0;padding:0}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{height:28px;margin-left:-8px;margin-right:10px;min-width:28px;width:28px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{height:16px;margin-left:-6px;margin-right:8px;min-width:16px;width:16px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:3px;margin-left:2px;margin-right:0;padding:0}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:18px}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:14px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:8px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-bN97Pc-sM5MNb{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;align-items:center;flex-direction:row;justify-content:space-between;flex-wrap:nowrap;height:100%;position:relative;width:100%}.nsm7Bb-HzV7m-LgbsSe .oXtfBe-l4eHX{justify-content:center}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-BPrWId{flex-grow:1;font-family:"Google Sans",arial,sans-serif;font-weight:500;overflow:hidden;text-overflow:ellipsis;vertical-align:top}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-BPrWId{font-weight:300}.nsm7Bb-HzV7m-LgbsSe .oXtfBe-l4eHX .nsm7Bb-HzV7m-LgbsSe-BPrWId{flex-grow:0}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-MJoBVe{transition:background-color .218s;bottom:0;left:0;position:absolute;right:0;top:0}.nsm7Bb-HzV7m-LgbsSe:hover,.nsm7Bb-HzV7m-LgbsSe:focus{box-shadow:none;border-color:#d2e3fc;outline:none}.nsm7Bb-HzV7m-LgbsSe:hover .nsm7Bb-HzV7m-LgbsSe-MJoBVe,.nsm7Bb-HzV7m-LgbsSe:focus .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(66,133,244,.04)}.nsm7Bb-HzV7m-LgbsSe:active .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(66,133,244,.1)}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:hover .nsm7Bb-HzV7m-LgbsSe-MJoBVe,.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:focus .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(255,255,255,.24)}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:active .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(255,255,255,.32)}.nsm7Bb-HzV7m-LgbsSe .n1UuX-DkfjY{border-radius:50%;display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;height:20px;margin-left:-4px;margin-right:8px;min-width:20px;width:20px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId{font-family:"Roboto";font-size:12px;text-align:left}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .ssJRIf,.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff .fmcmS{overflow:hidden;text-overflow:ellipsis}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;align-items:center;color:#5f6368;fill:#5f6368;font-size:11px;font-weight:400}.nsm7Bb-HzV7m-LgbsSe.jVeSEe.MFS4be-Ia7Qfc .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff{color:#e8eaed;fill:#e8eaed}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff .Bz112c{height:18px;margin:-3px -3px -3px 2px;min-width:18px;width:18px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-top-left-radius:0;border-bottom-left-radius:0;border-top-right-radius:3px;border-bottom-right-radius:3px;margin-left:12px;margin-right:-10px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:18px}.L5Fo6c-sM5MNb{border:0;display:block;left:0;position:relative;top:0}.L5Fo6c-bF1uUb{-moz-border-radius:4px;border-radius:4px;bottom:0;cursor:pointer;left:0;position:absolute;right:0;top:0}.L5Fo6c-bF1uUb:focus{border:none;outline:none}sentinel{}</style><style type="text/css"></style><link id="googleidentityservice" type="text/css" media="all" rel="stylesheet" href="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/style.css"><style></style><link href="data:text/css,%5Bid*%3D'google_ads_iframe'%5D%2C%5Bid*%3D'taboola-'%5D%2C.taboolaHeight%2C.taboola-placeholder%2C%23credential_picker_container%2C%23credentials-picker-container%2C%23credential_picker_iframe%2C%5Bid*%3D'google-one-tap-iframe'%5D%2C%23google-one-tap-popup-container%2C.google-one-tap-modal-div%2C%23amp_floatingAdDiv%2C%23ez-content-blocker-container%2C%23notify-adblock%7Bdisplay%3Anone!important%3Bmin-height%3A0!important%3Bheight%3A0!important%3B%7D" rel="stylesheet" type="text/css"></head>	

<body class="firefox firefox116"><div class="cc-revoke cc-bottom cc-animate cc-color-override--316233370" style="display: none;">Cookie Policy</div><div role="dialog" aria-live="polite" aria-label="cookieconsent" aria-describedby="cookieconsent:desc" class="cc-window cc-banner cc-type-opt-in-out cc-theme-edgeless cc-bottom cc-color-override--316233370 " style=""><!--googleoff: all--><span id="cookieconsent:desc" class="cc-message">Like every other website we use cookies. By using our site you acknowledge that you have read and understand our <a href="https://www.codeproject.com/info/cookie.aspx">Cookie Policy</a>, <a href="https://www.codeproject.com/info/privacy.aspx">Privacy Policy</a>, and our <a href="https://www.codeproject.com/info/TermsOfUse.aspx">Terms of Service</a>. <a aria-label="learn more about cookies" role="button" tabindex="0" class="cc-link" href="https://www.codeproject.com/info/privacy.aspx" rel="noopener noreferrer nofollow" target="_blank">Learn more</a></span><div class="cc-compliance cc-highlight"><a aria-label="dismiss cookie message" role="button" tabindex="0" class="cc-btn cc-dismiss">Ask me later</a><a aria-label="deny cookies" role="button" tabindex="0" class="cc-btn cc-deny">Decline</a><a aria-label="allow cookies" role="button" tabindex="0" class="cc-btn cc-allow">Allow cookies</a></div><!--googleon: all--></div>

	<div id="ctl00_OneTap_OneTap">
    <div id="g_id_onload" data-client_id="857795997829.apps.googleusercontent.com" data-login_uri="/script/Membership/OAuthLogOn.aspx?auth=Google">
    </div>
</div>



	<a class="access-link" href="#Main"><img alt="Click here to Skip to main content" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/t.gif"></a>




<div class="page-background">

	
	

	

	
    <div id="ctl00_STM" class="site-top-menu fixed">
        <div class="main-content">
            

<div class="container memberbar clearfix flex-container flex-extend">

	<div id="ctl00_MemberBar_GenInfo" class="flex-item align-left">15,723,416 members</div>

	<div class="flex-item">
		
	</div>

	<div class="flex-item align-right">

		

		

		

			<script type="text/javascript">//<!--
			function doSubmit(secure)
			{
				if (secure)
					document.signinForm.action = "https://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fArticles%2f14183%2fCOM-in-plain-C-Part-5"
				else
					document.signinForm.action = "https://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fArticles%2f14183%2fCOM-in-plain-C-Part-5"
				document.signinForm.submit();
				return true;
			}//-->
			</script>

			<a name="SignUp"></a>
			<span class="member-signin">
				<a data-micromodal-trigger="modal-1" href="javascript:;">Sign in</a>
				<!--<a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fArticles%2f14183%2fCOM-in-plain-C-Part-5">Sign in</a>-->

				<div class="micromodal" id="modal-1" aria-hidden="true">

					<div class="modal__overlay" tabindex="-1" data-micromodal-close="">
					  <div class="modal__container" role="dialog" aria-modal="true" aria-labelledby="modal-1-title">

						<header class="modal_header">
							<h4 class="modal_title" id="modal-1-title">
								Sign in
							</h4>
							<button class="modal_close" aria-label="Close modal" data-micromodal-close=""></button>
						</header>

						<form name="signinForm" id="signinForm" action="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fArticles%2f14183%2fCOM-in-plain-C-Part-5" method="post" class="tight align-left">

							
							<input id="FormName" name="FormName" value="MenuBarForm" type="hidden">

							<div>Email</div>
							<div><input type="email" name="Email" id="Email" autocomplete="email" data-ddg-inputtype="credentials.username"></div>
							<div>Password</div>
							<div><input type="password" name="Password" id="Password" autocomplete="current-password" data-ddg-inputtype="credentials.password"></div>
							<div class="action">
								<input id="joinBtn" type="button" class="create hidden" onclick="return Join();" value="Join" style="visibility: visible;">
								<input type="hidden" name="fld_quicksign" value="true">
								<input type="submit" value="Sign in" class="signin" onclick="return doSubmit(false);">
							</div>

							<div class="container">						
								<a id="ctl00_MemberBar_SendPassword" class="forgot float-right" href="https://www.codeproject.com/script/Membership/SendPassword.aspx?rp=/Articles/14183/COM-in-plain-C-Part-5">Forgot your password?</a>
							</div>
						</form>

						<hr class="divider-dark">

						Sign in with &nbsp;<a class="oauth" alt="Sign in using Github" title="Sign in using Github" href="https://www.codeproject.com/script/Membership/OAuthLogOn.aspx?auth=GitHub"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/octicons_github-lg.png" style="vertical-align:middle;padding-right:3px;border:0;"></a>
<a class="oauth" alt="Sign in using Facebook" title="Sign in using Facebook" href="https://www.codeproject.com/script/Membership/OAuthLogOn.aspx?auth=Facebook"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/facebook-lg.png" style="vertical-align:middle;padding-right:3px;border:0;"></a>
<a class="oauth" alt="Sign in using Google" title="Sign in using Google" href="https://www.codeproject.com/script/Membership/OAuthLogOn.aspx?auth=Google"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/google-plus-lg.png" style="vertical-align:middle;padding-right:3px;border:0;"></a>
<a class="oauth" alt="Sign in using Microsoft" title="Sign in using Microsoft" href="https://www.codeproject.com/script/Membership/OAuthLogOn.aspx?auth=Microsoft"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/microsoft-lg.png" style="vertical-align:middle;padding-right:3px;border:0;"></a>



					  </div>
					</div>
				  </div>

            </span>
		
	</div>
</div>
        </div>
    </div>

	
    <div id="ctl00_SH" class="site-header fixed">
        <div class="main-content">
            <div class="logo"><a href="https://www.codeproject.com/"><img id="ctl00_Logo" tabindex="1" title="CodeProject" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/logo250x135.gif" alt="Home" style="height:135px;width:250px;border-width:0px;"></a></div>
            <div class="promo"><div class="msg-728x90" data-format="728x90" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="Programming-LanguagesCplusplus" data-country="US" data-tags="C++, Windows, Visual-Studio, Dev, COM, Beginner,rating4.5"><noscript><a href="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Programming-LanguagesCplusplus&sz=728x90&c=881171"><img src="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Programming-LanguagesCplusplus&sz=728x90&c=881171"  width="728px" height="90px" target="_blank"/></a></noscript><iframe id="dm-gpt-iframe-1" width="728" height="90" marginwidth="0" marginheight="0" frameborder="0" scrolling="no"></iframe></div></div>
        </div>
    </div>

	
	<div id="ctl00_TPR" class="sub-headerbar flex-container flex-extend flex-wrap fixed">
		<div class="flex-item" style="min-width:20rem">
			

<div class="navbar clearfix">
<ul class="navmenu openable">

<li class="desktop-only"><a id="ctl00_TopNavBar_Home" href="https://www.codeproject.com/">home</a>


</li><li class="openable"><a id="ctl00_TopNavBar_Art" class="down selected" href="https://www.codeproject.com/script/Articles/Latest.aspx">articles</a>

	<ul>
		<li class="openable"><a id="ctl00_TopNavBar_ArtTopicList" class="fly" onmouseover="navBarMenu.ShowMap(this, 'ctl00_TopNavBar_MapFlyout');" href="https://www.codeproject.com/script/Content/SiteMap.aspx">Browse Topics<span class="has-submenu">&gt;</span></a><ul id="ctl00_TopNavBar_MapFlyout" class="taxonomy">
			<li>
				<div id="siteMap"></div>
			</li>
			</ul>
		</li>
		<li><a id="ctl00_TopNavBar_ArtLatestArts" class="fly" href="https://www.codeproject.com/script/Articles/Latest.aspx">Latest Articles</a></li>
		<li><a id="ctl00_TopNavBar_ArtTop" class="fly" href="https://www.codeproject.com/script/Articles/TopArticles.aspx?ta_so=5">Top Articles</a></li>
		<li><a id="ctl00_TopNavBar_ArtGuide" class="fly" href="https://www.codeproject.com/info/Submit.aspx">Posting/Update Guidelines</a></li>
		<li><a id="ctl00_TopNavBar_ArtHelpForum" class="fly" href="https://www.codeproject.com/Forums/1641/Article-Writing">Article Help Forum</a></li>
		<li><a id="ctl00_TopNavBar_ArtPostArticle" class="fly highlight1" href="https://www.codeproject.com/script/Articles/Submit.aspx">
			<img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/write13.png" width="13" height="13"> Submit an article or tip
			</a></li>
        
		<li><a id="ctl00_TopNavBar_ArtImportGitHub" class="fly highlight3" href="https://www.codeproject.com/script/Articles/ImportArticle.aspx">
			<img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/write13.png" width="13" height="13"> Import GitHub Project
			</a></li>
        
		<li><a id="ctl00_TopNavBar_ArtPostBlog" class="fly highlight2" href="https://www.codeproject.com/script/Articles/BlogFeed.aspx">
			<img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/write13.png" width="13" height="13"> Import your Blog
			</a></li>		
        
        <li class="last"></li>
	</ul>

</li>



<li class="openable">
<a id="ctl00_TopNavBar_Answers" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active">
    <span class="desktop-only tablet-only">quick answers</span><span class="mobile-only">Q&amp;A</span>
</a>
	<ul>
		<li id="ctl00_TopNavBar_AQL"><a id="ctl00_TopNavBar_ArticleQuestion" class="fly highlight1" href="#_comments">
			<img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/write13.png" width="13" height="13"> Ask a Question about this 
			article</a>
		</li>

		<li><a id="ctl00_TopNavBar_QAAsk" class="fly highlight2" href="https://www.codeproject.com/Questions/ask.aspx"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/write13.png" width="13" height="13"> Ask a Question</a></li>

		<li><a id="ctl00_TopNavBar_QAUnanswered" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=unanswered">View Unanswered Questions</a></li>
		<li><a id="ctl00_TopNavBar_QALatest" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active">View All Questions</a></li>
        
				<li><a id="ctl00_TopNavBar_QATR_ctl00_Tag" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;amp;alltags=true&amp;amp;tags=81" style="padding-left:30px">View C# questions</a></li>
			
				<li><a id="ctl00_TopNavBar_QATR_ctl01_Tag" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;amp;alltags=true&amp;amp;tags=87" style="padding-left:30px">View Javascript questions</a></li>
			
				<li><a id="ctl00_TopNavBar_QATR_ctl02_Tag" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;amp;alltags=true&amp;amp;tags=268" style="padding-left:30px">View Python questions</a></li>
			
				<li><a id="ctl00_TopNavBar_QATR_ctl03_Tag" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;amp;alltags=true&amp;amp;tags=78" style="padding-left:30px">View C++ questions</a></li>
			
				<li><a id="ctl00_TopNavBar_QATR_ctl04_Tag" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;amp;alltags=true&amp;amp;tags=91" style="padding-left:30px">View Java questions</a></li>
			
    
		<li class="last"></li>
	</ul>

</li>



<li class="openable"><a id="ctl00_TopNavBar_Forums" href="https://www.codeproject.com/script/Forums/List.aspx">
        <span class="desktop-only tablet-only">discussions</span><span class="mobile-only">forums</span>
</a>

	<ul>
		<li><a id="ctl00_TopNavBar_CodeProjectAI" class="fly" href="https://www.codeproject.com/Feature/CodeProjectAI-Discussions.aspx">CodeProject.AI Server</a></li>
		<li><a id="ctl00_TopNavBar_MessageBoardsAll" class="fly" href="https://www.codeproject.com/script/Forums/List.aspx">All Message Boards...</a></li>
		<li class="openable"><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1580997/Application-Lifecycle">Application Lifecycle<span class="has-submenu">&gt;</span></a>
<ul class="openable"><li><a class="fly" href="https://www.codeproject.com/Forums/1533717/Running-a-Business">Running a Business</a></li>
<li><a class="fly" href="https://www.codeproject.com/Forums/1533716/Sales-Marketing">Sales / Marketing</a></li>
<li><a class="fly" href="https://www.codeproject.com/Forums/1651/Collaboration-Beta-Testing">Collaboration / Beta Testing</a></li>
<li><a class="fly" href="https://www.codeproject.com/Forums/3304/Work-Issues">Work  Issues</a></li>
</ul></li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/369270/Design-and-Architecture">Design and Architecture</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1969389/Artificial-Intelligence">Artificial Intelligence</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/12076/ASP-NET">ASP.NET</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1580226/JavaScript">JavaScript</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1969388/Internet-of-Things">Internet of Things</a>
</li>
<li class="openable"><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1647/C-Cplusplus-MFC">C / C++ / MFC<span class="has-submenu">&gt;</span></a>
<ul class="openable"><li><a class="fly" href="https://www.codeproject.com/Forums/4486/ATL-WTL-STL">ATL /  WTL / STL</a></li>
<li><a class="fly" href="https://www.codeproject.com/Forums/3785/Managed-Cplusplus-CLI">Managed C++/CLI</a></li>
</ul></li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1649/Csharp">C#</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1627782/Free-Tools">Free Tools</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1827460/Objective-C-and-Swift">Objective-C and Swift</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1725/Database">Database</a>
</li>
<li class="openable"><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/186301/Hardware-Devices">Hardware &amp; Devices<span class="has-submenu">&gt;</span></a>
<ul class="openable"><li><a class="fly" href="https://www.codeproject.com/Forums/1644/System-Admin">System Admin</a></li>
</ul></li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1606152/Hosting-and-Servers">Hosting and Servers</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1643/Java">Java</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1942421/Linux-Programming">Linux Programming</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1988311/Python">Python</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1650/NET-Core-and-Framework">.NET (Core and Framework)</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1848626/Android">Android</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1876716/iOS">iOS</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/13695/Mobile">Mobile</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1004257/WPF">WPF</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1646/Visual-Basic">Visual Basic</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1640/Web-Development">Web Development</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/suggestions.aspx">Site Bugs / Suggestions</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1652005/Spam-and-Abuse-Watch">Spam and Abuse Watch</a>
</li>

		<li class="last"></li>
	</ul>

</li>

<li class="openable"><a id="ctl00_TopNavBar_Features" href="https://www.codeproject.com/Feature/">
      <span class="desktop-only tablet-only">features</span><span class="mobile-only">features</span>
</a>

	<ul>
		<li><a id="ctl00_TopNavBar_Comps" class="fly" href="https://www.codeproject.com/script/Contests/CurrentCompetitions.aspx?cmpTpId=3&amp;amp;awsac=true">Competitions</a></li>
        
		<li><a id="ctl00_TopNavBar_News" class="fly" href="https://www.codeproject.com/script/News/List.aspx">News</a></li>
		<li><a id="ctl00_TopNavBar_Insider" class="fly" href="https://www.codeproject.com/Feature/Insider/">The Insider Newsletter</a></li>
    	<li><a id="ctl00_TopNavBar_DailyBuild" class="fly" href="https://www.codeproject.com/Feature/DailyBuild">The Daily Build Newsletter</a></li>
		<li><a id="ctl00_TopNavBar_Newsletters" class="fly" href="https://www.codeproject.com/script/Mailouts/Archive.aspx?mtpid=1">Newsletter archive</a></li>
		<li><a id="ctl00_TopNavBar_Surveys" class="fly" href="https://www.codeproject.com/script/Surveys/List.aspx">Surveys</a></li>
		
        
		<li><a id="ctl00_TopNavBar_Stuff" class="fly" href="https://www.codeproject.com/Info/Stuff.aspx">CodeProject Stuff</a></li>
		<li class="last"></li>
	</ul>

</li>


<li class="openable"><a id="ctl00_TopNavBar_Lounge" href="https://www.codeproject.com/Lounge.aspx">
            <span class="desktop-only tablet-only">community</span><span class="mobile-only">lounge</span>
</a>

	<ul>
		<li><a id="ctl00_TopNavBar_WhosWho" class="fly" href="https://www.codeproject.com/script/Membership/Profiles.aspx">Who's Who</a></li>
		<li><a id="ctl00_TopNavBar_MVPs" class="fly break" href="https://www.codeproject.com/script/Contests/Winners.aspx?obtid=1&amp;amp;cmpTpId=2&amp;amp;cid=0">Most Valuable Professionals</a></li>

		<li><a id="ctl00_TopNavBar_LoungeLnk" class="fly highlight2" href="https://www.codeproject.com/Lounge.aspx">The Lounge &nbsp;</a></li>
		<li><a id="ctl00_TopNavBar_SiteBlog" class="fly break" href="https://www.codeproject.com/Members/CodeProject#_comments">The CodeProject Blog</a></li>

		<li><a id="ctl00_TopNavBar_WhereAmILink" class="fly" href="https://www.codeproject.com/Forums/1939564/Where-I-am-Member-Photos">Where I Am: Member Photos</a></li>
		<li><a id="ctl00_TopNavBar_InsiderLnk" class="fly" href="https://www.codeproject.com/Insider.aspx">The Insider News</a></li>
		<li><a id="ctl00_TopNavBar_WeirdWonderful" class="fly" href="https://www.codeproject.com/Feature/WeirdAndWonderful.aspx">The Weird &amp; The Wonderful</a></li>

		<li class="last"></li>
	</ul>

</li>


<li class="openable" style="margin-left:20px"><a id="ctl00_TopNavBar_Help" href="https://www.codeproject.com/KB/FAQs/">
    <span class="desktop-only tablet-only">help</span><span class="mobile-only">?</span>
</a>


	<ul>
		<li><a id="ctl00_TopNavBar_HelpWhatIs" class="fly" href="https://www.codeproject.com/info/guide.aspx">What is 'CodeProject'?</a></li>
		<li><a id="ctl00_TopNavBar_HelpGeneral" class="fly break" href="https://www.codeproject.com/KB/FAQs/">General FAQ</a></li>
		<li><a id="ctl00_TopNavBar_HelpPostQuestion" class="fly break highlight2" href="https://www.codeproject.com/Questions/ask.aspx">Ask a Question</a></li>
		<li><a id="ctl00_TopNavBar_HelpBugs" class="fly" href="https://www.codeproject.com/suggestions.aspx">Bugs and Suggestions</a></li>
		<li><a id="ctl00_TopNavBar_HelpArticles" class="fly" href="https://www.codeproject.com/Forums/1641/Article-Writing">Article Help Forum</a></li>
		
		
		
		
		<li><a id="ctl00_TopNavBar_HelpAboutUs" class="fly" href="https://www.codeproject.com/info/about.aspx">About Us</a></li>
		<li class="last"></li>
	</ul>

</li>

</ul>

</div>
		</div>
		<div class="flex-item-tight align-right">
			

<div class="searchbar">

<form method="get" action="/search.aspx?sbo=kw" name="Search" class="tight">


<table border="0" cellspacing="0" cellpadding="0" class="search"><tbody><tr><td><input tabindex="2" class="search subdue" id="sb_tb" autocomplete="off" value="Search for articles, questions, tips" name="q" data-ddg-inputtype="unknown"></td><td><input type="image" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/search.gif"></td></tr></tbody></table>

<div class="hover-container">
	<div id="SearchFilter" class="search-advanced small-text align-left" style="display: none;">
	<b>Search within:<br></b>
		
		<input type="radio" id="sb_kw" name="sbo" value="kw" checked="checked"><label for="sb_kw">Articles</label><br>
<input type="radio" id="sb_qa" name="sbo" value="qa"><label for="sb_qa">Quick Answers</label><br>
<input type="radio" id="sb_fm" name="sbo" value="fm"><label for="sb_fm">Messages</label><br>


		
		

		
		
	</div>
</div>
</form>

</div>
		</div>
		<div class="sub-headerbar-divider"></div>
	</div>		
	

	<div id="A" class="container-content-wrap fixed"> 

	<div class="container-content">

        
		<div class="clearfix">
			<div class="container-breadcrumb float-left ">
				<div><a rel="nofollow" href="https://www.codeproject.com/script/Content/SiteMap.aspx">Articles</a> / <a rel="nofollow" href="https://www.codeproject.com/script/Content/Tag.aspx?tags=Languages">Programming Languages</a> / <a rel="nofollow" href="https://www.codeproject.com/script/Content/Tag.aspx?tags=Cplusplus">C++</a></div>
			</div>

            <div class="float-left">
				
			</div>

			<div class="edit-links float-right">
				



 
&nbsp;










			</div>

			<div class="article-nav float-right">
				


<div style="display:inline-block;position:relative;top:-6px;margin-right:20px">
    
</div>



 

<a id="ctl00_ActionLinks_PrintMd" data-tooltip="Print" data-enabletooltip="true" data-width="auto" href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?display=Print" class="tooltip" title="">
   <img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/print48.png" width="24" height="24" style="border:0">
<div class="speech-bubble-container-up" style="width:auto">  <div class="speech-bubble-up" style="text-align:center"> Print</div>  <div class="speech-bubble-pointer-up">    <div class="speech-bubble-pointer-up-inner"></div>  </div></div></a>



<span id="ctl00_ActionLinks_R">
    
    
</span>
			</div>
		</div>

        
		<div class="extended article-container-parts">

			
		    <div id="ctl00_LeftSideBar" class="article-left-sidebar">

                <div id="ctl00_StickyBlock" class="article-left-sidebar-inner sticky">

                    
    		        

<div class="tabs">
	<div class=" selected">Article</div>
<div class="browse-code"><a href="https://www.codeproject.com/script/Articles/ViewDownloads.aspx?aid=14183">Browse Code</a></div>
<div><a href="https://www.codeproject.com/script/Articles/Statistics.aspx?aid=14183">View Stats</a></div>
<div><a href="https://www.codeproject.com/script/Articles/ListVersions.aspx?aid=14183">Revisions</a></div>
<div><a href="#_comments">Comments (24)</a></div>
<div>Posted 21 May 2006</div>


    
</div>



			        

			        <div>
                        <h4 id="ctl00_TaggedAsWrapper">Tagged as</h4>
			            <span id="ctl00_TagList_TagWrp" class="tags vertical">

	
	

	
	<span id="ctl00_TagList_VisibleTags"><div class="t"><a rel="tag" href="https://www.codeproject.com/Tags/Cplusplus" data-id="78">C++</a></div><div class="t"><a rel="tag" href="https://www.codeproject.com/Tags/Windows" data-id="94">Windows</a></div><div class="t"><a rel="tag" href="https://www.codeproject.com/Tags/Visual-Studio" data-id="103">Visual-Studio</a></div><div class="t"><a rel="tag" href="https://www.codeproject.com/Tags/COM" data-id="130">COM</a></div></span> 

	
	
</span>


			        </div>

                    <div id="ctl00_VerticalStatsWrapper" class="stats">
                    <h4>Stats</h4>
                    <div id="ctl00_VerticalStats"><div class="stats"><div>116.8K views</div><div>2.2K downloads</div><div>101 bookmarked</div></div></div>
                    </div>

                    
                </div>
		    </div>
            

			
			<div id="AT" class="article-container  fixed"> 

				<div class="article">

					<form name="aspnetForm" method="post" action="./View.aspx" id="aspnetForm" style="margin:0;padding:0">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="m27q6XRAW3dyyB6+LVc+0cp4HeHTjbfhAsTzEL41MXgPLuR7LQS4AACFT/ca4+CSvnEkYtzZxWQhs7WAPY5HS44O0RRQnspu5HNE8ZISXiSlLlrXzvpzBvesd2KJFcbHv/haThetnbbKouik5YtXLzbU5rw/0l0Xweye04rAa6qdytho/VeLDsyPzPv8arEos3NqqZE2LR8TxluSJIuUIFB1p15IL3yJWv2+Tdrzz0SF/Wd8VNxA3sNXAkSj1yo4UbCmUKtwOmFtOxL1SIOBvNJ+LH9avQgIumUMx8/5AnjjtXVqbJqn2kwI4eYLKZBzN2WPdugfHS7VqrfpUi09pALmAtzbSHoG3u465NSTvccRhbGyrDDND+fghh7cMqY85E5mIy7gpvOINf0qYmSzxXnT1v9JUoUOlZyyKVxtZegoX6axbPqP2N284JAU2wmvB1I2VJR5eXuvXE+UByVGYgdaHJgFcVecHh6S9tzrQP4Yx/vjyifVX1bqkLt4zOxzcC4T8gHv2umuV/jnHf/kyarvaOOH2QnAdP0poJnAviij9D5Z+GtpClab5a6FH6dR0hF03Jy4G10SJuE55j7F37yxDk249+ZASKX/ZJxQ/dla/0Fl7S+i8nncJka7v3gMsY7QBenMg0WkZqHKvh/PBsFlMsqKlFSk8SuO3+kE5+yIrncdZvRVgTWTaYd234aRaXNvoGGLMoc8cEbx8iLamUQlDl+sHm0yoiRpyZuW8Eiptq5f7FJHCcQCDjZabmCct0/eFOv053FAw4psQRNYWY9GxgOQUE59nu8tDJT2r/dxNjYdAAKCeLOS0EzEAWzFk2AiguhNvSbuv6wTPyEicXDuywyAQE4N1+a9H7K0iIlyhyYkFXIQv0sGpWPuYihb7Qei+aiopC+3DTsbnjeOkzidJv+YVjmn5oHw0UX2sJPrCbQ/URaRBV6rlxLWHgVum5biwm8qT7WDo2HbwYmdoWbdQnc4Q8brDhQsfzT38lHm6M744ZaiOO5xi2SiGGAKSAbCipuGiGwYZZ4wWgcSPwAqrteut1Ep0V3Ia6ZJ0jCr52M3xdSggX/tm6XV4J2QiEQ8vkXQG5ulS5CjzH2yW8/vGKVvvmgn0HskzMLrqN1PLgTA6xAZxuCijh8Ntmftci+rVd1AX83YJr7SXrNO71nlt+w1lL1MUfwdlOJZkpd7WB4S5SdNgTzfTNRZml1jT19agIGhG1fywwvsDC0tplOzRHte6I+fcbKMf1x7LZGm0KnTXA3hxrgMahW5qzyt9wHavdDljOMcK8tuyz9NNPr0KbybCI63o8G3uKlG90N9RxprQQku3fshpeJTetqpFTvYnp7kHS7RlPf6+RQIHtyfxwbqf2rFsINiwNmvLa5i1azCcVc0WenMFSuP9yGwKVMuhTlD/o6AQRJ3+rNuTw3UtJNqE4YadwZO7I56cGkxZ9cxZARfZb1HmXCWBkuayefiJvMdslCItNGWx0aI+jWzk6KYoBzAaC3iiCw3uq6Mv7/8ZKQ6ZY+B7R+Hz0XH6+Zv3ncehjLPaffcC7WoVLV9HfMmvDsC2oeOCgai/7yDt/taUhiEmNXEGkGJ2q5bXzcMO7rgSvWcFy0Cy9gnviu/bbcYy+7GnMiCEHlivp9S52e65ONGCcfu7z8p03ktfTBaVSc7t6wZ/ccXkFCrzGivyKv0CMgDGr4EuKzovr2AWxQu6Cgx7e/iIWrKS1zowJnDp+0fH8qMpbXh65Qoc99Ew2YEC58poDSMMFm38oWyeyB5kfKh7pLkYugUwPxSHkC98OrViRJlC9z6KWkHf7kb3absJMvqBFYjlcqe5fmsExWfY24OBaMNQ+rpT7TaH18GwEfAG8ScFlVPatu/DNh47Hsrxk7ajdIJc5PSbyJLmD38ogGCJJEWAZ4kGPfyB6APMQ==">
</div>

<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="10C1FD69">
</div>

					
					 
					<div class="header">
					    <a name="Main"></a>

					    
					    <a name="_articleTop" id="_articleTop"></a>
					    <div class="title">
					        <h1 id="ctl00_ArticleTitle">COM in plain C, Part 5</h1>
					    </div>

                        <div>
					        
					        <div class="entry flex-container">

								

                                <div class="flex-item" style="flex:1 1 auto">
                                    <div class="flex-container" style="justify-content:space-between;flex-wrap:wrap-reverse">
                                       <span id="ctl00_Authors" class="author flex-item"><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=88625" rel="author">Jeff Glatt</a></span> 

                                        <div class="flex-item" style="margin-top:-4px;">
                                            <div id="ctl00_RateArticle_RatingTable" class="small-text" data-objectref="2_14183_1">

	<meta itemprop="upvoteCount" content="34">


	<div id="ctl00_RateArticle_RatingRow" class="flex-container rating-container large-stars">

					
		<div id="ctl00_RateArticle_Prompt" class="rating-prompt nowrap">Rate me:</div>

		
		<div class="nowrap tooltip">

			
			
			

			
			<div id="ctl00_RateArticle_RatingHistWrap" class="tooltip">

				
				<div id="ctl00_RateArticle_ResultWithHist" class="rating-result"><div class="flex-container rating-stars large-stars"><div><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/star-fill-lg.png" style="width:24px;height:24px"></div><div><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/star-fill-lg.png" style="width:24px;height:24px"></div><div><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/star-fill-lg.png" style="width:24px;height:24px"></div><div><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/star-fill-lg.png" style="width:24px;height:24px"></div><div style="width:22px;" class="clipped"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/star-fill-lg.png" style="width:24px;height:24px"></div><div style="width:2px;position:relative" class="clipped"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/star-empty-lg.png" style="width:24px;height:24px;position:absolute;top:0px;right:0"></div></div></div>
				

				<div class="speech-bubble-container-up-right" style="width:170px">
					<div class="speech-bubble-up-right">
						<div class="histogram"></div>
					</div>
					<div class="speech-bubble-pointer-up-right">
						<div class="speech-bubble-pointer-up-right-inner"></div>
					</div>
				</div>
			</div>

			
            

			
            <span id="ctl00_RateArticle_RatingSignin" class="speech-bubble-container-down">
		        <div class="speech-bubble-down">
                    Please <a id="ctl00_RateArticle_SignUp" href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fArticles%2f14183%2fCOM-in-plain-C-Part-5">Sign up or sign in</a> 
                    to vote.
		        </div>
		        <div class="speech-bubble-pointer-down">
			        <div class="speech-bubble-pointer-down-inner"></div>
		        </div>
	        </span>    

		</div>
		
	
		
		<div id="ctl00_RateArticle_VoteCountNoHist" class="rating-votes nowrap">4.94/5  (35 votes)</div>	

		

		
		<div class="rating-undo" title="Undo vote" style="margin-left:5px;display:none"></div>

		
		
	</div>

	
	

</div>

                                        </div>
                                    </div>

                                    <div class="flex-container">
                                        <span id="ctl00_LastUpdated" class="date flex-item-tight" title="Date last updated">21 May 2006</span><a id="ctl00_LicenseLink" title="The Code Project Open License (CPOL)" class="license flex-item-tight" href="http://www.codeproject.com/info/cpol10.aspx">CPOL</a><span id="ctl00_ReadingTime" class="stats flex-item-tight">18 min read</span>
                                    </div>
                                </div>
					        </div>

                            

                        </div>

                        <div id="ctl00_DescriptionSpot" class="summary">Add a connectable object (source/sink).</div><span id="ctl00_ThumbnailUrl" class="date" content="https://codeproject.global.ssl.fastly.net/script/Articles/Images/article100x80.png"></span>			

                    </div>
                    
					
					

					

					
					

					
					

						
					

					

						
						<div id="contentdiv" class="text">
						



<ul class="download">
<li><a href="https://www.codeproject.com/KB/COM/com_in_c5/com_in_c5_src.zip">Download source files - 246 Kb</a> </li></ul>
<h2>Contents</h2>
<ul>
<li><a href="#WRAP">Wrapping a callback function in a COM object</a> 
</li><li><a href="#CONNECT">IConnectionPointContainer and IConnectionPoint objects</a> 
</li><li><a href="#C1">An example C app</a> 
</li><li><a href="#SCRIPT">Adding support for script languages</a> 
</li><li><a href="#C2">Another example C app</a> 
</li><li><a href="#VB">A VBScript example</a> 
</li><li><a href="#MULT">Multiple types of callback objects</a> 
</li><li><a href="#MULT2">Multiple callback objects</a> </li></ul>
<h2>Introduction</h2>
<p>Often, it's convenient for a DLL function we call to "callback" into 
one of our own functions so that we can do some additional tasks at a 
particular point, or be notified that something has happened. For 
example, consider the standard C library function <code>qsort</code>. The fourth argument passed to <code>qsort</code> is a pointer to some function we provide to compare two items. In this way, when we call <code>qsort</code>, <code>qsort</code> allows us to determine the order that items are sorted, while <code>qsort</code> itself does the work of actually reordering the items.</p>
<p>We can't just provide any arbitrary function to <code>qsort</code>. The guy who wrote <code>qsort</code>
 specified exactly what arguments would be passed to our "compare" 
callback function, what our function returns, and of course, specified 
exactly what the purpose of our callback function is. Furthermore, <code>qsort</code> determines when our callback function is actually called (because it is <code>qsort</code> itself that calls our function). The guy who designed <code>qsort</code> mandated that our compare callback function <b>must</b> be defined as so:</p><div class="pre-lang" id="premain384626"><div></div><div class="pre-action-link"><span id="copycode384626" class="copy-code" data-index="384626" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre384626" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-keyword">int</span> (__cdecl *compare)(<span class="code-keyword">const</span> <span class="code-keyword">void</span> *elem1, <span class="code-keyword">const</span> <span class="code-keyword">void</span> *elem2);</pre>
<p>Let's create our own version of <code>qsort</code>, which we'll call <code>Sort</code>. (Actually, we'll cheat to make this simpler, and just do a bubble sort.) And let's assume that we'll put this in a DLL named <i>ISort.dll</i>.</p>
<p>Instead of passing <code>Sort</code> a pointer to the compare function each time, let's design this so that the app will first call a separate <code>SetCompare</code> function to allow our DLL to store the pointer in some global. Let's also put a function in the DLL called <code>UnsetCompare</code> that an app can call to clear that function pointer. So here's our DLL source code (that we'll put in a file called <i>ISort.c</i>):</p><div class="pre-lang" id="premain376164"><div></div><div class="pre-action-link"><span class="code-collapse" data-index="376164" id="preShrink376164">Shrink </span> &nbsp; <span id="copycode376164" class="copy-code" data-index="376164" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre376164" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-comment">//</span><span class="code-comment"> A global to store the pointer to the app's Compare function</span>
<span class="code-keyword">int</span> (STDMETHODCALLTYPE *CompareFunc)(<span class="code-keyword">const</span> <span class="code-keyword">void</span> *, <span class="code-keyword">const</span> <span class="code-keyword">void</span> *);

<span class="code-keyword">void</span> STDMETHODCALLTYPE SetCompare(
     <span class="code-keyword">int</span> (STDMETHODCALLTYPE *compare)(<span class="code-keyword">const</span> <span class="code-keyword">void</span> *, <span class="code-keyword">const</span> <span class="code-keyword">void</span> *))
{
   <span class="code-comment">//</span><span class="code-comment"> Save the compare function ptr in a global</span>
   CompareFunc = compare;
}

<span class="code-keyword">void</span> STDMETHODCALLTYPE UnsetCompare(<span class="code-keyword">void</span>)
{
   CompareFunc = <span class="code-digit">0</span>;
}

HRESULT STDMETHODCALLTYPE Sort(<span class="code-keyword">void</span> *base, 
        DWORD numElems, DWORD sizeElem)
{
   <span class="code-keyword">void</span>   *hi;
   <span class="code-keyword">void</span>      *p;
   <span class="code-keyword">void</span>   *lo;
   <span class="code-keyword">void</span>   *tmp;

   <span class="code-comment">//</span><span class="code-comment"> Has the app set its Compare function pointer yet?</span>
   <span class="code-keyword">if</span> (!CompareFunc) <span class="code-keyword">return</span>(E_FAIL);

   <span class="code-comment">//</span><span class="code-comment"> Do the (bubble) sort</span>
   <span class="code-keyword">if</span> ((tmp = GlobalAlloc(GMEM_FIXED, sizeElem)))
   {
      hi = ((<span class="code-keyword">char</span> *)<span class="code-keyword">base</span> + ((numElems - <span class="code-digit">1</span>) * sizeElem));
      lo = <span class="code-keyword">base</span>;

      <span class="code-keyword">while</span> (hi &gt; <span class="code-keyword">base</span>)
      {
         lo = <span class="code-keyword">base</span>;
         p = ((char*)<span class="code-keyword">base</span> + sizeElem);
         <span class="code-keyword">while</span> (p &lt;= hi)
         {
            <span class="code-keyword">if</span> ((*CompareFunc)(p, lo) &gt; <span class="code-digit">0</span>) lo = p;
            (<span class="code-keyword">char</span> *)p += sizeElem;
         }

         CopyMemory(tmp, lo, sizeElem);
         CopyMemory(lo, hi, sizeElem);
         CopyMemory(hi, tmp, sizeElem);
         (<span class="code-keyword">char</span> *)hi -= sizeElem;
      }

      GlobalFree(tmp);
      <span class="code-keyword">return</span>(S_OK);
   }

   <span class="code-keyword">return</span>(E_OUTOFMEMORY);
}</pre>
<p>Now, let's write an app that uses our DLL to sort an array of five <code>DWORD</code>s. First, the app calls <code>SetCompare</code> to specify its compare callback function (which we'll name <code>Compare</code>). Then, the app calls <code>Sort</code>. Finally, when our app is finished using <code>Sort</code>, and we wish to make sure that any additional calls to <code>Sort</code> do not accidentally cause it to call our <code>Compare</code> function, we call <code>UnsetCompare</code>.</p><div class="pre-lang" id="premain134311"><div></div><div class="pre-action-link"><span class="code-collapse" data-index="134311" id="preShrink134311">Shrink </span> &nbsp; <span id="copycode134311" class="copy-code" data-index="134311" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre134311" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-comment">//</span><span class="code-comment"> An array of 5 DWORDs to be sorted</span>
DWORD Array[5] = {<span class="code-digit">2</span>, <span class="code-digit">3</span>, <span class="code-digit">1</span>, <span class="code-digit">5</span>, <span class="code-digit">4</span>};

<span class="code-comment">//</span><span class="code-comment"> Our Compare function</span>
<span class="code-keyword">int</span> STDMETHODCALLTYPE Compare(<span class="code-keyword">const</span> <span class="code-keyword">void</span> *elem1, <span class="code-keyword">const</span> <span class="code-keyword">void</span> *elem2)
{
   <span class="code-comment">//</span><span class="code-comment"> Do a compare of the two elements. We know that</span>
   <span class="code-comment">//</span><span class="code-comment"> we passed an array of DWORD values to Sort()</span>
   <span class="code-keyword">if</span> (*((DWORD *)elem1) == *((DWORD *)elem2)) <span class="code-keyword">return</span> <span class="code-digit">0</span>;
   <span class="code-keyword">if</span> (*((DWORD *)elem1) *lt; *((DWORD *)elem2)) <span class="code-keyword">return</span> -1;
   <span class="code-keyword">return</span> <span class="code-digit">1</span>;
}

<span class="code-keyword">int</span> main(<span class="code-keyword">int</span> argc, <span class="code-keyword">char</span> **argv)
{
   <span class="code-comment">//</span><span class="code-comment"> Give ISort.dll our Compare function ptr</span>
   SetCompare(Compare);

   <span class="code-comment">//</span><span class="code-comment"> Sort of array of 5 DWORDs</span>
   Sort(&amp;Array[0], <span class="code-digit">5</span>, <span class="code-keyword">sizeof</span>(DWORD));

   UnsetCompare();

   <span class="code-keyword">return</span> <span class="code-digit">0</span>;
}</pre>
<h2><a name="WRAP">Wrapping</a> a callback function in a COM object</h2>
<p>COM also has a facility to allow callbacks, but as you may have 
feared, it's not quite as straight-forward as our example above. In the 
directory named <i>ISort</i>, you'll find the files to a COM object that implements our above Sort DLL.</p>
<p>First of all, we have to wrap our <code>Sort</code> function inside some COM object. After all, we're going to turn <i>ISort.dll</i> into a COM component. Let's define an <code>ISort</code> object, using the <code>DECLARE_INTERFACE_</code> macro Microsoft provides. Like all COM objects, its VTable begins with the <code>QueryInterface</code>, <code>AddRef</code>, and <code>Release</code> functions. We won't bother adding any <code>IDispatch</code> function to it. (Our <code>ISort</code> is not useable by script languages such as VBScript). And then, we'll add the <code>Sort</code> function as the first extra function. Here's the definition that we'll put in <i>ISort.h</i>:</p><div class="pre-lang" id="premain672221"><div></div><div class="pre-action-link"><span id="copycode672221" class="copy-code" data-index="672221" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre672221" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-preprocessor">#undef INTERFACE
</span><span class="code-preprocessor">#define INTERFACE  ISort
</span>DECLARE_INTERFACE_ (INTERFACE, IUnknown)
{
   STDMETHOD  (QueryInterface) (THIS_ REFIID, <span class="code-keyword">void</span> **) PURE;
   STDMETHOD_ (ULONG, AddRef)  (THIS) PURE;
   STDMETHOD_ (ULONG, Release) (THIS) PURE;
   STDMETHOD  (Sort)           (THIS_ <span class="code-keyword">void</span> *, DWORD, DWORD) PURE;
};</pre>
<p>So our app is going to get an instance of our <code>ISort</code> object and call its <code>Sort</code>
 function. You've now had plenty of experience writing C/C++ apps that 
get a COM object and call its functions. That's nothing new.</p>
<p>And of course, we need to run <i>GUIDGEN.EXE</i> to generate a GUID for our <code>ISort</code> object and its VTable. We'll give them names of <code>CLSID_ISort</code> and <code>IID_ISort</code> respectively, and put them in <i>ISort.h</i>.</p><div class="pre-lang" id="premain11933"><div></div><div class="pre-action-link"><span id="copycode11933" class="copy-code" data-index="11933" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre11933" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-comment">//</span><span class="code-comment"> ISort object's GUID</span>
<span class="code-comment">//</span><span class="code-comment"> {619321BA-4907-4596-874A-AEFF082F0014}</span>
DEFINE_GUID(CLSID_ISort, <span class="code-digit">0x619321ba</span>, <span class="code-digit">0x4907</span>, <span class="code-digit">0x4596</span>,
 <span class="code-digit">0x87</span>, <span class="code-digit">0x4a</span>, <span class="code-digit">0xae</span>, <span class="code-digit">0xff</span>, <span class="code-digit">0x8</span>, <span class="code-digit">0x2f</span>, <span class="code-digit">0x0</span>, <span class="code-digit">0x14</span>);

<span class="code-comment">//</span><span class="code-comment"> ISort VTable's GUID</span>
<span class="code-comment">//</span><span class="code-comment"> {4C9A7D40-D0ED-45ea-9520-1CB9095973F8}</span>
DEFINE_GUID(IID_ISort, <span class="code-digit">0x4c9a7d40</span>, <span class="code-digit">0xd0ed</span>, <span class="code-digit">0x45ea</span>,
 <span class="code-digit">0x95</span>, <span class="code-digit">0x20</span>, <span class="code-digit">0x1c</span>, <span class="code-digit">0xb9</span>, <span class="code-digit">0x9</span>, <span class="code-digit">0x59</span>, <span class="code-digit">0x73</span>, <span class="code-digit">0xf8</span>);</pre>
<p>And like we typically do, we'll need to add at least one, extra, private data member to our <code>ISort</code> object -- a reference count member. So, we'll define a <code>MyRealISort</code> inside <i>ISort.c</i> that adds this extra private member to our <code>ISort</code>:</p><div class="pre-lang" id="premain942913"><div></div><div class="pre-action-link"><span id="copycode942913" class="copy-code" data-index="942913" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre942913" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">typedef <span class="code-keyword">struct</span> {
   ISortVtbl   *lpVtbl;   <span class="code-comment">//</span><span class="code-comment"> ISort's VTable</span>
   DWORD       count;     <span class="code-comment">//</span><span class="code-comment"> ISort's reference count</span>
} MyRealISort;</pre>
<p>By now, all of this should be quite familiar to you.</p>
<p>All that's left is to provide some way for an app to give us a pointer to its <code>Compare</code> function so our <code>Sort</code> function can call it. So, do we simply add <code>SetCompare</code> and <code>UnsetCompare</code> functions to our <code>ISort</code> VTable? Nope.</p>
<p>Here's where it starts to get complicated. Microsoft needed some 
standard way to allow an app to provide its callback functions to a COM 
object. Microsoft decided that an app should wrap its callback functions
 in a COM object. What particular COM object? That depends.</p>
<p>Remember how it was the author of <code>qsort</code> who determined what arguments were passed to the callback, and what it returned? Well, since we're the guys writing our <code>ISort</code>
 object, we get to make up our own COM object that the app must use to 
wrap any callback functions we require. So, let's just define our own 
COM object that we'll call an <code>ICompare</code>. Of course, we must start its VTable with the three functions <code>QueryInterface</code>, <code>AddRef</code>, and <code>Release</code>.
 So, what do we want next? Let's see... Do we want to support script 
languages supplying us a compare function (such as a VBScript function)?
 If so, we'd put some <code>IDispatch</code> functions next. No, let's skip that, and for now, only allow a C/C++ app to provide us with a compare callback.</p>
<p>Let's add an extra function to <code>ICompare</code>. We'll call it <code>Compare</code>.
 That will be the app's compare callback. (So now, you see how the app 
has to wrap its callback in our own defined COM object.) Here's the 
definition of our <code>ICompare</code> (which we'll add to <i>ISort.h</i>):</p><div class="pre-lang" id="premain557081"><div></div><div class="pre-action-link"><span id="copycode557081" class="copy-code" data-index="557081" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre557081" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-preprocessor">#undef INTERFACE
</span><span class="code-preprocessor">#define INTERFACE  ICompare
</span>DECLARE_INTERFACE_ (INTERFACE, IUnknown)
{
   STDMETHOD  (QueryInterface) (THIS_ REFIID, <span class="code-keyword">void</span> **) PURE;
   STDMETHOD_ (ULONG, AddRef)  (THIS) PURE;
   STDMETHOD_ (ULONG, Release) (THIS) PURE;
   STDMETHOD_ (<span class="code-keyword">long</span>, Compare)  (THIS_ <span class="code-keyword">const</span> <span class="code-keyword">void</span> *, 
                                <span class="code-keyword">const</span> <span class="code-keyword">void</span> *) PURE;
};</pre>
<p>We do need to run <i>GUIDGEN.EXE</i> to create a GUID for our <code>ICompare</code>'s VTable. (We won't need a GUID for the object itself). We'll give it the name of <code>DIID_Compare</code>. (Traditionally, Microsoft prepends a <i>D</i> to the names of GUIDs intended for VTables that wrap callbacks. We'll just follow the tradition.)</p><div class="pre-lang" id="premain851484"><div></div><div class="pre-action-link"><span id="copycode851484" class="copy-code" data-index="851484" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre851484" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate"><span class="code-comment">//</span><span class="code-comment"> ICompare VTable's GUID</span>
<span class="code-comment">//</span><span class="code-comment"> {4115B8E2-1823-4bbc-B10D-3D33AAA12ACF}</span>
DEFINE_GUID(DIID_ICompare, <span class="code-digit">0x4115b8e2</span>, <span class="code-digit">0x1823</span>, <span class="code-digit">0x4bbc</span>,
 <span class="code-digit">0xb1</span>, <span class="code-digit">0xd</span>, <span class="code-digit">0x3d</span>, <span class="code-digit">0x33</span>, <span class="code-digit">0xaa</span>, <span class="code-digit">0xa1</span>, <span class="code-digit">0x2a</span>, <span class="code-digit">0xcf</span>);</pre>
<p>Let's go back to our app. Now, we have to put a COM object inside our app code. Specifically, we have to create an <code>ICompare</code> object, and have our <code>Compare</code> callback be its extra function. Because we'll need only one <code>ICompare</code> object, we'll simply declare it static. We'll also have to <code>#include ISort.h</code> because that contains the definition of the <code>ICompare</code> object, its VTable, and its GUID. So, here's the code we insert to replace the <code>Compare</code> function in our above app code:</p><div class="pre-lang" id="premain82956"><div></div><div class="pre-action-link"><span class="code-collapse" data-index="82956" id="preShrink82956">Shrink </span> &nbsp; <span id="copycode82956" class="copy-code" data-index="82956" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre82956" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">#include <span class="code-string">"</span><span class="code-string">ISort.h"</span>

<span class="code-comment">//</span><span class="code-comment"> Here's our app's ICompare object. We need only one of these,</span>
<span class="code-comment">//</span><span class="code-comment"> so we'll just declare it static. That way, we don't have to</span>
<span class="code-comment">//</span><span class="code-comment"> allocate it, free it, nor maintain any reference count.</span>
<span class="code-keyword">static</span> ICompare   MyCompare;

<span class="code-comment">//</span><span class="code-comment"> This is ICompare's QueryInterface. It returns a pointer</span>
<span class="code-comment">//</span><span class="code-comment"> to our ICompare object.</span>
HRESULT STDMETHODCALLTYPE QueryInterface(ICompare *this,
      REFIID vTableGuid, <span class="code-keyword">void</span> **ppv)
{
   <span class="code-comment">//</span><span class="code-comment"> Since this is an ICompare object, we must recognize</span>
   <span class="code-comment">//</span><span class="code-comment"> ICompare VTable's GUID, which is defined for us in</span>
   <span class="code-comment">//</span><span class="code-comment"> ISort.h. Our ICompare can also masquerade as an IUnknown.</span>
   <span class="code-keyword">if</span> (!IsEqualIID(vTableGuid, &amp;IID_IUnknown) &amp;&amp;
      !IsEqualIID(vTableGuid, &amp;DIID_ICompare))
   {
      *ppv = <span class="code-digit">0</span>;
      <span class="code-keyword">return</span>(E_NOINTERFACE);
   }

   *ppv = <span class="code-keyword">this</span>;

   <span class="code-comment">//</span><span class="code-comment"> Normally, we'd call our AddRef function here. But since</span>
   <span class="code-comment">//</span><span class="code-comment"> our ICompare isn't allocated, we don't need to bother</span>
   <span class="code-comment">//</span><span class="code-comment"> with reference counting.</span>
   <span class="code-keyword">return</span>(NOERROR);
}

ULONG STDMETHODCALLTYPE AddRef(ICompare *this)
{
   <span class="code-comment">//</span><span class="code-comment"> Our one and only ICompare isn't allocated. Instead, it's</span>
   <span class="code-comment">//</span><span class="code-comment"> statically declared above (MyCompare). So we'll just</span>
   <span class="code-comment">//</span><span class="code-comment"> return 1.</span>
   <span class="code-keyword">return</span>(<span class="code-digit">1</span>);
}

ULONG STDMETHODCALLTYPE Release(ICompare *this)
{
   <span class="code-comment">//</span><span class="code-comment"> Our one and only ICompare isn't allocated, so we</span>
   <span class="code-comment">//</span><span class="code-comment"> never need worry about freeing it.</span>
   <span class="code-keyword">return</span>(<span class="code-digit">1</span>);
}

<span class="code-comment">//</span><span class="code-comment"> This is the extra function for ICompare. It is called</span>
<span class="code-comment">//</span><span class="code-comment"> Compare. The ISort object will call this function when</span>
<span class="code-comment">//</span><span class="code-comment"> we call ISort's Sort function.</span>
<span class="code-keyword">long</span> STDMETHODCALLTYPE Compare(ICompare *this,
      <span class="code-keyword">const</span> <span class="code-keyword">void</span> *elem1, <span class="code-keyword">const</span> <span class="code-keyword">void</span> *elem2)
{
   <span class="code-comment">//</span><span class="code-comment"> Do a compare of the two elements. We know that</span>
   <span class="code-comment">//</span><span class="code-comment"> we passed an array of DWORD values to Sort().</span>
   <span class="code-keyword">if</span> (*((DWORD *)elem1) == *((DWORD *)elem2)) <span class="code-keyword">return</span> <span class="code-digit">0</span>;
   <span class="code-keyword">if</span> (*((DWORD *)elem1) &lt; *((DWORD *)elem2)) <span class="code-keyword">return</span> -1;
   <span class="code-keyword">return</span> <span class="code-digit">1</span>;
}

<span class="code-comment">//</span><span class="code-comment"> Our ICompare VTable. We need only one of these, so we can</span>
<span class="code-comment">//</span><span class="code-comment"> declare it static.</span>
<span class="code-keyword">static</span> <span class="code-keyword">const</span> ICompareVtbl ICompare_Vtbl = {QueryInterface,
AddRef,
Release,
Compare};</pre>
<p>Notice that our <code>Compare</code> function is there. It's simply wrapped inside an <code>ICompare</code> object now. (And the first argument passed to it is now a pointer to our <code>ICompare</code> object, which will be our statically declared <code>MyCompare</code>, in this case.)</p>
<p>Now, we're left with the really convoluted job. How does our app give its <code>ICompare</code> object to our <code>ISort</code> object (inside <i>ISort.dll</i>)?
 I really wish I could say that this is going to be simple and 
easy-to-understand, but unfortunately, due to some dubious design 
decisions by the MS guys who devised this whole scheme, it's going to be
 a painfully twisted trip through the house of horrors.</p>
<h2><a name="CONNECT">IConnectionPointContainer</a> and IConnectionPoint objects</h2>
<p>To let an app give its <code>ICompare</code> object to our <code>ISort</code> object, we have to add some things to our <code>ISort</code>
 object. Specifically, we have to add two sub-objects to it. (Hopefully,
 in the last chapter, you have read and understand how to create an 
object that has sub-objects.)</p>
<p>One good thing is that Microsoft has already defined these two 
sub-objects (and their VTable GUIDs) in some include files that ship 
with your compiler. The two sub-objects are called <code>IConnectionPointContainer</code> and <code>IConnectionPoint</code>. All we need to do is add them to our <code>ISort</code> object. Since we've already defined a <code>MyRealISort</code>, we'll just embed these two sub-objects inside it. And since we know that an app is going to give us a pointer to an <code>ICompare</code> object, let's also add a place to store that inside <code>MyRealISort</code>.</p><div class="pre-lang" id="premain55343"><div></div><div class="pre-action-link"><span id="copycode55343" class="copy-code" data-index="55343" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre55343" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">typedef <span class="code-keyword">struct</span> {
   ISortVtbl                 *lpVtbl;
   DWORD                     count;
   IConnectionPointContainer container;
   IConnectionPoint          point;
   ICompare                  *compare;
} MyRealISort;</pre>
<p>Note that our base object is our <code>ISort</code> itself. We could notate it like so:</p><div class="pre-lang" id="premain20962"><div></div><div class="pre-action-link"><span id="copycode20962" class="copy-code" data-index="20962" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre20962" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">typedef <span class="code-keyword">struct</span> {
   ISort                     iSort;
   DWORD                     count;
   IConnectionPointContainer container;
   IConnectionPoint          point;
   ICompare                  *compare;
} MyRealISort;</pre>
<p>But since an <code>ISort</code> has only its one <code>lpVtbl</code> member, both definitions amount to the same thing.</p>
<p>As you'll remember from the last chapter, the base object's <code>QueryInterface</code> must recognize the GUIDs of all of its sub-object's VTables, as well as its own VTable. So our <code>ISort</code> <code>QueryInterface</code> must look like so:</p><div class="pre-lang" id="premain146190"><div></div><div class="pre-action-link"><span class="code-collapse" data-index="146190" id="preShrink146190">Shrink </span> &nbsp; <span id="copycode146190" class="copy-code" data-index="146190" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre146190" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">HRESULT STDMETHODCALLTYPE QueryInterface(ISort *this, 
        REFIID vTableGuid, <span class="code-keyword">void</span> **ppv)
{
   <span class="code-comment">//</span><span class="code-comment"> Because an IConnectionPointContainer</span>
   <span class="code-comment">//</span><span class="code-comment"> is a sub-object of our ISort, we</span>
   <span class="code-comment">//</span><span class="code-comment"> must return a pointer to this sub-object</span>
   <span class="code-comment">//</span><span class="code-comment"> if the app asks for it. Because</span>
   <span class="code-comment">//</span><span class="code-comment"> we've embedded our IConnectionPointContainer</span>
   <span class="code-comment">//</span><span class="code-comment"> object inside of our</span>
   <span class="code-comment">//</span><span class="code-comment"> MyRealISort, we can get that sub-object</span>
   <span class="code-comment">//</span><span class="code-comment"> very easily using pointer arithmetic.</span>
   <span class="code-keyword">if</span> (IsEqualIID(vTableGuid, &amp;IID_IConnectionPointContainer))
      *ppv = ((unsigned <span class="code-keyword">char</span> *)<span class="code-keyword">this</span> + 
               offsetof(MyRealISort, container));

   <span class="code-keyword">else</span> <span class="code-keyword">if</span> (IsEqualIID(vTableGuid, &amp;IID_IUnknown) || 
            IsEqualIID(vTableGuid, &amp;IID_ISort))
      *ppv = <span class="code-keyword">this</span>;

   <span class="code-keyword">else</span>
   {
      *ppv = <span class="code-digit">0</span>;
      <span class="code-keyword">return</span>(E_NOINTERFACE);
   }

   this-&gt;lpVtbl-&gt;AddRef(<span class="code-keyword">this</span>);

   <span class="code-keyword">return</span>(NOERROR);
}</pre>
<p>But wait. Did we forget to also check for our <code>IConnectionPoint</code>
 sub-object's VTable GUID, and return a pointer to that? No, we didn't 
forget. Unfortunately, the MS guys who thought up this design kind of 
broke the rules. The <code>IConnectionPoint</code> sub-object is not gotten by calling the base object's <code>QueryInterface</code> (nor the <code>QueryInterface</code> of our <code>IConnectionPointContainer</code> sub-object). In a moment, we'll see how it's gotten.</p>
<p>The <code>IConnectionPointContainer</code> sub-object can serve two purposes.</p>
<p>First of all, by passing an <code>IConnectionPointContainer</code> VTable GUID to our <code>ISort</code>'s <code>QueryInterface</code> function, an app can determine whether our <code>ISort</code> accepts callback functions. Incidentally, in COM documentation, such an object (i.e., one that provides an <code>IConnectionPointContainer</code>) is described as <i>sourcing events</i>. If <code>QueryInterface</code> returns a pointer to an <code>IConnectionPointContainer</code>, then the object can source events. (If not, then a 0 is returned.)</p>
<p>Secondly, the <code>IConnectionPointContainer</code> has a function to get an <code>IConnectionPoint</code> sub-object. That function is called <code>FindConnectionPoint</code>.</p>
<p>So, let's write the functions of our <code>IConnectionPointContainer</code> sub-object. Because it's a sub-object of <code>ISort</code>, and <code>ISort</code> is the base object, our <code>IConnectionPointContainer</code>'s <code>QueryInterface</code>, <code>AddRef</code>, and <code>Release</code> functions simply delegate to <code>ISort</code>'s <code>QueryInterface</code>, <code>AddRef</code>, and <code>Release</code>.</p><div class="pre-lang" id="premain577329"><div></div><div class="pre-action-link"><span class="code-collapse" data-index="577329" id="preShrink577329">Shrink </span> &nbsp; <span id="copycode577329" class="copy-code" data-index="577329" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre577329" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">STDMETHODIMP QueryInterface_Connect(IConnectionPointContainer *this,
                                    REFIID vTableGuid, <span class="code-keyword">void</span> **ppv)
{
   <span class="code-comment">//</span><span class="code-comment"> Because this is a sub-object of our ISort (ie, MyRealISort) object,</span>
   <span class="code-comment">//</span><span class="code-comment"> we delegate to ISort's QueryInterface. And because we embedded the</span>
   <span class="code-comment">//</span><span class="code-comment"> IConnectionPointContainer directly inside of MyRealISort, all we need</span>
   <span class="code-comment">//</span><span class="code-comment"> is a little pointer arithmetic to get our ISort.</span>
   <span class="code-keyword">return</span>(QueryInterface((ISort *)((<span class="code-keyword">char</span> *)<span class="code-keyword">this</span> - 
          offsetof(MyRealISort, container)), vTableGuid, ppv));
}

STDMETHODIMP_(ULONG) AddRef_Connect(IConnectionPointContainer *this)
{
   <span class="code-comment">//</span><span class="code-comment"> Because we're a sub-object of ISort, delegate to its AddRef()</span>
   <span class="code-comment">//</span><span class="code-comment"> in order to increment ISort's reference count.</span>
   <span class="code-keyword">return</span>(AddRef((ISort *)((<span class="code-keyword">char</span> *)<span class="code-keyword">this</span> - offsetof(MyRealISort, container))));
}

STDMETHODIMP_(ULONG) Release_Connect(IConnectionPointContainer *this)
{
   <span class="code-comment">//</span><span class="code-comment"> Because we're a sub-object of ISort, delegate to its Release()</span>
   <span class="code-comment">//</span><span class="code-comment"> in order to decrement ISort's reference count.</span>
   <span class="code-keyword">return</span>(Release((ISort *)((<span class="code-keyword">char</span> *)<span class="code-keyword">this</span> - offsetof(MyRealISort, container))));
}</pre>
<p>For now, we're going to use a stub for the <code>EnumConnectionPoints</code> function.</p><div class="pre-lang" id="premain936750"><div></div><div class="pre-action-link"><span id="copycode936750" class="copy-code" data-index="936750" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre936750" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">STDMETHODIMP EnumConnectionPoints(IConnectionPointContainer *this,
             IEnumConnectionPoints **enumPoints)
{
   *enumPoints = <span class="code-digit">0</span>;
   <span class="code-keyword">return</span>(E_NOTIMPL);
}</pre>
<p>The real work is in <code>FindConnectionPoint</code>. The app passes us a handle to where it wants us to return <code>ISort</code>'s <code>IConnectionPoint</code> sub-object. Since we've embedded it directly inside <code>MyRealISort</code>, it's easy to locate.</p>
<p>The app also passes us the VTable GUID we defined for our <code>ICompare</code>
 (callback) object. That's how we know that the app really does mean to 
provide us with the correct object that we require. We don't want to 
return a <code>IConnectionPoint</code> if the app isn't prepared to give us an <code>ICompare</code> object.</p><div class="pre-lang" id="premain399750"><div></div><div class="pre-action-link"><span class="code-collapse" data-index="399750" id="preShrink399750">Shrink </span> &nbsp; <span id="copycode399750" class="copy-code" data-index="399750" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre399750" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">STDMETHODIMP FindConnectionPoint(IConnectionPointContainer *this,
             REFIID vTableGuid, IConnectionPoint **ppv) 
{
   <span class="code-comment">//</span><span class="code-comment"> Is the app asking us to return an IConnectionPoint object it can use</span>
   <span class="code-comment">//</span><span class="code-comment"> to give us its ICompare object? The app asks this by passing us</span>
   <span class="code-comment">//</span><span class="code-comment"> ICompare VTable's GUID (which we defined in ISort.h).</span>
   <span class="code-keyword">if</span> (IsEqualIID(vTableGuid, &amp;DIID_ICompare))
   {
      MyRealISort  *iSort;

      <span class="code-comment">//</span><span class="code-comment"> The app obviously wants to give its ICompare object to our</span>
      <span class="code-comment">//</span><span class="code-comment"> ISort. In order to do that, we need to give the app a standard</span>
      <span class="code-comment">//</span><span class="code-comment"> IConnectionPoint. This is easy to do since we embedded both</span>
      <span class="code-comment">//</span><span class="code-comment"> our IConnectionPointContainer and IConnectionPoint inside of our </span>
      <span class="code-comment">//</span><span class="code-comment"> ISort. All we need is a little pointer arithmetic.</span>
      iSort = (MyRealISort *)((<span class="code-keyword">char</span> *)<span class="code-keyword">this</span> - offsetof(MyRealISort, container));
      *ppv = &amp;iSort-&gt;point;

      <span class="code-comment">//</span><span class="code-comment"> Because we're giving the app a pointer to our IConnectionPoint,</span>
      <span class="code-comment">//</span><span class="code-comment"> and our IConnectionPoint is a sub-object of ISort, we need to</span>
      <span class="code-comment">//</span><span class="code-comment"> increment ISort's reference count. The easiest way to do this is</span>
      <span class="code-comment">//</span><span class="code-comment"> to call our IConnectionPointContainer's AddRef, because all we do</span>
      <span class="code-comment">//</span><span class="code-comment"> there is delegate to our ISort's AddRef.</span>
      AddRef_Connect(<span class="code-keyword">this</span>);

      <span class="code-keyword">return</span>(S_OK);
   }

   <span class="code-comment">//</span><span class="code-comment"> We don't support any other app callback objects for our ISort.</span>
   <span class="code-comment">//</span><span class="code-comment"> All we've defined, and support, is an ICompare object. Tell</span>
   <span class="code-comment">//</span><span class="code-comment"> the app we don't know anything about the GUID he passed to us, and</span>
   <span class="code-comment">//</span><span class="code-comment"> do not give him any IConnectionPoint object.</span>
   *ppv = <span class="code-digit">0</span>;
   <span class="code-keyword">return</span>(E_NOINTERFACE);
}</pre>
<p>That takes care of our <code>IConnectionPointContainer</code>'s functions. Now we need to write our <code>IConnectionPoint</code>'s functions.</p>
<p>Since <code>IConnectionPoint</code> is also a sub-object of <code>ISort</code> (just like <code>IConnectionPointContainer</code>), its <code>QueryInterface</code>, <code>AddRef</code>, and <code>Release</code> will delegate to <code>ISort</code>'s <code>QueryInterface</code>, <code>AddRef</code>, and <code>Release</code>. I won't bother reproducing those functions since they are almost identical to <code>IConnectionPointContainer</code>'s.</p>
<p>For now, we're going to use a stub for the <code>EnumConnections</code> function.</p>
<p>The <code>GetConnectionInterface</code> function simply copies <code>ICompare</code>'s VTable GUID to a buffer that the app passes. Later, we'll see the use for this.</p>
<p>The <code>GetConnectionPointContainer</code> function returns a pointer to the <code>IConnectionPointContainer</code> sub-object that created this <code>IConnectionPoint</code> object. What this implies is that, as long as the app is holding onto some <code>IConnectionPoint</code> sub-object that our <code>IConnectionPointContainer</code> gives to the app, our <code>IConnectionPointContainer</code> must stick around. This is no problem here since we've embedded both our <code>IConnectionPointContainer</code> and <code>IConnectionPoint</code> inside our <code>MyRealISort</code> (and our <code>MyRealISort</code> is going to stick around until all its sub-objects and base object are <code>Release</code>d).</p>
<p>The above three functions are fairly trivial, so I'll simply refer you to the source code in <i>Sort.c</i>.</p>
<p>The real work is in the <code>Advise</code> and <code>Unadvise</code> functions. This is how an app actually gives us its <code>ICompare</code>. <code>Advise</code> essentially does the same task as our <code>SetCompare</code> function did. And <code>Unadvise</code> does what our <code>UnsetCompare</code> did.</p>
<p>Let's look at <code>Advise</code>:</p><div class="pre-lang" id="premain696988"><div></div><div class="pre-action-link"><span class="code-collapse" data-index="696988" id="preShrink696988">Shrink </span> &nbsp; <span id="copycode696988" class="copy-code" data-index="696988" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre696988" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">STDMETHODIMP Advise(IConnectionPoint *this, IUnknown *obj, DWORD *cookie) 
{
   HRESULT     hr;
   MyRealISort *iSort;

   <span class="code-comment">//</span><span class="code-comment"> Get our MyRealISort that this IConnectionPoint sub-object belongs</span>
   <span class="code-comment">//</span><span class="code-comment"> to. Because this IConnectPoint sub-object is embedded directly</span>
   <span class="code-comment">//</span><span class="code-comment"> inside its MyRealISort, all we need is a little pointer arithmetic.</span>
   iSort = (MyRealISort *)((<span class="code-keyword">char</span> *)<span class="code-keyword">this</span> - offsetof(MyRealISort, point));

   <span class="code-comment">//</span><span class="code-comment"> We allow only one ICompare for our ISort, so see if the app already</span>
   <span class="code-comment">//</span><span class="code-comment"> called our Advise(), and we got one. If so, let the app know that it</span>
   <span class="code-comment">//</span><span class="code-comment"> is trying to give us more ICompares than we allow.</span>
   <span class="code-keyword">if</span> (iSort-&gt;compare) <span class="code-keyword">return</span>(CONNECT_E_ADVISELIMIT);
 
   <span class="code-comment">//</span><span class="code-comment"> Ok, we haven't yet gotten the one ICompare we allow from the app. Get</span>
   <span class="code-comment">//</span><span class="code-comment"> the app's ICompare object. We do this by calling the QueryInterface</span>
   <span class="code-comment">//</span><span class="code-comment"> function of the app object passed to us. We pass ICompare VTable's</span>
   <span class="code-comment">//</span><span class="code-comment"> GUID (which we defined in ISort.h).</span>
   <span class="code-comment">//</span><span class="code-comment"></span>
   <span class="code-comment">//</span><span class="code-comment"> Save the app's ICompare pointer in our ISort compare member, so we</span>
   <span class="code-comment">//</span><span class="code-comment"> can get it when we need it.</span>
   hr = obj-&gt;lpVtbl-&gt;QueryInterface(obj, &amp;DIID_ICompare, &amp;iSort-&gt;compare);

   <span class="code-comment">//</span><span class="code-comment"> We need to return (to the app) some value that will clue our Unadvise()</span>
   <span class="code-comment">//</span><span class="code-comment"> function below how to locate this app ICompare. The simpliest thing is</span>
   <span class="code-comment">//</span><span class="code-comment"> to just use the app's ICompare pointer as that return value.</span>
   *cookie = (DWORD)iSort-&gt;compare;

   <span class="code-keyword">return</span>(hr);
}</pre>
<p>Actually, the app doesn't pass a pointer to its <code>ICompare</code>
 object. That would be too easy, straight-forward, and understandable, 
and obviously that wasn't the goal for the MS programmers who designed 
this thing. Rather, the app passes us some app object from which we can 
request the app to give us its <code>ICompare</code>. Our <code>Advise</code> function is expected to call that object's <code>QueryInterface</code> function, passing the <code>ICompare</code> VTable's GUID to request the app's <code>ICompare</code>. I guess that MS thought this would be a good way to double-check that the app really is giving us an <code>ICompare</code> (except, don't you know that if an app is so badly written, it can't figure out what it should be doing with <code>Advise</code>, then its <code>QueryInterface</code> will probably return the wrong object too?). Our course, the app's <code>QueryInterface</code> will automatically do an <code>AddRef</code> on the <code>ICompare</code> it gives to us, so we are expected to <code>Release</code> the app's <code>ICompare</code> when done with it.</p>
<p>Our <code>Advise</code> function stores the app's <code>ICompare</code> pointer in our <code>MyRealISort</code>'s <code>compare</code> member, so we can access it when we need it, and finally <code>Release</code> it.</p>
<p><code>Advise</code> must return some <code>DWORD</code> value, of our own choosing, to the app. The app is expected to store this <code>DWORD</code> value, and later pass it to our <code>Unadvise</code> function. We can choose any <code>DWORD</code> value we want, but this value should somehow help our <code>Unadvise</code> function when the app later wants us to give back (i.e., <code>Release</code>) its <code>ICompare</code>. Indeed, the app later calls our <code>Unadvise</code> when the app no longer wants us to call its callback functions, and to instead <code>Release</code> its <code>ICompare</code>. So, let's look at <code>Unadvise</code>:</p><div class="pre-lang" id="premain240781"><div></div><div class="pre-action-link"><span class="code-collapse" data-index="240781" id="preShrink240781">Shrink </span> &nbsp; <span id="copycode240781" class="copy-code" data-index="240781" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre240781" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">STDMETHODIMP Unadvise(IConnectionPoint *this, DWORD cookie) 
{
   MyRealISort *iSort;

   <span class="code-comment">//</span><span class="code-comment"> Get the MyRealISort that this IConnectionPoint sub-object belongs</span>
   <span class="code-comment">//</span><span class="code-comment"> to. Because this IConnectPoint sub-object is embedded directly</span>
   <span class="code-comment">//</span><span class="code-comment"> inside its MyRealISort, all we need is a little pointer arithmetic.</span>
   iSort = (MyRealISort *)((<span class="code-keyword">char</span> *)<span class="code-keyword">this</span> - offsetof(MyRealISort, point));

   <span class="code-comment">//</span><span class="code-comment"> Use the passed value to find wherever we stored his ICompare pointer.</span>
   <span class="code-comment">//</span><span class="code-comment"> Well, since we allow only one ICompare for our ISort, we already</span>
   <span class="code-comment">//</span><span class="code-comment"> know we stored it in our ISort-&gt;compare member. And Advise()</span>
   <span class="code-comment">//</span><span class="code-comment"> returned that pointer as the "cookie" value. So we already got the</span>
   <span class="code-comment">//</span><span class="code-comment"> ICompare right now.</span>
   <span class="code-comment">//</span><span class="code-comment">        </span>
   <span class="code-comment">//</span><span class="code-comment"> Let's just make sure the cookie he passed is really the pointer we</span>
   <span class="code-comment">//</span><span class="code-comment"> expect.</span>
   <span class="code-keyword">if</span> (cookie &amp;&amp; (ICompare *)cookie == iSort-&gt;compare)
   {
      <span class="code-comment">//</span><span class="code-comment"> Release the app's ICompare</span>
      ((ICompare *)cookie)-&gt;lpVtbl-&gt;Release((ICompare *)cookie);

      <span class="code-comment">//</span><span class="code-comment"> We no longer have the app's ICompare, so clear the ISort</span>
      <span class="code-comment">//</span><span class="code-comment"> compare member.</span>
      iSort-&gt;compare = <span class="code-digit">0</span>;
      
      <span class="code-keyword">return</span>(S_OK);
   }
   <span class="code-keyword">return</span>(CONNECT_E_NOCONNECTION);
}</pre>
<p>The rest of the code in <i>Sort.c</i> is almost exactly the same as in our very first chapter's <i>IExample.c</i>. The only difference is that, after our <code>IClassFactory</code>'s <code>CreateInstance</code> allocates our <code>MyRealISort</code>, we must initialize the sub-objects inside it, and initialize any other private data members.</p>
<p>You can compile our COM object into <i>ISORT.DLL</i>. To register it, simply take the register utility for <code>IExample</code> (in the directory <i>RegIExample</i>), and replace all instances of <code>IExample</code> with <code>ISort</code>.</p>
<h2><a name="C1">An</a> example C app</h2>
<p>In the directory <i>ISortApp</i> is an example C app that uses our ISort DLL. Previously, we discussed the <code>ICompare</code> functions, so all that's really new here is how the app calls our <code>Advise</code> function to give us its <code>ICompare</code> object, and then later calls <code>Unadvice</code> to ask us to release it. This is a fairly trivial example, so you can peruse the comments in <i>ISortApp.c</i>.</p>
<p>Because COM event connections can be fairly complicated, I've 
supplied a second example of an object that uses callbacks. In the 
directory <i>IExampleEvts</i> is the source to another COM DLL. This DLL implements an object (<code>IExampleEvts</code>) that has an extra function called <code>DoSomething</code>. This function has the ability to call any of up to five different app callbacks. So we have defined an <code>IFeedback</code> object to wrap all five of those callback functions. Its definition is in <i>IExampleEvts.h</i>.
 (A callback object can contain numerous extra, callback functions. And 
each function can have a different purpose, take different arguments, 
and return different values.)</p>
<p>Take the time to peruse these examples and fully understand what is 
going on. Things are going to get more complicated as we go on from 
here.</p>
<h2><a name="SCRIPT">Adding</a> support for script languages</h2>
<p>In order to support script languages, we need to add some <code>IDispatch</code> functions. Let's take our <code>IExampleEvts</code> COM object and adapt it for use with script languages.</p>
<p>First, let's create a new directory named <i>IExampleEvts2</i>, and copy the original sources there. Then, we'll rename the files, replacing all instances of <code>IExampleEvts</code> with <code>IExampleEvts2</code>, and all instances of <code>IFeedback</code> with <code>IFeedback2</code>. I've done this for you already. I also ran <i>GUIDGEN.EXE</i>
 and made new GUIDs for the objects and their VTables. Since we're going
 to also need a type library, I created a new GUID for that too.</p>
<p>We need to add <code>IDispatch</code> functions to both our <code>IExampleEvts2</code> VTable and our <code>IFeedback2</code> VTable. You can compare the original <i>IExampleEvts.h</i> with the new <i>IExampleEvts2.h</i> to see the changes. Note that both VTables now have the five standard <code>IDispatch</code> functions added, and also the macros now specify that both VTables are based on an <code>IDispatch</code> (instead of <code>IUnknown</code>).</p>
<p>In <i>IExampleEvts2.c</i>, I've added the five <code>IDispatch</code> functions to our <code>IExampleEvts2</code> object and its statically declared VTable. I also added a static variable <code>MyTypeInfo</code> to hold an <code>ITypeInfo</code> that Microsoft's <code>GetTypeInfoOfGuid</code> creates for us (and which we use with <code>DispInvoke</code>). This is same thing we did when we added support to our <code>IExample2</code> object back in chapter 2. There's nothing new to any of these changes so far.</p>
<p>We do have to change our <code>DoSomething</code> function. No longer can we call any callback function directly (referencing it via the <code>lpVtbl</code>
 of the object). This is because a script engine will not actually have 
function pointers in its VTable for those extra callback functions. 
Instead, we must call it indirectly using the callback object's (<code>IFeedback</code>'s) <code>Invoke</code> function. We must pass the appropriate DISPID of the function we wish to call.</p>
<p>The only new thing appears in our <i>IExampleEvts2.IDL</i> file (i.e., the file that <i>MIDL.EXE</i> compiles into our <i>.TLB</i> type library file). Notice how we've defined <code>IFeedback2</code>'s VTable (which we arbitrarily label as <code>IFeedback2VTbl</code>). This is similar to how we define our <code>IExampleEvts2</code> VTable, except that we don't use the <code>dual</code> keyword on <code>IFeedback2</code>'s
 VTable. Script engines can't utilize a dual VTable for a callback 
object. I've arbitrarily chosen to use DISPID 1 for the first callback 
function (<code>Callback1</code>), 2 for the second callback function, etc.</p>
<p>The other new thing is how we define our <code>IExampleEvts2</code> object itself as so:</p><div class="pre-lang" id="premain634720"><div></div><div class="pre-action-link"><span id="copycode634720" class="copy-code" data-index="634720" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre634720" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">coclass IExampleEvts2
{
   [default] <span class="code-keyword">interface</span> IExampleEvts2VTbl;
   [source, default] <span class="code-keyword">interface</span> IFeedback2VTbl;
}</pre>
<p>The first interface line should look familiar. It's the same as how 
we've always marked an object's VTable in any IDL file. But the second 
interface line tells anyone using our type library that <code>IExampleEvts2</code> supports a callback object whose VTable is described by <code>IFeedback2Vtbl</code>. The "<code>source</code>" keyword indicates this is a callback VTable. The "<code>default</code>" keyword means that this VTable is the one a script engine should use for any callback object associated with our <code>IExampleEvts2</code> object.</p>
<p>You can compile our COM object into <i>IExampleEvts2.DLL</i>. To register it, simply take the register utility for <code>IExample2</code> (in the directory <i>RegIExample2</i>) and replace all instances of <code>IExample2</code> with <code>IExampleEvts2</code>.</p>
<h2><a name="C2">Another</a> example C app</h2>
<p>In the directory <i>IExampleEvts2App</i> is an example C app that uses our IExampleEvts2 DLL. Compare this with the original source in <i>IExampleEvtsApp</i>. Notice that we've added the five standard <code>IDispatch</code> functions to our <code>IFeedback2</code> object.</p>
<p>Although <i>IExampleEvts2.IDL</i> did not define the <code>IFeedback2</code> VTable as "dual", we've nevertheless included the extra functions (<code>Callback1</code> through <code>Callback5</code>) in our actual statically declared VTable (<code>IFeedback2_Vtbl</code>). In this way, we can fool <code>DispInvoke</code> into using this VTable as if it really was declared as dual. Also, notice that the type library we load is <code>IExampleEvts2</code>'s type library, because that is where the <code>IFeedback2</code> VTable is described. And the <code>ITypeInfo</code> we ask <code>GetTypeInfoOfGuid</code> to create is for an <code>IFeedback2</code> VTable. We use this <code>ITypeInfo</code> with our <code>IFeedback2</code>'s <code>Invoke</code> function.</p>
<h2><a name="VB">A</a> VBScript example</h2>
<p>In the <i>IExampleEvts2</i> directory is a VBScript example named <i>IExampleEvts2.vbs</i> as so:</p><div class="pre-lang" id="premain712456"><div>VBScript</div><div class="pre-action-link"><span id="copycode712456" class="copy-code" data-index="712456" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre712456" style="margin-top:0;" class="lang-vbscript notranslate" data-language="vbscript" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true"><span class="code-keyword">Set</span> myobj = WScript.<span class="code-keyword">CreateObject</span>(<span class="code-string">"</span><span class="code-string">IExampleEvts2.object"</span>, <span class="code-string">"</span><span class="code-string">label_"</span>)
myobj.DoSomething()

<span class="code-keyword">sub</span> label_Callback1()
   Wscript.echo <span class="code-string">"</span><span class="code-string">Callback1 is called"</span>
<span class="code-keyword">end</span> <span class="code-keyword">sub</span></pre>
<p>The first line uses the Windows Scripting Shell's <code>CreateObject</code> to get an instance of our <code>IExampleEvts2</code> object (which should have been registered with the ProdID of <i>IExampleEvts2.object</i>). The reason we use the Script Shell's <code>CreateObject</code> instead of the VB engine's <code>CreateObject</code>,
 is because the former allows us to pass a second argument -- a string 
that is prepended to the name of any callback function. Here, we've 
specified the string <i>label</i>. So for example, when our <code>IExampleEvts2</code> <code>DoSomething</code> calls the script engine's <code>IFeedback2</code>'s <code>Invoke</code> and passes a DISPID of 1 (i.e., for <code>Callback1</code>), then the VBScript function that gets called is <code>label_Callback1</code>.</p>
<p>In fact, we've provided a VB function by that name, which simply displays a message box.</p>
<h2><a name="MULT">Multiple</a> types of callback objects</h2>
<p>An object can support numerous types of callback objects. For example, if we wanted, we could have our <code>ISort</code> object support being given both an <code>ICompare</code> and <code>IFeedback2</code> callback objects. In this case, we would need a separate <code>IConnectionPoint</code> object for each. In that case, we'd need to put both the <code>ICompare</code> and <code>IFeedback2</code> VTables in our IDL file, and reference them both in our object like so:</p><div class="pre-lang" id="premain191285"><div></div><div class="pre-action-link"><span id="copycode191285" class="copy-code" data-index="191285" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre191285" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">coclass IExampleEvts2
{
   [default] <span class="code-keyword">interface</span> IExampleEvts2VTbl;
   [source, default] <span class="code-keyword">interface</span> IFeedback2VTbl;
   [source] <span class="code-keyword">interface</span> ICompareVtbl;
}</pre>
<p>But note that only one source interface can be marked as default, and
 a script engine can use only the default one (i.e., a script can't 
provide us any <code>ICompare</code> callback functions).</p>
<p>Furthermore, we have to provide real code for our <code>IConnectionPointContainer</code>'s <code>EnumConnectionPoints</code> function. This function should return another object that can enumerate each of the different types of <code>IConnectPoint</code>s
 that we support. (The object it returns is a standard enumerator object
 such as the enumerator we used in our Collections chapter.)</p>
<p>Because callback objects are usually used in conjunction with 
scripting (and script engines can't support multiple types of callback 
objects per a single coclass object), I'm going to delve further into 
multiple types of callback objects.</p>
<h2><a name="MULT2">Multiple</a> callback objects</h2>
<p>In our example objects, we allowed an app (or script engine) to provide us only one <code>IFeedback2</code> object (which we stored in our <code>MyRealIExampleEvts2</code>'s <code>feedback</code> member). But theoretically, an app may provide us with as many <code>IFeedback2</code> callback objects as it desires. In our <code>IConnectionPoint</code>'s <code>Advise</code>, we simply refused to accept more than one <code>IFeedback2</code> from an app/engine. If you wish to allow an app/engine to provide more <code>IFeedback2</code>s, then instead of a <code>feedback</code> member, you may wish to define another struct that can be linked into a list, and also has a member to store an <code>IFeedback2</code> pointer. You would <code>GlobalAlloc</code> one of these structs in <code>Advise</code>, and link them into a list whose head would be stored in some <code>MyRealIExampleEvts2</code> member.</p>
<p>You would also need to modify <code>DoSomething</code> to loop through the entire list, and call each <code>IFeedback2</code>'s <code>Invoke</code>.</p>
<p>But again, since the primary use of callback objects is for 
scripting, and most uses will involve only one callback object, we'll 
skip developing an example to illustrate.</p>
<h2>What's next?</h2>
<p>In the next article, we'll examine how to turn a C app into an 
ActiveX script host (i.e., how to run scripts from your C app, and how a
 script calls C functions in your app, and your app calls functions in 
the script, to control your app and exchange data with a script).</p>


						</div>
						

						
						<h2>License</h2>
						<div id="LicenseTerms"><p>This article, along with any associated source code and files, is licensed under <a href="http://www.codeproject.com/info/cpol10.aspx" rel="license">The Code Project Open License (CPOL)</a></p></div>
						

						
						<br>
						
						    

<div class="author-wrapper">

    <div class="desktop-only tablet-only" style="position:absolute; top:-30px;right:20px">
        <img id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberPhoto" class="profile-pic" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/member_unknown.gif" style="border-width:0px;transform:rotate(1deg);">
    </div>

    <div style="padding-right:100px">
        <div class="subdue" style="margin-bottom:7px">Written By</div>

        <div class="container-member">
             <b><a id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberProfileLink" class="author" href="https://www.codeproject.com/Members/Jeff-Glatt">Jeff Glatt</a></b>
        </div>

        <div class="company text-nowrap">
            <span id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberJobTitle"></span>
	        <span id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberCompany"></span>
        </div>

        <div class="text-nowrap">
            <span id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberLocation"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/US.gif" alt="United States" width="16" height="11">&nbsp;United States</span>
        </div>
    </div>

</div>

<div class="description" style="padding-top:1rem">
    This member has not yet provided a Biography. Assume it's 
interesting and varied, and probably something to do with programming.
</div>

<div id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_SocialRow" class="follow flex-container flex-extend" style="margin-top:20px">
    <div class="flex-item">
        
    </div>
    <div class="flex-item-tight" style="margin-right:25px">
        
    </div>
</div>

<br>
						
						

						<div class="clearfix"></div>

						<div style="padding-top:8px">
							
						</div>

					

				    
					</form>

				</div>

				
				<div class="bottom-promo"> 
				    <div class="msg-728x90" data-format="728x90" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="Programming-LanguagesCplusplus" data-country="US" data-loadonview="true" data-tags="C++, Windows, Visual-Studio, Dev, COM, Beginner,rating4.5,pos_bottom"><noscript><a href="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Programming-LanguagesCplusplus&sz=728x90&c=881171"><img src="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Programming-LanguagesCplusplus&sz=728x90&c=881171"  width="728px" height="90px" target="_blank"/></a></noscript></div>
				</div>
				
                
                

				
				

					<h2 class="padded-top">Comments and Discussions</h2>

                    
			        <div id="ctl00_SharePH" class="share-list float-right desktop-only tablet-only" style="margin-top:-3.5rem">
				        

    <ul class="rrssb-buttons clearfix rrssb-1">
        <li id="ctl00_SocialLike_Email" class="email compact">
            <a href="mailto:?subject=COM%20in%20plain%20C%2c%20Part%205%20-%20CodeProject&amp;body=Here%27s%20an%20interesting%20article%20on%20for%20you%20on%20codeproject.com%0a%0aAdd%20a%20connectable%20object%20(source%2fsink).%0a%0ahttps%3a%2f%2fwww.codeproject.com%2fArticles%2f14183%2fCOM-in-plain-C-Part-5%0a">
                <span class="icon">
                    <svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                        <g>
                            <path d="M20.111 26.147c-2.336 1.051-4.361 1.401-7.125 1.401c-6.462 0-12.146-4.633-12.146-12.265 
                                c0-7.94 5.762-14.833 14.561-14.833c6.853 0 11.8 4.7 11.8 11.252c0 5.684-3.194 9.265-7.399 
                                9.3 c-1.829 0-3.153-0.934-3.347-2.997h-0.077c-1.208 1.986-2.96 2.997-5.023 2.997c-2.532 
                                0-4.361-1.868-4.361-5.062 c0-4.749 3.504-9.071 9.111-9.071c1.713 0 3.7 0.4 4.6 0.973l-1.169 
                                7.203c-0.388 2.298-0.116 3.3 1 3.4 c1.673 0 3.773-2.102 3.773-6.58c0-5.061-3.27-8.994-9.303-8.994c-5.957 
                                0-11.175 4.673-11.175 12.1 c0 6.5 4.2 10.2 10 10.201c1.986 0 4.089-0.43 5.646-1.245L20.111 
                                26.147z M16.646 10.1 c-0.311-0.078-0.701-0.155-1.207-0.155c-2.571 0-4.595 2.53-4.595 5.529c0 
                                1.5 0.7 2.4 1.9 2.4 c1.441 0 2.959-1.828 3.311-4.087L16.646 10.068z"></path>
                        </g>
                    </svg>
                </span>
                
            </a>
        </li><li id="ctl00_SocialLike_Twitter" class="twitter compact">
            <a href="http://twitter.com/home?status=COM+in+plain+C%2c+Part+5+-+CodeProject+-+https%3a%2f%2fwww.codeproject.com%2fArticles%2f14183%2fCOM-in-plain-C-Part-5" class="popup">
                <span class="icon">
                    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                    <path d="M24.253,8.756C24.689,17.08,18.297,24.182,9.97,24.62c-3.122,0.162-6.219-0.646-8.861-2.32
                        c2.703,0.179,5.376-0.648,7.508-2.321c-2.072-0.247-3.818-1.661-4.489-3.638c0.801,0.128,1.62,0.076,2.399-0.155
                        C4.045,15.72,2.215,13.6,2.115,11.077c0.688,0.275,1.426,0.407,2.168,0.386c-2.135-1.65-2.729-4.621-1.394-6.965
                        C5.575,7.816,9.54,9.84,13.803,10.071c-0.842-2.739,0.694-5.64,3.434-6.482c2.018-0.623,4.212,0.044,5.546,1.683
                        c1.186-0.213,2.318-0.662,3.329-1.317c-0.385,1.256-1.247,2.312-2.399,2.942c1.048-0.106,2.069-0.394,3.019-0.851
                        C26.275,7.229,25.39,8.196,24.253,8.756z"></path>
                    </svg>
                </span>
                
            </a>
        </li><li id="ctl00_SocialLike_Facebook" class="facebook compact">
            
            <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.codeproject.com%2fArticles%2f14183%2fCOM-in-plain-C-Part-5" class="popup">
                <span class="icon">
                    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                        <path d="M27.825,4.783c0-2.427-2.182-4.608-4.608-4.608H4.783c-2.422,0-4.608,2.182-4.608,4.608v18.434
                            c0,2.427,2.181,4.608,4.608,4.608H14V17.379h-3.379v-4.608H14v-1.795c0-3.089,2.335-5.885,5.192-5.885h3.718v4.608h-3.726
                            c-0.408,0-0.884,0.492-0.884,1.236v1.836h4.609v4.608h-4.609v10.446h4.916c2.422,0,4.608-2.188,4.608-4.608V4.783z"></path>
                    </svg>
                </span>
                
            </a>
        </li><li id="ctl00_SocialLike_LinkedIn" class="linkedin compact">
            <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.codeproject.com%2fArticles%2f14183%2fCOM-in-plain-C-Part-5&amp;title=COM+in+plain+C%2c+Part+5+-+CodeProject&amp;summary=Add+a+connectable+object+(source%2fsink).&amp;source=codeproject.com" class="popup">
                <span class="icon">
                    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                        <path d="M25.424,15.887v8.447h-4.896v-7.882c0-1.979-0.709-3.331-2.48-3.331c-1.354,0-2.158,0.911-2.514,1.803
                            c-0.129,0.315-0.162,0.753-0.162,1.194v8.216h-4.899c0,0,0.066-13.349,0-14.731h4.899v2.088c-0.01,0.016-0.023,0.032-0.033,0.048
                            h0.033V11.69c0.65-1.002,1.812-2.435,4.414-2.435C23.008,9.254,25.424,11.361,25.424,15.887z M5.348,2.501
                            c-1.676,0-2.772,1.092-2.772,2.539c0,1.421,1.066,2.538,2.717,2.546h0.032c1.709,0,2.771-1.132,2.771-2.546
                            C8.054,3.593,7.019,2.501,5.343,2.501H5.348z M2.867,24.334h4.897V9.603H2.867V24.334z"></path>
                    </svg>
                </span>
                
            </a>
        </li><li id="ctl00_SocialLike_Reddit" class="reddit compact">
            <a href="http://www.reddit.com/submit?url=https%3a%2f%2fwww.codeproject.com%2fArticles%2f14183%2fCOM-in-plain-C-Part-5&amp;title=COM+in+plain+C%2c+Part+5+-+CodeProject">
                <span class="icon">
                    <svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve"><g>
                    <path d="M11.794 15.316c0-1.029-0.835-1.895-1.866-1.895c-1.03 0-1.893 0.865-1.893 1.895s0.863 1.9 1.9 1.9 C10.958 17.2 11.8 16.3 11.8 15.316z"></path>
                    <path d="M18.1 13.422c-1.029 0-1.895 0.864-1.895 1.895c0 1 0.9 1.9 1.9 1.865c1.031 0 1.869-0.836 1.869-1.865 C19.969 14.3 19.1 13.4 18.1 13.422z"></path>
                    <path d="M17.527 19.791c-0.678 0.678-1.826 1.006-3.514 1.006c-0.004 0-0.009 0-0.014 0c-0.004 0-0.01 0-0.015 0 
                    c-1.686 0-2.834-0.328-3.51-1.005c-0.264-0.265-0.693-0.265-0.958 0c-0.264 0.265-0.264 0.7 0 1 c0.943 0.9 2.4 1.4 
                    4.5 1.402c0.005 0 0 0 0 0c0.005 0 0 0 0 0c2.066 0 3.527-0.459 4.47-1.402 c0.265-0.264 0.265-0.693 0.002-0.958C18.221 
                    19.5 17.8 19.5 17.5 19.791z"></path><path d="M27.707 13.267c0-1.785-1.453-3.237-3.236-3.237c-0.793 0-1.518 0.287-2.082 
                    0.761c-2.039-1.295-4.646-2.069-7.438-2.219 l1.483-4.691l4.062 0.956c0.071 1.4 1.3 2.6 2.7 2.555c1.488 0 2.695-1.208 
                    2.695-2.695C25.881 3.2 24.7 2 23.2 2 c-1.059 0-1.979 0.616-2.42 1.508l-4.633-1.091c-0.344-0.081-0.693 0.118-0.803 
                    0.455l-1.793 5.7 C10.548 8.6 7.7 9.4 5.6 10.75C5.006 10.3 4.3 10 3.5 10.029c-1.785 0-3.237 1.452-3.237 3.2 c0 1.1 0.6 
                    2.1 1.4 2.69c-0.04 0.272-0.061 0.551-0.061 0.831c0 2.3 1.3 4.4 3.7 5.9 c2.299 1.5 5.3 2.3 8.6 2.325c3.228 0 6.271-0.825 
                    8.571-2.325c2.387-1.56 3.7-3.66 3.7-5.917 c0-0.26-0.016-0.514-0.051-0.768C27.088 15.5 27.7 14.4 27.7 13.267z M23.186 
                    3.355c0.74 0 1.3 0.6 1.3 1.3 c0 0.738-0.6 1.34-1.34 1.34s-1.342-0.602-1.342-1.34C21.844 4 22.4 3.4 23.2 3.355z M1.648 
                    13.3 c0-1.038 0.844-1.882 1.882-1.882c0.31 0 0.6 0.1 0.9 0.209c-1.049 0.868-1.813 1.861-2.26 2.9 C1.832 14.2 1.6 13.8 1.6 
                    13.267z M21.773 21.57c-2.082 1.357-4.863 2.105-7.831 2.105c-2.967 0-5.747-0.748-7.828-2.105 
                    c-1.991-1.301-3.088-3-3.088-4.782c0-1.784 1.097-3.484 3.088-4.784c2.081-1.358 4.861-2.106 7.828-2.106 c2.967 0 5.7 
                    0.7 7.8 2.106c1.99 1.3 3.1 3 3.1 4.784C24.859 18.6 23.8 20.3 21.8 21.57z M25.787 14.6 
                    c-0.432-1.084-1.191-2.095-2.244-2.977c0.273-0.156 0.59-0.245 0.928-0.245c1.035 0 1.9 0.8 1.9 1.9 
                    C26.354 13.8 26.1 14.3 25.8 14.605z"></path></g></svg>
                </span>
                
            </a>
        </li><li id="ctl00_SocialLike_Pinterest" class="pinterest compact">
            <a href="http://pinterest.com/pin/create/bookmarklet/?is_video=false&amp;url=https%3a%2f%2fwww.codeproject.com%2fArticles%2f14183%2fCOM-in-plain-C-Part-5&amp;description=COM+in+plain+C%2c+Part+5+-+CodeProject">
                <span class="icon">
                    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                    <path d="M14.021,1.57C6.96,1.57,1.236,7.293,1.236,14.355c0,7.062,5.724,12.785,12.785,12.785c7.061,0,12.785-5.725,12.785-12.785
                        C26.807,7.294,21.082,1.57,14.021,1.57z M15.261,18.655c-1.161-0.09-1.649-0.666-2.559-1.219c-0.501,2.626-1.113,5.145-2.925,6.458
                        c-0.559-3.971,0.822-6.951,1.462-10.116c-1.093-1.84,0.132-5.545,2.438-4.632c2.837,1.123-2.458,6.842,1.099,7.557
                        c3.711,0.744,5.227-6.439,2.925-8.775c-3.325-3.374-9.678-0.077-8.897,4.754c0.19,1.178,1.408,1.538,0.489,3.168
                        C7.165,15.378,6.53,13.7,6.611,11.462c0.131-3.662,3.291-6.227,6.46-6.582c4.007-0.448,7.771,1.474,8.29,5.239
                        c0.579,4.255-1.816,8.865-6.102,8.533L15.261,18.655z"></path>
                    </svg>
                </span>
                
            </a>
        </li>

    </ul>



			        </div><a class="float-left" name="_comments" id="_comments">&nbsp;</a><div id="_MessageBoardctl00_MessageBoard" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(event, null)">
<table id="ForumTable" class="forum relaxed" cellpadding="0" cellspacing="0">
<tbody><tr>
<td class="header1"><div class="callout">
	<b>You must <a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fArticles%2f14183%2fCOM-in-plain-C-Part-5%3ffid%3d308357%26df%3d90%26mpp%3d25%26sort%3dPosition%26view%3dNormal%26spc%3dRelaxed%26prof%3dTrue">Sign In</a> to use this message board.</b>
</div></td>
</tr><tr>
<td><table width="100%" border="0" cellpadding="3px" cellspacing="0">
<tbody><tr class="header1">
<td colspan="2" style="white-space:nowrap;"><div class="container">
<div class="float-right">
<form action="/Search.aspx?sbo=fm" method="get" class="searchbar">
<input type="hidden" name="fid" value="308357"><input type="hidden" name="sbo" value="fm"><input id="search_forumCtrl_ctl00_MessageBoard" type="search" class="search subdue" autocomplete="off" name="q" value="Search Comments"><input type="image" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/search.gif">
</form>
</div>
</div></td>
</tr><tr class="header2">
<td></td><td style="width:100%;"><div style="text-align:right;">
<form action="/script/Forums/SetOptions.aspx?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;view=Normal&amp;spc=Relaxed&amp;prof=True&amp;floc=%2fArticles%2f14183%2fCOM-in-plain-C-Part-5" method="get" style="margin:0;padding:0;">
<input type="hidden" name="fid" value="308357"><input type="hidden" name="currentQS" value="fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;view=Normal&amp;spc=Relaxed&amp;prof=True&amp;floc=%2fArticles%2f14183%2fCOM-in-plain-C-Part-5"><input type="hidden" name="floc" value="/Articles/14183/COM-in-plain-C-Part-5">Spacing<select size="1" class="dropdown" name="spc" data-ddg-inputtype="unknown">
<option selected="selected" value="Relaxed">Relaxed</option><option value="Compact">Compact</option><option value="Tight">Tight</option>
</select>&nbsp;&nbsp;Layout<select size="1" class="dropdown" name="view" data-ddg-inputtype="unknown">
<option selected="selected" value="Normal">Normal</option><option value="Topic">Open Topics</option><option value="Expanded">Open All</option><option value="Thread">Thread View</option>
</select>&nbsp;&nbsp;Per page<select size="1" class="dropdown" name="mpp" data-ddg-inputtype="unknown">
<option value="10">10</option><option selected="selected" value="25">25</option><option value="50">50</option>
</select>&nbsp;&nbsp;&nbsp;<input type="submit" value="Update" name="SetOpt" class="button">
</form>
</div></td>
</tr>
</tbody></table></td>
</tr><tr>
<td><a name="xx0xx"></a><table border="0" cellpadding="2px" cellspacing="0" width="100%">
<tbody><tr class="navbar">
<td></td><td style="text-align:right;width:50%;"></td><td style="text-align:right;white-space:nowrap;"><span class="nav-link disabled">First</span> <span class="nav-link disabled">Prev</span> <span class="nav-link disabled">Next</span></td>
</tr>
</tbody></table></td>
</tr><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%" class="fixed-layout blank-background msg-list">
<tbody><tr id="F4798468_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx4798468xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_question.gif" alt="Question" title="Question"></td><td class="subject hover-container"><a class="message-link" name="4798468" parent="0" thread="4798468" href="https://www.codeproject.com/Messages/4798468/I-need-to-find-a-way-to-call-the-vbscript-inside-a">I need to find a way to call the vbscript inside an html file</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">gupse gunes</span><span class="date">11-Apr-14  0:55</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=6723925">gupse gunes</a></span></td><td class="date"><span>11-Apr-14  0:55&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4798468_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">I tried the callback function iexampleevts2 and it works
 with the vbs file many thanks for the great article it helped me a lot.
 I also need to have a callback function defined in a vbscript or 
javascript in an html file. I tried to copy and paste the vbs into an 
html file but it seems  WScript.CreateObject does not work in html.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14183/COM-in-plain-C-Part-5" rel="nofollow noopener">Sign In</a><wbr><a href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=4798468" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_4798468" name="react-item_4798468" id="MRF4798468" class="reaction-result"></span><span data-objectref="3_4798468" data-votingtype="GoodOrBad" name="RateItem_4798468" id="MVF4798468" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="4798468" href="https://www.codeproject.com/Messages/4798468/I-need-to-find-a-way-to-call-the-vbscript-inside-a" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4073919_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx4073919xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_question.gif" alt="Question" title="Question"></td><td class="subject hover-container"><a class="message-link" name="4073919" parent="0" thread="4073919" href="https://www.codeproject.com/Messages/4073919/Event-Sink-in-DLL-not-Firing">Event Sink in DLL not Firing</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">rveach</span><span class="date">9-Nov-11  10:46</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=4818802">rveach</a></span></td><td class="date"><span>9-Nov-11  10:46&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4073919_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Hi, I am trying to make a DLL Wrapper for Java to 
support an application through a COM interface. I have gotten alot of it
 working, thanks some to your articles, but I am having problems with 
the Events not firing. Everything returns a good return code when I am 
advising it of my class.<br>
Now the same code works fine in a regular EXE, so there is something special that prevents it from working in a DLL.<br>
<br>
Do you have any ideas what the problem could be and how to fix it?<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14183/COM-in-plain-C-Part-5" rel="nofollow noopener">Sign In</a><wbr><a href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=4073919" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_4073919" name="react-item_4073919" id="MRF4073919" class="reaction-result"></span><span data-objectref="3_4073919" data-votingtype="GoodOrBad" name="RateItem_4073919" id="MVF4073919" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="4073919" href="https://www.codeproject.com/Messages/4073919/Event-Sink-in-DLL-not-Firing" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4080886_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="38px" class="indent"><a name="xx4080886xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_answer.gif" alt="Answer" title="Answer"></td><td class="subject hover-container"><a class="message-link" name="4080886" parent="4073919" thread="4073919" href="https://www.codeproject.com/Messages/4080886/Re-Event-Sink-in-DLL-not-Firing">Re: Event Sink in DLL not Firing</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">rveach</span><span class="date">17-Nov-11  3:23</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=4818802">rveach</a></span></td><td class="date"><span>17-Nov-11  3:23&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4080886_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,4073919);" href="https://www.codeproject.com/Messages/4073919/Event-Sink-in-DLL-not-Firing"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>I figured out my problem.<br>
<br>
<b>The thread that created the sink object</b> needs to also pump the thread's message queue using the window's function <b>'GetMessage'</b>.<br>
<br>
This is why the windows executable was working correctly, it already 
have a message pump for the window that was created. I figured this out 
when I put a breakpoint in the sink object when the invoke was being 
called and looked at the stack trace. 'GetMessage' was the first thing 
on the trace that came from my code.<br>
<br>
In this instance, I believe why 'GetMessage' is the answer is because I 
believe the COM's code is calling 'PostThreadMessage' to notify me that a
 sink event has occurred and 'GetMessage' looks at these messages and 
somehow knows they are COM related and handle them on its own.<br>
<br>
<b>PS</b>: Notice I said <i>the thread</i> that created the sink. If you
 create the sink in one thread and have the message pump in another, you
 will receive the message from the COM about the sink, but it won't know
 how to handle it automatically since this thread has nothing loaded 
about the COM in its space. So the sink object's invoke is never called.<br>
<br>
So Java could access the same COM everywhere, I made the 2nd thread 
control everything about the COM, and any native methods that were 
called redirect the request to the that thread. So no matter what thread
 Java is running in, it will always have access to the same COM without 
having to reload everything.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14183/COM-in-plain-C-Part-5" rel="nofollow noopener">Sign In</a><wbr><a href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=4073919" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_4080886" name="react-item_4080886" id="MRF4080886" class="reaction-result"></span><span data-objectref="3_4080886" data-votingtype="GoodOrBad" name="RateItem_4080886" id="MVF4080886" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="4080886" href="https://www.codeproject.com/Messages/4080886/Re-Event-Sink-in-DLL-not-Firing" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F2731895_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx2731895xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="2731895" parent="0" thread="2731895" href="https://www.codeproject.com/Messages/2731895/Got-Code-Could-not-connect-object-Error-80020009">Got Code: Could not connect object Error: 80020009</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Pacsoft</span><span class="date">19-Sep-08  12:02</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=5320348">Pacsoft</a></span></td><td class="date"><span>19-Sep-08  12:02&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F2731895_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Hi, Jeff,<br>
<br>
I used the code from Part 2 as an aid to write an EXE application that is driven by a a script and works perfectly.<br>
<br>
However, now that I have used code from Part 5 as an aid to write an EXE
 to source events to a VB Script, when I run the script I got the 
message "Could not connect to object". <br>
<br>
I have verified that the FindConnectionPoint is actually called and returns valid data, but Advise got never called.<br>
<br>
Any ideas ?<br>
<br>
Pacsoft<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14183/COM-in-plain-C-Part-5" rel="nofollow noopener">Sign In</a><wbr><a href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=2731895" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_2731895" name="react-item_2731895" id="MRF2731895" class="reaction-result"></span><span data-objectref="3_2731895" data-votingtype="GoodOrBad" name="RateItem_2731895" id="MVF2731895" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="2731895" href="https://www.codeproject.com/Messages/2731895/Got-Code-Could-not-connect-object-Error-80020009" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F2641249_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx2641249xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_question.gif" alt="Question" title="Question"></td><td class="subject hover-container"><a class="message-link" name="2641249" parent="0" thread="2641249" href="https://www.codeproject.com/Messages/2641249/Where-is-the-IFeedback2s-Invoke-in-VBScript-exampl">Where is the "IFeedback2's Invoke" in VBScript example?</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">yanxinxin1985</span><span class="date">16-Jul-08  23:13</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=4431965">yanxinxin1985</a></span></td><td class="date"><span>16-Jul-08  23:13&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F2641249_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">The series of articles are great! I've learned a lot from them, thanks!  <img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/smiley_wink.gif" align="top" alt="Wink | ;)">  <br>
<br>
There is a problem I don't understand in this part, please give me a hand. In the C example, "<code>IFeedback2</code>'s <code>IDispatch</code> functions" are well defined, however, where is the "<code>IFeedback2</code>'s <code>IDispatch</code> function definition" in VBScript example?  How can it work fine without <code>Invoke </code>function?<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14183/COM-in-plain-C-Part-5" rel="nofollow noopener">Sign In</a><wbr><a href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=2641249" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_2641249" name="react-item_2641249" id="MRF2641249" class="reaction-result"></span><span data-objectref="3_2641249" data-votingtype="GoodOrBad" name="RateItem_2641249" id="MVF2641249" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="2641249" href="https://www.codeproject.com/Messages/2641249/Where-is-the-IFeedback2s-Invoke-in-VBScript-exampl" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F2568489_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx2568489xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_question.gif" alt="Question" title="Question"></td><td class="subject hover-container"><a class="message-link" name="2568489" parent="0" thread="2568489" href="https://www.codeproject.com/Messages/2568489/are-these-used-to-create-events">are these used to create events</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">dbrower256</span><span class="date">24-May-08  18:37</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=5179524">dbrower256</a></span></td><td class="date"><span>24-May-08  18:37&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F2568489_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Are the techniques and interfaces of part 5 the way that events work in Visual Basic?<br>
<br>
Daniel<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14183/COM-in-plain-C-Part-5" rel="nofollow noopener">Sign In</a><wbr><a href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=2568489" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_2568489" name="react-item_2568489" id="MRF2568489" class="reaction-result"></span><span data-objectref="3_2568489" data-votingtype="GoodOrBad" name="RateItem_2568489" id="MVF2568489" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="2568489" href="https://www.codeproject.com/Messages/2568489/are-these-used-to-create-events" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1885965_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx1885965xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_question.gif" alt="Question" title="Question"></td><td class="subject hover-container"><a class="message-link" name="1885965" parent="0" thread="1885965" href="https://www.codeproject.com/Messages/1885965/Can-a-COM-server-dll-be-implemented-as-a-regular-d">Can a COM server dll be implemented as a regular dll?</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">ehaerim</span><span class="date">9-Feb-07  0:09</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=658032">ehaerim</a></span></td><td class="date"><span>9-Feb-07  0:09&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1885965_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Jeff, thanks for your good article.  I've printed all your 8 articles for COM in plain C.<br>
<br>
Maybe after reading all of them, I may be able to do what I want, but at this moment everything is foggy, so please help me.<br>
<br>
I have a scenario like this:<br>
 <br>
An application(App_A) allows me to extend its functionality by writing a
 regular DLL only.  I would like to make it work as a COM DLL server 
with an event source interface.<br>
 <br>
For example, let's name the regular DLL as MyDLL.dll and it will have the following exported functions:<br>
1) Initialize(void* pInit);<br>
2) SendInfo(void* pInfo);<br>
 <br>
Now, App_A loads MyDLL.dll and calls 'Initialize' and 'SendInfo' in sequence.<br>
And within 'SendInfo' I would like to fire an event for another application(App_B).  Then App_B will handle the event.  <br>
 <br>
In summary, MyDLL.dll <br>
1) Must be <b>regular</b> DLL. =&gt; This limitation is tough for me.<br>
2) Should work as a COM DLL server with an event source interface and 
fire an event for external event sink within App_B so that App_B could 
receive that event fired from MyDLL.dll.<br>
 <br>
Do you think this is possible?  Maybe it is necessary to use pure C, not C++.  Of course, C++ would be preferrable if possible.<br>
 <br>
I need your help please.  A sample would be most appreciated.<br>
 <br>
HaeRim<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14183/COM-in-plain-C-Part-5" rel="nofollow noopener">Sign In</a><wbr><a href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1885965" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_1885965" name="react-item_1885965" id="MRF1885965" class="reaction-result"></span><span data-objectref="3_1885965" data-votingtype="GoodOrBad" name="RateItem_1885965" id="MVF1885965" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="1885965" href="https://www.codeproject.com/Messages/1885965/Can-a-COM-server-dll-be-implemented-as-a-regular-d" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1889088_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="38px" class="indent"><a name="xx1889088xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_answer.gif" alt="Answer" title="Answer"></td><td class="subject hover-container"><a class="message-link" name="1889088" parent="1885965" thread="1885965" href="https://www.codeproject.com/Messages/1889088/Re-Can-a-COM-server-dll-be-implemented-as-a-regula">Re: Can a COM server dll be implemented as a regular dll?</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Jeff Glatt</span><span class="date">11-Feb-07  16:10</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=88625">Jeff Glatt</a></span></td><td class="date"><span>11-Feb-07  16:10&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1889088_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,1885965);" href="https://www.codeproject.com/Messages/1885965/Can-a-COM-server-dll-be-implemented-as-a-regular-d"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>I'm totally confused why you have to deal with event sinks/sources at all.<br>
<br>
Why do you have to deal with event sinks? Do you not have the source to 
App_B, and it requires event sourcing in order to be able to communicate
 with it?<br>
<br>
Hopefully, App_B has either a COM interface that doesn't involve the 
very ugly event sink stuff, or has some other C-assessible method for 
invoking it and passing it arguments.<br>
<br>
If the former, then your DLL merely has to call CreateInstance to get 
one of App_B's "application objects" (once you find out what it's GUID 
is). Then you can call its functions directly within your DLL.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14183/COM-in-plain-C-Part-5" rel="nofollow noopener">Sign In</a><wbr><a href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1885965" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_1889088" name="react-item_1889088" id="MRF1889088" class="reaction-result"></span><span data-objectref="3_1889088" data-votingtype="GoodOrBad" name="RateItem_1889088" id="MVF1889088" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="1889088" href="https://www.codeproject.com/Messages/1889088/Re-Can-a-COM-server-dll-be-implemented-as-a-regula" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1809796_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx1809796xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_question.gif" alt="Question" title="Question"></td><td class="subject hover-container"><a class="message-link" name="1809796" parent="0" thread="1809796" href="https://www.codeproject.com/Messages/1809796/Does-COM-need-to-be-Rebased">Does COM need to be Rebased?</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Hunt Chang</span><span class="date">18-Dec-06  15:23</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=1474499">Hunt Chang</a></span></td><td class="date"><span>18-Dec-06  15:23&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1809796_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Hi,<br>
<br>
First off, Thanks to Mr. Glatt. I have learned a lot from this series of articles about COM. <img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/rose.gif" align="top" alt="Rose | [Rose]"> <br>
<br>
A question about COM need some help.<br>
<br>
Since COM is intrinsic a DLL; and we know sometimes we have to rebase 
the DLL to match certain program needs, then should we do the same thing
 to COM?<br>
<br>
About COM, what I have learned is the client program call for COM 
service thru its vtable. It seems this kind of calling structure should 
not need the help of rebase. But frankly I can not make it sure in its 
concept by myself. <br>
<br>
Thanks in advance for anyone's tip and share,<br>
<br>
Hunt  <img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/smiley_squeamish.gif" align="top" alt="Unsure | :~"><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14183/COM-in-plain-C-Part-5" rel="nofollow noopener">Sign In</a><wbr><a href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1809796" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_1809796" name="react-item_1809796" id="MRF1809796" class="reaction-result"></span><span data-objectref="3_1809796" data-votingtype="GoodOrBad" name="RateItem_1809796" id="MVF1809796" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="1809796" href="https://www.codeproject.com/Messages/1809796/Does-COM-need-to-be-Rebased" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1810810_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="38px" class="indent"><a name="xx1810810xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_answer.gif" alt="Answer" title="Answer"></td><td class="subject hover-container"><a class="message-link" name="1810810" parent="1809796" thread="1809796" href="https://www.codeproject.com/Messages/1810810/Re-Does-COM-need-to-be-Rebased">Re: Does COM need to be Rebased?</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Jeff Glatt</span><span class="date">19-Dec-06  4:02</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=88625">Jeff Glatt</a></span></td><td class="date"><span>19-Dec-06  4:02&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1810810_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,1809796);" href="https://www.codeproject.com/Messages/1809796/Does-COM-need-to-be-Rebased"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>A DLL doesn't need to be rebased, and I definitely wouldn't do that with a DLL which may be loaded by numerous processes.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14183/COM-in-plain-C-Part-5" rel="nofollow noopener">Sign In</a><wbr><a href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1809796" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_1810810" name="react-item_1810810" id="MRF1810810" class="reaction-result"></span><span data-objectref="3_1810810" data-votingtype="GoodOrBad" name="RateItem_1810810" id="MVF1810810" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="1810810" href="https://www.codeproject.com/Messages/1810810/Re-Does-COM-need-to-be-Rebased" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1810944_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="56px" class="indent"><a name="xx1810944xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="1810944" parent="1810810" thread="1809796" href="https://www.codeproject.com/Messages/1810944/Re-Does-COM-need-to-be-Rebased">Re: Does COM need to be Rebased?</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Hunt Chang</span><span class="date">19-Dec-06  5:06</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=1474499">Hunt Chang</a></span></td><td class="date"><span>19-Dec-06  5:06&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1810944_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:56px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,1810810);" href="https://www.codeproject.com/Messages/1810810/Re-Does-COM-need-to-be-Rebased"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Mr. Glatt,<br>
<br>
Thanks a lot for your fast response. <img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/rose.gif" align="top" alt="Rose | [Rose]"> <br>
<br>
But I am a little bit confused, do you mean the "COM" does not need to be rebased or all the general "DLLs"?<br>
<br>
I can understand if we rebase a DLL used by lots of process may mess up 
the thing even more, but I can not understand the meaning of "A DLL 
doesn't need to be rebased".  Why is that?<br>
<br>
You know this is a very different guide and opinion. I am not a mature 
programmer of C or C++, my question is just because there are too many 
articles say so, "some time we have to rebase the DLL to fit it into 
certain virtual memory", and even MS offers a tool of "rebase", then 
why?<br>
<br>
Hunt<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14183/COM-in-plain-C-Part-5" rel="nofollow noopener">Sign In</a><wbr><a href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1809796" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_1810944" name="react-item_1810944" id="MRF1810944" class="reaction-result"></span><span data-objectref="3_1810944" data-votingtype="GoodOrBad" name="RateItem_1810944" id="MVF1810944" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="1810944" href="https://www.codeproject.com/Messages/1810944/Re-Does-COM-need-to-be-Rebased" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1811318_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="74px" class="indent"><a name="xx1811318xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="1811318" parent="1810944" thread="1809796" href="https://www.codeproject.com/Messages/1811318/Re-Does-COM-need-to-be-Rebased">Re: Does COM need to be Rebased?</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Jeff Glatt</span><span class="date">19-Dec-06  10:02</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=88625">Jeff Glatt</a></span></td><td class="date"><span>19-Dec-06  10:02&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1811318_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:74px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,1810944);" href="https://www.codeproject.com/Messages/1810944/Re-Does-COM-need-to-be-Rebased"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Do
 not rebase your COM DLLs. You don't need to do that for _any_ DLLs. If 
another article tells you that is _required_, then that article is 
incorrect. Rebasing a DLL may be fine if you're sure it's going to be 
loaded in a process that doesn't load any other DLL rebased to the same 
address. But you can't be sure of that with a COM component (unless you 
plan to use it only with software you yourself write). Don't do it, or 
you're asking for trouble.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14183/COM-in-plain-C-Part-5" rel="nofollow noopener">Sign In</a><wbr><a href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1809796" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_1811318" name="react-item_1811318" id="MRF1811318" class="reaction-result"></span><span data-objectref="3_1811318" data-votingtype="GoodOrBad" name="RateItem_1811318" id="MVF1811318" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="1811318" href="https://www.codeproject.com/Messages/1811318/Re-Does-COM-need-to-be-Rebased" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1811528_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="92px" class="indent"><a name="xx1811528xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="1811528" parent="1811318" thread="1809796" href="https://www.codeproject.com/Messages/1811528/Re-Does-COM-need-to-be-Rebased">Re: Does COM need to be Rebased?</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Hunt Chang</span><span class="date">19-Dec-06  15:01</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=1474499">Hunt Chang</a></span></td><td class="date"><span>19-Dec-06  15:01&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1811528_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:92px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,1811318);" href="https://www.codeproject.com/Messages/1811318/Re-Does-COM-need-to-be-Rebased"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Mr. Glatt,<br>
<br>
Thanks very much, I got your point.<br>
<br>
Hunt <img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/smiley_biggrin.gif" align="top" alt="Big Grin | :-D"><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14183/COM-in-plain-C-Part-5" rel="nofollow noopener">Sign In</a><wbr><a href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1809796" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_1811528" name="react-item_1811528" id="MRF1811528" class="reaction-result"></span><span data-objectref="3_1811528" data-votingtype="GoodOrBad" name="RateItem_1811528" id="MVF1811528" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="1811528" href="https://www.codeproject.com/Messages/1811528/Re-Does-COM-need-to-be-Rebased" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1552351_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx1552351xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="1552351" parent="0" thread="1552351" href="https://www.codeproject.com/Messages/1552351/Exe-and-DCOM-error">Exe and DCOM error</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">czatcodeguru</span><span class="date">28-Jun-06  0:23</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=3130730">czatcodeguru</a></span></td><td class="date"><span>28-Jun-06  0:23&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1552351_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Hey,<br>
<br>
thanks for this great tutorial.<br>
<br>
I have a wsc script and wrapper, which simple gives the script an own 
process. The wrapper is written in Labwindos from National Instruments. 
But I hate the NI IDE and I would like to replace it, with a simple c 
program. <br>
<br>
I start compiling the examples and the dll stuff is working without any 
problems. But I have some problems to compile the "exe". <br>
<br>
First, it looks like that there is a "#ifdef" missing:<br>
<div class="pre-lang" id="premain493998"><div></div><div class="pre-action-link"><span class="code-collapse" data-index="493998" id="preShrink493998">Shrink </span> &nbsp; <span id="copycode493998" class="copy-code" data-index="493998" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve">
<g>
<path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272
    c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729
    c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path>
<path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272
    c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068
    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001
    C291.206,428.715,289.92,430,288.341,430z"></path>	
</g>
</svg></span></div></div>
<pre id="pre493998" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">	OutstandingObjects = (DWORD)-1;
<span class="code-preprocessor">#else
</span>	OutstandingObjects = <span class="code-digit">0</span>;
<span class="code-preprocessor">#endif</span></pre><br>
I replace this and I tried it with both ways (-1 and 0).<br>
<br>
Now, when I start the script-client-example the server starts but then I
 get a DCOM timeout error in the event log and a activex object error 
from the script engine:<br>
<br>
(Sorry, the os is a german installation and I have to translate it - but my english is very bad.)<br>
<br>
Event Log:<br>
<br>
Event Number: 10010<br>
Source: DCOM<br>
The Server did not response in the given time interval.<br>
<br>
<br>
Script Engine:<br>
<br>
Runtime Error in Microsoft VBScrip: ActiveX-Component cannot create object: 'IExampleExe.object'<br>
<br>
<br>
<br>
Can you give me a hint, how to solve this?<br>
<br>
Thankx,<br>
<br>
CZ<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14183/COM-in-plain-C-Part-5" rel="nofollow noopener">Sign In</a><wbr><a href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1552351" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_1552351" name="react-item_1552351" id="MRF1552351" class="reaction-result"></span><span data-objectref="3_1552351" data-votingtype="GoodOrBad" name="RateItem_1552351" id="MVF1552351" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="1552351" href="https://www.codeproject.com/Messages/1552351/Exe-and-DCOM-error" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1552796_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="38px" class="indent"><a name="xx1552796xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="1552796" parent="1552351" thread="1552351" href="https://www.codeproject.com/Messages/1552796/Re-Exe-and-DCOM-error">Re: Exe and DCOM error</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Jeff Glatt</span><span class="date">28-Jun-06  4:58</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=88625">Jeff Glatt</a></span></td><td class="date"><span>28-Jun-06  4:58&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1552796_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,1552351);" href="https://www.codeproject.com/Messages/1552351/Exe-and-DCOM-error"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>I
 think that a DCOM component needs to be started as a service, and 
probably needs some other things done. I haven't worked with DCOM.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14183/COM-in-plain-C-Part-5" rel="nofollow noopener">Sign In</a><wbr><a href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1552351" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_1552796" name="react-item_1552796" id="MRF1552796" class="reaction-result"></span><span data-objectref="3_1552796" data-votingtype="GoodOrBad" name="RateItem_1552796" id="MVF1552796" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="1552796" href="https://www.codeproject.com/Messages/1552796/Re-Exe-and-DCOM-error" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1553973_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="56px" class="indent"><a name="xx1553973xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="1553973" parent="1552796" thread="1552351" href="https://www.codeproject.com/Messages/1553973/Re-Exe-and-DCOM-error">Re: Exe and DCOM error</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">czatcodeguru</span><span class="date">28-Jun-06  23:11</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=3130730">czatcodeguru</a></span></td><td class="date"><span>28-Jun-06  23:11&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1553973_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:56px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,1552796);" href="https://www.codeproject.com/Messages/1552796/Re-Exe-and-DCOM-error"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Hey Jeff,<br>
<br>
thanks for your answer. AFAIK DCOM is just the extension of COM managed 
by the os. But I am not a expert. I just found this information in the 
jungle of my Visual C++ 6.0 help files:<br>
<br>
<div class="pre-lang" id="premain330378"><div></div><div class="pre-action-link"><span class="code-collapse" data-index="330378" id="preShrink330378">Shrink </span> &nbsp; <span id="copycode330378" class="copy-code" data-index="330378" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve">
<g>
<path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272
    c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729
    c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path>
<path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272
    c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068
    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001
    C291.206,428.715,289.92,430,288.341,430z"></path>	
</g>
</svg></span></div></div>
<pre id="pre330378" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">Article ID: Q158582  
The information <span class="code-keyword">in</span> <span class="code-keyword">this</span> article applies to: 
Microsoft COM/DCOM libraries included with: Microsoft Windows NT <span class="code-digit">4</span>.<span class="code-digit">0</span> Microsoft Windows <span class="code-digit">95</span> with DCOM support 


SUMMARY
COM server and client applications that were written before the introduction of DCOM can be configured to use DCOM by making appropriate changes to the server application<span class="code-string">'</span><span class="code-string">s registry entries. The server and client applications do not need to be rewritten. This procedure can be applied to any COM server and client, including those created using MFC or Visual Basic. </span></pre><br>
<br>
Can you help me to get your Example exe server running? I don't know which client example application to use.<br>
<br>
Thanks for your work,<br>
<br>
CZ<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14183/COM-in-plain-C-Part-5" rel="nofollow noopener">Sign In</a><wbr><a href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1552351" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_1553973" name="react-item_1553973" id="MRF1553973" class="reaction-result"></span><span data-objectref="3_1553973" data-votingtype="GoodOrBad" name="RateItem_1553973" id="MVF1553973" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="1553973" href="https://www.codeproject.com/Messages/1553973/Re-Exe-and-DCOM-error" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1534200_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx1534200xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="1534200" parent="0" thread="1534200" href="https://www.codeproject.com/Messages/1534200/Differences-between-an-OCX-and-a-DLL">Differences between an OCX and a DLL</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Jahanshahi</span><span class="date">15-Jun-06  6:10</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=2896030">Jahanshahi</a></span></td><td class="date"><span>15-Jun-06  6:10&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1534200_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Dear Jeff,<br>
<br>
  I eagarly follow your series in COM development in plain C. I should confess that it is more than interesting for me.<br>
<br>
I've always doubted if the underlying file format of a DLL and an OCX 
are the same. For example if we bury an automation server into a DLL and
 add a type library resource for it we can simply change the type from a
 .DLL to an .OCX and use it without problem. Can this be true?<br>
<br>
Mohsen <br>
<br>
Mohsen Jahanshahi<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14183/COM-in-plain-C-Part-5" rel="nofollow noopener">Sign In</a><wbr><a href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1534200" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_1534200" name="react-item_1534200" id="MRF1534200" class="reaction-result"></span><span data-objectref="3_1534200" data-votingtype="GoodOrBad" name="RateItem_1534200" id="MVF1534200" class="rating-result"><span>2.00/5 (1 vote)</span></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="1534200" href="https://www.codeproject.com/Messages/1534200/Differences-between-an-OCX-and-a-DLL" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1534802_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="38px" class="indent"><a name="xx1534802xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="1534802" parent="1534200" thread="1534200" href="https://www.codeproject.com/Messages/1534802/Re-Differences-between-an-OCX-and-a-DLL">Re: Differences between an OCX and a DLL</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Jeff Glatt</span><span class="date">15-Jun-06  14:03</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=88625">Jeff Glatt</a></span></td><td class="date"><span>15-Jun-06  14:03&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1534802_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,1534200);" href="https://www.codeproject.com/Messages/1534200/Differences-between-an-OCX-and-a-DLL"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>I
 haven't worked with OCX files, but I do know that they are ActiveX 
"controls". As such, I would assume that they must implement certain, 
defined COM objects such as IOleObject, IOleControl, IViewObject, etc. I
 do not know if they need to be registered via any particular registry 
keys, or not.<br>
<br>
This is not something I'm planning on covering in this series, so you'll have to seek out other sources of information.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14183/COM-in-plain-C-Part-5" rel="nofollow noopener">Sign In</a><wbr><a href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1534200" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_1534802" name="react-item_1534802" id="MRF1534802" class="reaction-result"></span><span data-objectref="3_1534802" data-votingtype="GoodOrBad" name="RateItem_1534802" id="MVF1534802" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="1534802" href="https://www.codeproject.com/Messages/1534802/Re-Differences-between-an-OCX-and-a-DLL" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1516880_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx1516880xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="1516880" parent="0" thread="1516880" href="https://www.codeproject.com/Messages/1516880/COM-development">COM development.</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">kravnus1</span><span class="date">4-Jun-06  21:32</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=1829210">kravnus1</a></span></td><td class="date"><span>4-Jun-06  21:32&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1516880_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Hi Jeff,<br>
<br>
 I do notice that you are relying plenty on internal workings on the C 
compiler. For example expecting certain fields to be there at these 
offset. I started reading from the first part of this series. I must say
 well done. However I am not not that comfortable with using pointer 
arithmetic when moving between sub type. I have read that portion and 
find it uncomfortable to use it. Yes it is correct but it relies too 
much on it's alignment of the fields. Anyway I don't see how one can 
overcome this limitation;I too depend on memory alignment since at times
 it is not easy with the VC compiler. <br>
<br>
 I believe the biggest grip is emulating CPP on C........ The headache and amount of typing one has to do. Argh!<br>
 <br>
 Anyway, good job in digging out on the internal on C++ and the COM technology!<br>
<br>
John<br><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14183/COM-in-plain-C-Part-5" rel="nofollow noopener">Sign In</a><wbr><a href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1516880" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_1516880" name="react-item_1516880" id="MRF1516880" class="reaction-result"></span><span data-objectref="3_1516880" data-votingtype="GoodOrBad" name="RateItem_1516880" id="MVF1516880" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="1516880" href="https://www.codeproject.com/Messages/1516880/COM-development" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1527741_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="38px" class="indent"><a name="xx1527741xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="1527741" parent="1516880" thread="1516880" href="https://www.codeproject.com/Messages/1527741/Re-COM-development">Re: COM development.</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Jeff Glatt</span><span class="date">12-Jun-06  6:05</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=88625">Jeff Glatt</a></span></td><td class="date"><span>12-Jun-06  6:05&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1527741_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,1516880);" href="https://www.codeproject.com/Messages/1516880/COM-development"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>I
 use the offsetof() macro to access private data fields of my COM 
objects. By "private", I mean that nobody accesses them except for the 
functions of my own COM object. Unless your C compiler's offsetof() 
macro is severely broken, it will always calculate the correct offset, 
regardless of "memory alignment of fields". So the pointer arithmetic 
will always work. This is a non-issue.<br>
<br>
Actually, I don't think that it's all that difficult to do COM in C, 
versus C++. And in fact, in translating various C++ COM examples to C, 
I've uncovered lots and lots of bugs, lack of proper error checking, and
 other questionable practices. The big gripe I have with C++ code is 
that, doing proper error checking makes it every bit as much a 
"headache" and involves an "amount of typing", such that few C++ 
programmers do it. For example, they think nothing of declaring some 
object as a data member of another object, and then fail to consider the
 ramifications of there being a problem creating that sub-object. Even 
if the code has the bare-minimum error checking needed to avoid 
crashing, there typically are memory leaks from some things being 
"allocated" but never "released".<br>
If you look at MS example C++ COM code, you'll be horrified about the 
lack of error checking. (They even do an explicit new without checking 
whether it failed). And it appears that lots and lots of programmers 
just use variations on this code without fixing these things. Why? 
Because programmers are misled that using C++ is so "easy" and "simple",
 and that the compiler does all of the messy low level details for you, 
including error checking. No, that's not the case if you want to write 
code that behaves in a responsible manner. Really, the main advantage of
 C++ is reusability, not ease of use. And if you organize your C COM 
objects into separate source files, follow a logical naming convention 
for global functions, and make judicious use of the static keyword (for 
example like how I did in the multiple interface COM example), then the C
 code is equally reusuable, and frankly, I think it's a lot more 
readable/understandable.<br>
<br>
The benefits of C++ are vastly overrated, and often misrepresented.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14183/COM-in-plain-C-Part-5" rel="nofollow noopener">Sign In</a><wbr><a href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1516880" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_1527741" name="react-item_1527741" id="MRF1527741" class="reaction-result"></span><span data-objectref="3_1527741" data-votingtype="GoodOrBad" name="RateItem_1527741" id="MVF1527741" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="1527741" href="https://www.codeproject.com/Messages/1527741/Re-COM-development" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1529851_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="56px" class="indent"><a name="xx1529851xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="1529851" parent="1527741" thread="1516880" href="https://www.codeproject.com/Messages/1529851/Re-COM-development-modified">Re: COM development. [modified]</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">kravnus1</span><span class="date">13-Jun-06  6:02</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=1829210">kravnus1</a></span></td><td class="date"><span>13-Jun-06  6:02&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1529851_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:56px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,1527741);" href="https://www.codeproject.com/Messages/1527741/Re-COM-development"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>I
 believe we all suffer from the lack of documentation for C++ COM or 
matter a fact COM itself. You are right that the samples are not bullet 
proof but who is <img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/smiley_smile.gif" align="top" alt="Smile | :)">
  You are right that C++ CAN lead to mysterious bugs but I have seen C 
that equally provides bad code. Any language can but it is the 
programmer's duty to check them. C++ simple? HA! I have been bitten by 
using ppl's code badly. <br>
<br>
I have double checked on the offset on the MSVC++ v6.0 compiler and the 
problem of inconsistent holes does not exist. But I do not have the 
certainty nor should it be a habit to expect every compiler to have the 
same member alignment. Fortunately most default settings are MSVC++ 
compliant. But if it is non standard then ............ <br>
<br>
the following is what can go wrong. <br>
<br>
#include &lt; stddef.h &gt; //problem on page????? showing output, so leaving spaces<br>
#include &lt; stdio.h &gt;<br>
<br>
<br>
<br>
struct nonAlignMem{<br>
	int i;<br>
	int b;<br>
	char c;<br>
	char d;<br>
	int e;<br>
}tmpMem0;<br>
<br>
<br>
#pragma pack(2)<br>
<br>
struct alignMem{<br>
	int i;<br>
	int b;<br>
	char c;<br>
	char d;<br>
	int e;<br>
}tmpMem1;<br>
<br>
<br>
<br>
int main(int argc,char **argv)<br>
{<br>
<br>
	<br>
	printf("sizeof %d \n",sizeof(tmpMem0));<br>
	printf("offset of c %d \n",offsetof(struct nonAlignMem,c) );<br>
	printf("offset of d %d \n",offsetof(struct nonAlignMem,d) );<br>
	printf("offset of e %d \n",offsetof(struct nonAlignMem,e) );<br>
<br>
	<br>
	<br>
	printf("sizeof %d \n",sizeof(tmpMem1));<br>
	printf("offset of c %d \n",offsetof(struct alignMem,c) );<br>
	printf("offset of d %d \n",offsetof(struct alignMem,d) );<br>
	printf("offset of e %d \n",offsetof(struct alignMem,e) );<br>
<br>
<br>
	return 0;<br>
<br>
<br>
<br>
}<br>
<br>
<br>
check the output for the offset for e. Your program can use pragma to eliminate the possibility of this happening.<br>
<br>
BTW, I use C++ but like C more thanks to it's simplicity. Heck Unix was written in C!<br>
<br>
John<br>
<br>
PS: I am tempted in using your code in production.<br>
<br>
<br>
 -- modified at 12:04 Tuesday 13th June, 2006<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14183/COM-in-plain-C-Part-5" rel="nofollow noopener">Sign In</a><wbr><a href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1516880" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_1529851" name="react-item_1529851" id="MRF1529851" class="reaction-result"></span><span data-objectref="3_1529851" data-votingtype="GoodOrBad" name="RateItem_1529851" id="MVF1529851" class="rating-result"><span>1.00/5 (1 vote)</span></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="1529851" href="https://www.codeproject.com/Messages/1529851/Re-COM-development-modified" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1530161_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="74px" class="indent"><a name="xx1530161xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="1530161" parent="1529851" thread="1516880" href="https://www.codeproject.com/Messages/1530161/Re-COM-development">Re: COM development.</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Jeff Glatt</span><span class="date">13-Jun-06  9:30</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=88625">Jeff Glatt</a></span></td><td class="date"><span>13-Jun-06  9:30&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1530161_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:74px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,1529851);" href="https://www.codeproject.com/Messages/1529851/Re-COM-development-modified"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>It
 doesn't matter. You're presumably going to use one compiler to compile 
all of the source files to make the DLL. (It won't make sense 
otherwise). So the offsetof() macro will work the same wherever it is 
used in those sources.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14183/COM-in-plain-C-Part-5" rel="nofollow noopener">Sign In</a><wbr><a href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1516880" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_1530161" name="react-item_1530161" id="MRF1530161" class="reaction-result"></span><span data-objectref="3_1530161" data-votingtype="GoodOrBad" name="RateItem_1530161" id="MVF1530161" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="1530161" href="https://www.codeproject.com/Messages/1530161/Re-COM-development" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1530482_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="92px" class="indent"><a name="xx1530482xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="1530482" parent="1530161" thread="1516880" href="https://www.codeproject.com/Messages/1530482/Re-COM-development">Re: COM development.</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">kravnus1</span><span class="date">13-Jun-06  15:47</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=1829210">kravnus1</a></span></td><td class="date"><span>13-Jun-06  15:47&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1530482_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:92px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,1530161);" href="https://www.codeproject.com/Messages/1530161/Re-COM-development"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>do you have any other contribution articles beside COM? Would like to read them.<br>
<br>
John<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14183/COM-in-plain-C-Part-5" rel="nofollow noopener">Sign In</a><wbr><a href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1516880" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_1530482" name="react-item_1530482" id="MRF1530482" class="reaction-result"></span><span data-objectref="3_1530482" data-votingtype="GoodOrBad" name="RateItem_1530482" id="MVF1530482" class="rating-result"></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="1530482" href="https://www.codeproject.com/Messages/1530482/Re-COM-development" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1530542_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="110px" class="indent"><a name="xx1530542xx"></a><img height="16px" width="16px" align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_general.gif" alt="General" title="General"></td><td class="subject hover-container"><a class="message-link" name="1530542" parent="1530482" thread="1516880" href="https://www.codeproject.com/Messages/1530542/Re-COM-development-modified">Re: COM development. [modified]</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Jeff Glatt</span><span class="date">13-Jun-06  17:58</span>
</div></td><td class="icon"><img style="border:0;width:16px;height:16px" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/icn-member-16.gif" title="Member"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=88625">Jeff Glatt</a></span></td><td class="date"><span>13-Jun-06  17:58&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1530542_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:110px;"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,1530482);" href="https://www.codeproject.com/Messages/1530482/Re-COM-development"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Toward
 the top of this page, you'll see my name under the article's title. 
This is a clickable link. Click on my name, and it will present a page 
listing all of my Code Project articles. (You can can click on some 
author's name of any Code Project article to see the other articles he 
has written. This is a standard Code Project navigation feature).<br>
<br>
Note that I rewrote the IE article since it duplicated a lot of the info
 in this COM series, and the code base was updated quite a bit since the
 article was originally written. <br>
<br>
<div class="ForumMod">modified on Wednesday, August 6, 2008 11:52 PM</div><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/14183/COM-in-plain-C-Part-5" rel="nofollow noopener">Sign In</a><wbr><a href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1516880" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span data-objectref="3_1530542" name="react-item_1530542" id="MRF1530542" class="reaction-result"></span><span data-objectref="3_1530542" data-votingtype="GoodOrBad" name="RateItem_1530542" id="MVF1530542" class="rating-result"><span>2.00/5 (1 vote)</span></span><a class="border-none" onclick="return forumCtrl_ctl00_MessageBoard.ShowPermaLink(this);" data-permalink="true" data-msgid="1530542" href="https://www.codeproject.com/Messages/1530542/Re-COM-development-modified" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/share.png" style="width:14px;height:14px;border:0"></a>&nbsp;</td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr>
<td><table width="100%" cellpadding="2px" cellspacing="0">
<tbody><tr class="footer">
<td><span class="last-visit desktop-only tablet-only">Last Visit: 31-Dec-99  18:00 &nbsp; &nbsp; Last Update: 27-Aug-23  0:42</span></td><td><a rel="nofollow" href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;prof=True&amp;view=Normal">Refresh</a></td><td style="text-align:right;white-space:nowrap;"><input id="_mbnUrl" type="hidden" value="/Articles/14183/COM-in-plain-C-Part-5?fid=308357&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;prof=True&amp;view=Normal&amp;fr=25"><span class="nav-link selected">1</span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table>
</div><p class="small-text"><img align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_general.gif" width="16px" height="16px" alt="General"> General &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_news.gif" width="16px" height="16px" alt="News"> News &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_idea.gif" width="16px" height="16px" alt="Suggestion"> Suggestion &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_question.gif" width="16px" height="16px" alt="Question"> Question &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_bug.gif" width="16px" height="16px" alt="Bug"> Bug &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_answer.gif" width="16px" height="16px" alt="Answer"> Answer &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_joke.gif" width="16px" height="16px" alt="Joke"> Joke &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_kudos.gif" width="16px" height="16px" alt="Praise"> Praise &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_rant.gif" width="16px" height="16px" alt="Rant"> Rant &nbsp;&nbsp; <img align="top" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/msg_admin.gif" width="16px" height="16px" alt="Admin"> Admin &nbsp;&nbsp; </p><p class="small-text">Use Ctrl+Left/Right to switch messages, Ctrl+Up/Down to switch threads, Ctrl+Shift+Left/Right to switch pages.</p>
				

			</div>
			

            
            <div id="ctl00_RightSideBar" class="article-right-sidebar">

				
				

				

                <div id="ctl00_RHSticky" class="container-article-info-sticky sticky">

					<div class="padded-top" style="height:250px;width:300px">
						<div class="msg-300x250" data-format="300x250" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="senseai" data-country="US" data-tags="C++, Windows, Visual-Studio, Dev, COM, Beginner,rating4.5"><noscript><a href="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/senseai&sz=300x250&c=881171"><img src="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/senseai&sz=300x250&c=881171"  width="300px" height="250px" target="_blank"/></a></noscript></div>
					</div>

        		    

<div class="article-summary">

    
    

</div>

				    

                    

				    

				    

					<div class="padded-top" style="height:250px;width:300px">
						<div class="msg-300x250" data-format="300x250" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="Programming-LanguagesCplusplus" data-country="US" data-loadonview="true" data-tags="C++, Windows, Visual-Studio, Dev, COM, Beginner,rating4.5"><noscript><a href="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Programming-LanguagesCplusplus&sz=300x250&c=881171"><img src="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Programming-LanguagesCplusplus&sz=300x250&c=881171"  width="300px" height="250px" target="_blank"/></a></noscript></div>
					</div>

                    <div class="anchorLink gototop" id="gototop">
                        <a id="ctl00_GoToTop" href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5#_articleTop">Go to top</a>
                    </div>

			    </div>
            </div>
            

        </div>
        

		
		<div class="site-footer">
			<div class="align-left">
				<a id="ctl00_PermaLink" href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5">Permalink</a><br>
				<a id="ctl00_AdvertiseLink" href="http://developermedia.com/">Advertise </a><br>
				<a id="ctl00_PrivacyLink" href="https://www.codeproject.com/info/privacy.aspx">Privacy</a><br>
    			<a id="ctl00_CookiePolicyLink" href="https://www.codeproject.com/info/cookie.aspx">Cookies</a><br>
                <a id="ctl00_TermsOfUseLink" href="https://www.codeproject.com/info/TermsOfUse.aspx">Terms of Use</a><br>
			</div>

            <div class="align-center">
				


<div class="page-width">
    Layout: <a id="ctl00_PageWidth_FixedT" title="Fixed width layout" rel="nofollow" class=" active" href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?PageFlow=FixedWidth">fixed</a>
    |
    <a id="ctl00_PageWidth_FluidT" title="Fluid layout" rel="nofollow" href="https://www.codeproject.com/Articles/14183/COM-in-plain-C-Part-5?PageFlow=Fluid">fluid</a>
</div>


				

				

	            

                <br>
			</div>
                
			<div class="align-right">
				Article Copyright 2006 by Jeff Glatt<br>Everything else
				Copyright  <a href="mailto:webmaster@codeproject.com">CodeProject</a>, 1999-2023 <br>
                <br>
				Web03 
				2.8:2023-08-14:1<br>
			</div>
		</div>
		

		<br clear="all">
		
			

	</div> 
	</div> 
</div>



<img id="ctl00_Audience" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/DFPAudiencePixel" style="border-width:0px;height:1px;width:1px;">



<script type="text/javascript"> // IMMEDIATE script

function Join() {
    document.location.href = 'https://www.codeproject.com/script/Membership/Modify.aspx';
    return false;
}

var xgikmimtql = function(n){var t=!1;n=n||{};var r=n.RetrievalServiceUrl||"/script/content/webservices/RetrieveContent.aspx/GetContent",u=n.RetrievalServiceRetries||3,f=n.RetrievalServiceTimeout||5e3,e=function(){t||(t=!0,$(window).on("resize scroll",i),i())},i=function(){if(typeof DMAds=="undefined"){var n=$('[data-type="ad"]');n.each(function(){var n=$(this),u=n.attr("data-format")||"",f=n.attr("data-publisher")||"",e=n.attr("data-zone")||"",t=n.attr("data-loadonview"),i=n.attr("data-noadx"),h=n.attr("data-tags")||"",c=n.find("iframe").length!==0||n.find("img").length!==0,r=n.attr("data-processed");t=typeof t=="string"&&t.toLowerCase()==="true";i=typeof i=="string"&&i.toLowerCase()==="true";r=typeof r=="string"&&r.toLowerCase()==="true";r||c||t&&!s(this)||(o(n,u,f,e,i,h),n.attr("data-processed","true"))})}},o=function(n,t,i,e,o,s){var h=new $.Deferred,c=JSON.stringify({format:t,publisherCode:i,zone:e,noAdX:o,keywords:s});$.ajax({url:r,cache:!1,type:"POST",data:c,contentType:"application/json; charset=utf-8",dataType:"json",tryCount:0,retryLimit:u,timeout:f}).done(function(t){var i=t?t.d:null;h.resolve(i); i && i.html && n.html(i.html)}).fail(function(n,t){h.reject(t)})},s=function(n){var t,f,e,o;if(!h(n))return!1;var u=!1,i=0,r=0;try{t=n.getBoundingClientRect();typeof innerWidth=="number"?(i=window.innerWidth,r=window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?(i=document.documentElement.clientWidth,r=document.documentElement.clientHeight):document.body&&(document.body.clientWidth||document.body.clientHeight)&&(i=document.body.clientWidth,r=document.body.clientHeight);f=-200;t.top===t.bottom&&(f+=n.height*-1);e=t.top>=0&&t.top-200<=r||t.top<=0&&t.top>=f;o=i>t.left&&t.right>=0;u=e&&o}catch(s){u=!0}return u},h=function(n){var t=!1,i;return n&&n.style.position!=="fixed"&&n.offsetParent?t=!0:n&&n.style.position==="fixed"&&(i=window.getComputedStyle(n),t=i&&i.display!=="none"),t&&c()},c=function(){var t=!0,n="";return typeof document.hidden!="undefined"?n="hidden":typeof document.mozHidden!="undefined"?n="mozHidden":typeof document.msHidden!="undefined"?n="msHidden":typeof document.webkitHidden!="undefined"&&(n="webkitHidden"),n!==null&&document[n]&&(t=!1),t};return{init:e}};
document.addEventListener('DOMContentLoaded', function() {
var n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP"),t;n.onreadystatechange=function(){try{if(n.readyState==4)if(n.status==200){var t=document.createElement("script");t.type="text/javascript";t.innerHTML=n.responseText;document.getElementsByTagName("body")[0].appendChild(t)}else(new xgikmimtql).init()}catch(i){(new xgikmimtql).init()}};try{t='/a.min.js?v=1.3';n.open("GET",t,!0);n.send()}catch(i){(new xgikmimtql).init()}

  $('div[data-type="ad"][data-showindicator="true"]').before('<div class="small-text muted hidden">Advertisement</div>');
  setTimeout(function(){ 
    $('div[data-type="ad"][data-showindicator="true"]').each(function( index ) {
      if ($(this).height() > 0) {
       $(this).prev().removeClass('hidden');
      }
    });
  }, 2000);

});

var ratingCtrl_ctl00_RateArticle;

var forumConfig_ctl00_MessageBoard;
var forumCtrl_ctl00_MessageBoard;
var forumCtrl_ctl00_MessageBoard_forumMsgFlag;
var forumCtrl_ctl00_MessageBoard_rating;
var forumCtrl_ctl00_MessageBoard_ratingConfig;
var forumCtrl_ctl00_MessageBoard_reaction;
var forumCtrl_ctl00_MessageBoard__reactionConfig;

var subscriptionConfig_ctl00_MessageBoard = {
 ParentId      : 'ctl00_MessageBoard_SubscribeDiv',
 NewId         : 'ctl00_MessageBoard_SubscribeNew',
 ReplyId       : 'ctl00_MessageBoard_SubscribeReplies',
 InstantId     : 'ctl00_MessageBoard_SubscribeInstant',
 DailyId       : 'ctl00_MessageBoard_SubscribeDaily',
 MessageTypeId : 'ctl00_MessageBoard_MessageType',
 GetInfoUrl    : '/script/Forums/WebServices/ForumSubscriptionServices.aspx/GetSubscriptions',
 UpdateInfoUrl : '/script/Forums/WebServices/ForumSubscriptionServices.aspx/UpdateSubscription',
 ForumId       : 308357,
};
var subscriptions_ctl00_MessageBoard;
</script>

<script type="text/javascript"> // DEFERRED script

document.addEventListener('DOMContentLoaded', function() {

	new CodeBlocks().initialise('#contentdiv');
	
	$('.author-wrapper .description').shorten({showChars: 400});
	
	anchorAnimate();
	
	$('#__EVENTVALIDATION').attr('autocomplete', 'off');
	
	$('#joinBtn').css('visibility', 'visible');
	
	MicroModal.init();
	
	$('.oauth').click(function () {
	    $this = $(this);
	    href = $this.attr('href');
	    var myWindow = window.open(href, 'popup',
	                              'width=800,height=600,location=0,menubar=0,resizeable=0,scrollbars=0,toolbar=0');
	    myWindow.focus();
	    var timer = setInterval(function () {
	        if (myWindow.closed) {
	            clearInterval(timer);
	            // window.location.reload(); // May do a POST reload, shows a warning
	            window.location = window.location; // force a GET reload
	        }
	    }, 200);
	    return false;
	});
	
	var oSrchFlt = false, oSrchBox=false, srchBoxFoc=false;
	var sbar     = $('#sb_tb');
	var sfilter  = $('#SearchFilter');
	
	if (typeof(InitWatermark) !== 'undefined')
	  InitWatermark('sb_tb', 'Search for articles, questions, tips');
	if (sbar && sfilter) {
	  sfilter.removeClass('popup'); sfilter.hide(); sfilter.removeClass('open');
	  sbar.blur(function() {
	    if (!oSrchFlt) { sfilter.hide(); sfilter.removeClass('open'); }
	    srchBoxFoc = false;
	  });
	  sbar.focus(function() {
	    oSrchFlt   = false;
	    srchBoxFoc = true;
	    sfilter.show();
	    sfilter.addClass('open');
	  });
	  sbar.mouseleave(function()    { oSrchBox = false; });
	  sbar.mouseover(function()     { oSrchBox = true; });
	  sfilter.mouseleave(function() {
	    oSrchFlt=false;
	    if (!srchBoxFoc && !oSrchBox) { sfilter.hide(); sfilter.removeClass('open'); }
	  });
	  sfilter.mouseover(function()  { oSrchFlt = true; });
	}
	
	var ratingConfig_ctl00_RateArticle = {
	  objectRef:          '2_14183_1',
	  objectSubtypeId:    1,
	  objectTypeName:     'article',
	  ownerId:            88625,
	  votingType:         'None',
	  ratingDisplayMode:  'LargeStars',
	  resultDisplayMode:  'LargeStars',
	  ratingCallback:     null,
	  staticServer:       'https://codeproject.freetls.fastly.net',
	  baseDir:            '/script/Ratings/',
	  ratingUrl:          'ajax/RateItem.aspx',
	  histogramUrl:       'ajax/Histogram.aspx',
	  getRatingUrl:       'ajax/GetRatings.aspx',
	  width:              130,
	  forceComment:       false,
	  lowVoteThreshold:   0,
	  minRating:          1,
	  maxRating:          5
	};
	ratingCtrl_ctl00_RateArticle = new RatingControl('#ctl00_RateArticle_RatingTable',ratingConfig_ctl00_RateArticle);
	
	forumConfig_ctl00_MessageBoard_ratingConfig = {
	  objectTypeId:       3,
	  objectTypeName:     'message',
	  bulkResultSelector: '#_MessageBoardctl00_MessageBoard',
	  votingType:         'GoodOrBad',
	  staticServer:       'https://codeproject.freetls.fastly.net',
	  forceComment:       false,
	  ratingDisplayMode:  'TextOnly',
	  resultDisplayMode:  'TextOnly'
	};
	forumCtrl_ctl00_MessageBoard_rating = new RatingControl('#_MessageBoardctl00_MessageBoard .content', forumConfig_ctl00_MessageBoard_ratingConfig);
	forumConfig_ctl00_MessageBoard = {
	    objectName          : 'forumCtrl_ctl00_MessageBoard',
	    messageTypeId       : 3,
	    searchPrompt        : 'Search Comments',
	    smoothScroll        : true,
	    allowReporting      : false,
	    allowRating         : false,
	    allowRatingDisplay  : true,
	    allowReactions      : false,
	    forumDir            : '/script/Forums/',
	    staticServer        : 'https://codeproject.freetls.fastly.net',
	    switchMsgCallback   : null,
	    ratingControl       : forumCtrl_ctl00_MessageBoard_rating,
	    reactionControl     : null,
	    codeblockProcessor  : new CodeBlocks(),
	    getReportFormMethod : getReportFormHtml,
	    voteHiThreshold     : 5 - 0.5,
	    reportOptions       : [
	       { reportTypeId : 19, name : 'Abusive / Trolling'},
	       { reportTypeId : 20, name : 'Inappropriate'},
	       { reportTypeId : 5, name : 'Spam'},
	    ],
	};
	forumCtrl_ctl00_MessageBoard = new ForumControl('#ForumTable',forumConfig_ctl00_MessageBoard, -1);
	forumCtrl_ctl00_MessageBoard_rating.setConfig('ratingCallback', forumCtrl_ctl00_MessageBoard.showMessageRating);
	forumCtrl_ctl00_MessageBoard.Initialise();
	
	subscriptions_ctl00_MessageBoard = new Subscriptions(subscriptionConfig_ctl00_MessageBoard);
	subscriptions_ctl00_MessageBoard.initialise();
	
	cookieconsent.initialise({
	                                    enabled : true,
	                                    cookie  : { domain: 'codeproject.com' },
	                                    palette : {
	                                        popup: { background: '#ff9900' },
	                                        button: { background: '#f5d948' }
	                                    },
	                                    law :  {
	                                        showForAllRegions : true, 
	                                        countryCode : 'US' 
	                                    },
	                                    theme: 'edgeless',
	                                    type : 'opt-in-out',
	                                    content: {
	                                        message: 'Like every other website we use cookies. By using our site you acknowledge that you have read and understand our <a href=\'/info/cookie.aspx\'>Cookie Policy</a>, <a href=\'/info/privacy.aspx\'>Privacy Policy</a>, and our <a href=\'/info/TermsOfUse.aspx\'>Terms of Service</a>.',
	                                        href:    'https://www.codeproject.com/info/privacy.aspx',
	                                        dismiss: 'Ask me later'
	                                    },
	                                    revokable:true,
	                                    onStatusChange: function(status) {
	                                        $.ajax({
	                                		    dataType  : 'json',
	                                            data: JSON.stringify({ allowCookies : this.hasConsented() }),
	                                            url: '/script/membership/webservices/LoggedOnMemberservices.aspx/SetCookieConsent',
	                                            cache: false,
	                                            type: 'POST',
	                                            contentType: 'application/json'
	                                        })
	                                        console.log(this.hasConsented() ? 'enable cookies' : 'disable cookies');
	                                        console.log(this.hasAnswered() ? 'has answered' : 'did not answer');
	                                    },
	                                });

})
</script>










<style type="text/css">.copied::after {  position: absolute;  right: 0;  display: inline-block; white-space: nowrap; content: 'copied'; color: #fff; background-color: #f90;  border-radius: 3px; padding:1px 8px; opacity: 0;  will-change: opacity, transform; animation: showcopied 1.5s ease; } @keyframes showcopied { 0% { opacity: 0; } 70% { opacity: 1; } 100% { opacity: 0; } } </style><style type="text/css">.copied::after {  position: absolute;  right: 0;  display: inline-block; white-space: nowrap; content: 'copied'; color: #fff; background-color: #f90;  border-radius: 3px; padding:1px 8px; opacity: 0;  will-change: opacity, transform; animation: showcopied 1.5s ease; } @keyframes showcopied { 0% { opacity: 0; } 70% { opacity: 1; } 100% { opacity: 0; } } </style><script type="text/javascript">if(typeof DMAds=="undefined"){var SendDmAdUid=!1,SendSearchTermsToServer=!0,CodeProjectPublisherId="lqm.codeproject.site",EnableMutableAds=!0,EnableViewOnScroll=!0,adServer=adServer||window.location.protocol+"//ads.DeveloperMedia.com/",SearchTermUrl="https://apps.developermedia.com/Ads/PageTerms/GetTerms",AdClickUrl="https://apps.developermedia.com/Ads/PageTerms/LogClick",DownvoteUrl="https://apps.developermedia.com/Ads/AdVote/DownvoteByFingerprint",UndoDownvoteUrl="https://apps.developermedia.com/Ads/AdVote/UndoDownvote",ReportAdUrl="https://apps.developermedia.com/Ads/AdVote/ReportAd",GlobalIdUrl="https://apps.developermedia.com/Ads/GlobalUserIdentification/",CloseAdImageUrl="https://cdn1.developermedia.com/Content/images/undo.png",UndoCloseAdImageUrl="https://cdn1.developermedia.com/Content/images/redo.png",DmLogoImageUrl="https://cdn1.developermedia.com/Content/images/dm-logo-150x23.png";String.prototype.includes||(String.prototype.includes=function(n,t){"use strict";return(typeof t!="number"&&(t=0),t+n.length>this.length)?!1:this.indexOf(n,t)!==-1});var DMAdXHelper=function(){var n=[],t={},s=!1,r=!1,v=0,f=null,y=function(n){try{var i=p(n),t=w(n),r=b(n);t.insertBefore(r,t.children[0]);n.closeAdButton=i;n.reportAdDiv=t;n.adContainer.appendChild(i);n.adContainer.parentNode.appendChild(t);n.reportButton=t.getElementsByClassName("reportButton")[0];n.reportButton.disabled=!0;n.reportButton.onclick=function(){return l(n),!1}}catch(u){console.log(u)}},p=function(n){var i=document.createElement("input");return i.type="image",i.src=t.CloseAdImageUrl,i.title="Report Ad",i.align="left",i.style.cssText="z-index:1000; position:relative; left:0px; top:-"+n.height+"px; margin-top: 0px; margin-left: 0px; display:block; font-size:0px; border: 0px; padding: 0px; height:14px; width:14px",i.onclick=n.width===125&&n.height===125?function(){return c(n),l(n),!1}:function(){return c(n),!1},i},w=function(n){var t=n.width,i=n.height,r=document.createElement("div"),u="<select class='reportReason' style='max-width:150px !important; padding: 0px !important'><option>Offensive<\/option><option>Abusive<\/option><option>Off topic<\/option><option>Don't like the Ad<\/option > <option>Wrong language<\/option><\/select > ",f="<input type='button' disabled class='reportButton' style='padding: 0px !important' value='Report'><\/input>";return t===728&&i===90?k(r,u,f):t===300&&i===250?d(r,u,f):t===160&&i===600?g(r,u,f):t===125&&i===125&&nt(r),(t===728&&i===90||t===300&&i===250||t===160&&i===600)&&tt(n,r),r},b=function(n){var i=document.createElement("input");return i.type="image",i.src=t.UndoCloseAdImageUrl,i.title="Show Ad",i.style.cssText="z-index:1000; position:relative; left:0px; top:0px; width:14px; height:14px;margin-top: 0px; margin-left: 0px; font-size:0px; display:block; padding: 0px; border: 0px",i.onclick=function(){return h(n),!1},i},k=function(n,i,r){n.innerHTML="<div class='sendReportContainer' style='padding-left: 2px; display:block; line-height:initial !important'><div style='display:inline-block; font:14px/18px \"Segoe UI\", Arial'><b>Don't like this Ad?<\/b><\/div><div class='dropzone' contenteditable='true' style='margin-left:10px; height:60px; width: 250px; background-color:lightgray; border-style:dotted; border-color:black; border-radius: 5px; border-width: 2px; text-align: center; display:inline-block; white-space:normal'>1. Hit the refresh icon to show the ad again and take a screenshot. 2. Drag and Drop or paste the screenshot here<\/div><div style='margin-left:10px; display:inline-block; font:14px/18px \"Segoe UI\", Arial;'> "+i+"&nbsp;"+r+"<\/div><\/div><div class='reportSentContainer' style='display:none; padding: 15px 20px; font:14px/18px \"Segoe UI\", Arial;'><span style='color:#999'>Thank you for the report!<\/span><\/div><a href='http://www.developermedia.com/' target='_blank'><img src='"+t.DmLogoImageUrl+"' style='max-width:100%;position:absolute; right:10px; top:10px;'><\/a>";n.style.cssText="display:none; width:728px; height:90px; z-index:100; text-align:left;border-style:solid; border-width:1px; position:relative; background-color:white;box-sizing:border-box; top:0px; left:0px"},d=function(n,i,r){n.innerHTML="<div class='sendReportContainer' style='padding: 5px 5px; display:block; line-height:initial !important'><div style='padding-bottom:5px; font:14px/18px \"Segoe UI\", Arial;'><b>Don't like this Ad?<\/b><\/div><div class='dropzone' contenteditable='true' style='height:100px; width: 290px; margin-top:20px; margin-bottom: 20px; background-color:lightgray; border-style:dotted; border-color:black; border-radius: 5px; border-width: 2px; text-align: center; box-sizing:border-box; white-space:normal'>1. Hit the refresh icon to show the ad again so you can take a screenshot <br/>2. Drag and Drop or paste the screenshot here<\/div><div style='margin-top:5px; font:14px/18px \"Segoe UI\", Arial; '> "+i+"<\/div><div style='margin-top:5px; display:block; font:14px/18px \"Segoe UI\", Arial;'>"+r+"<\/div><\/div><div class='reportSentContainer' style='display:none; padding: 15px 20px; font:14px/18px \"Segoe UI\", Arial; '><span style='color:#999;'>Thank you for the report!<\/span><\/div><a href='http://www.developermedia.com/' target='_blank'><img src='"+t.DmLogoImageUrl+"' style='max-width:100%;position:absolute; right:20px; bottom:10px;'><\/a>";n.style.cssText="display:none; width:300px; height:250px; z-index:100; text-align:left;border-style:solid; border-width:1px; position:relative; background-color:white;box-sizing:border-box; top:0px; left:0px"},g=function(n,i,r){n.innerHTML="<div class='sendReportContainer' style='padding: 20px 15px; display:block; line-height:initial !important'><div style='padding-bottom:20px; display:block; font:14px/18px \"Segoe UI\", Arial;'><b>Don't like this Ad?<\/b><\/div><div class='dropzone' contenteditable='true' style='height:180px; width: 130px; margin-top:20px; margin-bottom: 20px; background-color:lightgray; border-style:dotted; border-color:black; border-radius: 5px; border-width: 2px; text-align: center; box-sizing:border-box; white-space:normal'>1. Hit the refresh icon to show the ad again so you can take a screenshot <br/><br/>2. Drag and Drop or paste the screenshot here<\/div><div style='padding-bottom:10px; padding-top: 10px display:block; font:14px/18px \"Segoe UI\", Arial;'> "+i+"<\/div><div style='font:14px/18px \"Segoe UI\", Arial;'>"+r+"<\/div><\/div><div class='reportSentContainer' style='display:none; padding: 15px 20px; font:14px/18px \"Segoe UI\", Arial;'><span style='color:#999;'>Thank you for the report!<\/span><\/div><a href='http://www.developermedia.com/' target='_blank'><img src='"+t.DmLogoImageUrl+"' style='max-width:120px;position:absolute; right:20px; bottom:20px;'><\/a>";n.style.cssText="display:none; width:160px; height:600px; z-index:100; text-align:left;border-style:solid; border-width:1px; position:relative; background-color:white;box-sizing:border-box; top:0px; left:0px"},nt=function(n){n.innerHTML="<div class='reportSentContainer' style='padding: 5px 5px;font:14px/18px \"Segoe UI\", Arial; width: 100px; height: 100px'><span style='color:#999;'>Thank you for the report!<\/span><\/div>";n.style.cssText="display:none; width:125px; height:125px; z-index:100; text-align:left;border-style:solid; border-width:1px; position:relative; background-color:white;box-sizing:border-box; top:0px; left:0px"},tt=function(n,t){if(n&&n.adContainer){var i=t.getElementsByClassName("dropzone")[0];i.dropzoneFor=n.adContainer.id;n.dropzone=i;s&&(i.ondragenter=function(n){n.currentTarget.style.backgroundColor="yellow";n.currentTarget.innerHTML="<br/><br/>Drag and Drop the ad here"},i.ondragleave=function(n){n.currentTarget.style.backgroundColor="lightgray";u(n.currentTarget.dropzoneFor)},i.ondragover=function(n){n.stopPropagation();n.preventDefault();n.currentTarget.style.backgroundColor="yellow"},i.ondrop=function(n){n.currentTarget.style.backgroundColor="lightgreen";rt(n)});r?f?f.observe(i,{childList:!0}):i.addEventListener("DOMSubtreeModified",function(){a(i)}):i.addEventListener("paste",it,!1)}},h=function(n){n.reportAdDiv.style.display==="none"?(n.reportAdDiv.style.display="table",n.closeAdButton.style.display="none",n.adContainer.style.display="none",n.dropzone.focus()):(n.reportAdDiv.style.display="none",n.closeAdButton.style.display="block",n.adContainer.style.display="block")},e=function(n){var t=i(n),r=t.dropzone;r.style.backgroundColor="lightgreen";r.innerHTML=t.width===160&&t.height===600?"<br/> Your screenshot has been received  thanks! <br/><br/> Next step: Whats wrong with the ad":t.width===300&&t.height===250?"<br/> Your screenshot has been received  thanks! <br/><br/> Next step: Whats wrong with the ad":t.width===728&&t.height===90?"Your screenshot has been received  thanks! Next step: Whats wrong with the ad":"Ad info received. Press Report to submit"},o=function(n){var t=i(n);t&&(t.reportButton.disabled=!1)},u=function(n){var t=i(n);t&&(t.reportButton.disabled=!0)},c=function(n){h(n)},l=function(n){var r=n.reportAdDiv.getElementsByClassName("reportReason")[0],s=r&&r.options[r.selectedIndex].value||"Unspecified",u=n.reportAdDiv.getElementsByClassName("sendReportContainer")[0],f=n.reportAdDiv.getElementsByClassName("reportSentContainer")[0];u&&(u.style.display="none");f&&(f.style.display="block");try{var e=new XMLHttpRequest,i=new FormData,h=DMUserIdentityHelper&&DMUserIdentityHelper.getGlobalUserId()||0,o=null;n.fileList&&n.fileList.length>0&&(o=n.fileList[0]);e.open("POST",t.DownvoteUrl,!0);i.append("adScreenshot",o);i.append("reason",s);i.append("DmGlobalUserId",h);e.send(i)}catch(c){console.log(c)}},it=function(n){var t,h,l,s,c,a,f,v;if(!r){if(n.preventDefault(),t=[],h=!1,window.clipboardData)t=window.clipboardData.files,h=!0;else if((n.clipboardData||n.originalEvent.clipboardData)&&(l=n.clipboardData||n.originalEvent.clipboardData,s=l&&l.items||[],t=[],s&&s.length>0))for(h=!0,c=0;c<s.length;c++)a=s[c],a.kind==="file"&&(t[t.length]=a.getAsFile());f=n.currentTarget.dropzoneFor;t&&t.length>0?(v=i(f),v&&(v.fileList=t),o(f),e(f)):h?(n.currentTarget.innerHTML="<br/><br/> No files found on clipboard <br/>",u(f)):(n.currentTarget.innerHTML="<br/><br/> Paste not supported on your browser <br/>",u(f))}},rt=function(n){var f,r,t;if(n.stopPropagation(),n.preventDefault(),f=i(n.currentTarget.dropzoneFor),r=[],n.dataTransfer.files&&n.dataTransfer.files.length>0)for(t=0;t<n.dataTransfer.files.length;t++)n.dataTransfer.files[t].type&&n.dataTransfer.files[t].type.indexOf("image")>=0&&(r[r.length]=n.dataTransfer.files[t]);r.length>0?(f&&(f.fileList=r),e(n.currentTarget.dropzoneFor),o(n.currentTarget.dropzoneFor)):(n.currentTarget.style.backgroundColor="yellow",n.currentTarget.innerHTML="<br/><br/>The dropped item was not an image",u(n.currentTarget.dropzoneFor))},a=function(n){for(var t,i=0;i<n.children.length;i++)t=n.children[i],t.nodeName.toLowerCase()==="img"&&t.style.display!=="none"&&t.src&&(t.style.display="none",ut(t.src,n))},ut=function(n,t){if(n){var f=n.indexOf(","),r=n.substring(0,f),h=r.indexOf(":"),c=r.indexOf(";"),l=r.substring(h+1,c),a=n.substring(f+1),v=ot(a,l,512),u=t.dropzoneFor,s=i(u);s&&(s.fileList=[v]);e(u);o(u)}},ft=function(){var n=document.createElement("div");return"draggable"in n||"ondragstart"in n&&"ondrop"in n},et=function(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1},i=function(t){for(var i=0,r=n.length;i<r;i++)if(n[i]&&n[i].adContainer&&n[i].adContainer.id===t)return n[i];return null},ot=function(n,t,i){var e,o,r,f,s,u,h;for(t=t||"",i=i||512,e=atob(n),o=[],r=0;r<e.length;r+=i){for(f=e.slice(r,r+i),s=new Array(f.length),u=0;u<f.length;u++)s[u]=f.charCodeAt(u);h=new Uint8Array(s);o.push(h)}return new Blob(o,{type:t})};return{appendAd:function(t){n.push(t)},init:function(i,u){n=i;t=u;s=ft();r=et();r&&window.MutationObserver&&(f=new MutationObserver(function(n){n.forEach(function(n){a(n.target)})}))},showAdReportingInterface:function(n){var t=i(n);t&&y(t)},setGlobalUserId:function(n){v=n}}}(),DMUserIdentityHelper=function(){var r,t,u="dmaduid",f="dmaduid_confirm",e,o,i=[],n=0,l=function(){return SendDmAdUid?navigator.cookieEnabled!==void 0?navigator.cookieEnabled:(document.cookie="testcookie=test; max-age=10000",document.cookie.indexOf("testcookie=test")>=0):!1},a=function(){var t=document.location.hostname,n=/([^.]+\.[^.]{3,})$/i.exec(t);return n?n[1]:(n=/([^.]+\.[^.]+\.[^.]{2})$/i.exec(t),n!==null?n[1]:t)},s=function(n,t,i,r,u,f){var e="",o;e=n+"="+t;i>0&&(o=new Date,o.setTime(o.getTime()+i*864e5))&&(e+="; expires="+o.toGMTString());r&&(e+="; path="+r);u&&u.indexOf(".")!==-1&&(e+="; domain="+u);f&&(e+="; secure");document.cookie=e},h=function(n){var r=document.cookie,u=null,t,i;if(r!=="")for(t=r.split(";"),index=0;index<t.length;index++)if(i=t[index].replace(/^\s+/,""),i.substring(0,n.length+1)===n+"="){u=i.substring(n.length+1);break}return u},v=function(n){var t=document.createElement("IFRAME");return t.width=1,t.height=1,t.src=e,t.id="DMGlobalUserIdetifierIFRAME",t.name="DMGlobalUserIdetifierIFRAME",t.style.display="none",document.body.appendChild(t),t.onload=n,t},y=function(){var i,l,n,a,e;if(r)if(i=h(u),l=h(f),!l&&JSON){if(n={},n.sender=location.href,n.Id=Math.random(),a=function(){o.contentWindow.postMessage(JSON.stringify(n),GlobalIdUrl)},e=function(i){var r=null,e;try{r=JSON.parse(i.data)}catch(o){}r&&r.Id&&r.Id===n.Id&&(e=r.DmGlobalUserId,s(u,e,365,"/",t,!1),s(f,r.DmGlobalUserConfirmResponse,365,"/",t,!1),c(e))},window.addEventListener)window.addEventListener("message",e,!1);else try{window.attachEvent("message",e)}catch(y){}o=v(a)}else i&&c(i)},c=function(t){for(n=t;i.length>0;){var r=i.pop();typeof r=="function"&&r()}};return{init:function(n){e=n;r=l();t=a();y()},getGlobalUserId:function(t){return n!==0?n:t?(i.push(t),n):void 0}}}(),DMAds={PageQueryTerms:"",PageTags:null,Tile:1,CurrentDocument:null,PublisherCode:"",PublisherPageViewID:0,PublisherPageViewGuid:null,CreateAdsCalled:!1,GetTermsCalled:!1,Ads:[],GPTRenderingMode:"loading",PIIViolatingUrls:["http://www.aspsnippets.com/handlers/comments.ashx","codeproject.com/script/membership/sendpassword.aspx","http://www.dailyfreecode.com/userlogin.aspx","codeproject.com/script/membership/modify.aspx","dotnetspider.com/account/login.aspx","codeproject.com/script/membership/logon.aspx"],SetQueryTerms:function(){function u(n){for(var i,u="",t=0;t<r.length;t++)if(i=r[t],n.indexOf(i.d)>=0){u=i.q;break}return u}function f(n,t){var r=t.toLowerCase().indexOf(n),u,i;return r<0||r+n.length>=t.length?"":(u=t.indexOf("&",r),u<0&&(u=t.length),i=t.substring(r+n.length,u),i=i.replace(/\+/gi," "),i=decodeURIComponent(i),i.replace(/\"/gi,""))}function e(n){if(n===undefined)return"";var t=n.replace(/^\s+|\s+$/gi,"");return t?(t=t.replace(/\bAND\b|\bNOT\b|^NOT\b|\bOR\b|[^A-Z0-9\+\-\#\._\s]+|\b[A-Z0-9]+:/gi," "),t.replace(/\s+/g," ")):""}var r=[{d:"www.google.",q:"q="},{d:"www.bing.com",q:"q="},{d:"search.live.com",q:"q="},{d:"search.yahoo.com",q:"p="},{d:"codeproject.com",q:"q="},{d:"msdn.microsoft.com",q:"query="},{d:"www.ask.com",q:"q="},{d:"yandex.com",q:"text="},{d:"yandex.ru",q:"text="},{d:"www.baidu.com",q:"wd="},{d:"localhost",q:"q="},{d:"mkyong.com",q:"q="},{d:"codeplex.com",q:"query="},{d:"aspsnippets.com",q:"q="},{d:"trirand.com",q:"s="}],i="",n=document.URL,t=u(n);if(t!==""&&(i=e(f(t,n))),i===""){if(n=document.referrer.toLocaleLowerCase(),!n)return"";t=u(n);t!==""&&(i=e(f(t,n)))}DMAds.PageQueryTerms=i},SetPageTagsAndPixels:function(n){var t,i,r,u;if(JSON){if(DMAds.GetTermsCalled){n&&n();return}DMAds.GetTermsCalled=!0;t=document.URL;t.indexOf("?")>0&&(t=t.substring(0,t.indexOf("?")));try{i=top.document.title}catch(f){i="FAILED TO GET DOCUMENT TITLE"}r={terms:DMAds.PageQueryTerms,title:i,url:t,publisher:DMAds.PublisherCode,DmGlobalUserId:DMUserIdentityHelper&&DMUserIdentityHelper.getGlobalUserId()||0,numberOfAdsOnPage:DMAds.Ads.length};u=function(t){if(t){var i;try{i=JSON.parse(t)}catch(r){}i&&(i.SearchTerms&&(DMAds.PageTags=i.SearchTerms),i.PublisherPageViewGuid&&(DMAds.PublisherPageViewGuid=i.PublisherPageViewGuid),i.aid&&i.aid.length&&i.aid.length>0&&DMAds.InsertAudiencePixels(i.aid))}DMAds.PublisherPageViewGuid||(DMAds.PublisherPageViewGuid=1);n&&n()};DMAds.POSTJson(SearchTermUrl,r,u,!0,500)}},InsertAudiencePixels:function(n){var t,i;try{for(t=0,i=n.length;t<i;t++){var r=Math.random()+"",u=r*1e13,f=new Image;f.src="https://pubads.g.doubleclick.net/activity;dc_iu=/6839/DFPAudiencePixel;ord="+u+";dc_seg="+n[t]+"?"}}catch(e){}},GetRandom:function(n,t){for(var u,i="",r=0;r<n;r++)u=Math.floor(Math.random()*t).toString(t).toUpperCase(),i=i+u;return i},POSTJson:function(n,t,i,r,u){var f;if(JSON&&(f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP"),f)){var s=!1,o=function(n){s||(s=!0,i&&i(n))},e=null;r&&(e=setTimeout(function(){try{f.abort()}catch(n){}o(null)},u));f.onreadystatechange=function(){try{f.readyState===4&&(e&&clearTimeout(e),f.status===200?o(f.responseText):o(null))}catch(n){e&&clearTimeout(e);o(null)}};try{f.open("POST",n,!0);f.setRequestHeader("Content-Type","application/json");f.send(JSON.stringify(t))}catch(h){e&&clearTimeout(e);o(null)}}},SignalSuccess:function(n){window.top&&window.top.postMessage&&setTimeout(function(){window.top.postMessage(n?"DM-enabled":"DM-disabled","*")},1e3)},CreateAds:function(n){this.PageRandomNumber=DMAds.GetRandom(32,16);var e=function(n){var t=DMAds.Ads[n];t.rendered=!0;DMAds.GPTRenderingMode==="weLoadedGPT"?DMAds.BuildGPTTag(t):DMAds.BuildInlineGPTTag(t)},l=function(n){var e=DMAds.Ads[n],h=e.theAdDiv,u=!1,i=0,r=0,t,f,o,s;try{t=h.getBoundingClientRect();typeof innerWidth=="number"?(i=window.innerWidth,r=window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?(i=document.documentElement.clientWidth,r=document.documentElement.clientHeight):document.body&&(document.body.clientWidth||document.body.clientHeight)&&(i=document.body.clientWidth,r=document.body.clientHeight);f=-200;t.top===t.bottom&&(f+=e.height*-1);o=t.top>=0&&t.top-200<=r||t.top<=0&&t.top>=f;s=i>t.left&&t.right>=0;u=o&&s}catch(c){u=!0}return u},t=function(){for(var t,i=0,n=0;n<DMAds.Ads.length;n++)t=DMAds.Ads[n],!t.rendered&&l(n)&&u(n)&&e(n),t.rendered&&(i++,t.sticky&&!t.stickySettings&&(t.stickySettings=s(t)),c(n));i===DMAds.Ads.length&&clearInterval(f)},o=function(){var n=function(){for(var c,i,r,o,s=EnableViewOnScroll,n=0;n<DMAds.Ads.length;n++)c=DMAds.Ads[n],c.rendered=!1,i=c.displayOverride,i==="onscroll"||i==="true"?s=!0:(i==="always"||i==="false")&&(s=!1),!s&&u(n)&&e(n);if(t(),window.addEventListener)window.addEventListener("resize",function(){t();h()},!1),window.addEventListener("scroll",t,!1);else try{window.attachEvent("onresize",function(){t();h()});window.attachEvent("onscroll",t)}catch(l){}for(a(),r=!1,o=0;o<DMAds.Ads.length&&!r;o++)if(r=!u(o),r)break;r&&(f=setInterval(t,100))};DMAds.GPTRenderingMode==="loading"?googletag.cmd.push(function(){n()}):n()},a=function(){var n=null;typeof document.hidden!="undefined"?n="visibilitychange":typeof document.mozHidden!="undefined"?n="mozvisibilitychange":typeof document.msHidden!="undefined"?n="msvisibilitychange":typeof document.webkitHidden!="undefined"&&(n="webkitvisibilitychange");n&&document.addEventListener&&document.addEventListener(n,t,!1)},s=function(n){var u=null,i,t;return n.adContainer&&(i=r(n.adContainer),t={},t.isStickyRequired=n.sticky&&n.sticky==="top",t.absoluteTop=i.y,t.absoluteLeft=i.x,t.absoluteTop!==-1&&(t.originalPosition=n.theAdDiv.style.position,u=t)),u},h=function(){for(i=0;i<DMAds.Ads.length;i++){var n=DMAds.Ads[i];n.stickySettings&&n.adContainer&&(n.adContainer.style.position=n.stickySettings.originalPosition,n.stickySettings=s(n),c(i))}},c=function(n){var t=DMAds.Ads[n].adContainer,i=DMAds.Ads[n].stickySettings,f=DMAds.Ads[n].theAdDiv,u,h,s;if(i&&i.isStickyRequired&&t.getBoundingClientRect&&document.getElementsByClassName){u=document.getElementsByClassName("sticky-stop")[0];u&&(h=r(u),s=u.getBoundingClientRect());var c=r(t),e=t.getBoundingClientRect(),o,l=c.y+e.height+Math.abs(e.top)>h.y;u&&l&&s.top<e.height?o=s.top-e.height+"px":window.pageYOffset+10>=i.absoluteTop&&(o="10px");o?(t.style.position="fixed",t.style.top=o,t.style.left=i.absoluteLeft-window.pageXOffset+"px",f.clientHeight===0&&(f.style.height=t.clientHeight+"px"),f.clientWidth===0&&(f.style.width=t.clientWidth+"px")):t.style.position=i.originalPosition}},r=function(n){var t={};if(t.x=-1,t.y=-1,n.getBoundingClientRect){var r=n.getBoundingClientRect(),i=document.documentElement,u=window.pageYOffset||i.scrollTop||document.body.scrollTop||0,f=window.pageXOffset||i.scrollLeft||document.body.scrollLeft||0,e=i.clientTop||document.body.clientTop||0,o=i.clientLeft||document.body.clientLeft||0;t.y=r.top+u-e;t.x=r.left+f-o}return t},u=function(n){var t=DMAds.Ads[n].theAdDiv,i=!1,r;return t&&t.style.position!=="fixed"&&t.offsetParent?i=!0:t&&t.style.position==="fixed"&&(r=window.getComputedStyle(t),i=r&&r.display!=="none"),i&&v()},v=function(){var t=!0,n="";return typeof document.hidden!="undefined"?n="hidden":typeof document.mozHidden!="undefined"?n="mozHidden":typeof document.msHidden!="undefined"?n="msHidden":typeof document.webkitHidden!="undefined"&&(n="webkitHidden"),n!==null&&document[n]&&(t=!1),t},f=f||null;n||DMAds.CreateAdsCalled?n&&(DMAds.Ads[DMAds.Ads.length]=DMAds.GetDivRequestData(n,DMAds.Ads.length-1),DMAds.PublisherCode=DMAds.Ads[0].publisher,DMAds.SetPageTagsAndPixels(o)):(DMAds.CreateAdsCalled=!0,DMAds.SetAdRequestData(),DMAds.Ads.length>0&&(DMAds.PublisherCode=DMAds.Ads[0].publisher,DMAds.SetPageTagsAndPixels(o)))},ShowAd:function(n){var t=DMAds.Ads,i;if(n&&(DMAds.GPTRenderingMode!=="weLoadedGPT"||!DMAds.PublisherPageViewGuid))t.push(n),DMAds.GetTermsCalled||(DMAds.PublisherCode=n.sitename,DMAds.SetPageTagsAndPixels(DMAds.ShowAd));else if(DMAds.GPTRenderingMode==="weLoadedGPT"&&DMAds.PublisherPageViewGuid){while(t&&t.length>0)i=t.pop(),DMAds.RequestQueuedAd(i);n&&DMAds.RequestQueuedAd(n)}},InitGPTLibrary:function(){if(googletag){var n=function(){if(googletag.pubadsReady)DMAds.GPTRenderingMode!=="weLoadedGPT"&&(DMAds.GPTRenderingMode="gptAlreadyLoaded");else{if(googletag.pubads().enableSingleRequest(),googletag.pubads().disableInitialLoad(),DMAds.Ads&&DMAds.Ads[0]&&typeof DMAds.Ads[0].cookieConsent!="undefined"){var n=DMAds.Ads[0].cookieConsent?1:0;googletag.pubads().setRequestNonPersonalizedAds(n?0:1)}googletag.pubads().enableAsyncRendering();googletag.enableServices();DMAds.GPTRenderingMode="weLoadedGPT";googletag.pubads().addEventListener("slotRenderEnded",function(n){DMAds.OnSlotRendered(n)})}};googletag.apiReady?n():googletag.cmd.push(function(){n()})}},BuildIFrameTag:function(n){var t=document.createElement("IFRAME"),i;return t.allowtransparency=!1,t.id="dm-gpt-iframe-"+n.tile,t.width=n.width,t.height=n.height,t.marginWidth=0,t.marginHeight=0,t.frameBorder=0,t.scrolling="no",i=encodeURIComponent(location.href),i.length<2048&&(t.dc_ref=i),t},BuildInlineGPTTagScript:function(n){var t="div-gpt-ad-"+n.publisher+"-"+n.zone+"-"+n.tile,i="/6839/"+n.publisher+"/"+n.zone,r="["+n.width+", "+n.height+"]",u=(n.tags||"")+","+(DMAds.PageSearchTerms||"")+","+(DMAds.PageQueryTerms||""),f=n.cookieConsent!==undefined,e=n.cookieConsent?1:0,o="<div id='"+t+"'>     <script type='text/javascript'>         googletag.cmd.push(function() {             if ( "+f+" && typeof googletag.pubads == 'function') {               googletag.pubads().setRequestNonPersonalizedAds("+e+" ? 0 : 1);            }            googletag.defineSlot('"+i+"', "+r+",'"+t+"')                 .addService(googletag.pubads())                 .setTargeting('kw', '"+u+"');             googletag.enableServices();             googletag.display('"+t+"');         });     <\/script> <\/div>";return"<script type='text/javascript'> var googletag = googletag || {}; googletag.cmd = googletag.cmd || []; (function() {     var gads = document.createElement('script');     gads.async = true;     gads.type = 'text/javascript';     var useSSL = 'https:' == document.location.protocol;     gads.src = (useSSL ? 'https:' : 'http:') + '//www.googletagservices.com/tag/js/gpt.js';     var node =document.getElementsByTagName('script')[0];     node.parentNode.insertBefore(gads, node); })(); <\/script>"+o},BuildGPTTag:function(n){var t=document.createElement("DIV"),i;t.style.height=n.height+"px";t.style.width=n.width+"px";t.style.boxSizing="border-box";t.style.border="0px";t.style.fontSize="0px";i="div-gpt-ad-"+n.publisher+"/"+n.zone+"-"+n.tile;t.id=i;t.adIndex=n.index;n.theAdDiv.appendChild(t);n.adContainer=t;googletag.cmd.push(function(){var u="/6839/"+n.publisher+"/"+n.zone,r=(n.tags||"")+","+(DMAds.PageSearchTerms||"")+","+(DMAds.PageQueryTerms||""),t;r=DMAds.EscapeSpecialCharacters({tags:r});t=googletag.defineSlot(u,[n.width,n.height],i).setTargeting("kw",r);n.articleid&&n.articleid>0&&t.setTargeting("articleid",n.articleid);t.addService(googletag.pubads());n.collapse_empty&&t.setCollapseEmptyDiv(!0,!0);googletag.display(i);googletag.pubads().refresh([t],{changeCorrelator:!1})})},RequestQueuedAd:function(n){googletag.cmd.push(function(){var r="/6839/"+n.sitename+"/"+n.zonename,i=(n.tags||"")+","+(DMAds.PageSearchTerms||""),t;i=DMAds.EscapeSpecialCharacters({tags:i});t=googletag.defineSlot(r,[n.width,n.height],n.targetDivId).setTargeting("kw",i);n.articleid&&n.articleid>0&&t.setTargeting("articleid",n.articleid);t.addService(googletag.pubads());n.collapse_empty&&t.setCollapseEmptyDiv(!0,!0);googletag.display(n.targetDivId);googletag.pubads().refresh([t],{changeCorrelator:!1})})},BuildInlineGPTTag:function(n){var t=DMAds.BuildIFrameTag(n),i;n.theAdDiv.appendChild(t);i=t.contentDocument||t.contentWindow.document||t.contentWindow.window.document;i.write(DMAds.BuildInlineGPTTagScript(n))},EscapeSpecialCharacters:function(n){var t=n.tags,i;t=t.replace(/\+/gi,"{plus}");t=t.replace(/\#/gi,"{sharp}");t=t.replace(/\./gi,"{dot}");t=t.replace(/[\#\*\.\(\)\+\<\>\[\]]/gi,"");for(var r=t.split(","),u=[];r.length>0;)i=r.shift(),/[^\u0020-\u007f]/.test(i)||u.push(i);return u.join(",")},GetArticleId:function(n){var t=0,i,r;if(n&&n===CodeProjectPublisherId)try{i="Articles";r=window.location.href.indexOf(i);r>=0&&(t=window.location.href.substring(r+i.length+1),t=t.substring(0,t.indexOf("/")),t=parseInt(t),isNaN(t)&&(t=0))}catch(u){t=0}return t},IsPagePIICompliant:function(){var t=!0,i,n,r;try{for(i=window.location.href.toLowerCase(),n=0,r=DMAds.PIIViolatingUrls.length;n<r&&t;n++)t=!(i.indexOf(DMAds.PIIViolatingUrls[n])>=0)}catch(u){console.log("Error in IsPagePIICompliant: "+u)}return t},OnSlotRendered:function(n){if(window.location.href&&window.location.href.includes("show_creative_id=1")&&n&&n.creativeId&&console.log(n.creativeId),EnableMutableAds&&n&&!n.isEmpty&&(!n.lineItemId||n.lineItemId&&n.lineItemId===0))DMAdXHelper.showAdReportingInterface(n.slot.getSlotElementId());else if(n&&n.isEmpty){var t=document.getElementById(n.slot.getSlotElementId());t.style.width="0px";t.style.height="0px";t.style.display="none"}DMAds.SignalSuccess(!0)},DetermineTagSize:function(n){if(n.format){var t=n.format.split("x");t.length===2&&(n.width=parseInt(t[0]),n.height=parseInt(t[1]))}},GetElementsByAttr:function(n,t,i,r){var o=[],u,e;i||(i=document);r||(r="*");var f=i.getElementsByTagName(r),s=f.length,h=new RegExp("(^|\\s)"+t+"(\\s|$)");for(u=0,e=0;u<s;u++)h.test(f[u].getAttribute(n))&&(o[e]=f[u],e++);return o},GetElementsByClass:function(n,t,i){var e=[],r,f;t||(t=document);i||(i="*");var u=t.getElementsByTagName(i),o=u.length,s=new RegExp("(^|\\s)"+n+"(\\s|$)");for(r=0,f=0;r<o;r++)s.test(u[r].className)&&(e[f]=u[r],f++);return e},SetAdRequestData:function(){var n=DMAds.GetElementsByAttr("data-type","ad",document,"div"),t;for((n===null||n.length<=0)&&(n=DMAds.GetElementsByClass("lqm_ad",document,"div")),t=0;t<n.length;t++)DMAds.Ads[DMAds.Ads.length]=DMAds.GetDivRequestData(n[t],t)},GetDivRequestData:function(n,t){for(var u,f,r,o=n.attributes,s=o.length,i={},e=0;e<s;e++)u=o.item(e),u.nodeName.indexOf("lqm_")===0&&(f=u.nodeName.slice(4),i[f]=u.value||u.nodeValue),u.nodeName.indexOf("data-")===0&&(f=u.nodeName.slice(5),i[f]=u.value||u.nodeValue);return r={height:0,width:0,publisher:i.publisher,zone:i.zone||"ros",site:i.site,tags:i.tags,sitename:undefined,zonename:undefined,target:"_blank",format:i.format,index:t,tile:t+1,type:i.type,noadx:i.noadx,collapse_empty:i.collapse_empty,displayOverride:i.display||i.loadOnView,sticky:i.sticky,charity:i.charity,cookieConsent:i.cookieconsent,theAdDiv:n},r.tags&&(r.tags=decodeURIComponent(r.tags)),DMAds.DetermineTagSize(r),r.publisher&&r.publisher===CodeProjectPublisherId&&(r.articleid=DMAds.GetArticleId(r.publisher)),r},SetupAds:function(){DMAds.IsPagePIICompliant()&&(DMAds.InitGPTLibrary(),DMAds.SetQueryTerms(),DMAdXHelper.init(DMAds.Ads,{DownvoteUrl:DownvoteUrl,UndoDownvoteUrl:UndoDownvoteUrl,ReportAdUrl:ReportAdUrl,CloseAdImageUrl:CloseAdImageUrl,UndoCloseAdImageUrl:UndoCloseAdImageUrl,DmLogoImageUrl:DmLogoImageUrl}),DMUserIdentityHelper.init(GlobalIdUrl),DMAds.CreateAds())},Initialise:function(){if(DMAds.IsPagePIICompliant())if(window.googletag)DMAds.SetupAds();else{var t="https:"===document.location.protocol,n=document.createElement("script");n.async=!0;n.type="text/javascript";n.src=(t?"https:":"http:")+"//www.googletagservices.com/tag/js/gpt.js";n.onload=this.SetupAds;document.body.appendChild(n)}}};window.DMAds=DMAds}if(DMAds.IsPagePIICompliant())if(window.addEventListener)window.addEventListener("load",function(){DMAds.Initialise()},!1);else try{window.attachEvent("onload",function(){DMAds.Initialise()})}catch(e){DMAds.Initialise()}</script><script async="" type="text/javascript" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/gpt.js"></script><script async="" type="text/javascript" src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/gpt.js"></script><div style="position: fixed; z-index: 9999; height: 289px;" id="credential_picker_container"><iframe src="COM%20in%20plain%20C,%20Part%205%20-%20CodeProject_files/select.html" title="Sign in with Google Dialog" style="height: 289px; width: 391px; overflow: hidden;"></iframe></div><canvas id="cv1" width="1px" height="1px" style="position:absolute;left:0;top:0;pointer-events:none"></canvas><canvas id="cv2" width="1px" height="1px" style="position:absolute;left:0;top:0;pointer-events:none"></canvas><div id="MemberProfilePopupDiv" class="raised box" style="display: none; position: absolute;"></div><div id="MemberProfilePopupDiv" class="raised box" style="display: none; position: absolute;"></div><div id="MemberProfilePopupDiv" class="raised box" style="display: none; position: absolute;"></div></body></html>